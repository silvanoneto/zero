module.exports=[108219,a=>{"use strict";var b=function(a,c){return(b=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(a,c)};function c(a,c){function d(){this.constructor=a}b(a,c),a.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}var d=function(){return(d=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};function e(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c}function f(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g}function g(a,b){return function(c,d){b(c,d,a)}}function h(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)}function i(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})}function j(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(f){return function(h){var i=[f,h];if(c)throw TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&i[0]?d.return:i[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,i[1])).done)return e;switch(d=0,e&&(i=[2&i[0],e.value]),i[0]){case 0:case 1:e=i;break;case 4:return g.label++,{value:i[1],done:!1};case 5:g.label++,d=i[1],i=[0];continue;case 7:i=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===i[0]||2===i[0])){g=0;continue}if(3===i[0]&&(!e||i[1]>e[0]&&i[1]<e[3])){g.label=i[1];break}if(6===i[0]&&g.label<e[1]){g.label=e[1],e=i;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(i);break}e[2]&&g.ops.pop(),g.trys.pop();continue}i=b.call(a,g)}catch(a){i=[6,a],d=0}finally{c=e=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}}}function k(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}function l(a,b){for(var c in a)"default"===c||b.hasOwnProperty(c)||(b[c]=a[c])}function m(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")}function o(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,e,f=c.call(a),g=[];try{for(;(void 0===b||b-- >0)&&!(d=f.next()).done;)g.push(d.value)}catch(a){e={error:a}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(e)throw e.error}}return g}function p(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(o(arguments[b]));return a}function q(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d}function r(a){return this instanceof r?(this.v=a,this):new r(a)}function s(a,b,c){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var d,e=c.apply(a,b||[]),f=[];return d={},g("next"),g("throw"),g("return"),d[Symbol.asyncIterator]=function(){return this},d;function g(a){e[a]&&(d[a]=function(b){return new Promise(function(c,d){f.push([a,b,c,d])>1||h(a,b)})})}function h(a,b){try{var c;(c=e[a](b)).value instanceof r?Promise.resolve(c.value.v).then(i,j):k(f[0][2],c)}catch(a){k(f[0][3],a)}}function i(a){h("next",a)}function j(a){h("throw",a)}function k(a,b){a(b),f.shift(),f.length&&h(f[0][0],f[0][1])}}function t(a){var b,c;return b={},d("next"),d("throw",function(a){throw a}),d("return"),b[Symbol.iterator]=function(){return this},b;function d(d,e){b[d]=a[d]?function(b){return(c=!c)?{value:r(a[d](b)),done:"return"===d}:e?e(b):b}:e}}function u(a){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var b,c=a[Symbol.asyncIterator];return c?c.call(a):(a=m(a),b={},d("next"),d("throw"),d("return"),b[Symbol.asyncIterator]=function(){return this},b);function d(c){b[c]=a[c]&&function(b){return new Promise(function(d,e){var f,g,h;f=d,g=e,h=(b=a[c](b)).done,Promise.resolve(b.value).then(function(a){f({value:a,done:h})},g)})}}}function v(a,b){return Object.defineProperty?Object.defineProperty(a,"raw",{value:b}):a.raw=b,a}function w(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function x(a){return a&&a.__esModule?a:{default:a}}function y(a,b){if(!b.has(a))throw TypeError("attempted to get private field on non-instance");return b.get(a)}function z(a,b,c){if(!b.has(a))throw TypeError("attempted to set private field on non-instance");return b.set(a,c),c}a.s(["__assign",()=>d,"__asyncDelegator",()=>t,"__asyncGenerator",()=>s,"__asyncValues",()=>u,"__await",()=>r,"__awaiter",()=>i,"__classPrivateFieldGet",()=>y,"__classPrivateFieldSet",()=>z,"__createBinding",()=>k,"__decorate",()=>f,"__exportStar",()=>l,"__extends",()=>c,"__generator",()=>j,"__importDefault",()=>x,"__importStar",()=>w,"__makeTemplateObject",()=>v,"__metadata",()=>h,"__param",()=>g,"__read",()=>o,"__rest",()=>e,"__spread",()=>p,"__spreadArrays",()=>q,"__values",()=>m])},708029,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.delay=void 0,c.delay=function(a){return new Promise(b=>{setTimeout(()=>{b(!0)},a)})}},145775,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ONE_THOUSAND=c.ONE_HUNDRED=void 0,c.ONE_HUNDRED=100,c.ONE_THOUSAND=1e3},159162,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ONE_YEAR=c.FOUR_WEEKS=c.THREE_WEEKS=c.TWO_WEEKS=c.ONE_WEEK=c.THIRTY_DAYS=c.SEVEN_DAYS=c.FIVE_DAYS=c.THREE_DAYS=c.ONE_DAY=c.TWENTY_FOUR_HOURS=c.TWELVE_HOURS=c.SIX_HOURS=c.THREE_HOURS=c.ONE_HOUR=c.SIXTY_MINUTES=c.THIRTY_MINUTES=c.TEN_MINUTES=c.FIVE_MINUTES=c.ONE_MINUTE=c.SIXTY_SECONDS=c.THIRTY_SECONDS=c.TEN_SECONDS=c.FIVE_SECONDS=c.ONE_SECOND=void 0,c.ONE_SECOND=1,c.FIVE_SECONDS=5,c.TEN_SECONDS=10,c.THIRTY_SECONDS=30,c.SIXTY_SECONDS=60,c.ONE_MINUTE=c.SIXTY_SECONDS,c.FIVE_MINUTES=5*c.ONE_MINUTE,c.TEN_MINUTES=10*c.ONE_MINUTE,c.THIRTY_MINUTES=30*c.ONE_MINUTE,c.SIXTY_MINUTES=60*c.ONE_MINUTE,c.ONE_HOUR=c.SIXTY_MINUTES,c.THREE_HOURS=3*c.ONE_HOUR,c.SIX_HOURS=6*c.ONE_HOUR,c.TWELVE_HOURS=12*c.ONE_HOUR,c.TWENTY_FOUR_HOURS=24*c.ONE_HOUR,c.ONE_DAY=c.TWENTY_FOUR_HOURS,c.THREE_DAYS=3*c.ONE_DAY,c.FIVE_DAYS=5*c.ONE_DAY,c.SEVEN_DAYS=7*c.ONE_DAY,c.THIRTY_DAYS=30*c.ONE_DAY,c.ONE_WEEK=c.SEVEN_DAYS,c.TWO_WEEKS=2*c.ONE_WEEK,c.THREE_WEEKS=3*c.ONE_WEEK,c.FOUR_WEEKS=4*c.ONE_WEEK,c.ONE_YEAR=365*c.ONE_DAY},553628,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(108219);d.__exportStar(a.r(145775),c),d.__exportStar(a.r(159162),c)},465290,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.fromMiliseconds=c.toMiliseconds=void 0;let d=a.r(553628);c.toMiliseconds=function(a){return a*d.ONE_THOUSAND},c.fromMiliseconds=function(a){return Math.floor(a/d.ONE_THOUSAND)}},486805,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(108219);d.__exportStar(a.r(708029),c),d.__exportStar(a.r(465290),c)},835315,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Watch=void 0;class d{constructor(){this.timestamps=new Map}start(a){if(this.timestamps.has(a))throw Error(`Watch already started for label: ${a}`);this.timestamps.set(a,{started:Date.now()})}stop(a){let b=this.get(a);if(void 0!==b.elapsed)throw Error(`Watch already stopped for label: ${a}`);let c=Date.now()-b.started;this.timestamps.set(a,{started:b.started,elapsed:c})}get(a){let b=this.timestamps.get(a);if(void 0===b)throw Error(`No timestamp found for label: ${a}`);return b}elapsed(a){let b=this.get(a);return b.elapsed||Date.now()-b.started}}c.Watch=d,c.default=d},229323,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.IWatch=void 0,c.IWatch=class{}},230635,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),a.r(108219).__exportStar(a.r(229323),c)},673620,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(108219);d.__exportStar(a.r(486805),c),d.__exportStar(a.r(835315),c),d.__exportStar(a.r(230635),c),d.__exportStar(a.r(553628),c)},679628,(a,b,c)=>{"use strict";function d(a){}function e(a){let b=d(a);if(!b)throw Error(`${a} is not defined in Window`);return b}Object.defineProperty(c,"__esModule",{value:!0}),c.getLocalStorage=c.getLocalStorageOrThrow=c.getCrypto=c.getCryptoOrThrow=c.getLocation=c.getLocationOrThrow=c.getNavigator=c.getNavigatorOrThrow=c.getDocument=c.getDocumentOrThrow=c.getFromWindowOrThrow=c.getFromWindow=void 0,c.getFromWindow=d,c.getFromWindowOrThrow=e,c.getDocumentOrThrow=function(){return e("document")},c.getDocument=function(){return d("document")},c.getNavigatorOrThrow=function(){return e("navigator")},c.getNavigator=function(){return d("navigator")},c.getLocationOrThrow=function(){return e("location")},c.getLocation=function(){return d("location")},c.getCryptoOrThrow=function(){return e("crypto")},c.getCrypto=function(){return d("crypto")},c.getLocalStorageOrThrow=function(){return e("localStorage")},c.getLocalStorage=function(){return d("localStorage")}},741721,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getWindowMetadata=void 0;let d=a.r(679628);c.getWindowMetadata=function(){let a,b,c;try{a=d.getDocumentOrThrow(),b=d.getLocationOrThrow()}catch(a){return null}function e(...b){let c=a.getElementsByTagName("meta");for(let a=0;a<c.length;a++){let d=c[a],e=["itemprop","property","name"].map(a=>d.getAttribute(a)).filter(a=>!!a&&b.includes(a));if(e.length&&e){let a=d.getAttribute("content");if(a)return a}}return""}let f=((c=e("name","og:site_name","og:title","twitter:title"))||(c=a.title),c),g=e("description","og:description","twitter:description","keywords"),h=b.origin;return{description:g,url:h,icons:function(){let c=a.getElementsByTagName("link"),d=[];for(let a=0;a<c.length;a++){let e=c[a],f=e.getAttribute("rel");if(f&&f.toLowerCase().indexOf("icon")>-1){let a=e.getAttribute("href");if(a)if(-1===a.toLowerCase().indexOf("https:")&&-1===a.toLowerCase().indexOf("http:")&&0!==a.indexOf("//")){let c=b.protocol+"//"+b.host;if(0===a.indexOf("/"))c+=a;else{let d=b.pathname.split("/");d.pop(),c+=d.join("/")+"/"+a}d.push(c)}else if(0===a.indexOf("//")){let c=b.protocol+a;d.push(c)}else d.push(a)}}return d}(),name:f}}},15388,611210,384815,570224,165782,934008,501060,a=>{"use strict";let b,c;var d,e=function(a,b,c){if(c||2==arguments.length)for(var d,e=0,f=b.length;e<f;e++)!d&&e in b||(d||(d=Array.prototype.slice.call(b,0,e)),d[e]=b[e]);return a.concat(d||Array.prototype.slice.call(b))},f=function(a,b,c){this.name=a,this.version=b,this.os=c,this.type="browser"},g=function(a){this.version=a,this.type="node",this.name="node",this.os=process.platform},h=function(a,b,c,d){this.name=a,this.version=b,this.os=c,this.bot=d,this.type="bot-device"},i=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},j=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},k=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,l=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],m=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function o(a){return a?p(a):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new j:"undefined"!=typeof navigator?p(navigator.userAgent):"undefined"!=typeof process&&process.version?new g(process.version.slice(1)):null}function p(a){var b=""!==a&&l.reduce(function(b,c){var d=c[0],e=c[1];if(b)return b;var f=e.exec(a);return!!f&&[d,f]},!1);if(!b)return null;var c=b[0],d=b[1];if("searchbot"===c)return new i;var g=d[1]&&d[1].split(".").join("_").split("_").slice(0,3);g?g.length<3&&(g=e(e([],g,!0),function(a){for(var b=[],c=0;c<a;c++)b.push("0");return b}(3-g.length),!0)):g=[];var j=g.join("."),o=function(a){for(var b=0,c=m.length;b<c;b++){var d=m[b],e=d[0];if(d[1].exec(a))return e}return null}(a),p=k.exec(a);return p&&p[1]?new h(c,j,o,p[1]):new f(c,j,o)}a.s(["detect",()=>o],15388);var q=a.i(666680);let r=q&&"object"==typeof q&&"webcrypto"in q?q.webcrypto:q&&"object"==typeof q&&"randomBytes"in q?q:void 0;function s(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function t(a,...b){if(!(a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function u(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function v(a,b){t(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}function w(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}function x(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function y(a,b){return a<<32-b|a>>>b}let z=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0]?a=>a:function(a){for(let c=0;c<a.length;c++){var b;a[c]=(b=a[c])<<24&0xff000000|b<<8&0xff0000|b>>>8&65280|b>>>24&255}return a};function A(a){return"string"==typeof a&&(a=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(a)),t(a),a}class B{}function C(a){let b=b=>a().update(A(b)).digest(),c=a();return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=()=>a(),b}function D(a=32){if(r&&"function"==typeof r.getRandomValues)return r.getRandomValues(new Uint8Array(a));if(r&&"function"==typeof r.randomBytes)return Uint8Array.from(r.randomBytes(a));throw Error("crypto.getRandomValues must be defined")}class E extends B{constructor(a,b,c,d){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.buffer=new Uint8Array(a),this.view=x(this.buffer)}update(a){u(this),t(a=A(a));let{view:b,buffer:c,blockLen:d}=this,e=a.length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=x(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){u(this),v(a,this),this.finished=!0;let{buffer:b,view:c,blockLen:d,isLE:e}=this,{pos:f}=this;b[f++]=128,w(this.buffer.subarray(f)),this.padOffset>d-f&&(this.process(c,0),f=0);for(let a=f;a<d;a++)b[a]=0;!function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)}(c,d-8,BigInt(8*this.length),e),this.process(c,0);let g=x(a),h=this.outputLen;if(h%4)throw Error("_sha2: outputLen should be aligned to 32bit");let i=h/4,j=this.get();if(i>j.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<i;a++)g.setUint32(4*a,j[a],e)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.destroyed=f,a.finished=e,a.length=d,a.pos=g,d%b&&a.buffer.set(c),a}clone(){return this._cloneInto()}}let F=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),G=Uint32Array.from([0xc1059ed8,0x367cd507,0x3070dd17,0xf70e5939,0xffc00b31,0x68581511,0x64f98fa7,0xbefa4fa4]),H=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),I=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),J=BigInt(0x100000000-1),K=BigInt(32);function L(a,b=!1){let c=a.length,d=new Uint32Array(c),e=new Uint32Array(c);for(let f=0;f<c;f++){let{h:c,l:g}=function(a,b=!1){return b?{h:Number(a&J),l:Number(a>>K&J)}:{h:0|Number(a>>K&J),l:0|Number(a&J)}}(a[f],b);[d[f],e[f]]=[c,g]}return[d,e]}let M=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),N=new Uint32Array(64);class O extends E{constructor(a=32){super(64,a,8,!1),this.A=0|F[0],this.B=0|F[1],this.C=0|F[2],this.D=0|F[3],this.E=0|F[4],this.F=0|F[5],this.G=0|F[6],this.H=0|F[7]}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)N[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=N[a-15],c=N[a-2],d=y(b,7)^y(b,18)^b>>>3,e=y(c,17)^y(c,19)^c>>>10;N[a]=e+N[a-7]+d+N[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,o;let b=j+(y(g,6)^y(g,11)^y(g,25))+((k=g)&h^~k&i)+M[a]+N[a]|0,p=(y(c,2)^y(c,13)^y(c,22))+((l=c)&(m=d)^l&(o=e)^m&o)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+p|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){w(N)}destroy(){this.set(0,0,0,0,0,0,0,0),w(this.buffer)}}let P=L(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),Q=P[0],R=P[1],S=new Uint32Array(80),T=new Uint32Array(80),U=C(()=>new O);class V extends B{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,function(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash should be wrapped by utils.createHasher");s(a.outputLen),s(a.blockLen)}(a);const c=A(b);if(this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const d=this.blockLen,e=new Uint8Array(d);e.set(c.length>d?a.create().update(c).digest():c);for(let a=0;a<e.length;a++)e[a]^=54;this.iHash.update(e),this.oHash=a.create();for(let a=0;a<e.length;a++)e[a]^=106;this.oHash.update(e),w(e)}update(a){return u(this),this.iHash.update(a),this}digestInto(a){u(this),t(a,this.outputLen),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||(a=Object.create(Object.getPrototypeOf(this),{}));let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let W=(a,b,c)=>new V(a,b).update(c).digest();W.create=(a,b)=>new V(a,b);let X=BigInt(0),Y=BigInt(1);function Z(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function $(a){if(!Z(a))throw Error("Uint8Array expected")}function _(a,b){if("boolean"!=typeof b)throw Error(a+" boolean expected, got "+b)}function aa(a){let b=a.toString(16);return 1&b.length?"0"+b:b}function ab(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?X:BigInt("0x"+a)}let ac="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,ad=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function ae(a){if($(a),ac)return a.toHex();let b="";for(let c=0;c<a.length;c++)b+=ad[a[c]];return b}function af(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function ag(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(ac)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=af(a.charCodeAt(e)),f=af(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function ah(a){return ab(ae(a))}function ai(a){return $(a),ab(ae(Uint8Array.from(a).reverse()))}function aj(a,b){return ag(a.toString(16).padStart(2*b,"0"))}function ak(a,b){return aj(a,b).reverse()}function al(a,b,c){let d;if("string"==typeof b)try{d=ag(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(Z(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}function am(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];$(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}let an=a=>"bigint"==typeof a&&X<=a;function ao(a,b,c){return an(a)&&an(b)&&an(c)&&b<=a&&a<c}function ap(a,b,c,d){if(!ao(b,c,d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}let aq=a=>(Y<<BigInt(a))-Y,ar=a=>new Uint8Array(a),as={bigint:a=>"bigint"==typeof a,function:a=>"function"==typeof a,boolean:a=>"boolean"==typeof a,string:a=>"string"==typeof a,stringOrUint8Array:a=>"string"==typeof a||Z(a),isSafeInteger:a=>Number.isSafeInteger(a),array:a=>Array.isArray(a),field:(a,b)=>b.Fp.isValid(a),hash:a=>"function"==typeof a&&Number.isSafeInteger(a.outputLen)};function at(a,b,c={}){let d=(b,c,d)=>{let e=as[c];if("function"!=typeof e)throw Error("invalid validator function");let f=a[b];if((!d||void 0!==f)&&!e(f,a))throw Error("param "+String(b)+" is invalid. Expected "+c+", got "+f)};for(let[a,c]of Object.entries(b))d(a,c,!1);for(let[a,b]of Object.entries(c))d(a,b,!0);return a}function au(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let av=BigInt(0),aw=BigInt(1),ax=BigInt(2),ay=BigInt(3),az=BigInt(4),aA=BigInt(5),aB=BigInt(8);function aC(a,b){let c=a%b;return c>=av?c:b+c}function aD(a,b,c){let d=a;for(;b-- >av;)d*=d,d%=c;return d}function aE(a,b){if(a===av)throw Error("invert: expected non-zero number");if(b<=av)throw Error("invert: expected positive modulus, got "+b);let c=aC(a,b),d=b,e=av,f=aw,g=aw,h=av;for(;c!==av;){let a=d/c,b=d%c,i=e-g*a,j=f-h*a;d=c,c=b,e=g,f=h,g=i,h=j}if(d!==aw)throw Error("invert: does not exist");return aC(e,b)}function aF(a,b){let c=(a.ORDER+aw)/az,d=a.pow(b,c);if(!a.eql(a.sqr(d),b))throw Error("Cannot find square root");return d}function aG(a,b){let c=(a.ORDER-aA)/aB,d=a.mul(b,ax),e=a.pow(d,c),f=a.mul(b,e),g=a.mul(a.mul(f,ax),e),h=a.mul(f,a.sub(g,a.ONE));if(!a.eql(a.sqr(h),b))throw Error("Cannot find square root");return h}let aH=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function aI(a){return at(a,aH.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"}))}function aJ(a,b,c=!1){let d=Array(b.length).fill(c?a.ZERO:void 0),e=b.reduce((b,c,e)=>a.is0(c)?b:(d[e]=b,a.mul(b,c)),a.ONE),f=a.inv(e);return b.reduceRight((b,c,e)=>a.is0(c)?b:(d[e]=a.mul(b,d[e]),a.mul(b,c)),f),d}function aK(a,b){let c=(a.ORDER-aw)/ax,d=a.pow(b,c),e=a.eql(d,a.ONE),f=a.eql(d,a.ZERO),g=a.eql(d,a.neg(a.ONE));if(!e&&!f&&!g)throw Error("invalid Legendre symbol result");return e?1:f?0:-1}function aL(a,b){void 0!==b&&s(b);let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function aM(a,b,c=!1,d={}){let e;if(a<=av)throw Error("invalid field: expected ORDER > 0, got "+a);let{nBitLength:f,nByteLength:g}=aL(a,b);if(g>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let h=Object.freeze({ORDER:a,isLE:c,BITS:f,BYTES:g,MASK:aq(f),ZERO:av,ONE:aw,create:b=>aC(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return av<=b&&b<a},is0:a=>a===av,isOdd:a=>(a&aw)===aw,neg:b=>aC(-b,a),eql:(a,b)=>a===b,sqr:b=>aC(b*b,a),add:(b,c)=>aC(b+c,a),sub:(b,c)=>aC(b-c,a),mul:(b,c)=>aC(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<av)throw Error("invalid exponent, negatives unsupported");if(c===av)return a.ONE;if(c===aw)return b;let d=a.ONE,e=b;for(;c>av;)c&aw&&(d=a.mul(d,e)),e=a.sqr(e),c>>=aw;return d})(h,a,b),div:(b,c)=>aC(b*aE(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>aE(b,a),sqrt:d.sqrt||(b=>(e||(e=a%az===ay?aF:a%aB===aA?aG:function(a){if(a<BigInt(3))throw Error("sqrt is not defined for small field");let b=a-aw,c=0;for(;b%ax===av;)b/=ax,c++;let d=ax,e=aM(a);for(;1===aK(e,d);)if(d++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===c)return aF;let f=e.pow(d,b),g=(b+aw)/ax;return function(a,d){if(a.is0(d))return d;if(1!==aK(a,d))throw Error("Cannot find square root");let e=c,h=a.mul(a.ONE,f),i=a.pow(d,b),j=a.pow(d,g);for(;!a.eql(i,a.ONE);){if(a.is0(i))return a.ZERO;let b=1,c=a.sqr(i);for(;!a.eql(c,a.ONE);)if(b++,c=a.sqr(c),b===e)throw Error("Cannot find square root");let d=aw<<BigInt(e-b-1),f=a.pow(h,d);e=b,h=a.sqr(f),i=a.mul(i,h),j=a.mul(j,f)}return j}}(a)),e(h,b))),toBytes:a=>c?ak(a,g):aj(a,g),fromBytes:a=>{if(a.length!==g)throw Error("Field.fromBytes: expected "+g+" bytes, got "+a.length);return c?ai(a):ah(a)},invertBatch:a=>aJ(h,a),cmov:(a,b,c)=>c?b:a});return Object.freeze(h)}function aN(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function aO(a){let b=aN(a);return b+Math.ceil(b/2)}let aP=BigInt(0),aQ=BigInt(1);function aR(a,b){let c=b.negate();return a?c:b}function aS(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function aT(a,b){aS(a,b);let c=Math.ceil(b/a)+1,d=2**(a-1),e=2**a;return{windows:c,windowSize:d,mask:aq(a),maxNumber:e,shiftBy:BigInt(a)}}function aU(a,b,c){let{windowSize:d,mask:e,maxNumber:f,shiftBy:g}=c,h=Number(a&e),i=a>>g;h>d&&(h-=f,i+=aQ);let j=b*d,k=j+Math.abs(h)-1,l=0===h;return{nextN:i,offset:k,isZero:l,isNeg:h<0,isNegF:b%2!=0,offsetF:j}}let aV=new WeakMap,aW=new WeakMap;function aX(a){return aW.get(a)||1}function aY(a){return aI(a.Fp),at(a,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...aL(a.n,a.nBitLength),...a,...{p:a.Fp.ORDER}})}function aZ(a){void 0!==a.lowS&&_("lowS",a.lowS),void 0!==a.prehash&&_("prehash",a.prehash)}let a$={Err:class extends Error{constructor(a=""){super(a)}},_tlv:{encode:(a,b)=>{let{Err:c}=a$;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(1&b.length)throw new c("tlv.encode: unpadded data");let d=b.length/2,e=aa(d);if(e.length/2&128)throw new c("tlv.encode: long form length too big");let f=d>127?aa(e.length/2|128):"";return aa(a)+f+e+b},decode(a,b){let{Err:c}=a$,d=0;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(b.length<2||b[d++]!==a)throw new c("tlv.decode: wrong tlv");let e=b[d++],f=0;if(128&e){let a=127&e;if(!a)throw new c("tlv.decode(long): indefinite length not supported");if(a>4)throw new c("tlv.decode(long): byte length is too big");let g=b.subarray(d,d+a);if(g.length!==a)throw new c("tlv.decode: length bytes not complete");if(0===g[0])throw new c("tlv.decode(long): zero leftmost byte");for(let a of g)f=f<<8|a;if(d+=a,f<128)throw new c("tlv.decode(long): not minimal encoding")}else f=e;let g=b.subarray(d,d+f);if(g.length!==f)throw new c("tlv.decode: wrong value length");return{v:g,l:b.subarray(d+f)}}},_int:{encode(a){let{Err:b}=a$;if(a<a_)throw new b("integer: negative integers are not allowed");let c=aa(a);if(8&Number.parseInt(c[0],16)&&(c="00"+c),1&c.length)throw new b("unexpected DER parsing assertion: unpadded hex");return c},decode(a){let{Err:b}=a$;if(128&a[0])throw new b("invalid signature integer: negative");if(0===a[0]&&!(128&a[1]))throw new b("invalid signature integer: unnecessary leading zero");return ah(a)}},toSig(a){let{Err:b,_int:c,_tlv:d}=a$,e=al("signature",a),{v:f,l:g}=d.decode(48,e);if(g.length)throw new b("invalid signature: left bytes after parsing");let{v:h,l:i}=d.decode(2,f),{v:j,l:k}=d.decode(2,i);if(k.length)throw new b("invalid signature: left bytes after parsing");return{r:c.decode(h),s:c.decode(j)}},hexFromSig(a){let{_tlv:b,_int:c}=a$,d=b.encode(2,c.encode(a.r)),e=b.encode(2,c.encode(a.s));return b.encode(48,d+e)}},a_=BigInt(0),a0=BigInt(1),a1=BigInt(2),a2=BigInt(3),a3=BigInt(4),a4=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),a5=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),a6=BigInt(0),a7=BigInt(1),a8=BigInt(2),a9=(a,b)=>(a+b/a8)/b,ba=aM(a4,void 0,void 0,{sqrt:function(a){let b=BigInt(3),c=BigInt(6),d=BigInt(11),e=BigInt(22),f=BigInt(23),g=BigInt(44),h=BigInt(88),i=a*a*a%a4,j=i*i*a%a4,k=aD(j,b,a4)*j%a4,l=aD(k,b,a4)*j%a4,m=aD(l,a8,a4)*i%a4,o=aD(m,d,a4)*m%a4,p=aD(o,e,a4)*o%a4,q=aD(p,g,a4)*p%a4,r=aD(q,h,a4)*q%a4,s=aD(r,g,a4)*p%a4,t=aD(s,b,a4)*j%a4,u=aD(t,f,a4)*o%a4,v=aD(u,c,a4)*i%a4,w=aD(v,a8,a4);if(!ba.eql(ba.sqr(w),a))throw Error("Cannot find square root");return w}}),bb=(d={a:a6,b:BigInt(7),Fp:ba,n:a5,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:a=>{let b=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),c=-a7*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),d=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),e=BigInt("0x100000000000000000000000000000000"),f=a9(b*a,a5),g=a9(-c*a,a5),h=aC(a-f*b-g*d,a5),i=aC(-f*c-g*b,a5),j=h>e,k=i>e;if(j&&(h=a5-h),k&&(i=a5-i),h>e||i>e)throw Error("splitScalar: Endomorphism failed, k="+a);return{k1neg:j,k1:h,k2neg:k,k2:i}}}},{...(b=a=>(function(a){let b,c=(at(b=aY(a),{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...b})),{Fp:d,n:e,nByteLength:f,nBitLength:g}=c,h=d.BYTES+1,i=2*d.BYTES+1;function j(a){return aC(a,e)}let{ProjectivePoint:k,normPrivateKeyToScalar:l,weierstrassEquation:m,isWithinCurveOrder:o}=function(a){var b;let c=function(a){let b=aY(a);at(b,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});let{endo:c,Fp:d,a:e}=b;if(c){if(!d.eql(e,d.ZERO))throw Error("invalid endo: CURVE.a must be 0");if("object"!=typeof c||"bigint"!=typeof c.beta||"function"!=typeof c.splitScalar)throw Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...b})}(a),{Fp:d}=c,e=aM(c.n,c.nBitLength),f=c.toBytes||((a,b,c)=>{let e=b.toAffine();return am(Uint8Array.from([4]),d.toBytes(e.x),d.toBytes(e.y))}),g=c.fromBytes||(a=>{let b=a.subarray(1);return{x:d.fromBytes(b.subarray(0,d.BYTES)),y:d.fromBytes(b.subarray(d.BYTES,2*d.BYTES))}});function h(a){let{a:b,b:e}=c,f=d.sqr(a),g=d.mul(f,a);return d.add(d.add(g,d.mul(a,b)),e)}function i(a,b){let c=d.sqr(b),e=h(a);return d.eql(c,e)}if(!i(c.Gx,c.Gy))throw Error("bad curve params: generator point");let j=d.mul(d.pow(c.a,a2),a3),k=d.mul(d.sqr(c.b),BigInt(27));if(d.is0(d.add(j,k)))throw Error("bad curve params: a or b");function l(a){let b,{allowedPrivateKeyLengths:d,nByteLength:e,wrapPrivateKey:f,n:g}=c;if(d&&"bigint"!=typeof a){if(Z(a)&&(a=ae(a)),"string"!=typeof a||!d.includes(a.length))throw Error("invalid private key");a=a.padStart(2*e,"0")}try{b="bigint"==typeof a?a:ah(al("private key",a,e))}catch(b){throw Error("invalid private key, expected hex or "+e+" bytes, got "+typeof a)}return f&&(b=aC(b,g)),ap("private key",b,a0,g),b}function m(a){if(!(a instanceof q))throw Error("ProjectivePoint expected")}let o=au((a,b)=>{let{px:c,py:e,pz:f}=a;if(d.eql(f,d.ONE))return{x:c,y:e};let g=a.is0();null==b&&(b=g?d.ONE:d.inv(f));let h=d.mul(c,b),i=d.mul(e,b),j=d.mul(f,b);if(g)return{x:d.ZERO,y:d.ZERO};if(!d.eql(j,d.ONE))throw Error("invZ was invalid");return{x:h,y:i}}),p=au(a=>{if(a.is0()){if(c.allowInfinityPoint&&!d.is0(a.py))return;throw Error("bad point: ZERO")}let{x:b,y:e}=a.toAffine();if(!d.isValid(b)||!d.isValid(e))throw Error("bad point: x or y not FE");if(!i(b,e))throw Error("bad point: equation left != right");if(!a.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});class q{constructor(a,b,c){if(null==a||!d.isValid(a))throw Error("x required");if(null==b||!d.isValid(b)||d.is0(b))throw Error("y required");if(null==c||!d.isValid(c))throw Error("z required");this.px=a,this.py=b,this.pz=c,Object.freeze(this)}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!d.isValid(b)||!d.isValid(c))throw Error("invalid affine point");if(a instanceof q)throw Error("projective point not allowed");let e=a=>d.eql(a,d.ZERO);return e(b)&&e(c)?q.ZERO:new q(b,c,d.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(a){let b=aJ(d,a.map(a=>a.pz));return a.map((a,c)=>a.toAffine(b[c])).map(q.fromAffine)}static fromHex(a){let b=q.fromAffine(g(al("pointHex",a)));return b.assertValidity(),b}static fromPrivateKey(a){return q.BASE.multiply(l(a))}static msm(a,b){return function(a,b,c,d){if(!Array.isArray(c))throw Error("array expected");c.forEach((b,c)=>{if(!(b instanceof a))throw Error("invalid point at index "+c)});if(!Array.isArray(d))throw Error("array of scalars expected");d.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)});let e=c.length,f=d.length;if(e!==f)throw Error("arrays of points and scalars must have equal length");let g=a.ZERO,h=function(a){let b;for(b=0;a>X;a>>=Y,b+=1);return b}(BigInt(e)),i=1;h>12?i=h-3:h>4?i=h-2:h>0&&(i=2);let j=aq(i),k=Array(Number(j)+1).fill(g),l=Math.floor((b.BITS-1)/i)*i,m=g;for(let a=l;a>=0;a-=i){k.fill(g);for(let b=0;b<f;b++){let e=Number(d[b]>>BigInt(a)&j);k[e]=k[e].add(c[b])}let b=g;for(let a=k.length-1,c=g;a>0;a--)c=c.add(k[a]),b=b.add(c);if(m=m.add(b),0!==a)for(let a=0;a<i;a++)m=m.double()}return m}(q,e,a,b)}_setWindowSize(a){t.setWindowSize(this,a)}assertValidity(){p(this)}hasEvenY(){let{y:a}=this.toAffine();if(d.isOdd)return!d.isOdd(a);throw Error("Field doesn't support isOdd")}equals(a){m(a);let{px:b,py:c,pz:e}=this,{px:f,py:g,pz:h}=a,i=d.eql(d.mul(b,h),d.mul(f,e)),j=d.eql(d.mul(c,h),d.mul(g,e));return i&&j}negate(){return new q(this.px,d.neg(this.py),this.pz)}double(){let{a,b}=c,e=d.mul(b,a2),{px:f,py:g,pz:h}=this,i=d.ZERO,j=d.ZERO,k=d.ZERO,l=d.mul(f,f),m=d.mul(g,g),o=d.mul(h,h),p=d.mul(f,g);return p=d.add(p,p),k=d.mul(f,h),k=d.add(k,k),i=d.mul(a,k),j=d.mul(e,o),j=d.add(i,j),i=d.sub(m,j),j=d.add(m,j),j=d.mul(i,j),i=d.mul(p,i),k=d.mul(e,k),o=d.mul(a,o),p=d.sub(l,o),p=d.mul(a,p),p=d.add(p,k),k=d.add(l,l),l=d.add(k,l),l=d.add(l,o),l=d.mul(l,p),j=d.add(j,l),o=d.mul(g,h),o=d.add(o,o),l=d.mul(o,p),i=d.sub(i,l),k=d.mul(o,m),k=d.add(k,k),new q(i,j,k=d.add(k,k))}add(a){m(a);let{px:b,py:e,pz:f}=this,{px:g,py:h,pz:i}=a,j=d.ZERO,k=d.ZERO,l=d.ZERO,o=c.a,p=d.mul(c.b,a2),r=d.mul(b,g),s=d.mul(e,h),t=d.mul(f,i),u=d.add(b,e),v=d.add(g,h);u=d.mul(u,v),v=d.add(r,s),u=d.sub(u,v),v=d.add(b,f);let w=d.add(g,i);return v=d.mul(v,w),w=d.add(r,t),v=d.sub(v,w),w=d.add(e,f),j=d.add(h,i),w=d.mul(w,j),j=d.add(s,t),w=d.sub(w,j),l=d.mul(o,v),j=d.mul(p,t),l=d.add(j,l),j=d.sub(s,l),l=d.add(s,l),k=d.mul(j,l),s=d.add(r,r),s=d.add(s,r),t=d.mul(o,t),v=d.mul(p,v),s=d.add(s,t),t=d.sub(r,t),t=d.mul(o,t),v=d.add(v,t),r=d.mul(s,v),k=d.add(k,r),r=d.mul(w,v),j=d.mul(u,j),j=d.sub(j,r),r=d.mul(u,s),l=d.mul(w,l),new q(j,k,l=d.add(l,r))}subtract(a){return this.add(a.negate())}is0(){return this.equals(q.ZERO)}wNAF(a){return t.wNAFCached(this,a,q.normalizeZ)}multiplyUnsafe(a){let{endo:b,n:e}=c;ap("scalar",a,a_,e);let f=q.ZERO;if(a===a_)return f;if(this.is0()||a===a0)return this;if(!b||t.hasPrecomputes(this))return t.wNAFCachedUnsafe(this,a,q.normalizeZ);let{k1neg:g,k1:h,k2neg:i,k2:j}=b.splitScalar(a),k=f,l=f,m=this;for(;h>a_||j>a_;)h&a0&&(k=k.add(m)),j&a0&&(l=l.add(m)),m=m.double(),h>>=a0,j>>=a0;return g&&(k=k.negate()),i&&(l=l.negate()),l=new q(d.mul(l.px,b.beta),l.py,l.pz),k.add(l)}multiply(a){let b,e,{endo:f,n:g}=c;if(ap("scalar",a,a0,g),f){let{k1neg:c,k1:g,k2neg:h,k2:i}=f.splitScalar(a),{p:j,f:k}=this.wNAF(g),{p:l,f:m}=this.wNAF(i);j=t.constTimeNegate(c,j),l=t.constTimeNegate(h,l),l=new q(d.mul(l.px,f.beta),l.py,l.pz),b=j.add(l),e=k.add(m)}else{let{p:c,f:d}=this.wNAF(a);b=c,e=d}return q.normalizeZ([b,e])[0]}multiplyAndAddUnsafe(a,b,c){let d=q.BASE,e=(a,b)=>b!==a_&&b!==a0&&a.equals(d)?a.multiply(b):a.multiplyUnsafe(b),f=e(this,b).add(e(a,c));return f.is0()?void 0:f}toAffine(a){return o(this,a)}isTorsionFree(){let{h:a,isTorsionFree:b}=c;if(a===a0)return!0;if(b)return b(q,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:a,clearCofactor:b}=c;return a===a0?this:b?b(q,this):this.multiplyUnsafe(c.h)}toRawBytes(a=!0){return _("isCompressed",a),this.assertValidity(),f(q,this,a)}toHex(a=!0){return _("isCompressed",a),ae(this.toRawBytes(a))}}q.BASE=new q(c.Gx,c.Gy,d.ONE),q.ZERO=new q(d.ZERO,d.ONE,d.ZERO);let{endo:r,nBitLength:s}=c,t=(b=r?Math.ceil(s/2):s,{constTimeNegate:aR,hasPrecomputes:a=>1!==aX(a),unsafeLadder(a,b,c=q.ZERO){let d=a;for(;b>aP;)b&aQ&&(c=c.add(d)),d=d.double(),b>>=aQ;return c},precomputeWindow(a,c){let{windows:d,windowSize:e}=aT(c,b),f=[],g=a,h=g;for(let a=0;a<d;a++){h=g,f.push(h);for(let a=1;a<e;a++)h=h.add(g),f.push(h);g=h.double()}return f},wNAF(a,c,d){let e=q.ZERO,f=q.BASE,g=aT(a,b);for(let a=0;a<g.windows;a++){let{nextN:b,offset:h,isZero:i,isNeg:j,isNegF:k,offsetF:l}=aU(d,a,g);d=b,i?f=f.add(aR(k,c[l])):e=e.add(aR(j,c[h]))}return{p:e,f}},wNAFUnsafe(a,c,d,e=q.ZERO){let f=aT(a,b);for(let a=0;a<f.windows&&d!==aP;a++){let{nextN:b,offset:g,isZero:h,isNeg:i}=aU(d,a,f);if(d=b,!h){let a=c[g];e=e.add(i?a.negate():a)}}return e},getPrecomputes(a,b,c){let d=aV.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&aV.set(b,c(d))),d},wNAFCached(a,b,c){let d=aX(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)},wNAFCachedUnsafe(a,b,c,d){let e=aX(a);return 1===e?this.unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)},setWindowSize(a,c){aS(c,b),aW.set(a,c),aV.delete(a)}});return{CURVE:c,ProjectivePoint:q,normPrivateKeyToScalar:l,weierstrassEquation:h,isWithinCurveOrder:function(a){return ao(a,a0,c.n)}}}({...c,toBytes(a,b,c){let e=b.toAffine(),f=d.toBytes(e.x);return(_("isCompressed",c),c)?am(Uint8Array.from([b.hasEvenY()?2:3]),f):am(Uint8Array.from([4]),f,d.toBytes(e.y))},fromBytes(a){let b=a.length,c=a[0],e=a.subarray(1);if(b===h&&(2===c||3===c)){let a,b=ah(e);if(!ao(b,a0,d.ORDER))throw Error("Point is not on curve");let f=m(b);try{a=d.sqrt(f)}catch(a){throw Error("Point is not on curve"+(a instanceof Error?": "+a.message:""))}return(1&c)==1!=((a&a0)===a0)&&(a=d.neg(a)),{x:b,y:a}}if(b===i&&4===c)return{x:d.fromBytes(e.subarray(0,d.BYTES)),y:d.fromBytes(e.subarray(d.BYTES,2*d.BYTES))};throw Error("invalid Point, expected length of "+h+", or uncompressed "+i+", got "+b)}}),p=(a,b,c)=>ah(a.slice(b,c));class q{constructor(a,b,c){ap("r",a,a0,e),ap("s",b,a0,e),this.r=a,this.s=b,null!=c&&(this.recovery=c),Object.freeze(this)}static fromCompact(a){return new q(p(a=al("compactSignature",a,2*f),0,f),p(a,f,2*f))}static fromDER(a){let{r:b,s:c}=a$.toSig(al("DER",a));return new q(b,c)}assertValidity(){}addRecoveryBit(a){return new q(this.r,this.s,a)}recoverPublicKey(a){let{r:b,s:f,recovery:g}=this,h=t(al("msgHash",a));if(null==g||![0,1,2,3].includes(g))throw Error("recovery id invalid");let i=2===g||3===g?b+c.n:b;if(i>=d.ORDER)throw Error("recovery id 2 or 3 invalid");let l=(1&g)==0?"02":"03",m=k.fromHex(l+ae(aj(i,d.BYTES))),o=aE(i,e),p=j(-h*o),q=j(f*o),r=k.BASE.multiplyAndAddUnsafe(m,p,q);if(!r)throw Error("point at infinify");return r.assertValidity(),r}hasHighS(){return this.s>e>>a0}normalizeS(){return this.hasHighS()?new q(this.r,j(-this.s),this.recovery):this}toDERRawBytes(){return ag(this.toDERHex())}toDERHex(){return a$.hexFromSig(this)}toCompactRawBytes(){return ag(this.toCompactHex())}toCompactHex(){return ae(aj(this.r,f))+ae(aj(this.s,f))}}function r(a){if("bigint"==typeof a)return!1;if(a instanceof k)return!0;let b=al("key",a).length,e=d.BYTES,g=e+1;if(!c.allowedPrivateKeyLengths&&f!==g)return b===g||b===2*e+1}let s=c.bits2int||function(a){if(a.length>8192)throw Error("input is too large");let b=ah(a),c=8*a.length-g;return c>0?b>>BigInt(c):b},t=c.bits2int_modN||function(a){return j(s(a))},u=aq(g);function v(a){return ap("num < 2^"+g,a,a_,u),aj(a,f)}let w={lowS:c.lowS,prehash:!1},x={lowS:c.lowS,prehash:!1};return k.BASE._setWindowSize(8),{CURVE:c,getPublicKey:function(a,b=!0){return k.fromPrivateKey(a).toRawBytes(b)},getSharedSecret:function(a,b,c=!0){if(!0===r(a))throw Error("first arg must be private key");if(!1===r(b))throw Error("second arg must be public key");return k.fromHex(b).multiply(l(a)).toRawBytes(c)},sign:function(a,b,f=w){let{seed:g,k2sig:h}=function(a,b,f=w){if(["recovered","canonical"].some(a=>a in f))throw Error("sign() legacy options not supported");let{hash:g,randomBytes:h}=c,{lowS:i,prehash:m,extraEntropy:p}=f;null==i&&(i=!0),a=al("msgHash",a),aZ(f),m&&(a=al("prehashed msgHash",g(a)));let r=t(a),u=l(b),x=[v(u),v(r)];if(null!=p&&!1!==p){let a=!0===p?h(d.BYTES):p;x.push(al("extraEntropy",a))}return{seed:am(...x),k2sig:function(a){var b;let c=s(a);if(!o(c))return;let d=aE(c,e),f=k.BASE.multiply(c).toAffine(),g=j(f.x);if(g===a_)return;let h=j(d*j(r+g*u));if(h===a_)return;let l=2*(f.x!==g)|Number(f.y&a0),m=h;return i&&h>e>>a0&&(m=(b=h)>e>>a0?j(-b):b,l^=1),new q(g,m,l)}}}(a,b,f);return(function(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=ar(a),e=ar(a),f=0,g=()=>{d.fill(1),e.fill(0),f=0},h=(...a)=>c(e,d,...a),i=(a=ar(0))=>{let b;if(e=h((b=[0],Uint8Array.from(b)),a),d=h(),0!==a.length){let b;e=h((b=[1],Uint8Array.from(b)),a),d=h()}},j=()=>{if(f++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(d=h()).slice();c.push(b),a+=d.length}return am(...c)};return(a,b)=>{let c;for(g(),i(a);!(c=b(j()));)i();return g(),c}})(c.hash.outputLen,c.nByteLength,c.hmac)(g,h)},verify:function(a,b,d,f=x){let g,h;b=al("msgHash",b),d=al("publicKey",d);let{lowS:i,prehash:l,format:m}=f;if(aZ(f),"strict"in f)throw Error("options.strict was renamed to lowS");if(void 0!==m&&"compact"!==m&&"der"!==m)throw Error("format must be compact or der");let o="string"==typeof a||Z(a),p=!o&&!m&&"object"==typeof a&&null!==a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!o&&!p)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");try{if(p&&(h=new q(a.r,a.s)),o){try{"compact"!==m&&(h=q.fromDER(a))}catch(a){if(!(a instanceof a$.Err))throw a}h||"der"===m||(h=q.fromCompact(a))}g=k.fromHex(d)}catch(a){return!1}if(!h||i&&h.hasHighS())return!1;l&&(b=c.hash(b));let{r,s}=h,u=t(b),v=aE(s,e),w=j(u*v),y=j(r*v),z=k.BASE.multiplyAndAddUnsafe(g,w,y)?.toAffine();return!!z&&j(z.x)===r},ProjectivePoint:k,Signature:q,utils:{isValidPrivateKey(a){try{return l(a),!0}catch(a){return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{let a=aO(c.n);return function(a,b,c=!1){let d=a.length,e=aN(b),f=aO(b);if(d<16||d<f||d>1024)throw Error("expected "+f+"-1024 bytes of input, got "+d);let g=aC(c?ai(a):ah(a),b-aw)+aw;return c?ak(g,e):aj(g,e)}(c.randomBytes(a),c.n)},precompute:(a=8,b=k.BASE)=>(b._setWindowSize(a),b.multiply(BigInt(3)),b)}}})({...d,hash:a,hmac:(b,...c)=>W(a,b,function(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];t(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}(...c)),randomBytes:D}))(U),create:b});bb.ProjectivePoint;let bc=(c=[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(a=>a.map(a=>BigInt(a))).map(a=>Array.from(a).reverse()),(a,b)=>{let[d,e,f,g]=c.map(b=>b.reduce((b,c)=>ba.add(ba.mul(b,a),c))),[h,i]=aJ(ba,[e,g],!0);return a=ba.mul(d,h),b=ba.mul(b,ba.mul(f,i)),{x:a,y:b}}),bd=function(a,b){if(aI(a),!a.isValid(b.A)||!a.isValid(b.B)||!a.isValid(b.Z))throw Error("mapToCurveSimpleSWU: invalid opts");let c=function(a,b){let c=a.ORDER,d=a_;for(let a=c-a0;a%a1===a_;a/=a1)d+=a0;let e=d,f=a1<<e-a0-a0,g=f*a1,h=(c-a0)/g,i=(h-a0)/a1,j=g-a0,k=a.pow(b,h),l=a.pow(b,(h+a0)/a1),m=(b,c)=>{let d=k,g=a.pow(c,j),h=a.sqr(g);h=a.mul(h,c);let m=a.mul(b,h);m=a.pow(m,i),m=a.mul(m,g),g=a.mul(m,c),h=a.mul(m,b);let o=a.mul(h,g);m=a.pow(o,f);let p=a.eql(m,a.ONE);g=a.mul(h,l),m=a.mul(o,d),h=a.cmov(g,h,p),o=a.cmov(m,o,p);for(let b=e;b>a0;b--){let c=b-a1;c=a1<<c-a0;let e=a.pow(o,c),f=a.eql(e,a.ONE);g=a.mul(h,d),d=a.mul(d,d),e=a.mul(o,d),h=a.cmov(g,h,f),o=a.cmov(e,o,f)}return{isValid:p,value:h}};if(a.ORDER%a3===a2){let c=(a.ORDER-a2)/a3,d=a.sqrt(a.neg(b));m=(b,e)=>{let f=a.sqr(e),g=a.mul(b,e);f=a.mul(f,g);let h=a.pow(f,c);h=a.mul(h,g);let i=a.mul(h,d),j=a.mul(a.sqr(h),e),k=a.eql(j,b),l=a.cmov(i,h,k);return{isValid:k,value:l}}}return m}(a,b.Z);if(!a.isOdd)throw Error("Fp.isOdd is not implemented!");return d=>{let e,f,g,h,i,j,k,l;e=a.sqr(d),e=a.mul(e,b.Z),f=a.sqr(e),f=a.add(f,e),g=a.add(f,a.ONE),g=a.mul(g,b.B),h=a.cmov(b.Z,a.neg(f),!a.eql(f,a.ZERO)),h=a.mul(h,b.A),f=a.sqr(g),j=a.sqr(h),i=a.mul(j,b.A),f=a.add(f,i),f=a.mul(f,g),j=a.mul(j,h),i=a.mul(j,b.B),f=a.add(f,i),k=a.mul(e,g);let{isValid:m,value:o}=c(f,j);l=a.mul(e,d),l=a.mul(l,o),k=a.cmov(k,g,m),l=a.cmov(l,o,m);let p=a.isOdd(d)===a.isOdd(l);l=a.cmov(a.neg(l),l,p);let q=aJ(a,[h],!0)[0];return{x:k=a.mul(k,q),y:l}}}(ba,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:ba.create(BigInt("-11"))});!function(a,b,c){if("function"!=typeof b)throw Error("mapToCurve() must be defined")}(bb.ProjectivePoint,a=>{let{x:b,y:c}=bd(ba.create(a[0]));return bc(b,c)},ba.ORDER);class be extends Error{constructor(a,b={}){const c=(()=>{if(b.cause instanceof be){if(b.cause.details)return b.cause.details;if(b.cause.shortMessage)return b.cause.shortMessage}return b.cause&&"details"in b.cause&&"string"==typeof b.cause.details?b.cause.details:b.cause?.message?b.cause.message:b.details})(),d=b.cause instanceof be&&b.cause.docsPath||b.docsPath,e=`https://oxlib.sh${d??""}`;super([a||"An error occurred.",...b.metaMessages?["",...b.metaMessages]:[],...c||d?["",c?`Details: ${c}`:void 0,d?`See: ${e}`:void 0]:[]].filter(a=>"string"==typeof a).join("\n"),b.cause?{cause:b.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:"ox@0.1.1"}),this.cause=b.cause,this.details=c,this.docs=e,this.docsPath=d,this.shortMessage=a}walk(a){return function a(b,c){return c?.(b)?b:b&&"object"==typeof b&&"cause"in b&&b.cause?a(b.cause,c):c?null:b}(this,a)}}function bf(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function bg(a,b){if(bq(a)>b)throw new bv({givenSize:bq(a),maxSize:b})}function bh(a,b={}){let{dir:c,size:d=32}=b;if(0===d)return a;let e=a.replace("0x","");if(e.length>2*d)throw new bx({size:Math.ceil(e.length/2),targetSize:d,type:"Hex"});return`0x${e["right"===c?"padEnd":"padStart"](2*d,"0")}`}function bi(a,b,c){return JSON.stringify(a,(a,c)=>"function"==typeof b?b(a,c):"bigint"==typeof c?c.toString()+"#__bigint":c,c)}let bj=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function bk(...a){return`0x${a.reduce((a,b)=>a+b.replace("0x",""),"")}`}function bl(a){return a instanceof Uint8Array?bm(a):Array.isArray(a)?bm(new Uint8Array(a)):a}function bm(a,b={}){let c="";for(let b=0;b<a.length;b++)c+=bj[a[b]];let d=`0x${c}`;return"number"==typeof b.size?(bg(d,b.size),bo(d,b.size)):d}function bn(a,b={}){var c;let d,{signed:e,size:f}=b,g=BigInt(a);f?d=e?(1n<<8n*BigInt(f)-1n)-1n:2n**(8n*BigInt(f))-1n:"number"==typeof a&&(d=BigInt(Number.MAX_SAFE_INTEGER));let h="bigint"==typeof d&&e?-d-1n:0;if(d&&g>d||g<h){let b="bigint"==typeof a?"n":"";throw new bs({max:d?`${d}${b}`:void 0,min:`${h}${b}`,signed:e,size:f,value:`${a}${b}`})}let i=(e&&g<0?(1n<<BigInt(8*f))+BigInt(g):g).toString(16),j=`0x${i}`;return f?(c=j,bh(c,{dir:"left",size:f})):j}function bo(a,b){return bh(a,{dir:"right",size:b})}function bp(a,b,c,d={}){let{strict:e}=d;if("number"==typeof b&&b>0&&b>bq(a)-1)throw new bw({offset:b,position:"start",size:bq(a)});let f=`0x${a.replace("0x","").slice((b??0)*2,(c??a.length)*2)}`;return e&&function(a,b,c){if("number"==typeof b&&"number"==typeof c&&bq(a)!==c-b)throw new bw({offset:c,position:"end",size:bq(a)})}(f,b,c),f}function bq(a){return Math.ceil((a.length-2)/2)}function br(a){return function(a,b={}){let{dir:c="left"}=b,d=a.replace("0x",""),e=0;for(let a=0;a<d.length-1;a++)if("0"===d["left"===c?a:d.length-a-1].toString())e++;else break;return"0"===(d="left"===c?d.slice(e):d.slice(0,d.length-e))?"0x":"right"===c&&d.length%2==1?`0x${d}0`:`0x${d}`}(a,{dir:"left"})}class bs extends be{constructor({max:a,min:b,signed:c,size:d,value:e}){super(`Number \`${e}\` is not in safe${d?` ${8*d}-bit`:""}${c?" signed":" unsigned"} integer range ${a?`(\`${b}\` to \`${a}\`)`:`(above \`${b}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class bt extends be{constructor(a){super(`Value \`${"object"==typeof a?bi(a):a}\` of type \`${typeof a}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class bu extends be{constructor(a){super(`Value \`${a}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}class bv extends be{constructor({givenSize:a,maxSize:b}){super(`Size cannot exceed \`${b}\` bytes. Given size: \`${a}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class bw extends be{constructor({offset:a,position:b,size:c}){super(`Slice ${"start"===b?"starting":"ending"} at offset \`${a}\` is out-of-bounds (size: \`${c}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}class bx extends be{constructor({size:a,targetSize:b,type:c}){super(`${c.charAt(0).toUpperCase()}${c.slice(1).toLowerCase()} size (\`${a}\`) exceeds padding size (\`${b}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}let by=new TextEncoder;function bz(a){var b;return a instanceof Uint8Array?a:"string"==typeof a?bA(a):(b=a)instanceof Uint8Array?b:new Uint8Array(b)}function bA(a,b={}){let{size:c}=b,d=a;c&&(bg(a,c),d=bo(a,c));let e=d.slice(2);e.length%2&&(e=`0${e}`);let f=e.length/2,g=new Uint8Array(f);for(let a=0,b=0;a<f;a++){let c=bf(e.charCodeAt(b++)),d=bf(e.charCodeAt(b++));if(void 0===c||void 0===d)throw new be(`Invalid byte sequence ("${e[b-2]}${e[b-1]}" in "${e}").`);g[a]=16*c+d}return g}class bB extends be{constructor(a){super(`Value \`${"object"==typeof a?bi(a):a}\` of type \`${typeof a}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class bC extends be{constructor({givenSize:a,maxSize:b}){super(`Size cannot exceed \`${b}\` bytes. Given size: \`${a}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class bD extends be{constructor({size:a,targetSize:b,type:c}){super(`${c.charAt(0).toUpperCase()}${c.slice(1).toLowerCase()} size (\`${a}\`) exceeds padding size (\`${b}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}let bE=2n**256n-1n;function bF(a,b={}){let{recovered:c}=b;if(void 0===a.r||void 0===a.s||c&&void 0===a.yParity)throw new b$({signature:a});if(a.r<0n||a.r>bE)throw new b_({value:a.r});if(a.s<0n||a.s>bE)throw new b0({value:a.s});if("number"==typeof a.yParity&&0!==a.yParity&&1!==a.yParity)throw new b1({value:a.yParity})}function bG(a){return bH(bm(a))}function bH(a){if(130!==a.length&&132!==a.length)throw new bZ({signature:a});let b=BigInt(bp(a,0,32)),c=BigInt(bp(a,32,64)),d=(()=>{let b=Number(`0x${a.slice(130)}`);if(!Number.isNaN(b))try{return bX(b)}catch{throw new b1({value:b})}})();return void 0===d?{r:b,s:c}:{r:b,s:c,yParity:d}}function bI(a){if(void 0!==a.r&&void 0!==a.s)return bJ(a)}function bJ(a){let b="string"==typeof a?bH(a):a instanceof Uint8Array?bG(a):"string"==typeof a.r?bN(a):a.v?bM(a):{r:a.r,s:a.s,...void 0!==a.yParity?{yParity:a.yParity}:{}};return bF(b),b}function bK(a){return bL(bm(a))}function bL(a){let{r:b,s:c}=bb.Signature.fromDER(bl(a).slice(2));return{r:b,s:c}}function bM(a){return{r:a.r,s:a.s,yParity:bX(a.v)}}function bN(a){let b=(()=>{let b=a.v?Number(a.v):void 0,c=a.yParity?Number(a.yParity):void 0;if("number"==typeof b&&"number"!=typeof c&&(c=bX(b)),"number"!=typeof c)throw new b1({value:a.yParity});return c})();return{r:BigInt(a.r),s:BigInt(a.s),yParity:b}}function bO(a){let[b,c,d]=a;return bJ({r:"0x"===c?0n:BigInt(c),s:"0x"===d?0n:BigInt(d),yParity:"0x"===b?0:Number(b)})}function bP(a){return bA(bQ(a))}function bQ(a){bF(a);let b=a.r,c=a.s;return bk(bn(b,{size:32}),bn(c,{size:32}),"number"==typeof a.yParity?bn(bY(a.yParity),{size:1}):"0x")}function bR(a){return new bb.Signature(a.r,a.s).toDERRawBytes()}function bS(a){let b=new bb.Signature(a.r,a.s);return`0x${b.toDERHex()}`}function bT(a){return{r:a.r,s:a.s,v:bY(a.yParity)}}function bU(a){let{r:b,s:c,yParity:d}=a;return{r:bn(b,{size:32}),s:bn(c,{size:32}),yParity:0===d?"0x0":"0x1"}}function bV(a){let{r:b,s:c,yParity:d}=a;return[d?"0x01":"0x",0n===b?"0x":br(bn(b)),0n===c?"0x":br(bn(c))]}function bW(a,b={}){try{return bF(a,b),!0}catch{return!1}}function bX(a){if(0===a||27===a)return 0;if(1===a||28===a)return 1;if(a>=35)return+(a%2==0);throw new b2({value:a})}function bY(a){if(0===a)return 27;if(1===a)return 28;throw new b1({value:a})}class bZ extends be{constructor({signature:a}){super(`Value \`${a}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${bq(bl(a))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class b$ extends be{constructor({signature:a}){super(`Signature \`${bi(a)}\` is missing either an \`r\`, \`s\`, or \`yParity\` property.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.MissingPropertiesError"})}}class b_ extends be{constructor({value:a}){super(`Value \`${a}\` is an invalid r value. r must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidRError"})}}class b0 extends be{constructor({value:a}){super(`Value \`${a}\` is an invalid s value. s must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSError"})}}class b1 extends be{constructor({value:a}){super(`Value \`${a}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class b2 extends be{constructor({value:a}){super(`Value \`${a}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}a.s(["InvalidRError",()=>b_,"InvalidSError",()=>b0,"InvalidSerializedSizeError",()=>bZ,"InvalidVError",()=>b2,"InvalidYParityError",()=>b1,"MissingPropertiesError",()=>b$,"assert",()=>bF,"extract",()=>bI,"from",()=>bJ,"fromBytes",()=>bG,"fromDerBytes",()=>bK,"fromDerHex",()=>bL,"fromHex",()=>bH,"fromLegacy",()=>bM,"fromRpc",()=>bN,"fromTuple",()=>bO,"toBytes",()=>bP,"toDerBytes",()=>bR,"toDerHex",()=>bS,"toHex",()=>bQ,"toLegacy",()=>bT,"toRpc",()=>bU,"toTuple",()=>bV,"vToYParity",()=>bX,"validate",()=>bW,"yParityToV",()=>bY],934671);var b3=a.i(934671);a.s(["Signature",0,b3],611210);class b4 extends Map{constructor(a){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=a}get(a){let b=super.get(a);return super.has(a)&&void 0!==b&&(this.delete(a),super.set(a,b)),b}set(a,b){if(super.set(a,b),this.maxSize&&this.size>this.maxSize){let a=this.keys().next().value;a&&this.delete(a)}return this}}let b5={checksum:new b4(8192)}.checksum,b6=Uint32Array.from([0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0]),b7=new Uint32Array(80);(a,b)=>Math.floor(0x100000000*Math.abs(Math.sin(b+1)));let b8=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),b9=Uint8Array.from(Array(16).fill(0).map((a,b)=>b)),ca=b9.map(a=>(9*a+5)%16),cb=(()=>{let a=[[b9],[ca]];for(let b=0;b<4;b++)for(let c of a)c.push(c[b].map(a=>b8[a]));return a})(),cc=cb[0],cd=cb[1],ce=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(a=>Uint8Array.from(a)),cf=cc.map((a,b)=>a.map(a=>ce[b][a])),cg=cd.map((a,b)=>a.map(a=>ce[b][a])),ch=Uint32Array.from([0,0x5a827999,0x6ed9eba1,0x8f1bbcdc,0xa953fd4e]),ci=Uint32Array.from([0x50a28be6,0x5c4dd124,0x6d703ef3,0x7a6d76e9,0]),cj=BigInt(0),ck=BigInt(1),cl=BigInt(2),cm=BigInt(7),cn=BigInt(256),co=BigInt(113),cp=[],cq=[],cr=[];for(let a=0,b=ck,c=1,d=0;a<24;a++){[c,d]=[d,(2*c+3*d)%5],cp.push(2*(5*d+c)),cq.push((a+1)*(a+2)/2%64);let e=cj;for(let a=0;a<7;a++)(b=(b<<ck^(b>>cm)*co)%cn)&cl&&(e^=ck<<(ck<<BigInt(a))-ck);cr.push(e)}let cs=L(cr,!0),ct=cs[0],cu=cs[1],cv=(a,b,c)=>c>32?b<<c-32|a>>>64-c:a<<c|b>>>32-c,cw=(a,b,c)=>c>32?a<<c-32|b>>>64-c:b<<c|a>>>32-c;class cx extends B{constructor(a,b,c,d=!1,e=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=a,this.suffix=b,this.outputLen=c,this.enableXOF=d,this.rounds=e,s(c),!(0<a&&a<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=function(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}(this.state)}clone(){return this._cloneInto()}keccak(){z(this.state32),function(a,b=24){let c=new Uint32Array(10);for(let d=24-b;d<24;d++){for(let b=0;b<10;b++)c[b]=a[b]^a[b+10]^a[b+20]^a[b+30]^a[b+40];for(let b=0;b<10;b+=2){let d=(b+8)%10,e=(b+2)%10,f=c[e],g=c[e+1],h=cv(f,g,1)^c[d],i=cw(f,g,1)^c[d+1];for(let c=0;c<50;c+=10)a[b+c]^=h,a[b+c+1]^=i}let b=a[2],e=a[3];for(let c=0;c<24;c++){let d=cq[c],f=cv(b,e,d),g=cw(b,e,d),h=cp[c];b=a[h],e=a[h+1],a[h]=f,a[h+1]=g}for(let b=0;b<50;b+=10){for(let d=0;d<10;d++)c[d]=a[b+d];for(let d=0;d<10;d++)a[b+d]^=~c[(d+2)%10]&c[(d+4)%10]}a[0]^=ct[d],a[1]^=cu[d]}w(c)}(this.state32,this.rounds),z(this.state32),this.posOut=0,this.pos=0}update(a){u(this),t(a=A(a));let{blockLen:b,state:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(b-this.pos,d-e);for(let b=0;b<f;b++)c[this.pos++]^=a[e++];this.pos===b&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:a,suffix:b,pos:c,blockLen:d}=this;a[c]^=b,(128&b)!=0&&c===d-1&&this.keccak(),a[d-1]^=128,this.keccak()}writeInto(a){u(this,!1),t(a),this.finish();let b=this.state,{blockLen:c}=this;for(let d=0,e=a.length;d<e;){this.posOut>=c&&this.keccak();let f=Math.min(c-this.posOut,e-d);a.set(b.subarray(this.posOut,this.posOut+f),d),this.posOut+=f,d+=f}return a}xofInto(a){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(a)}xof(a){return s(a),this.xofInto(new Uint8Array(a))}digestInto(a){if(v(a,this),this.finished)throw Error("digest() was already called");return this.writeInto(a),this.destroy(),a}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,w(this.state)}_cloneInto(a){let{blockLen:b,suffix:c,outputLen:d,rounds:e,enableXOF:f}=this;return a||(a=new cx(b,c,d,f,e)),a.state32.set(this.state32),a.pos=this.pos,a.posOut=this.posOut,a.finished=this.finished,a.rounds=e,a.suffix=c,a.outputLen=d,a.enableXOF=f,a.destroyed=this.destroyed,a}}let cy=C(()=>new cx(136,1,32));function cz(a,b={}){let{as:c="string"==typeof a?"Hex":"Bytes"}=b,d=cy(bz(a));return"Bytes"===c?d:bm(d)}function cA(a,b={}){let{compressed:c}=b,{prefix:d,x:e,y:f}=a;if(!1===c||"bigint"==typeof e&&"bigint"==typeof f){if(4!==d)throw new cF({prefix:d,cause:new cH});return}if(!0===c||"bigint"==typeof e&&void 0===f){if(3!==d&&2!==d)throw new cF({prefix:d,cause:new cG});return}throw new cE({publicKey:a})}function cB(a){let b=(()=>{if(function(a,b={}){let{strict:c=!1}=b;try{return!function(a,b={}){let{strict:c=!1}=b;if(!a||"string"!=typeof a)throw new bt(a);if(c&&!/^0x[0-9a-fA-F]*$/.test(a)||!a.startsWith("0x"))throw new bu(a)}(a,{strict:c}),!0}catch{return!1}}(a))return cC(a);if(function(a){try{if(!(a instanceof Uint8Array)&&(!a||"object"!=typeof a||!("BYTES_PER_ELEMENT"in a)||1!==a.BYTES_PER_ELEMENT||"Uint8Array"!==a.constructor.name))throw new bB(a);return!0}catch{return!1}}(a))return cC(bm(a));let{prefix:b,x:c,y:d}=a;return"bigint"==typeof c&&"bigint"==typeof d?{prefix:b??4,x:c,y:d}:{prefix:b,x:c}})();return cA(b),b}function cC(a){if(132!==a.length&&130!==a.length&&68!==a.length)throw new cI({publicKey:a});if(130===a.length)return{prefix:4,x:BigInt(bp(a,0,32)),y:BigInt(bp(a,32,64))};if(132===a.length){let b=Number(bp(a,0,1));return{prefix:b,x:BigInt(bp(a,1,33)),y:BigInt(bp(a,33,65))}}return{prefix:Number(bp(a,0,1)),x:BigInt(bp(a,1,33))}}function cD(a,b={}){cA(a);let{prefix:c,x:d,y:e}=a,{includePrefix:f=!0}=b;return bk(f?bn(c,{size:1}):"0x",bn(d,{size:32}),"bigint"==typeof e?bn(e,{size:32}):"0x")}class cE extends be{constructor({publicKey:a}){super(`Value \`${bi(a)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class cF extends be{constructor({prefix:a,cause:b}){super(`Prefix "${a}" is invalid.`,{cause:b}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class cG extends be{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class cH extends be{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}class cI extends be{constructor({publicKey:a}){super(`Value \`${a}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${bq(bl(a))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}}let cJ=/^0x[a-fA-F0-9]{40}$/;function cK(a,b={}){let{strict:c=!0}=b;if(!cJ.test(a))throw new cM({address:a,cause:new cN});if(c){if(a.toLowerCase()===a)return;if(cL(a)!==a)throw new cM({address:a,cause:new cO})}}function cL(a){if(b5.has(a))return b5.get(a);cK(a,{strict:!1});let b=a.substring(2).toLowerCase(),c=cz(function(a,b={}){let{size:c}=b,d=by.encode(a);if("number"==typeof c){var e;if(d.length>c)throw new bC({givenSize:d.length,maxSize:c});return e=d,function(a,b={}){let{dir:c,size:d=32}=b;if(0===d)return a;if(a.length>d)throw new bD({size:a.length,targetSize:d,type:"Bytes"});let e=new Uint8Array(d);for(let b=0;b<d;b++){let f="right"===c;e[f?b:d-b-1]=a[f?b:a.length-b-1]}return e}(e,{dir:"right",size:c})}return d}(b),{as:"Bytes"}),d=b.split("");for(let a=0;a<40;a+=2)c[a>>1]>>4>=8&&d[a]&&(d[a]=d[a].toUpperCase()),(15&c[a>>1])>=8&&d[a+1]&&(d[a+1]=d[a+1].toUpperCase());let e=`0x${d.join("")}`;return b5.set(a,e),e}class cM extends be{constructor({address:a,cause:b}){super(`Address "${a}" is invalid.`,{cause:b}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class cN extends be{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class cO extends be{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}function cP(a={}){let{as:b="Hex"}=a,c=cS({as:b}),d=cQ({privateKey:c});return{privateKey:c,publicKey:d}}function cQ(a){let{privateKey:b}=a;return cB(bb.ProjectivePoint.fromPrivateKey(bl(b).slice(2)))}function cR(a){let{as:b="Hex",privateKey:c,publicKey:d}=a,e=bb.ProjectivePoint.fromHex(cD(d).slice(2)).multiply(bb.utils.normPrivateKeyToScalar(bl(c).slice(2))).toRawBytes(!0);return"Hex"===b?bm(e):e}function cS(a={}){let{as:b="Hex"}=a,c=bb.utils.randomPrivateKey();return"Hex"===b?bm(c):c}function cT(a){return function(a,b={}){let c=cz(`0x${cD(a).slice(4)}`).substring(26);return function(a,b={}){let{checksum:c=!1}=b;return(cK(a),c)?cL(a):a}(`0x${c}`,b)}(cU(a))}function cU(a){let{payload:b,signature:c}=a,{r:d,s:e,yParity:f}=c;return cB(new bb.Signature(BigInt(d),BigInt(e)).addRecoveryBit(f).recoverPublicKey(bl(b).substring(2)))}function cV(a){let{extraEntropy:b=!1,hash:c,payload:d,privateKey:e}=a,{r:f,s:g,recovery:h}=bb.sign(bz(d),bz(e),{extraEntropy:"boolean"==typeof b?b:bl(b).slice(2),lowS:!0,...c?{prehash:!0}:{}});return{r:f,s:g,yParity:h}}function cW(a){let{address:b,hash:c,payload:d,publicKey:e,signature:f}=a;if(b){var g;return g=cT({payload:d,signature:f}),cK(b,{strict:!1}),cK(g,{strict:!1}),b.toLowerCase()===g.toLowerCase()}return bb.verify(f,bz(d),function(a,b={}){return bA(cD(a,b))}(e),...c?[{prehash:!0,lowS:!0}]:[])}a.s(["createKeyPair",()=>cP,"getPublicKey",()=>cQ,"getSharedSecret",()=>cR,"noble",0,bb,"randomPrivateKey",()=>cS,"recoverAddress",()=>cT,"recoverPublicKey",()=>cU,"sign",()=>cV,"verify",()=>cW],5494);var cX=a.i(5494);a.s(["Secp256k1",0,cX],384815);let cY=function(a){if(a.length>=255)throw TypeError("Alphabet too long");let b=new Uint8Array(256);for(let a=0;a<b.length;a++)b[a]=255;for(let c=0;c<a.length;c++){let d=a.charAt(c),e=d.charCodeAt(0);if(255!==b[e])throw TypeError(d+" is ambiguous");b[e]=c}let c=a.length,d=a.charAt(0),e=Math.log(c)/Math.log(256),f=Math.log(256)/Math.log(c);function g(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;let f=0,g=0,h=0;for(;a[f]===d;)g++,f++;let i=(a.length-f)*e+1>>>0,j=new Uint8Array(i);for(;f<a.length;){let d=a.charCodeAt(f);if(d>255)return;let e=b[d];if(255===e)return;let g=0;for(let a=i-1;(0!==e||g<h)&&-1!==a;a--,g++)e+=c*j[a]>>>0,j[a]=e%256>>>0,e=e/256>>>0;if(0!==e)throw Error("Non-zero carry");h=g,f++}let k=i-h;for(;k!==i&&0===j[k];)k++;let l=new Uint8Array(g+(i-k)),m=g;for(;k!==i;)l[m++]=j[k++];return l}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";let e=0,g=0,h=0,i=b.length;for(;h!==i&&0===b[h];)h++,e++;let j=(i-h)*f+1>>>0,k=new Uint8Array(j);for(;h!==i;){let a=b[h],d=0;for(let b=j-1;(0!==a||d<g)&&-1!==b;b--,d++)a+=256*k[b]>>>0,k[b]=a%c>>>0,a=a/c>>>0;if(0!==a)throw Error("Non-zero carry");g=d,h++}let l=j-g;for(;l!==j&&0===k[l];)l++;let m=d.repeat(e);for(;l<j;++l)m+=a.charAt(k[l]);return m},decodeUnsafe:g,decode:function(a){let b=g(a);if(b)return b;throw Error("Non-base"+c+" character")}}}("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");function cZ(a){return`${a<0?"-":""}0x${Math.abs(a).toString(16).padStart(2,"0")}`}a.s(["default",0,cY],570224);class c${constructor(a,b){this.type=a,this.data=b}}class c_ extends Error{constructor(a){super(a),Object.setPrototypeOf(this,Object.create(c_.prototype)),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:c_.name})}}function c0(a,b,c){let d=Math.floor(c/0x100000000);a.setUint32(b,d),a.setUint32(b+4,c)}function c1(a,b){return 0x100000000*a.getInt32(b)+a.getUint32(b+4)}let c2={type:-1,encode:function(a){if(!(a instanceof Date))return null;{let b,c,d,e;return function({sec:a,nsec:b}){if(a>=0&&b>=0&&a<=0x3ffffffff)if(0===b&&a<=0xffffffff){let b=new Uint8Array(4);return new DataView(b.buffer).setUint32(0,a),b}else{let c=a/0x100000000,d=new Uint8Array(8),e=new DataView(d.buffer);return e.setUint32(0,b<<2|3&c),e.setUint32(4,0|a),d}{let c=new Uint8Array(12),d=new DataView(c.buffer);return d.setUint32(0,b),c0(d,4,a),c}}((c=Math.floor((b=a.getTime())/1e3),e=Math.floor((d=(b-1e3*c)*1e6)/1e9),{sec:c+e,nsec:d-1e9*e}))}},decode:function(a){let b=function(a){let b=new DataView(a.buffer,a.byteOffset,a.byteLength);switch(a.byteLength){case 4:return{sec:b.getUint32(0),nsec:0};case 8:{let a=b.getUint32(0);return{sec:(3&a)*0x100000000+b.getUint32(4),nsec:a>>>2}}case 12:return{sec:c1(b,4),nsec:b.getUint32(0)};default:throw new c_(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${a.length}`)}}(a);return new Date(1e3*b.sec+b.nsec/1e6)}};class c3{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(c2)}register({type:a,encode:b,decode:c}){if(a>=0)this.encoders[a]=b,this.decoders[a]=c;else{let d=-1-a;this.builtInEncoders[d]=b,this.builtInDecoders[d]=c}}tryToEncode(a,b){for(let c=0;c<this.builtInEncoders.length;c++){let d=this.builtInEncoders[c];if(null!=d){let e=d(a,b);if(null!=e)return new c$(-1-c,e)}}for(let c=0;c<this.encoders.length;c++){let d=this.encoders[c];if(null!=d){let e=d(a,b);if(null!=e)return new c$(c,e)}}return a instanceof c$?a:null}decode(a,b,c){let d=b<0?this.builtInDecoders[-1-b]:this.decoders[b];return d?d(a,b,c):new c$(b,a)}}c3.defaultCodec=new c3;let c4=new TextEncoder;function c5(a,b,c){let d=b,e=d+c,f=[],g="";for(;d<e;){let b=a[d++];if((128&b)==0)f.push(b);else if((224&b)==192){let c=63&a[d++];f.push((31&b)<<6|c)}else if((240&b)==224){let c=63&a[d++],e=63&a[d++];f.push((31&b)<<12|c<<6|e)}else if((248&b)==240){let c=(7&b)<<18|(63&a[d++])<<12|(63&a[d++])<<6|63&a[d++];c>65535&&(c-=65536,f.push(c>>>10&1023|55296),c=56320|1023&c),f.push(c)}else f.push(b);f.length>=4096&&(g+=String.fromCharCode(...f),f.length=0)}return f.length>0&&(g+=String.fromCharCode(...f)),g}let c6=new TextDecoder;function c7(a){return a instanceof Uint8Array?a:ArrayBuffer.isView(a)?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&a instanceof SharedArrayBuffer?new Uint8Array(a):Uint8Array.from(a)}let c8="array",c9="map_key",da="map_value",db=a=>{if("string"==typeof a||"number"==typeof a)return a;throw new c_("The type of key must be string or number but "+typeof a)};class dc{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(a){let b=this.getUninitializedStateFromPool();b.type=c8,b.position=0,b.size=a,b.array=Array(a)}pushMapState(a){let b=this.getUninitializedStateFromPool();b.type=c9,b.readCount=0,b.size=a,b.map={}}getUninitializedStateFromPool(){return this.stackHeadPosition++,this.stackHeadPosition===this.stack.length&&this.stack.push({type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null}),this.stack[this.stackHeadPosition]}release(a){if(this.stack[this.stackHeadPosition]!==a)throw Error("Invalid stack state. Released state is not on top of the stack.");a.type===c8&&(a.size=0,a.array=void 0,a.position=0,a.type=void 0),(a.type===c9||a.type===da)&&(a.size=0,a.map=void 0,a.readCount=0,a.type=void 0),this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}let dd=new DataView(new ArrayBuffer(0)),de=new Uint8Array(dd.buffer);try{dd.getInt8(0)}catch(a){if(!(a instanceof RangeError))throw Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}let df=RangeError("Insufficient data"),dg=new class{constructor(a=16,b=16){this.hit=0,this.miss=0,this.maxKeyLength=a,this.maxLengthPerKey=b,this.caches=[];for(let a=0;a<this.maxKeyLength;a++)this.caches.push([])}canBeCached(a){return a>0&&a<=this.maxKeyLength}find(a,b,c){let d=this.caches[c-1];a:for(let e of d){let d=e.bytes;for(let e=0;e<c;e++)if(d[e]!==a[b+e])continue a;return e.str}return null}store(a,b){let c=this.caches[a.length-1],d={bytes:a,str:b};c.length>=this.maxLengthPerKey?c[Math.random()*c.length|0]=d:c.push(d)}decode(a,b,c){let d=this.find(a,b,c);if(null!=d)return this.hit++,d;this.miss++;let e=c5(a,b,c),f=Uint8Array.prototype.slice.call(a,b,b+c);return this.store(f,e),e}};class dh{constructor(a){this.totalPos=0,this.pos=0,this.view=dd,this.bytes=de,this.headByte=-1,this.stack=new dc,this.entered=!1,this.extensionCodec=a?.extensionCodec??c3.defaultCodec,this.context=a?.context,this.useBigInt64=a?.useBigInt64??!1,this.rawStrings=a?.rawStrings??!1,this.maxStrLength=a?.maxStrLength??0xffffffff,this.maxBinLength=a?.maxBinLength??0xffffffff,this.maxArrayLength=a?.maxArrayLength??0xffffffff,this.maxMapLength=a?.maxMapLength??0xffffffff,this.maxExtLength=a?.maxExtLength??0xffffffff,this.keyDecoder=a?.keyDecoder!==void 0?a.keyDecoder:dg,this.mapKeyConverter=a?.mapKeyConverter??db}clone(){return new dh({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=-1,this.stack.reset()}setBuffer(a){let b=c7(a);this.bytes=b,this.view=new DataView(b.buffer,b.byteOffset,b.byteLength),this.pos=0}appendBuffer(a){if(-1!==this.headByte||this.hasRemaining(1)){let b=this.bytes.subarray(this.pos),c=c7(a),d=new Uint8Array(b.length+c.length);d.set(b),d.set(c,b.length),this.setBuffer(d)}else this.setBuffer(a)}hasRemaining(a){return this.view.byteLength-this.pos>=a}createExtraByteError(a){let{view:b,pos:c}=this;return RangeError(`Extra ${b.byteLength-c} of ${b.byteLength} byte(s) found at buffer[${a}]`)}decode(a){if(this.entered)return this.clone().decode(a);try{this.entered=!0,this.reinitializeState(),this.setBuffer(a);let b=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return b}finally{this.entered=!1}}*decodeMulti(a){if(this.entered){let b=this.clone();yield*b.decodeMulti(a);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(a);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(a){if(this.entered)return this.clone().decodeAsync(a);try{let b;this.entered=!0;let c=!1;for await(let d of a){if(c)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(d);try{b=this.doDecodeSync(),c=!0}catch(a){if(!(a instanceof RangeError))throw a}this.totalPos+=this.pos}if(c){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return b}let{headByte:d,pos:e,totalPos:f}=this;throw RangeError(`Insufficient data in parsing ${cZ(d)} at ${f} (${e} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(a){return this.decodeMultiAsync(a,!0)}decodeStream(a){return this.decodeMultiAsync(a,!1)}async *decodeMultiAsync(a,b){if(this.entered){let c=this.clone();yield*c.decodeMultiAsync(a,b);return}try{this.entered=!0;let c=b,d=-1;for await(let e of a){if(b&&0===d)throw this.createExtraByteError(this.totalPos);this.appendBuffer(e),c&&(d=this.readArraySize(),c=!1,this.complete());try{for(;yield this.doDecodeSync(),0!=--d;);}catch(a){if(!(a instanceof RangeError))throw a}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){b:for(;;){let a,b=this.readHeadByte();if(b>=224)a=b-256;else if(b<192)if(b<128)a=b;else if(b<144){let c=b-128;if(0!==c){this.pushMapState(c),this.complete();continue}a={}}else if(b<160){let c=b-144;if(0!==c){this.pushArrayState(c),this.complete();continue}a=[]}else{let c=b-160;a=this.decodeString(c,0)}else if(192===b)a=null;else if(194===b)a=!1;else if(195===b)a=!0;else if(202===b)a=this.readF32();else if(203===b)a=this.readF64();else if(204===b)a=this.readU8();else if(205===b)a=this.readU16();else if(206===b)a=this.readU32();else if(207===b)a=this.useBigInt64?this.readU64AsBigInt():this.readU64();else if(208===b)a=this.readI8();else if(209===b)a=this.readI16();else if(210===b)a=this.readI32();else if(211===b)a=this.useBigInt64?this.readI64AsBigInt():this.readI64();else if(217===b){let b=this.lookU8();a=this.decodeString(b,1)}else if(218===b){let b=this.lookU16();a=this.decodeString(b,2)}else if(219===b){let b=this.lookU32();a=this.decodeString(b,4)}else if(220===b){let b=this.readU16();if(0!==b){this.pushArrayState(b),this.complete();continue}a=[]}else if(221===b){let b=this.readU32();if(0!==b){this.pushArrayState(b),this.complete();continue}a=[]}else if(222===b){let b=this.readU16();if(0!==b){this.pushMapState(b),this.complete();continue}a={}}else if(223===b){let b=this.readU32();if(0!==b){this.pushMapState(b),this.complete();continue}a={}}else if(196===b){let b=this.lookU8();a=this.decodeBinary(b,1)}else if(197===b){let b=this.lookU16();a=this.decodeBinary(b,2)}else if(198===b){let b=this.lookU32();a=this.decodeBinary(b,4)}else if(212===b)a=this.decodeExtension(1,0);else if(213===b)a=this.decodeExtension(2,0);else if(214===b)a=this.decodeExtension(4,0);else if(215===b)a=this.decodeExtension(8,0);else if(216===b)a=this.decodeExtension(16,0);else if(199===b){let b=this.lookU8();a=this.decodeExtension(b,1)}else if(200===b){let b=this.lookU16();a=this.decodeExtension(b,2)}else if(201===b){let b=this.lookU32();a=this.decodeExtension(b,4)}else throw new c_(`Unrecognized type byte: ${cZ(b)}`);this.complete();let c=this.stack;for(;c.length>0;){let b=c.top();if(b.type===c8)if(b.array[b.position]=a,b.position++,b.position===b.size)a=b.array,c.release(b);else continue b;else if(b.type===c9){if("__proto__"===a)throw new c_("The key __proto__ is not allowed");b.key=this.mapKeyConverter(a),b.type=da;continue b}else if(b.map[b.key]=a,b.readCount++,b.readCount===b.size)a=b.map,c.release(b);else{b.key=null,b.type=c9;continue b}}return a}}readHeadByte(){return -1===this.headByte&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=-1}readArraySize(){let a=this.readHeadByte();switch(a){case 220:return this.readU16();case 221:return this.readU32();default:if(a<160)return a-144;throw new c_(`Unrecognized array type byte: ${cZ(a)}`)}}pushMapState(a){if(a>this.maxMapLength)throw new c_(`Max length exceeded: map length (${a}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(a)}pushArrayState(a){if(a>this.maxArrayLength)throw new c_(`Max length exceeded: array length (${a}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(a)}decodeString(a,b){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(a,b):this.decodeBinary(a,b)}decodeUtf8String(a,b){let c;if(a>this.maxStrLength)throw new c_(`Max length exceeded: UTF-8 byte length (${a}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+b+a)throw df;let d=this.pos+b;return c=this.stateIsMapKey()&&this.keyDecoder?.canBeCached(a)?this.keyDecoder.decode(this.bytes,d,a):function(a,b,c){let d;if(!(c>200))return c5(a,b,c);return d=a.subarray(b,b+c),c6.decode(d)}(this.bytes,d,a),this.pos+=b+a,c}stateIsMapKey(){return this.stack.length>0&&this.stack.top().type===c9}decodeBinary(a,b){if(a>this.maxBinLength)throw new c_(`Max length exceeded: bin length (${a}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(a+b))throw df;let c=this.pos+b,d=this.bytes.subarray(c,c+a);return this.pos+=b+a,d}decodeExtension(a,b){if(a>this.maxExtLength)throw new c_(`Max length exceeded: ext length (${a}) > maxExtLength (${this.maxExtLength})`);let c=this.view.getInt8(this.pos+b),d=this.decodeBinary(a,b+1);return this.extensionCodec.decode(d,c,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){let a=this.view.getUint8(this.pos);return this.pos++,a}readI8(){let a=this.view.getInt8(this.pos);return this.pos++,a}readU16(){let a=this.view.getUint16(this.pos);return this.pos+=2,a}readI16(){let a=this.view.getInt16(this.pos);return this.pos+=2,a}readU32(){let a=this.view.getUint32(this.pos);return this.pos+=4,a}readI32(){let a=this.view.getInt32(this.pos);return this.pos+=4,a}readU64(){var a,b;let c=(a=this.view,b=this.pos,0x100000000*a.getUint32(b)+a.getUint32(b+4));return this.pos+=8,c}readI64(){let a=c1(this.view,this.pos);return this.pos+=8,a}readU64AsBigInt(){let a=this.view.getBigUint64(this.pos);return this.pos+=8,a}readI64AsBigInt(){let a=this.view.getBigInt64(this.pos);return this.pos+=8,a}readF32(){let a=this.view.getFloat32(this.pos);return this.pos+=4,a}readF64(){let a=this.view.getFloat64(this.pos);return this.pos+=8,a}}function di(a,b){return new dh(b).decode(a)}a.s(["decode",()=>di],165782);class dj{constructor(a){this.entered=!1,this.extensionCodec=a?.extensionCodec??c3.defaultCodec,this.context=a?.context,this.useBigInt64=a?.useBigInt64??!1,this.maxDepth=a?.maxDepth??100,this.initialBufferSize=a?.initialBufferSize??2048,this.sortKeys=a?.sortKeys??!1,this.forceFloat32=a?.forceFloat32??!1,this.ignoreUndefined=a?.ignoreUndefined??!1,this.forceIntegerToFloat=a?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new dj({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(a){if(this.entered)return this.clone().encodeSharedRef(a);try{return this.entered=!0,this.reinitializeState(),this.doEncode(a,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(a){if(this.entered)return this.clone().encode(a);try{return this.entered=!0,this.reinitializeState(),this.doEncode(a,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(a,b){if(b>this.maxDepth)throw Error(`Too deep objects in depth ${b}`);null==a?this.encodeNil():"boolean"==typeof a?this.encodeBoolean(a):"number"==typeof a?this.forceIntegerToFloat?this.encodeNumberAsFloat(a):this.encodeNumber(a):"string"==typeof a?this.encodeString(a):this.useBigInt64&&"bigint"==typeof a?this.encodeBigInt64(a):this.encodeObject(a,b)}ensureBufferSizeToWrite(a){let b=this.pos+a;this.view.byteLength<b&&this.resizeBuffer(2*b)}resizeBuffer(a){let b=new ArrayBuffer(a),c=new Uint8Array(b),d=new DataView(b);c.set(this.bytes),this.view=d,this.bytes=c}encodeNil(){this.writeU8(192)}encodeBoolean(a){!1===a?this.writeU8(194):this.writeU8(195)}encodeNumber(a){!this.forceIntegerToFloat&&Number.isSafeInteger(a)?a>=0?a<128?this.writeU8(a):a<256?(this.writeU8(204),this.writeU8(a)):a<65536?(this.writeU8(205),this.writeU16(a)):a<0x100000000?(this.writeU8(206),this.writeU32(a)):this.useBigInt64?this.encodeNumberAsFloat(a):(this.writeU8(207),this.writeU64(a)):a>=-32?this.writeU8(224|a+32):a>=-128?(this.writeU8(208),this.writeI8(a)):a>=-32768?(this.writeU8(209),this.writeI16(a)):a>=-0x80000000?(this.writeU8(210),this.writeI32(a)):this.useBigInt64?this.encodeNumberAsFloat(a):(this.writeU8(211),this.writeI64(a)):this.encodeNumberAsFloat(a)}encodeNumberAsFloat(a){this.forceFloat32?(this.writeU8(202),this.writeF32(a)):(this.writeU8(203),this.writeF64(a))}encodeBigInt64(a){a>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(a)):(this.writeU8(211),this.writeBigInt64(a))}writeStringHeader(a){if(a<32)this.writeU8(160+a);else if(a<256)this.writeU8(217),this.writeU8(a);else if(a<65536)this.writeU8(218),this.writeU16(a);else if(a<0x100000000)this.writeU8(219),this.writeU32(a);else throw Error(`Too long string: ${a} bytes in UTF-8`)}encodeString(a){let b=function(a){let b=a.length,c=0,d=0;for(;d<b;){let e=a.charCodeAt(d++);if((0xffffff80&e)==0){c++;continue}if((0xfffff800&e)==0)c+=2;else{if(e>=55296&&e<=56319&&d<b){let b=a.charCodeAt(d);(64512&b)==56320&&(++d,e=((1023&e)<<10)+(1023&b)+65536)}(0xffff0000&e)==0?c+=3:c+=4}}return c}(a);this.ensureBufferSizeToWrite(5+b),this.writeStringHeader(b),function(a,b,c){if(a.length>50)c4.encodeInto(a,b.subarray(c));else!function(a,b,c){let d=a.length,e=c,f=0;for(;f<d;){let c=a.charCodeAt(f++);if((0xffffff80&c)==0){b[e++]=c;continue}if((0xfffff800&c)==0)b[e++]=c>>6&31|192;else{if(c>=55296&&c<=56319&&f<d){let b=a.charCodeAt(f);(64512&b)==56320&&(++f,c=((1023&c)<<10)+(1023&b)+65536)}(0xffff0000&c)==0?b[e++]=c>>12&15|224:(b[e++]=c>>18&7|240,b[e++]=c>>12&63|128),b[e++]=c>>6&63|128}b[e++]=63&c|128}}(a,b,c)}(a,this.bytes,this.pos),this.pos+=b}encodeObject(a,b){let c=this.extensionCodec.tryToEncode(a,this.context);if(null!=c)this.encodeExtension(c);else if(Array.isArray(a))this.encodeArray(a,b);else if(ArrayBuffer.isView(a))this.encodeBinary(a);else if("object"==typeof a)this.encodeMap(a,b);else throw Error(`Unrecognized object: ${Object.prototype.toString.apply(a)}`)}encodeBinary(a){let b=a.byteLength;if(b<256)this.writeU8(196),this.writeU8(b);else if(b<65536)this.writeU8(197),this.writeU16(b);else if(b<0x100000000)this.writeU8(198),this.writeU32(b);else throw Error(`Too large binary: ${b}`);let c=c7(a);this.writeU8a(c)}encodeArray(a,b){let c=a.length;if(c<16)this.writeU8(144+c);else if(c<65536)this.writeU8(220),this.writeU16(c);else if(c<0x100000000)this.writeU8(221),this.writeU32(c);else throw Error(`Too large array: ${c}`);for(let c of a)this.doEncode(c,b+1)}countWithoutUndefined(a,b){let c=0;for(let d of b)void 0!==a[d]&&c++;return c}encodeMap(a,b){let c=Object.keys(a);this.sortKeys&&c.sort();let d=this.ignoreUndefined?this.countWithoutUndefined(a,c):c.length;if(d<16)this.writeU8(128+d);else if(d<65536)this.writeU8(222),this.writeU16(d);else if(d<0x100000000)this.writeU8(223),this.writeU32(d);else throw Error(`Too large map object: ${d}`);for(let d of c){let c=a[d];this.ignoreUndefined&&void 0===c||(this.encodeString(d),this.doEncode(c,b+1))}}encodeExtension(a){if("function"==typeof a.data){let b=a.data(this.pos+6),c=b.length;if(c>=0x100000000)throw Error(`Too large extension object: ${c}`);this.writeU8(201),this.writeU32(c),this.writeI8(a.type),this.writeU8a(b);return}let b=a.data.length;if(1===b)this.writeU8(212);else if(2===b)this.writeU8(213);else if(4===b)this.writeU8(214);else if(8===b)this.writeU8(215);else if(16===b)this.writeU8(216);else if(b<256)this.writeU8(199),this.writeU8(b);else if(b<65536)this.writeU8(200),this.writeU16(b);else if(b<0x100000000)this.writeU8(201),this.writeU32(b);else throw Error(`Too large extension object: ${b}`);this.writeI8(a.type),this.writeU8a(a.data)}writeU8(a){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,a),this.pos++}writeU8a(a){let b=a.length;this.ensureBufferSizeToWrite(b),this.bytes.set(a,this.pos),this.pos+=b}writeI8(a){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,a),this.pos++}writeU16(a){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,a),this.pos+=2}writeI16(a){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,a),this.pos+=2}writeU32(a){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,a),this.pos+=4}writeI32(a){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,a),this.pos+=4}writeF32(a){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,a),this.pos+=4}writeF64(a){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,a),this.pos+=8}writeU64(a){var b,c;this.ensureBufferSizeToWrite(8),b=this.view,c=this.pos,b.setUint32(c,a/0x100000000),b.setUint32(c+4,a),this.pos+=8}writeI64(a){this.ensureBufferSizeToWrite(8),c0(this.view,this.pos,a),this.pos+=8}writeBigUint64(a){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,a),this.pos+=8}writeBigInt64(a){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,a),this.pos+=8}}function dk(a,b){return new dj(b).encodeSharedRef(a)}function dl(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function dm(a,b){return!!Array.isArray(b)&&(0===b.length||(a?b.every(a=>"string"==typeof a):b.every(a=>Number.isSafeInteger(a))))}function dn(a){if("function"!=typeof a)throw Error("function expected");return!0}function dp(a,b){if("string"!=typeof b)throw Error(`${a}: string expected`);return!0}function dq(a){if(!Number.isSafeInteger(a))throw Error(`invalid integer: ${a}`)}function dr(a){if(!Array.isArray(a))throw Error("array expected")}function ds(a,b){if(!dm(!0,b))throw Error(`${a}: array of strings expected`)}function dt(a,b){if(!dm(!1,b))throw Error(`${a}: array of numbers expected`)}function du(...a){let b=a=>a,c=(a,b)=>c=>a(b(c));return{encode:a.map(a=>a.encode).reduceRight(c,b),decode:a.map(a=>a.decode).reduce(c,b)}}function dv(a){let b="string"==typeof a?a.split(""):a,c=b.length;ds("alphabet",b);let d=new Map(b.map((a,b)=>[a,b]));return{encode:d=>(dr(d),d.map(d=>{if(!Number.isSafeInteger(d)||d<0||d>=c)throw Error(`alphabet.encode: digit index outside alphabet "${d}". Allowed: ${a}`);return b[d]})),decode:b=>(dr(b),b.map(b=>{dp("alphabet.decode",b);let c=d.get(b);if(void 0===c)throw Error(`Unknown letter: "${b}". Allowed: ${a}`);return c}))}}function dw(a=""){return dp("join",a),{encode:b=>(ds("join.decode",b),b.join(a)),decode:b=>(dp("join.decode",b),b.split(a))}}function dx(a,b,c){if(b<2)throw Error(`convertRadix: invalid from=${b}, base cannot be less than 2`);if(c<2)throw Error(`convertRadix: invalid to=${c}, base cannot be less than 2`);if(dr(a),!a.length)return[];let d=0,e=[],f=Array.from(a,a=>{if(dq(a),a<0||a>=b)throw Error(`invalid integer: ${a}`);return a}),g=f.length;for(;;){let a=0,h=!0;for(let e=d;e<g;e++){let g=f[e],i=b*a,j=i+g;if(!Number.isSafeInteger(j)||i/b!==a||j-g!==i)throw Error("convertRadix: carry overflow");let k=j/c;a=j%c;let l=Math.floor(k);if(f[e]=l,!Number.isSafeInteger(l)||l*c+a!==j)throw Error("convertRadix: carry overflow");h&&(l?h=!1:d=e)}if(e.push(a),h)break}for(let b=0;b<a.length-1&&0===a[b];b++)e.push(0);return e.reverse()}a.s(["encode",()=>dk],934008);let dy=(a,b)=>0===b?a:dy(b,a%b),dz=(a,b)=>a+(b-dy(a,b)),dA=(()=>{let a=[];for(let b=0;b<40;b++)a.push(2**b);return a})();function dB(a,b,c,d){if(dr(a),b<=0||b>32)throw Error(`convertRadix2: wrong from=${b}`);if(c<=0||c>32)throw Error(`convertRadix2: wrong to=${c}`);if(dz(b,c)>32)throw Error(`convertRadix2: carry overflow from=${b} to=${c} carryBits=${dz(b,c)}`);let e=0,f=0,g=dA[b],h=dA[c]-1,i=[];for(let d of a){if(dq(d),d>=g)throw Error(`convertRadix2: invalid data word=${d} from=${b}`);if(e=e<<b|d,f+b>32)throw Error(`convertRadix2: carry overflow pos=${f} from=${b}`);for(f+=b;f>=c;f-=c)i.push((e>>f-c&h)>>>0);let a=dA[f];if(void 0===a)throw Error("invalid carry");e&=a-1}if(e=e<<c-f&h,!d&&f>=b)throw Error("Excess padding");if(!d&&e>0)throw Error(`Non-zero padding: ${e}`);return d&&f>0&&i.push(e>>>0),i}let dC=du(function(a,b=!1){dq(5),!1;if(dz(8,5)>32||dz(5,8)>32)throw Error("radix2: carry overflow");return{encode:a=>{if(!dl(a))throw Error("radix2.encode input should be Uint8Array");return dB(Array.from(a),8,5,!b)},decode:a=>(dt("radix2.decode",a),Uint8Array.from(dB(a,5,8,b)))}}(5),dv("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),function(a,b="="){return dq(5),dp("padding",b),{encode(a){for(ds("padding.encode",a);5*a.length%8;)a.push(b);return a},decode(a){ds("padding.decode",a);let c=a.length;if(5*c%8)throw Error("padding: invalid, string should have whole number of bytes");for(;c>0&&a[c-1]===b;c--)if((c-1)*5%8==0)throw Error("padding: invalid, string has too much padding");return a.slice(0,c)}}}(5),dw("")),dD="function"==typeof Uint8Array.from([]).toBase64&&"function"==typeof Uint8Array.fromBase64;dq(58);"function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex||dn(a=>{if("string"!=typeof a||a.length%2!=0)throw TypeError(`hex.decode: expected string, got ${typeof a} with length ${a.length}`);return a.toLowerCase()}),a.s(["base32",0,dC],501060)},920275,a=>{"use strict";function b(a){if("string"!=typeof a)throw Error(`Cannot safe json parse value of type ${typeof a}`);try{return JSON.parse(a.replace(/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,'$1"$2n"$3'),(a,b)=>"string"==typeof b&&b.match(/^\d+n$/)?BigInt(b.substring(0,b.length-1)):b)}catch(b){return a}}function c(a){return"string"==typeof a?a:JSON.stringify(a,(a,b)=>"bigint"==typeof b?b.toString()+"n":b)||""}a.s(["safeJsonParse",()=>b,"safeJsonStringify",()=>c])},832819,a=>{"use strict";let b,c;var d,e=a.i(673620),f=a.i(920275);function g(a,...b){if(!(a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function h(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}let i="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,j=a=>new DataView(a.buffer,a.byteOffset,a.byteLength);function k(a){return"string"==typeof a&&(a=function(a){if("string"!=typeof a)throw Error("utf8ToBytes expected string, got "+typeof a);return new Uint8Array(new TextEncoder().encode(a))}(a)),g(a),a}class l{clone(){return this._cloneInto()}}function m(a=32){if(i&&"function"==typeof i.getRandomValues)return i.getRandomValues(new Uint8Array(a));if(i&&"function"==typeof i.randomBytes)return i.randomBytes(a);throw Error("crypto.getRandomValues must be defined")}class o extends l{constructor(a,b,c,d){super(),this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(a),this.view=j(this.buffer)}update(a){h(this);let{view:b,buffer:c,blockLen:d}=this,e=(a=k(a)).length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=j(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){h(this),function(a,b){g(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}(a,this),this.finished=!0;let{buffer:b,view:c,blockLen:d,isLE:e}=this,{pos:f}=this;b[f++]=128,this.buffer.subarray(f).fill(0),this.padOffset>d-f&&(this.process(c,0),f=0);for(let a=f;a<d;a++)b[a]=0;(function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)})(c,d-8,BigInt(8*this.length),e),this.process(c,0);let i=j(a),k=this.outputLen;if(k%4)throw Error("_sha2: outputLen should be aligned to 32bit");let l=k/4,m=this.get();if(l>m.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<l;a++)i.setUint32(4*a,m[a],e)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.length=d,a.pos=g,a.finished=e,a.destroyed=f,d%b&&a.buffer.set(c),a}}let p=BigInt(0x100000000-1),q=BigInt(32),r=(a,b,c)=>a>>>c,s=(a,b,c)=>a<<32-c|b>>>c,t=(a,b,c)=>a>>>c|b<<32-c,u=(a,b,c)=>a<<32-c|b>>>c,v=(a,b,c)=>a<<64-c|b>>>c-32,w=(a,b,c)=>a>>>c-32|b<<64-c,x=function(a,b,c,d){let e=(b>>>0)+(d>>>0);return{h:a+c+(e/0x100000000|0)|0,l:0|e}},y=(a,b,c)=>(a>>>0)+(b>>>0)+(c>>>0),z=(a,b,c,d)=>b+c+d+(a/0x100000000|0)|0,A=(a,b,c,d)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0),B=(a,b,c,d,e)=>b+c+d+e+(a/0x100000000|0)|0,C=(a,b,c,d,e,f)=>b+c+d+e+f+(a/0x100000000|0)|0,D=(a,b,c,d,e)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0)+(e>>>0),[E,F]=function(a,b=!1){let c=new Uint32Array(a.length),d=new Uint32Array(a.length);for(let e=0;e<a.length;e++){let{h:f,l:g}=function(a,b=!1){return b?{h:Number(a&p),l:Number(a>>q&p)}:{h:0|Number(a>>q&p),l:0|Number(a&p)}}(a[e],b);[c[e],d[e]]=[f,g]}return[c,d]}(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),G=new Uint32Array(80),H=new Uint32Array(80);class I extends o{constructor(){super(128,64,16,!1),this.Ah=0x6a09e667,this.Al=-0xc4336f8,this.Bh=-0x4498517b,this.Bl=-0x7b3558c5,this.Ch=0x3c6ef372,this.Cl=-0x16b07d5,this.Dh=-0x5ab00ac6,this.Dl=0x5f1d36f1,this.Eh=0x510e527f,this.El=-0x52197d2f,this.Fh=-0x64fa9774,this.Fl=0x2b3e6c1f,this.Gh=0x1f83d9ab,this.Gl=-0x4be4295,this.Hh=0x5be0cd19,this.Hl=0x137e2179}get(){let{Ah:a,Al:b,Bh:c,Bl:d,Ch:e,Cl:f,Dh:g,Dl:h,Eh:i,El:j,Fh:k,Fl:l,Gh:m,Gl:o,Hh:p,Hl:q}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,o,p,q]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,o,p,q){this.Ah=0|a,this.Al=0|b,this.Bh=0|c,this.Bl=0|d,this.Ch=0|e,this.Cl=0|f,this.Dh=0|g,this.Dl=0|h,this.Eh=0|i,this.El=0|j,this.Fh=0|k,this.Fl=0|l,this.Gh=0|m,this.Gl=0|o,this.Hh=0|p,this.Hl=0|q}process(a,b){for(let c=0;c<16;c++,b+=4)G[c]=a.getUint32(b),H[c]=a.getUint32(b+=4);for(let a=16;a<80;a++){let b=0|G[a-15],c=0|H[a-15],d=t(b,c,1)^t(b,c,8)^r(b,c,7),e=u(b,c,1)^u(b,c,8)^s(b,c,7),f=0|G[a-2],g=0|H[a-2],h=t(f,g,19)^v(f,g,61)^r(f,g,6),i=A(e,u(f,g,19)^w(f,g,61)^s(f,g,6),H[a-7],H[a-16]),j=B(i,d,h,G[a-7],G[a-16]);G[a]=0|j,H[a]=0|i}let{Ah:c,Al:d,Bh:e,Bl:f,Ch:g,Cl:h,Dh:i,Dl:j,Eh:k,El:l,Fh:m,Fl:o,Gh:p,Gl:q,Hh:I,Hl:J}=this;for(let a=0;a<80;a++){let b=t(k,l,14)^t(k,l,18)^v(k,l,41),r=u(k,l,14)^u(k,l,18)^w(k,l,41),s=k&m^~k&p,A=D(J,r,l&o^~l&q,F[a],H[a]),B=C(A,I,b,s,E[a],G[a]),K=0|A,L=t(c,d,28)^v(c,d,34)^v(c,d,39),M=u(c,d,28)^w(c,d,34)^w(c,d,39),N=c&e^c&g^e&g,O=d&f^d&h^f&h;I=0|p,J=0|q,p=0|m,q=0|o,m=0|k,o=0|l,({h:k,l:l}=x(0|i,0|j,0|B,0|K)),i=0|g,j=0|h,g=0|e,h=0|f,e=0|c,f=0|d;let P=y(K,M,O);c=z(P,B,L,N),d=0|P}({h:c,l:d}=x(0|this.Ah,0|this.Al,0|c,0|d)),({h:e,l:f}=x(0|this.Bh,0|this.Bl,0|e,0|f)),({h:g,l:h}=x(0|this.Ch,0|this.Cl,0|g,0|h)),({h:i,l:j}=x(0|this.Dh,0|this.Dl,0|i,0|j)),({h:k,l:l}=x(0|this.Eh,0|this.El,0|k,0|l)),({h:m,l:o}=x(0|this.Fh,0|this.Fl,0|m,0|o)),({h:p,l:q}=x(0|this.Gh,0|this.Gl,0|p,0|q)),({h:I,l:J}=x(0|this.Hh,0|this.Hl,0|I,0|J)),this.set(c,d,e,f,g,h,i,j,k,l,m,o,p,q,I,J)}roundClean(){G.fill(0),H.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let J=(d=()=>new I,(b=a=>d().update(k(a)).digest()).outputLen=(c=d()).outputLen,b.blockLen=c.blockLen,b.create=()=>d(),b),K=BigInt(0),L=BigInt(1),M=BigInt(2);function N(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function O(a){if(!N(a))throw Error("Uint8Array expected")}function P(a,b){if("boolean"!=typeof b)throw Error(a+" boolean expected, got "+b)}let Q=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function R(a){O(a);let b="";for(let c=0;c<a.length;c++)b+=Q[a[c]];return b}function S(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?K:BigInt("0x"+a)}function T(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function U(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=T(a.charCodeAt(e)),f=T(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function V(a){return O(a),S(R(Uint8Array.from(a).reverse()))}function W(a,b){return U(a.toString(16).padStart(2*b,"0"))}function X(a,b){return W(a,b).reverse()}function Y(a,b,c){let d;if("string"==typeof b)try{d=U(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(N(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}function Z(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];O(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}let $=a=>"bigint"==typeof a&&K<=a;function _(a,b,c,d){if(!($(b)&&$(c)&&$(d))||!(c<=b)||!(b<d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}let aa={bigint:a=>"bigint"==typeof a,function:a=>"function"==typeof a,boolean:a=>"boolean"==typeof a,string:a=>"string"==typeof a,stringOrUint8Array:a=>"string"==typeof a||N(a),isSafeInteger:a=>Number.isSafeInteger(a),array:a=>Array.isArray(a),field:(a,b)=>b.Fp.isValid(a),hash:a=>"function"==typeof a&&Number.isSafeInteger(a.outputLen)};function ab(a,b,c={}){let d=(b,c,d)=>{let e=aa[c];if("function"!=typeof e)throw Error("invalid validator function");let f=a[b];if(!(d&&void 0===f)&&!e(f,a))throw Error("param "+String(b)+" is invalid. Expected "+c+", got "+f)};for(let[a,c]of Object.entries(b))d(a,c,!1);for(let[a,b]of Object.entries(c))d(a,b,!0);return a}function ac(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let ad=BigInt(0),ae=BigInt(1),af=BigInt(2),ag=BigInt(3),ah=BigInt(4),ai=BigInt(5),aj=BigInt(8);function ak(a,b){let c=a%b;return c>=ad?c:b+c}function al(a,b,c){let d=a;for(;b-- >ad;)d*=d,d%=c;return d}function am(a,b){if(a===ad)throw Error("invert: expected non-zero number");if(b<=ad)throw Error("invert: expected positive modulus, got "+b);let c=ak(a,b),d=b,e=ad,f=ae;for(;c!==ad;){let a=d/c,b=d%c,g=e-f*a;d=c,c=b,e=f,f=g}if(d!==ae)throw Error("invert: does not exist");return ak(e,b)}let an=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ao(a,b){let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function ap(a,b,c=!1,d={}){let e;if(a<=ad)throw Error("invalid field: expected ORDER > 0, got "+a);let{nBitLength:f,nByteLength:g}=ao(a,b);if(g>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let h=Object.freeze({ORDER:a,isLE:c,BITS:f,BYTES:g,MASK:(M<<BigInt(f-1))-L,ZERO:ad,ONE:ae,create:b=>ak(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return ad<=b&&b<a},is0:a=>a===ad,isOdd:a=>(a&ae)===ae,neg:b=>ak(-b,a),eql:(a,b)=>a===b,sqr:b=>ak(b*b,a),add:(b,c)=>ak(b+c,a),sub:(b,c)=>ak(b-c,a),mul:(b,c)=>ak(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<ad)throw Error("invalid exponent, negatives unsupported");if(c===ad)return a.ONE;if(c===ae)return b;let d=a.ONE,e=b;for(;c>ad;)c&ae&&(d=a.mul(d,e)),e=a.sqr(e),c>>=ae;return d})(h,a,b),div:(b,c)=>ak(b*am(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>am(b,a),sqrt:d.sqrt||(b=>(e||(e=function(a){if(a%ah===ag){let b=(a+ae)/ah;return function(a,c){let d=a.pow(c,b);if(!a.eql(a.sqr(d),c))throw Error("Cannot find square root");return d}}if(a%aj===ai){let b=(a-ai)/aj;return function(a,c){let d=a.mul(c,af),e=a.pow(d,b),f=a.mul(c,e),g=a.mul(a.mul(f,af),e),h=a.mul(f,a.sub(g,a.ONE));if(!a.eql(a.sqr(h),c))throw Error("Cannot find square root");return h}}return function(a){let b,c,d,e=(a-ae)/af;for(b=a-ae,c=0;b%af===ad;b/=af,c++);for(d=af;d<a&&function(a,b,c){if(b<ad)throw Error("invalid exponent, negatives unsupported");if(c<=ad)throw Error("invalid modulus");if(c===ae)return ad;let d=ae;for(;b>ad;)b&ae&&(d=d*a%c),a=a*a%c,b>>=ae;return d}(d,e,a)!==a-ae;d++)if(d>1e3)throw Error("Cannot find square root: likely non-prime P");if(1===c){let b=(a+ae)/ah;return function(a,c){let d=a.pow(c,b);if(!a.eql(a.sqr(d),c))throw Error("Cannot find square root");return d}}let f=(b+ae)/af;return function(a,g){if(a.pow(g,e)===a.neg(a.ONE))throw Error("Cannot find square root");let h=c,i=a.pow(a.mul(a.ONE,d),b),j=a.pow(g,f),k=a.pow(g,b);for(;!a.eql(k,a.ONE);){if(a.eql(k,a.ZERO))return a.ZERO;let b=1;for(let c=a.sqr(k);b<h&&!a.eql(c,a.ONE);b++)c=a.sqr(c);let c=a.pow(i,ae<<BigInt(h-b-1));i=a.sqr(c),j=a.mul(j,c),k=a.mul(k,i),h=b}return j}}(a)}(a)),e(h,b))),invertBatch:a=>{let b,c,d;return b=Array(a.length),c=a.reduce((a,c,d)=>h.is0(c)?a:(b[d]=a,h.mul(a,c)),h.ONE),d=h.inv(c),a.reduceRight((a,c,d)=>h.is0(c)?a:(b[d]=h.mul(a,b[d]),h.mul(a,c)),d),b},cmov:(a,b,c)=>c?b:a,toBytes:a=>c?X(a,g):W(a,g),fromBytes:a=>{if(a.length!==g)throw Error("Field.fromBytes: expected "+g+" bytes, got "+a.length);return c?V(a):S(R(a))}});return Object.freeze(h)}let aq=BigInt(0),ar=BigInt(1);function as(a,b){let c=b.negate();return a?c:b}function at(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function au(a,b){return at(a,b),{windows:Math.ceil(b/a)+1,windowSize:2**(a-1)}}let av=new WeakMap,aw=new WeakMap;function ax(a){return aw.get(a)||1}let ay=BigInt(0),az=BigInt(1),aA=BigInt(2),aB=BigInt(8),aC={zip215:!0};BigInt(0),BigInt(1);let aD=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),aE=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);let aF=BigInt(1),aG=BigInt(2);BigInt(3);let aH=BigInt(5),aI=BigInt(8),aJ=ap(aD,void 0,!0),aK=function(a){var b;let c,d=(ab(a.Fp,an.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),ab(a,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),c=Object.freeze({...ao(a.n,a.nBitLength),...a,p:a.Fp.ORDER}),ab(a,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...c})),{Fp:e,n:f,prehash:g,hash:h,randomBytes:i,nByteLength:j,h:k}=d,l=aA<<BigInt(8*j)-az,m=e.create,o=ap(d.n,d.nBitLength),p=d.uvRatio||((a,b)=>{try{return{isValid:!0,value:e.sqrt(a*e.inv(b))}}catch{return{isValid:!1,value:ay}}}),q=d.adjustScalarBytes||(a=>a),r=d.domain||((a,b,c)=>{if(P("phflag",c),b.length||c)throw Error("Contexts/pre-hash are not supported");return a});function s(a,b){_("coordinate "+a,b,ay,l)}function t(a){if(!(a instanceof w))throw Error("ExtendedPoint expected")}let u=ac((a,b)=>{let{ex:c,ey:d,ez:f}=a,g=a.is0();null==b&&(b=g?aB:e.inv(f));let h=m(c*b),i=m(d*b),j=m(f*b);if(g)return{x:ay,y:az};if(j!==az)throw Error("invZ was invalid");return{x:h,y:i}}),v=ac(a=>{let{a:b,d:c}=d;if(a.is0())throw Error("bad point: ZERO");let{ex:e,ey:f,ez:g,et:h}=a,i=m(e*e),j=m(f*f),k=m(g*g),l=m(k*k),o=m(i*b);if(m(k*m(o+j))!==m(l+m(c*m(i*j))))throw Error("bad point: equation left != right (1)");if(m(e*f)!==m(g*h))throw Error("bad point: equation left != right (2)");return!0});class w{constructor(a,b,c,d){this.ex=a,this.ey=b,this.ez=c,this.et=d,s("x",a),s("y",b),s("z",c),s("t",d),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(a){if(a instanceof w)throw Error("extended point not allowed");let{x:b,y:c}=a||{};return s("x",b),s("y",c),new w(b,c,az,m(b*c))}static normalizeZ(a){let b=e.invertBatch(a.map(a=>a.ez));return a.map((a,c)=>a.toAffine(b[c])).map(w.fromAffine)}static msm(a,b){return function(a,b,c,d){if(function(a,b){if(!Array.isArray(a))throw Error("array expected");a.forEach((a,c)=>{if(!(a instanceof b))throw Error("invalid point at index "+c)})}(c,a),function(a,b){if(!Array.isArray(a))throw Error("array of scalars expected");a.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)})}(d,b),c.length!==d.length)throw Error("arrays of points and scalars must have equal length");let e=a.ZERO,f=function(a){let b;for(b=0;a>K;a>>=L,b+=1);return b}(BigInt(c.length)),g=f>12?f-3:f>4?f-2:f?2:1,h=(1<<g)-1,i=Array(h+1).fill(e),j=Math.floor((b.BITS-1)/g)*g,k=e;for(let a=j;a>=0;a-=g){i.fill(e);for(let b=0;b<d.length;b++){let e=Number(d[b]>>BigInt(a)&BigInt(h));i[e]=i[e].add(c[b])}let b=e;for(let a=i.length-1,c=e;a>0;a--)c=c.add(i[a]),b=b.add(c);if(k=k.add(b),0!==a)for(let a=0;a<g;a++)k=k.double()}return k}(w,o,a,b)}_setWindowSize(a){z.setWindowSize(this,a)}assertValidity(){v(this)}equals(a){t(a);let{ex:b,ey:c,ez:d}=this,{ex:e,ey:f,ez:g}=a,h=m(b*g),i=m(e*d),j=m(c*g),k=m(f*d);return h===i&&j===k}is0(){return this.equals(w.ZERO)}negate(){return new w(m(-this.ex),this.ey,this.ez,m(-this.et))}double(){let{a:a}=d,{ex:b,ey:c,ez:e}=this,f=m(b*b),g=m(c*c),h=m(aA*m(e*e)),i=m(a*f),j=b+c,k=m(m(j*j)-f-g),l=i+g,o=l-h,p=i-g,q=m(k*o),r=m(l*p),s=m(k*p);return new w(q,r,m(o*l),s)}add(a){t(a);let{a:b,d:c}=d,{ex:e,ey:f,ez:g,et:h}=this,{ex:i,ey:j,ez:k,et:l}=a;if(b===BigInt(-1)){let a=m((f-e)*(j+i)),b=m((f+e)*(j-i)),c=m(b-a);if(c===ay)return this.double();let d=m(g*aA*l),o=m(h*aA*k),p=o+d,q=b+a,r=o-d,s=m(p*c),t=m(q*r),u=m(p*r);return new w(s,t,m(c*q),u)}let o=m(e*i),p=m(f*j),q=m(h*c*l),r=m(g*k),s=m((e+f)*(i+j)-o-p),u=r-q,v=r+q,x=m(p-b*o),y=m(s*u),z=m(v*x),A=m(s*x);return new w(y,z,m(u*v),A)}subtract(a){return this.add(a.negate())}wNAF(a){return z.wNAFCached(this,a,w.normalizeZ)}multiply(a){_("scalar",a,az,f);let{p:b,f:c}=this.wNAF(a);return w.normalizeZ([b,c])[0]}multiplyUnsafe(a,b=w.ZERO){return _("scalar",a,ay,f),a===ay?y:this.is0()||a===az?this:z.wNAFCachedUnsafe(this,a,w.normalizeZ,b)}isSmallOrder(){return this.multiplyUnsafe(k).is0()}isTorsionFree(){return z.unsafeLadder(this,f).is0()}toAffine(a){return u(this,a)}clearCofactor(){let{h:a}=d;return a===az?this:this.multiplyUnsafe(a)}static fromHex(a,b=!1){let{d:c,a:f}=d,g=e.BYTES;a=Y("pointHex",a,g),P("zip215",b);let h=a.slice(),i=a[g-1];h[g-1]=-129&i;let j=V(h);_("pointHex.y",j,ay,b?l:e.ORDER);let k=m(j*j),{isValid:o,value:q}=p(m(k-az),m(c*k-f));if(!o)throw Error("Point.fromHex: invalid y coordinate");let r=(q&az)===az,s=(128&i)!=0;if(!b&&q===ay&&s)throw Error("Point.fromHex: x=0 and x_0=1");return s!==r&&(q=m(-q)),w.fromAffine({x:q,y:j})}static fromPrivateKey(a){return A(a).point}toRawBytes(){let{x:a,y:b}=this.toAffine(),c=X(b,e.BYTES);return c[c.length-1]|=a&az?128:0,c}toHex(){return R(this.toRawBytes())}}w.BASE=new w(d.Gx,d.Gy,az,m(d.Gx*d.Gy)),w.ZERO=new w(ay,az,az,ay);let{BASE:x,ZERO:y}=w,z=(b=8*j,{constTimeNegate:as,hasPrecomputes:a=>1!==ax(a),unsafeLadder(a,b,c=w.ZERO){let d=a;for(;b>aq;)b&ar&&(c=c.add(d)),d=d.double(),b>>=ar;return c},precomputeWindow(a,c){let{windows:d,windowSize:e}=au(c,b),f=[],g=a,h=g;for(let a=0;a<d;a++){h=g,f.push(h);for(let a=1;a<e;a++)h=h.add(g),f.push(h);g=h.double()}return f},wNAF(a,c,d){let{windows:e,windowSize:f}=au(a,b),g=w.ZERO,h=w.BASE,i=BigInt(2**a-1),j=2**a,k=BigInt(a);for(let a=0;a<e;a++){let b=a*f,e=Number(d&i);d>>=k,e>f&&(e-=j,d+=ar);let l=b+Math.abs(e)-1,m=a%2!=0,o=e<0;0===e?h=h.add(as(m,c[b])):g=g.add(as(o,c[l]))}return{p:g,f:h}},wNAFUnsafe(a,c,d,e=w.ZERO){let{windows:f,windowSize:g}=au(a,b),h=BigInt(2**a-1),i=2**a,j=BigInt(a);for(let a=0;a<f;a++){let b=a*g;if(d===aq)break;let f=Number(d&h);if(d>>=j,f>g&&(f-=i,d+=ar),0===f)continue;let k=c[b+Math.abs(f)-1];f<0&&(k=k.negate()),e=e.add(k)}return e},getPrecomputes(a,b,c){let d=av.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&av.set(b,c(d))),d},wNAFCached(a,b,c){let d=ax(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)},wNAFCachedUnsafe(a,b,c,d){let e=ax(a);return 1===e?this.unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)},setWindowSize(a,c){at(c,b),aw.set(a,c),av.delete(a)}});function A(a){let b=e.BYTES;a=Y("private key",a,b);let c=Y("hashed private key",h(a),2*b),d=q(c.slice(0,b)),g=c.slice(b,2*b),i=ak(V(d),f),j=x.multiply(i),k=j.toRawBytes();return{head:d,prefix:g,scalar:i,point:j,pointBytes:k}}function B(a=new Uint8Array,...b){return ak(V(h(r(Z(...b),Y("context",a),!!g))),f)}return x._setWindowSize(8),{CURVE:d,getPublicKey:function(a){return A(a).pointBytes},sign:function(a,b,c={}){a=Y("message",a),g&&(a=g(a));let{prefix:d,scalar:h,pointBytes:i}=A(b),j=B(c.context,d,a),k=x.multiply(j).toRawBytes(),l=ak(j+B(c.context,k,i,a)*h,f);return _("signature.s",l,ay,f),Y("result",Z(k,X(l,e.BYTES)),2*e.BYTES)},verify:function(a,b,c,d=aC){let f,h,i,{context:j,zip215:k}=d,l=e.BYTES;a=Y("signature",a,2*l),b=Y("message",b),c=Y("publicKey",c,l),void 0!==k&&P("zip215",k),g&&(b=g(b));let m=V(a.slice(l,2*l));try{f=w.fromHex(c,k),h=w.fromHex(a.slice(0,l),k),i=x.multiplyUnsafe(m)}catch{return!1}if(!k&&f.isSmallOrder())return!1;let o=B(j,h.toRawBytes(),f.toRawBytes(),b);return h.add(f.multiplyUnsafe(o)).subtract(i).clearCofactor().equals(w.ZERO)},ExtendedPoint:w,utils:{getExtendedPublicKey:A,randomPrivateKey:()=>i(e.BYTES),precompute:(a=8,b=w.BASE)=>(b._setWindowSize(a),b.multiply(BigInt(3)),b)}}}({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:aJ,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:aI,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:J,randomBytes:m,adjustScalarBytes:function(a){return a[0]&=248,a[31]&=127,a[31]|=64,a},uvRatio:function(a,b){var c;let d,e,f,g,h,i,j,k,l,m,o,p,q,r,s=ak(b*b*b,aD),t=(c=a*ak(s*s*b,aD),d=BigInt(10),e=BigInt(20),f=BigInt(40),g=BigInt(80),i=al(h=c*c%aD*c%aD,aG,aD)*h%aD,j=al(i,aF,aD)*c%aD,k=al(j,aH,aD)*j%aD,l=al(k,d,aD)*k%aD,m=al(l,e,aD)*l%aD,o=al(m,f,aD)*m%aD,p=al(o,g,aD)*o%aD,q=al(p,g,aD)*o%aD,r=al(q,d,aD)*k%aD,{pow_p_5_8:al(r,aG,aD)*c%aD,b2:h}).pow_p_5_8,u=ak(a*s*t,aD),v=ak(b*u*u,aD),w=u,x=ak(u*aE,aD),y=v===a,z=v===ak(-a,aD),A=v===ak(-a*aE,aD);return y&&(u=w),(z||A)&&(u=x),(ak(u,aD)&ae)===ae&&(u=ak(-u,aD)),{isValid:y||z,value:u}}}),aL="base64url",aM="utf8",aN="utf8",aO="base58btc";function aP(a){return null!=globalThis.Buffer?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function aQ(a=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?aP(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}function aR(a,b){b||(b=a.reduce((a,b)=>a+b.length,0));let c=aQ(b),d=0;for(let b of a)c.set(b,d),d+=b.length;return aP(c)}var aS=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var o=f-e;o!==f&&0===g[o];)o++;for(var p=new Uint8Array(d+(f-o)),q=d;o!==f;)p[q++]=g[o++];return p}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,o=g-1;(0!==l||m<d)&&-1!==o;o--,m++)l+=256*j[o]>>>0,j[o]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var p=g-d;p!==g&&0===j[p];)p++;for(var q=i.repeat(c);p<g;++p)q+=a.charAt(j[p]);return q},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}};let aT=a=>{if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")};class aU{constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class aV{constructor(a,b,c){if(this.name=a,this.prefix=b,void 0===b.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=b.codePointAt(0),this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return aX(this,a)}}class aW{constructor(a){this.decoders=a}or(a){return aX(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let aX=(a,b)=>new aW({...a.decoders||{[a.prefix]:a},...b.decoders||{[b.prefix]:b}});class aY{constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new aU(a,b,c),this.decoder=new aV(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}let aZ=({name:a,prefix:b,encode:c,decode:d})=>new aY(a,b,c,d),a$=({prefix:a,name:b,alphabet:c})=>{let{encode:d,decode:e}=aS(c,b);return aZ({prefix:a,name:b,encode:d,decode:a=>aT(e(a))})},a_=({name:a,prefix:b,bitsPerChar:c,alphabet:d})=>aZ({prefix:b,name:a,encode:a=>((a,b,c)=>{let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(g&&(f+=b[e&h<<c-g]),d)for(;f.length*c&7;)f+="=";return f})(a,d,c),decode:b=>((a,b,c,d)=>{let e={};for(let a=0;a<b.length;++a)e[b[a]]=a;let f=a.length;for(;"="===a[f-1];)--f;let g=new Uint8Array(f*c/8|0),h=0,i=0,j=0;for(let b=0;b<f;++b){let f=e[a[b]];if(void 0===f)throw SyntaxError(`Non-${d} character`);i=i<<c|f,(h+=c)>=8&&(h-=8,g[j++]=255&i>>h)}if(h>=c||255&i<<8-h)throw SyntaxError("Unexpected end of data");return g})(b,d,c,a)});var a0=Object.freeze({__proto__:null,identity:aZ({prefix:"\0",name:"identity",encode:a=>new TextDecoder().decode(a),decode:a=>new TextEncoder().encode(a)})}),a1=Object.freeze({__proto__:null,base2:a_({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})}),a2=Object.freeze({__proto__:null,base8:a_({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})}),a3=Object.freeze({__proto__:null,base10:a$({prefix:"9",name:"base10",alphabet:"0123456789"})}),a4=Object.freeze({__proto__:null,base16:a_({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper:a_({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})}),a5=Object.freeze({__proto__:null,base32:a_({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper:a_({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad:a_({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper:a_({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex:a_({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper:a_({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad:a_({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper:a_({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z:a_({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})}),a6=Object.freeze({__proto__:null,base36:a$({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper:a$({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})}),a7=Object.freeze({__proto__:null,base58btc:a$({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr:a$({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})}),a8=Object.freeze({__proto__:null,base64:a_({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad:a_({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url:a_({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad:a_({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});let a9=Array.from(""),ba=a9.reduce((a,b,c)=>(a[c]=b,a),[]),bb=a9.reduce((a,b,c)=>(a[b.codePointAt(0)]=c,a),[]);var bc=Object.freeze({__proto__:null,base256emoji:aZ({prefix:"",name:"base256emoji",encode:function(a){return a.reduce((a,b)=>a+=ba[b],"")},decode:function(a){let b=[];for(let c of a){let a=bb[c.codePointAt(0)];if(void 0===a)throw Error(`Non-base256emoji character: ${c}`);b.push(a)}return new Uint8Array(b)}})});function bd(a,b,c){b=b||[],c=c||0;for(var d=c;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,bd.bytes=c-d+1,b}var be=function(a){return a<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:a<0x800000000?5:a<0x40000000000?6:a<0x2000000000000?7:a<0x100000000000000?8:a<0x8000000000000000?9:10};let bf=(a,b,c=0)=>(bd(a,b,c),b),bg=(a,b)=>{let c=b.byteLength,d=be(a),e=d+be(c),f=new Uint8Array(e+c);return bf(a,f,0),bf(c,f,d),f.set(b,e),new bh(a,c,b,f)};class bh{constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}let bi=({name:a,code:b,encode:c})=>new bj(a,b,c);class bj{constructor(a,b,c){this.name=a,this.code=b,this.encode=c}digest(a){if(a instanceof Uint8Array){let b=this.encode(a);return b instanceof Uint8Array?bg(this.code,b):b.then(a=>bg(this.code,a))}throw Error("Unknown type, must be binary type")}}let bk=a=>async b=>new Uint8Array(await crypto.subtle.digest(a,b));var bl=Object.freeze({__proto__:null,sha256:bi({name:"sha2-256",code:18,encode:bk("SHA-256")}),sha512:bi({name:"sha2-512",code:19,encode:bk("SHA-512")})}),bm=Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:aT,digest:a=>bg(0,aT(a))}});new TextEncoder,new TextDecoder;let bn={...a0,...a1,...a2,...a3,...a4,...a5,...a6,...a7,...a8,...bc};function bo(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}({...bl,...bm});let bp=bo("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),bq=bo("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=aQ((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),br={utf8:bp,"utf-8":bp,hex:bn.base16,latin1:bq,ascii:bq,binary:bq,...bn};function bs(a,b="utf8"){let c=br[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?globalThis.Buffer.from(a.buffer,a.byteOffset,a.byteLength).toString("utf8"):c.encoder.encode(a).substring(1)}function bt(a,b="utf8"){let c=br[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?aP(globalThis.Buffer.from(a,"utf-8")):c.decoder.decode(`${c.prefix}${a}`)}function bu(a){return(0,f.safeJsonParse)(bs(bt(a,aL),aM))}function bv(a){return bs(bt((0,f.safeJsonStringify)(a),aM),aL)}function bw(a){return["did:key","z"+bs(aR([bt("K36",aO),a]),aO)].join(":")}function bx(a){let b=a.split(".");return{header:bu(b[0]),payload:bu(b[1]),signature:bt(b[2],aL),data:bt(b.slice(0,2).join("."),aN)}}function by(a=m(32)){let b=aK.getPublicKey(a);return{secretKey:aR([a,b]),publicKey:b}}async function bz(a,b,c,d,f=(0,e.fromMiliseconds)(Date.now())){let g={alg:"EdDSA",typ:"JWT"},h={iss:bw(d.publicKey),sub:a,aud:b,iat:f,exp:f+c},i=bt([bv((j={header:g,payload:h}).header),bv(j.payload)].join("."),aN);var j,k={header:g,payload:h,signature:aK.sign(i,d.secretKey.slice(0,32))};return[bv(k.header),bv(k.payload),bs(k.signature,aL)].join(".")}a.s(["decodeJWT",()=>bx,"encodeIss",()=>bw,"generateKeyPair",()=>by,"signJWT",()=>bz])},682177,30145,465191,640843,73915,a=>{"use strict";function b(a){return null!=globalThis.Buffer?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function c(a=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?b(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}function d(a,d){d||(d=a.reduce((a,b)=>a+b.length,0));let e=c(d),f=0;for(let b of a)e.set(b,f),f+=b.length;return b(e)}a.s(["concat",()=>d],30145);let e=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var o=f-e;o!==f&&0===g[o];)o++;for(var p=new Uint8Array(d+(f-o)),q=d;o!==f;)p[q++]=g[o++];return p}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,o=g-1;(0!==l||m<d)&&-1!==o;o--,m++)l+=256*j[o]>>>0,j[o]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var p=g-d;p!==g&&0===j[p];)p++;for(var q=i.repeat(c);p<g;++p)q+=a.charAt(j[p]);return q},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}},f=new Uint8Array(0),g=a=>a.reduce((a,b)=>a+b.toString(16).padStart(2,"0"),""),h=a=>{let b=a.match(/../g);return b?new Uint8Array(b.map(a=>parseInt(a,16))):f},i=(a,b)=>{if(a===b)return!0;if(a.byteLength!==b.byteLength)return!1;for(let c=0;c<a.byteLength;c++)if(a[c]!==b[c])return!1;return!0},j=a=>{if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")},k=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),l=a=>new TextEncoder().encode(a),m=a=>new TextDecoder().decode(a);a.s(["coerce",()=>j,"empty",()=>f,"equals",()=>i,"fromHex",()=>h,"fromString",()=>l,"isBinary",()=>k,"toHex",()=>g,"toString",()=>m],165113);class o{constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class p{constructor(a,b,c){if(this.name=a,this.prefix=b,void 0===b.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=b.codePointAt(0),this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return r(this,a)}}class q{constructor(a){this.decoders=a}or(a){return r(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let r=(a,b)=>new q({...a.decoders||{[a.prefix]:a},...b.decoders||{[b.prefix]:b}});class s{constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new o(a,b,c),this.decoder=new p(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}let t=({name:a,prefix:b,encode:c,decode:d})=>new s(a,b,c,d),u=({prefix:a,name:b,alphabet:c})=>{let{encode:d,decode:f}=e(c,b);return t({prefix:a,name:b,encode:d,decode:a=>j(f(a))})},v=({name:a,prefix:b,bitsPerChar:c,alphabet:d})=>t({prefix:b,name:a,encode:a=>((a,b,c)=>{let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(g&&(f+=b[e&h<<c-g]),d)for(;f.length*c&7;)f+="=";return f})(a,d,c),decode:b=>((a,b,c,d)=>{let e={};for(let a=0;a<b.length;++a)e[b[a]]=a;let f=a.length;for(;"="===a[f-1];)--f;let g=new Uint8Array(f*c/8|0),h=0,i=0,j=0;for(let b=0;b<f;++b){let f=e[a[b]];if(void 0===f)throw SyntaxError(`Non-${d} character`);i=i<<c|f,(h+=c)>=8&&(h-=8,g[j++]=255&i>>h)}if(h>=c||255&i<<8-h)throw SyntaxError("Unexpected end of data");return g})(b,d,c,a)}),w=t({prefix:"\0",name:"identity",encode:a=>m(a),decode:a=>l(a)});a.s(["identity",0,w],743427);var x=a.i(743427);let y=v({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});a.s(["base2",0,y],177971);var z=a.i(177971);let A=v({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});a.s(["base8",0,A],213168);var B=a.i(213168);let C=u({prefix:"9",name:"base10",alphabet:"0123456789"});a.s(["base10",0,C],480868);var D=a.i(480868);let E=v({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),F=v({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});a.s(["base16",0,E,"base16upper",0,F],583539);var G=a.i(583539);let H=v({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),I=v({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),J=v({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),K=v({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),L=v({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),M=v({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),N=v({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),O=v({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),P=v({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});a.s(["base32",0,H,"base32hex",0,L,"base32hexpad",0,N,"base32hexpadupper",0,O,"base32hexupper",0,M,"base32pad",0,J,"base32padupper",0,K,"base32upper",0,I,"base32z",0,P],957182);var Q=a.i(957182);let R=u({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),S=u({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});a.s(["base36",0,R,"base36upper",0,S],824068);var T=a.i(824068);let U=u({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),V=u({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});a.s(["base58btc",0,U,"base58flickr",0,V],822289);var W=a.i(822289);let X=v({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Y=v({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Z=v({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),$=v({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});a.s(["base64",0,X,"base64pad",0,Y,"base64url",0,Z,"base64urlpad",0,$],435621);var _=a.i(435621);let aa=Array.from("\uD83D\uDE80\uD83E\uDE90\uD83D\uDEF0\uD83C\uDF0C\uD83C\uDF11\uD83C\uDF12\uD83C\uDF13\uD83C\uDF14\uD83C\uDF15\uD83C\uDF16\uD83C\uDF17\uD83C\uDF18\uD83C\uDF0D\uD83C\uDF0F\uD83C\uDF0E\uD83D\uDC09\uD83D\uDCBB\uD83D\uDDA5\uD83D\uDCBE\uD83D\uDCBF\uD83D\uDE02\uD83D\uDE0D\uD83E\uDD23\uD83D\uDE0A\uD83D\uDE4F\uD83D\uDC95\uD83D\uDE2D\uD83D\uDE18\uD83D\uDC4D\uD83D\uDE05\uD83D\uDC4F\uD83D\uDE01\uD83D\uDD25\uD83E\uDD70\uD83D\uDC94\uD83D\uDC96\uD83D\uDC99\uD83D\uDE22\uD83E\uDD14\uD83D\uDE06\uD83D\uDE44\uD83D\uDCAA\uD83D\uDE09\uD83D\uDC4C\uD83E\uDD17\uD83D\uDC9C\uD83D\uDE14\uD83D\uDE0E\uD83D\uDE07\uD83C\uDF39\uD83E\uDD26\uD83C\uDF89\uD83D\uDC9E\uD83E\uDD37\uD83D\uDE31\uD83D\uDE0C\uD83C\uDF38\uD83D\uDE4C\uD83D\uDE0B\uD83D\uDC97\uD83D\uDC9A\uD83D\uDE0F\uD83D\uDC9B\uD83D\uDE42\uD83D\uDC93\uD83E\uDD29\uD83D\uDE04\uD83D\uDE00\uD83D\uDDA4\uD83D\uDE03\uD83D\uDCAF\uD83D\uDE48\uD83D\uDC47\uD83C\uDFB6\uD83D\uDE12\uD83E\uDD2D\uD83D\uDE1C\uD83D\uDC8B\uD83D\uDC40\uD83D\uDE2A\uD83D\uDE11\uD83D\uDCA5\uD83D\uDE4B\uD83D\uDE1E\uD83D\uDE29\uD83D\uDE21\uD83E\uDD2A\uD83D\uDC4A\uD83E\uDD73\uD83D\uDE25\uD83E\uDD24\uD83D\uDC49\uD83D\uDC83\uD83D\uDE33\uD83D\uDE1A\uD83D\uDE1D\uD83D\uDE34\uD83C\uDF1F\uD83D\uDE2C\uD83D\uDE43\uD83C\uDF40\uD83C\uDF37\uD83D\uDE3B\uD83D\uDE13\uD83E\uDD7A\uD83C\uDF08\uD83D\uDE08\uD83E\uDD18\uD83D\uDCA6\uD83D\uDE23\uD83C\uDFC3\uD83D\uDC90\uD83C\uDF8A\uD83D\uDC98\uD83D\uDE20\uD83D\uDE15\uD83C\uDF3A\uD83C\uDF82\uD83C\uDF3B\uD83D\uDE10\uD83D\uDD95\uD83D\uDC9D\uD83D\uDE4A\uD83D\uDE39\uD83D\uDDE3\uD83D\uDCAB\uD83D\uDC80\uD83D\uDC51\uD83C\uDFB5\uD83E\uDD1E\uD83D\uDE1B\uD83D\uDD34\uD83D\uDE24\uD83C\uDF3C\uD83D\uDE2B\uD83E\uDD19\uD83C\uDFC6\uD83E\uDD2B\uD83D\uDC48\uD83D\uDE2E\uD83D\uDE46\uD83C\uDF7B\uD83C\uDF43\uD83D\uDC36\uD83D\uDC81\uD83D\uDE32\uD83C\uDF3F\uD83E\uDDE1\uD83C\uDF81\uD83C\uDF1E\uD83C\uDF88\uD83D\uDC4B\uD83D\uDE30\uD83E\uDD28\uD83D\uDE36\uD83E\uDD1D\uD83D\uDEB6\uD83D\uDCB0\uD83C\uDF53\uD83D\uDCA2\uD83E\uDD1F\uD83D\uDE41\uD83D\uDEA8\uD83D\uDCA8\uD83E\uDD2C\uD83C\uDF80\uD83C\uDF7A\uD83E\uDD13\uD83D\uDE19\uD83D\uDC9F\uD83C\uDF31\uD83D\uDE16\uD83D\uDC76\uD83E\uDD74\uD83D\uDC8E\uD83D\uDCB8\uD83D\uDE28\uD83C\uDF1A\uD83E\uDD8B\uD83D\uDE37\uD83D\uDD7A\uD83D\uDE45\uD83D\uDE1F\uD83D\uDE35\uD83D\uDC4E\uD83E\uDD32\uD83E\uDD20\uD83E\uDD27\uD83D\uDCCC\uD83D\uDD35\uD83D\uDC85\uD83E\uDDD0\uD83D\uDC3E\uD83C\uDF52\uD83D\uDE17\uD83E\uDD11\uD83C\uDF0A\uD83E\uDD2F\uD83D\uDC37\uD83D\uDCA7\uD83D\uDE2F\uD83D\uDC86\uD83D\uDC46\uD83C\uDFA4\uD83D\uDE47\uD83C\uDF51\uD83C\uDF34\uD83D\uDCA3\uD83D\uDC38\uD83D\uDC8C\uD83D\uDCCD\uD83E\uDD40\uD83E\uDD22\uD83D\uDC45\uD83D\uDCA1\uD83D\uDCA9\uD83D\uDC50\uD83D\uDCF8\uD83D\uDC7B\uD83E\uDD10\uD83E\uDD2E\uD83C\uDFBC\uD83E\uDD75\uD83D\uDEA9\uD83C\uDF4E\uD83C\uDF4A\uD83D\uDC7C\uD83D\uDC8D\uD83D\uDCE3\uD83E\uDD42"),ab=aa.reduce((a,b,c)=>(a[c]=b,a),[]),ac=aa.reduce((a,b,c)=>(a[b.codePointAt(0)]=c,a),[]),ad=t({prefix:"\uD83D\uDE80",name:"base256emoji",encode:function(a){return a.reduce((a,b)=>a+=ab[b],"")},decode:function(a){let b=[];for(let c of a){let a=ac[c.codePointAt(0)];if(void 0===a)throw Error(`Non-base256emoji character: ${c}`);b.push(a)}return new Uint8Array(b)}});a.s(["base256emoji",0,ad],379069);var ae=a.i(379069),af=a.i(254799);function ag(a,b,c){b=b||[];for(var d=c=c||0;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,ag.bytes=c-d+1,b}function ah(a,b){var c,d=0,b=b||0,e=0,f=b,g=a.length;do{if(f>=g)throw ah.bytes=0,RangeError("Could not decode varint");c=a[f++],d+=e<28?(127&c)<<e:(127&c)*Math.pow(2,e),e+=7}while(c>=128)return ah.bytes=f-b,d}let ai=(a,b=0)=>[ah(a,b),ah.bytes],aj=(a,b,c=0)=>(ag(a,b,c),b),ak=a=>{var b;return(b=a)<128?1:b<16384?2:b<2097152?3:b<0x10000000?4:b<0x800000000?5:b<0x40000000000?6:b<0x2000000000000?7:b<0x100000000000000?8:b<0x8000000000000000?9:10};a.s(["decode",0,ai,"encodeTo",0,aj,"encodingLength",0,ak],818333);let al=(a,b)=>{let c=b.byteLength,d=ak(a),e=d+ak(c),f=new Uint8Array(e+c);return aj(a,f,0),aj(c,f,d),f.set(b,e),new ao(a,c,b,f)},am=a=>{let b=j(a),[c,d]=ai(b),[e,f]=ai(b.subarray(d)),g=b.subarray(d+f);if(g.byteLength!==e)throw Error("Incorrect length");return new ao(c,e,g,b)},an=(a,b)=>a===b||a.code===b.code&&a.size===b.size&&i(a.bytes,b.bytes);class ao{constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}a.s(["Digest",()=>ao,"create",0,al,"decode",0,am,"equals",0,an],271784);let ap=({name:a,code:b,encode:c})=>new aq(a,b,c);class aq{constructor(a,b,c){this.name=a,this.code=b,this.encode=c}digest(a){if(a instanceof Uint8Array){let b=this.encode(a);return b instanceof Uint8Array?al(this.code,b):b.then(a=>al(this.code,a))}throw Error("Unknown type, must be binary type")}}a.s(["Hasher",()=>aq,"from",0,ap],228442);let ar=ap({name:"sha2-256",code:18,encode:a=>j(af.default.createHash("sha256").update(a).digest())}),as=ap({name:"sha2-512",code:19,encode:a=>j(af.default.createHash("sha512").update(a).digest())});a.s(["sha256",0,ar,"sha512",0,as],971686);var at=a.i(971686);a.s(["identity",0,{code:0,name:"identity",encode:j,digest:a=>al(0,j(a))}],456138);var au=a.i(456138);a.s(["code",0,85,"decode",0,a=>j(a),"encode",0,a=>j(a),"name",0,"raw"],487340),a.i(487340);let av=new TextEncoder,aw=new TextDecoder;a.s(["code",0,512,"decode",0,a=>JSON.parse(aw.decode(a)),"encode",0,a=>av.encode(JSON.stringify(a)),"name",0,"json"],902439),a.i(902439);class ax{constructor(a,b,c,d){this.code=b,this.version=a,this.multihash=c,this.bytes=d,this.byteOffset=d.byteOffset,this.byteLength=d.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:aG,byteLength:aG,code:aF,version:aF,multihash:aF,bytes:aF,_baseCache:aG,asCID:aG})}toV0(){if(0===this.version)return this;{let{code:a,multihash:b}=this;if(a!==aB)throw Error("Cannot convert a non dag-pb CID to CIDv0");if(b.code!==aC)throw Error("Cannot convert non sha2-256 multihash CID to CIDv0");return ax.createV0(b)}}toV1(){switch(this.version){case 0:{let{code:a,digest:b}=this.multihash,c=al(a,b);return ax.createV1(this.code,c)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(a){return a&&this.code===a.code&&this.version===a.version&&an(this.multihash,a.multihash)}toString(a){let{bytes:b,version:c,_baseCache:d}=this;return 0===c?az(b,d,a||U.encoder):aA(b,d,a||H.encoder)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(a){return aH(/^0\.0/,aI),!!(a&&(a[aE]||a.asCID===a))}get toBaseEncodedString(){throw Error("Deprecated, use .toString()")}get codec(){throw Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw Error('"multibaseName" property is deprecated')}get prefix(){throw Error('"prefix" property is deprecated')}static asCID(a){if(a instanceof ax)return a;if(null!=a&&a.asCID===a){let{version:b,code:c,multihash:d,bytes:e}=a;return new ax(b,c,d,e||aD(b,c,d.bytes))}if(null==a||!0!==a[aE])return null;{let{version:b,multihash:c,code:d}=a,e=am(c);return ax.create(b,d,e)}}static create(a,b,c){if("number"!=typeof b)throw Error("String codecs are no longer supported");switch(a){case 0:if(b===aB)return new ax(a,b,c,c.bytes);throw Error(`Version 0 CID must use dag-pb (code: ${aB}) block encoding`);case 1:{let d=aD(a,b,c.bytes);return new ax(a,b,c,d)}default:throw Error("Invalid version")}}static createV0(a){return ax.create(0,aB,a)}static createV1(a,b){return ax.create(1,a,b)}static decode(a){let[b,c]=ax.decodeFirst(a);if(c.length)throw Error("Incorrect length");return b}static decodeFirst(a){let b=ax.inspectBytes(a),c=b.size-b.multihashSize,d=j(a.subarray(c,c+b.multihashSize));if(d.byteLength!==b.multihashSize)throw Error("Incorrect length");let e=d.subarray(b.multihashSize-b.digestSize),f=new ao(b.multihashCode,b.digestSize,e,d);return[0===b.version?ax.createV0(f):ax.createV1(b.codec,f),a.subarray(b.size)]}static inspectBytes(a){let b=0,c=()=>{let[c,d]=ai(a.subarray(b));return b+=d,c},d=c(),e=aB;if(18===d?(d=0,b=0):1===d&&(e=c()),0!==d&&1!==d)throw RangeError(`Invalid CID version ${d}`);let f=b,g=c(),h=c(),i=b+h;return{version:d,codec:e,multihashCode:g,digestSize:h,multihashSize:i-f,size:i}}static parse(a,b){let[c,d]=ay(a,b),e=ax.decode(d);return e._baseCache.set(c,a),e}}let ay=(a,b)=>{switch(a[0]){case"Q":{let c=b||U;return[U.prefix,c.decode(`${U.prefix}${a}`)]}case U.prefix:{let c=b||U;return[U.prefix,c.decode(a)]}case H.prefix:{let c=b||H;return[H.prefix,c.decode(a)]}default:if(null==b)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[a[0],b.decode(a)]}},az=(a,b,c)=>{let{prefix:d}=c;if(d!==U.prefix)throw Error(`Cannot string encode V0 in ${c.name} encoding`);let e=b.get(d);if(null!=e)return e;{let e=c.encode(a).slice(1);return b.set(d,e),e}},aA=(a,b,c)=>{let{prefix:d}=c,e=b.get(d);if(null!=e)return e;{let e=c.encode(a);return b.set(d,e),e}},aB=112,aC=18,aD=(a,b,c)=>{let d=ak(a),e=d+ak(b),f=new Uint8Array(e+c.byteLength);return aj(a,f,0),aj(b,f,d),f.set(c,e),f},aE=Symbol.for("@ipld/js-cid/CID"),aF={writable:!1,configurable:!1,enumerable:!0},aG={writable:!1,enumerable:!1,configurable:!1},aH=(a,b)=>{if(a.test("0.0.0-dev"))console.warn(b);else throw Error(b)},aI=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`;a.i(818333),a.i(165113),a.i(228442),a.i(271784);let aJ={...x,...z,...B,...D,...G,...Q,...T,...W,..._,...ae};function aK(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}({...at,...au});let aL=aK("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),aM=aK("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=c((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),aN={utf8:aL,"utf-8":aL,hex:aJ.base16,latin1:aM,ascii:aM,binary:aM,...aJ};function aO(a,c="utf8"){let d=aN[c];if(!d)throw Error(`Unsupported encoding "${c}"`);return("utf8"===c||"utf-8"===c)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?b(globalThis.Buffer.from(a,"utf-8")):d.decoder.decode(`${d.prefix}${a}`)}function aP(a,b="utf8"){let c=aN[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?globalThis.Buffer.from(a.buffer,a.byteOffset,a.byteLength).toString("utf8"):c.encoder.encode(a).substring(1)}a.s(["fromString",()=>aO],465191),a.s(["toString",()=>aP],640843),a.s([],682177);let aQ={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};a.s(["RELAY_JSONRPC",()=>aQ],73915)},343579,(a,b,c)=>{function d(a){return(0x100000000+a).toString(16).substring(1)}b.exports={normalizeInput:function(a){let b;if(a instanceof Uint8Array)b=a;else if("string"==typeof a)b=new TextEncoder().encode(a);else throw Error("Input must be an string, Buffer or Uint8Array");return b},toHex:function(a){return Array.prototype.map.call(a,function(a){return(a<16?"0":"")+a.toString(16)}).join("")},debugPrint:function(a,b,c){let e="\n"+a+" = ";for(let f=0;f<b.length;f+=2){if(32===c)e+=d(b[f]).toUpperCase(),e+=" ",e+=d(b[f+1]).toUpperCase();else if(64===c)e+=d(b[f+1]).toUpperCase(),e+=d(b[f]).toUpperCase();else throw Error("Invalid size "+c);f%6==4?e+="\n"+Array(a.length+4).join(" "):f<b.length-2&&(e+=" ")}console.log(e)},testSpeed:function(a,b,c){let d=new Date().getTime(),e=new Uint8Array(b);for(let a=0;a<b;a++)e[a]=a%256;let f=new Date().getTime();console.log("Generated random input in "+(f-d)+"ms"),d=f;for(let f=0;f<c;f++){let c=a(e),f=new Date().getTime(),g=f-d;d=f,console.log("Hashed in "+g+"ms: "+c.substring(0,20)+"..."),console.log(Math.round(b/1048576/(g/1e3)*100)/100+" MB PER SECOND")}}}},335783,(a,b,c)=>{let d=a.r(343579);function e(a,b,c){let d=a[b]+a[c],e=a[b+1]+a[c+1];d>=0x100000000&&e++,a[b]=d,a[b+1]=e}function f(a,b,c,d){let e=a[b]+c;c<0&&(e+=0x100000000);let f=a[b+1]+d;e>=0x100000000&&f++,a[b]=e,a[b+1]=f}function g(a,b){return a[b]^a[b+1]<<8^a[b+2]<<16^a[b+3]<<24}function h(a,b,c,d,g,h){let i=l[g],j=l[g+1],m=l[h],o=l[h+1];e(k,a,b),f(k,a,i,j);let p=k[d]^k[a],q=k[d+1]^k[a+1];k[d]=q,k[d+1]=p,e(k,c,d),p=k[b]^k[c],q=k[b+1]^k[c+1],k[b]=p>>>24^q<<8,k[b+1]=q>>>24^p<<8,e(k,a,b),f(k,a,m,o),p=k[d]^k[a],q=k[d+1]^k[a+1],k[d]=p>>>16^q<<16,k[d+1]=q>>>16^p<<16,e(k,c,d),p=k[b]^k[c],q=k[b+1]^k[c+1],k[b]=q>>>31^p<<1,k[b+1]=p>>>31^q<<1}let i=new Uint32Array([0xf3bcc908,0x6a09e667,0x84caa73b,0xbb67ae85,0xfe94f82b,0x3c6ef372,0x5f1d36f1,0xa54ff53a,0xade682d1,0x510e527f,0x2b3e6c1f,0x9b05688c,0xfb41bd6b,0x1f83d9ab,0x137e2179,0x5be0cd19]),j=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3].map(function(a){return 2*a})),k=new Uint32Array(32),l=new Uint32Array(32);function m(a,b){let c=0;for(c=0;c<16;c++)k[c]=a.h[c],k[c+16]=i[c];for(k[24]=k[24]^a.t,k[25]=k[25]^a.t/0x100000000,b&&(k[28]=~k[28],k[29]=~k[29]),c=0;c<32;c++)l[c]=g(a.b,4*c);for(c=0;c<12;c++)h(0,8,16,24,j[16*c+0],j[16*c+1]),h(2,10,18,26,j[16*c+2],j[16*c+3]),h(4,12,20,28,j[16*c+4],j[16*c+5]),h(6,14,22,30,j[16*c+6],j[16*c+7]),h(0,10,20,30,j[16*c+8],j[16*c+9]),h(2,12,22,24,j[16*c+10],j[16*c+11]),h(4,14,16,26,j[16*c+12],j[16*c+13]),h(6,8,18,28,j[16*c+14],j[16*c+15]);for(c=0;c<16;c++)a.h[c]=a.h[c]^k[c]^k[c+16]}let o=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function p(a,b,c,d){if(0===a||a>64)throw Error("Illegal output length, expected 0 < length <= 64");if(b&&b.length>64)throw Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(c&&16!==c.length)throw Error("Illegal salt, expected Uint8Array with length is 16");if(d&&16!==d.length)throw Error("Illegal personal, expected Uint8Array with length is 16");let e={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:a};o.fill(0),o[0]=a,b&&(o[1]=b.length),o[2]=1,o[3]=1,c&&o.set(c,32),d&&o.set(d,48);for(let a=0;a<16;a++)e.h[a]=i[a]^g(o,4*a);return b&&(q(e,b),e.c=128),e}function q(a,b){for(let c=0;c<b.length;c++)128===a.c&&(a.t+=a.c,m(a,!1),a.c=0),a.b[a.c++]=b[c]}function r(a){for(a.t+=a.c;a.c<128;)a.b[a.c++]=0;m(a,!0);let b=new Uint8Array(a.outlen);for(let c=0;c<a.outlen;c++)b[c]=a.h[c>>2]>>8*(3&c);return b}function s(a,b,c,e,f){c=c||64,a=d.normalizeInput(a),e&&(e=d.normalizeInput(e)),f&&(f=d.normalizeInput(f));let g=p(c,b,e,f);return q(g,a),r(g)}b.exports={blake2b:s,blake2bHex:function(a,b,c,e,f){let g=s(a,b,c,e,f);return d.toHex(g)},blake2bInit:p,blake2bUpdate:q,blake2bFinal:r}},824034,(a,b,c)=>{let d=a.r(343579);function e(a,b,c,d,e,g){i[a]=i[a]+i[b]+e,i[d]=f(i[d]^i[a],16),i[c]=i[c]+i[d],i[b]=f(i[b]^i[c],12),i[a]=i[a]+i[b]+g,i[d]=f(i[d]^i[a],8),i[c]=i[c]+i[d],i[b]=f(i[b]^i[c],7)}function f(a,b){return a>>>b^a<<32-b}let g=new Uint32Array([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),h=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),i=new Uint32Array(16),j=new Uint32Array(16);function k(a,b){let c=0;for(c=0;c<8;c++)i[c]=a.h[c],i[c+8]=g[c];for(i[12]^=a.t,i[13]^=a.t/0x100000000,b&&(i[14]=~i[14]),c=0;c<16;c++){var d,f;j[c]=(d=a.b)[f=4*c]^d[f+1]<<8^d[f+2]<<16^d[f+3]<<24}for(c=0;c<10;c++)e(0,4,8,12,j[h[16*c+0]],j[h[16*c+1]]),e(1,5,9,13,j[h[16*c+2]],j[h[16*c+3]]),e(2,6,10,14,j[h[16*c+4]],j[h[16*c+5]]),e(3,7,11,15,j[h[16*c+6]],j[h[16*c+7]]),e(0,5,10,15,j[h[16*c+8]],j[h[16*c+9]]),e(1,6,11,12,j[h[16*c+10]],j[h[16*c+11]]),e(2,7,8,13,j[h[16*c+12]],j[h[16*c+13]]),e(3,4,9,14,j[h[16*c+14]],j[h[16*c+15]]);for(c=0;c<8;c++)a.h[c]^=i[c]^i[c+8]}function l(a,b){if(!(a>0&&a<=32))throw Error("Incorrect output length, should be in [1, 32]");let c=b?b.length:0;if(b&&!(c>0&&c<=32))throw Error("Incorrect key length, should be in [1, 32]");let d={h:new Uint32Array(g),b:new Uint8Array(64),c:0,t:0,outlen:a};return d.h[0]^=0x1010000^c<<8^a,c>0&&(m(d,b),d.c=64),d}function m(a,b){for(let c=0;c<b.length;c++)64===a.c&&(a.t+=a.c,k(a,!1),a.c=0),a.b[a.c++]=b[c]}function o(a){for(a.t+=a.c;a.c<64;)a.b[a.c++]=0;k(a,!0);let b=new Uint8Array(a.outlen);for(let c=0;c<a.outlen;c++)b[c]=a.h[c>>2]>>8*(3&c)&255;return b}function p(a,b,c){c=c||32,a=d.normalizeInput(a);let e=l(c,b);return m(e,a),o(e)}b.exports={blake2s:p,blake2sHex:function(a,b,c){let e=p(a,b,c);return d.toHex(e)},blake2sInit:l,blake2sUpdate:m,blake2sFinal:o}},572696,(a,b,c)=>{let d=a.r(335783),e=a.r(824034);b.exports={blake2b:d.blake2b,blake2bHex:d.blake2bHex,blake2bInit:d.blake2bInit,blake2bUpdate:d.blake2bUpdate,blake2bFinal:d.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal}},362562,(a,b,c)=>{b.exports=a.x("module",()=>require("module"))},903874,(a,b,c)=>{"use strict";function d(a,b){return b}b.exports=function(){let a=Error.prepareStackTrace;Error.prepareStackTrace=d;let b=Error().stack;if(Error.prepareStackTrace=a,!Array.isArray(b))return;let c=b.slice(2),e=[];for(let a of c)a&&e.push(a.getFileName());return e}},750227,(a,b,c)=>{b.exports=a.x("node:path",()=>require("node:path"))},327959,(a,b,c)=>{"use strict";if("undefined"!=typeof SharedArrayBuffer&&"undefined"!=typeof Atomics){let a=new Int32Array(new SharedArrayBuffer(4));b.exports=function(b){if(!1==(b>0&&b<1/0)){if("number"!=typeof b&&"bigint"!=typeof b)throw TypeError("sleep: ms must be a number");throw RangeError("sleep: ms must be a number that is greater than 0 but less than Infinity")}Atomics.wait(a,0,0,Number(b))}}else b.exports=function(a){if(!1==(a>0&&a<1/0)){if("number"!=typeof a&&"bigint"!=typeof a)throw TypeError("sleep: ms must be a number");throw RangeError("sleep: ms must be a number that is greater than 0 but less than Infinity")}let b=Date.now()+Number(a);for(;b>Date.now(););}},360012,(a,b,c)=>{"use strict";let d,e={exit:[],beforeExit:[]},f={exit:function(){h("exit")},beforeExit:function(){h("beforeExit")}};function g(a){e[a].length>0||(process.removeListener(a,f[a]),0===e.exit.length&&0===e.beforeExit.length&&(d=void 0))}function h(a){for(let b of e[a]){let c=b.deref(),d=b.fn;void 0!==c&&d(c,a)}e[a]=[]}function i(a){for(let b of["exit","beforeExit"]){let c=e[b].indexOf(a);e[b].splice(c,c+1),g(b)}}function j(a,b,c){if(void 0===b)throw Error("the object can't be undefined");e[a].length>0||process.on(a,f[a]);let g=new WeakRef(b);g.fn=c,void 0===d&&(d=new FinalizationRegistry(i)),d.register(b,g),e[a].push(g)}b.exports={register:function(a,b){j("exit",a,b)},registerBeforeExit:function(a,b){j("beforeExit",a,b)},unregister:function(a){if(void 0!==d)for(let b of(d.unregister(a),["exit","beforeExit"]))e[b]=e[b].filter(b=>{let c=b.deref();return c&&c!==a}),g(b)}}},194346,a=>{a.v({name:"thread-stream",version:"3.1.0",description:"A streaming way to send data to a Node.js Worker Thread",main:"index.js",types:"index.d.ts",dependencies:{"real-require":"^0.2.0"},devDependencies:{"@types/node":"^20.1.0","@types/tap":"^15.0.0","@yao-pkg/pkg":"^5.11.5",desm:"^1.3.0",fastbench:"^1.0.1",husky:"^9.0.6","pino-elasticsearch":"^8.0.0","sonic-boom":"^4.0.1",standard:"^17.0.0",tap:"^16.2.0","ts-node":"^10.8.0",typescript:"^5.3.2","why-is-node-running":"^2.2.2"},scripts:{build:"tsc --noEmit",test:'standard && npm run build && npm run transpile && tap "test/**/*.test.*js" && tap --ts test/*.test.*ts',"test:ci":"standard && npm run transpile && npm run test:ci:js && npm run test:ci:ts","test:ci:js":'tap --no-check-coverage --timeout=120 --coverage-report=lcovonly "test/**/*.test.*js"',"test:ci:ts":'tap --ts --no-check-coverage --coverage-report=lcovonly "test/**/*.test.*ts"',"test:yarn":'npm run transpile && tap "test/**/*.test.js" --no-check-coverage',transpile:"sh ./test/ts/transpile.sh",prepare:"husky install"},standard:{ignore:["test/ts/**/*","test/syntax-error.mjs"]},repository:{type:"git",url:"git+https://github.com/mcollina/thread-stream.git"},keywords:["worker","thread","threads","stream"],author:"Matteo Collina <hello@matteocollina.com>",license:"MIT",bugs:{url:"https://github.com/mcollina/thread-stream/issues"},homepage:"https://github.com/mcollina/thread-stream#readme"})},37702,(a,b,c)=>{b.exports=a.x("worker_threads",()=>require("worker_threads"))},261044,(a,b,c)=>{"use strict";b.exports={wait:function(a,b,c,d,e){let f=Date.now()+d,g=Atomics.load(a,b);if(g===c)return void e(null,"ok");let h=g,i=d=>{Date.now()>f?e(null,"timed-out"):setTimeout(()=>{h=g,(g=Atomics.load(a,b))===h?i(d>=1e3?1e3:2*d):g===c?e(null,"ok"):e(null,"not-equal")},d)};i(1)},waitDiff:function(a,b,c,d,e){let f=Date.now()+d,g=Atomics.load(a,b);if(g!==c)return void e(null,"ok");let h=d=>{Date.now()>f?e(null,"timed-out"):setTimeout(()=>{(g=Atomics.load(a,b))!==c?e(null,"ok"):h(d>=1e3?1e3:2*d)},d)};h(1)}}},475067,(a,b,c)=>{"use strict";b.exports={WRITE_INDEX:4,READ_INDEX:8}},505222,(a,b,c)=>{"use strict";let{version:d}=a.r(194346),{EventEmitter:e}=a.r(427699),{Worker:f}=a.r(37702),{join:g}=a.r(814747),{pathToFileURL:h}=a.r(792509),{wait:i}=a.r(261044),{WRITE_INDEX:j,READ_INDEX:k}=a.r(475067),l=a.r(500874),m=a.r(449719),o=Symbol("kImpl"),p=l.constants.MAX_STRING_LENGTH;class q{constructor(a){this._value=a}deref(){return this._value}}class r{register(){}unregister(){}}let s=process.env.NODE_V8_COVERAGE?r:a.g.FinalizationRegistry||r,t=process.env.NODE_V8_COVERAGE?q:a.g.WeakRef||q,u=new s(a=>{a.exited||a.terminate()});function v(a){m(!a[o].sync),a[o].needDrain&&(a[o].needDrain=!1,a.emit("drain"))}function w(a){let b=Atomics.load(a[o].state,j),c=a[o].data.length-b;if(c>0){if(0===a[o].buf.length){a[o].flushing=!1,a[o].ending?C(a):a[o].needDrain&&process.nextTick(v,a);return}let b=a[o].buf.slice(0,c),d=Buffer.byteLength(b);d<=c?(a[o].buf=a[o].buf.slice(c),B(a,b,w.bind(null,a))):a.flush(()=>{if(!a.destroyed){for(Atomics.store(a[o].state,k,0),Atomics.store(a[o].state,j,0);d>a[o].data.length;)c/=2,b=a[o].buf.slice(0,c),d=Buffer.byteLength(b);a[o].buf=a[o].buf.slice(c),B(a,b,w.bind(null,a))}})}else if(0===c){if(0===b&&0===a[o].buf.length)return;a.flush(()=>{Atomics.store(a[o].state,k,0),Atomics.store(a[o].state,j,0),w(a)})}else A(a,Error("overwritten"))}function x(a){let b=this.stream.deref();if(void 0===b){this.exited=!0,this.terminate();return}switch(a.code){case"READY":this.stream=new t(b),b.flush(()=>{b[o].ready=!0,b.emit("ready")});break;case"ERROR":A(b,a.err);break;case"EVENT":Array.isArray(a.args)?b.emit(a.name,...a.args):b.emit(a.name,a.args);break;case"WARNING":process.emitWarning(a.err);break;default:A(b,Error("this should not happen: "+a.code))}}function y(a){let b=this.stream.deref();void 0!==b&&(u.unregister(b),b.worker.exited=!0,b.worker.off("exit",y),A(b,0!==a?Error("the worker thread exited"):null))}function z(a,b){setImmediate(()=>{a.emit("error",b)})}function A(a,b){a[o].destroyed||(a[o].destroyed=!0,b&&(a[o].errored=b,z(a,b)),a.worker.exited?setImmediate(()=>{a[o].closed=!0,a.emit("close")}):a.worker.terminate().catch(()=>{}).then(()=>{a[o].closed=!0,a.emit("close")}))}function B(a,b,c){let d=Atomics.load(a[o].state,j),e=Buffer.byteLength(b);return a[o].data.write(b,d),Atomics.store(a[o].state,j,d+e),Atomics.notify(a[o].state,j),c(),!0}function C(a){if(!a[o].ended&&a[o].ending&&!a[o].flushing){a[o].ended=!0;try{a.flushSync();let b=Atomics.load(a[o].state,k);Atomics.store(a[o].state,j,-1),Atomics.notify(a[o].state,j);let c=0;for(;-1!==b;){if(Atomics.wait(a[o].state,k,b,1e3),b=Atomics.load(a[o].state,k),-2===b)return void A(a,Error("end() failed"));if(10==++c)return void A(a,Error("end() took too long (10s)"))}process.nextTick(()=>{a[o].finished=!0,a.emit("finish")})}catch(b){A(a,b)}}}function D(a){let b=()=>{a[o].ending?C(a):a[o].needDrain&&process.nextTick(v,a)};for(a[o].flushing=!1;0!==a[o].buf.length;){let c=Atomics.load(a[o].state,j),d=a[o].data.length-c;if(0===d){E(a),Atomics.store(a[o].state,k,0),Atomics.store(a[o].state,j,0);continue}if(d<0)throw Error("overwritten");let e=a[o].buf.slice(0,d),f=Buffer.byteLength(e);if(f<=d)a[o].buf=a[o].buf.slice(d),B(a,e,b);else{for(E(a),Atomics.store(a[o].state,k,0),Atomics.store(a[o].state,j,0);f>a[o].buf.length;)d/=2,e=a[o].buf.slice(0,d),f=Buffer.byteLength(e);a[o].buf=a[o].buf.slice(d),B(a,e,b)}}}function E(a){if(a[o].flushing)throw Error("unable to flush while flushing");let b=Atomics.load(a[o].state,j),c=0;for(;;){let d=Atomics.load(a[o].state,k);if(-2===d)throw Error("_flushSync failed");if(d!==b)Atomics.wait(a[o].state,k,d,1e3);else break;if(10==++c)throw Error("_flushSync took too long (10s)")}}b.exports=class extends e{constructor(a={}){if(super(),a.bufferSize<4)throw Error("bufferSize must at least fit a 4-byte utf-8 char");this[o]={},this[o].stateBuf=new SharedArrayBuffer(128),this[o].state=new Int32Array(this[o].stateBuf),this[o].dataBuf=new SharedArrayBuffer(a.bufferSize||4194304),this[o].data=Buffer.from(this[o].dataBuf),this[o].sync=a.sync||!1,this[o].ending=!1,this[o].ended=!1,this[o].needDrain=!1,this[o].destroyed=!1,this[o].flushing=!1,this[o].ready=!1,this[o].finished=!1,this[o].errored=null,this[o].closed=!1,this[o].buf="",this.worker=function(a,b){let{filename:c,workerData:e}=b,i=new f(("__bundlerPathsOverrides"in globalThis?globalThis.__bundlerPathsOverrides:{})["thread-stream-worker"]||g("/ROOT/node_modules/thread-stream","lib","worker.js"),{...b.workerOpts,trackUnmanagedFds:!1,workerData:{filename:0===c.indexOf("file://")?c:h(c).href,dataBuf:a[o].dataBuf,stateBuf:a[o].stateBuf,workerData:{$context:{threadStreamVersion:d},...e}}});return i.stream=new q(a),i.on("message",x),i.on("exit",y),u.register(a,i),i}(this,a),this.on("message",(a,b)=>{this.worker.postMessage(a,b)})}write(a){if(this[o].destroyed)return z(this,Error("the worker has exited")),!1;if(this[o].ending)return z(this,Error("the worker is ending")),!1;if(this[o].flushing&&this[o].buf.length+a.length>=p)try{D(this),this[o].flushing=!0}catch(a){return A(this,a),!1}if(this[o].buf+=a,this[o].sync)try{return D(this),!0}catch(a){return A(this,a),!1}return this[o].flushing||(this[o].flushing=!0,setImmediate(w,this)),this[o].needDrain=this[o].data.length-this[o].buf.length-Atomics.load(this[o].state,j)<=0,!this[o].needDrain}end(){this[o].destroyed||(this[o].ending=!0,C(this))}flush(a){if(this[o].destroyed){"function"==typeof a&&process.nextTick(a,Error("the worker has exited"));return}let b=Atomics.load(this[o].state,j);i(this[o].state,k,b,1/0,(b,c)=>{if(b){A(this,b),process.nextTick(a,b);return}"not-equal"===c?this.flush(a):process.nextTick(a)})}flushSync(){this[o].destroyed||(D(this),E(this))}unref(){this.worker.unref()}ref(){this.worker.ref()}get ready(){return this[o].ready}get destroyed(){return this[o].destroyed}get closed(){return this[o].closed}get writable(){return!this[o].destroyed&&!this[o].ending}get writableEnded(){return this[o].ending}get writableFinished(){return this[o].finished}get writableNeedDrain(){return this[o].needDrain}get writableObjectMode(){return!1}get writableErrored(){return this[o].errored}}},47325,(a,b,c)=>{"use strict";let{createRequire:d}=a.r(362562),e=a.r(903874),{join:f,isAbsolute:g,sep:h}=a.r(750227),i=a.r(327959),j=a.r(360012),k=a.r(505222);function l(a){a.ref(),a.flushSync(),a.end(),a.once("close",function(){a.unref()})}function m(a){a.flushSync()}b.exports=function(a){let{pipeline:b,targets:c,levels:o,dedupe:p,worker:q={},caller:r=e(),sync:s=!1}=a,t={...a.options},u="string"==typeof r?[r]:r,v="__bundlerPathsOverrides"in globalThis?globalThis.__bundlerPathsOverrides:{},w=a.target;if(w&&c)throw Error("only one of target or targets can be specified");c?(w=v["pino-worker"]||f("/ROOT/node_modules/pino/lib","worker.js"),t.targets=c.filter(a=>a.target).map(a=>({...a,target:z(a.target)})),t.pipelines=c.filter(a=>a.pipeline).map(a=>a.pipeline.map(b=>({...b,level:a.level,target:z(b.target)})))):b&&(w=v["pino-worker"]||f("/ROOT/node_modules/pino/lib","worker.js"),t.pipelines=[b.map(a=>({...a,target:z(a.target)}))]),o&&(t.levels=o),p&&(t.dedupe=p),t.pinoWillSendConfig=!0;let x=new k({filename:z(w),workerData:t,workerOpts:q,sync:s});function y(){x.closed||(x.flushSync(),i(100),x.end())}return x.on("ready",function(){process.removeListener("exit",y),x.unref(),!1!==q.autoEnd&&(j.register(x,l),j.registerBeforeExit(x,m),x.on("close",function(){j.unregister(x)}))}),x.on("close",function(){process.removeListener("exit",y)}),process.on("exit",y),x;function z(a){let b;if(g(a=v[a]||a)||0===a.indexOf("file://"))return a;if("pino/file"===a)return f("/ROOT/node_modules/pino/lib","..","file.js");for(let c of u)try{let e="node:repl"===c?process.cwd()+h:c;b=d(e).resolve(a);break}catch(a){continue}if(!b)throw Error(`unable to determine transport target for "${a}"`);return b}}},311500,(a,b,c)=>{b.exports={DEFAULT_LEVELS:{trace:10,debug:20,info:30,warn:40,error:50,fatal:60},SORTING_ORDER:{ASC:"ASC",DESC:"DESC"}}},688454,(a,b,c)=>{"use strict";let d=Symbol.for("pino.metadata"),{DEFAULT_LEVELS:e}=a.r(311500),f=e.info;function g(a,b){return a.level-b.level}b.exports=function(a,b){a=a||[],b=b||{dedupe:!1};let c=Object.create(e);c.silent=1/0,b.levels&&"object"==typeof b.levels&&Object.keys(b.levels).forEach(a=>{c[a]=b.levels[a]});let h={write:i,add:l,remove:m,emit:j,flushSync:k,end:function(){for(let{stream:a}of this.streams)"function"==typeof a.flushSync&&a.flushSync(),a.end()},minLevel:0,lastId:0,streams:[],clone:function a(b){let c=Array(this.streams.length);for(let a=0;a<c.length;a++)c[a]={level:b,stream:this.streams[a].stream};return{write:i,add:l,remove:m,minLevel:b,streams:c,clone:a,emit:j,flushSync:k,[d]:!0}},[d]:!0,streamLevels:c};return Array.isArray(a)?a.forEach(l,h):l.call(h,a),a=null,h;function i(a){var c,e,f,g;let h,i,j=this.lastLevel,{streams:k}=this,l=0;for(let m=(c=k.length,b.dedupe?c-1:0);e=m,f=k.length,b.dedupe?e>=0:e<f;g=m,m=b.dedupe?g-1:g+1)if((h=k[m]).level<=j){if(0!==l&&l!==h.level)break;if((i=h.stream)[d]){let{lastTime:a,lastMsg:b,lastObj:c,lastLogger:d}=this;i.lastLevel=j,i.lastTime=a,i.lastMsg=b,i.lastObj=c,i.lastLogger=d}i.write(a),b.dedupe&&(l=h.level)}else if(!b.dedupe)break}function j(...a){for(let{stream:b}of this.streams)"function"==typeof b.emit&&b.emit(...a)}function k(){for(let{stream:a}of this.streams)"function"==typeof a.flushSync&&a.flushSync()}function l(a){if(!a)return h;let b="function"==typeof a.write||a.stream,c=a.write?a:a.stream;if(!b)throw Error("stream object needs to implement either StreamEntry or DestinationStream interface");let{streams:d,streamLevels:e}=this,i={stream:c,level:"number"==typeof a.levelVal?a.levelVal:"string"==typeof a.level?e[a.level]:"number"==typeof a.level?a.level:f,levelVal:void 0,id:++h.lastId};return d.unshift(i),d.sort(g),this.minLevel=d[0].level,h}function m(a){let{streams:b}=this,c=b.findIndex(b=>b.id===a);return c>=0&&(b.splice(c,1),b.sort(g),this.minLevel=b.length>0?b[0].level:-1),h}}},660526,(a,b,c)=>{b.exports=a.x("node:os",()=>require("node:os"))},577905,(a,b,c)=>{"use strict";let d=a=>a&&"string"==typeof a.message,e=a=>{if(!a)return;let b=a.cause;if("function"!=typeof b)return d(b)?b:void 0;{let b=a.cause();return d(b)?b:void 0}},f=(a,b)=>{if(!d(a))return"";let c=a.stack||"";if(b.has(a))return c+"\ncauses have become circular...";let g=e(a);return g?(b.add(a),c+"\ncaused by: "+f(g,b)):c},g=(a,b,c)=>{if(!d(a))return"";let f=c?"":a.message||"";if(b.has(a))return f+": ...";let h=e(a);if(!h)return f;{b.add(a);let c="function"==typeof a.cause;return f+(c?"":": ")+g(h,b,c)}};b.exports={isErrorLike:d,getErrorCause:e,stackWithCauses:a=>f(a,new Set),messageWithCauses:a=>g(a,new Set)}},445115,(a,b,c)=>{"use strict";let d=Symbol("circular-ref-tag"),e=Symbol("pino-raw-err-ref"),f=Object.create({},{type:{enumerable:!0,writable:!0,value:void 0},message:{enumerable:!0,writable:!0,value:void 0},stack:{enumerable:!0,writable:!0,value:void 0},aggregateErrors:{enumerable:!0,writable:!0,value:void 0},raw:{enumerable:!1,get:function(){return this[e]},set:function(a){this[e]=a}}});Object.defineProperty(f,e,{writable:!0,value:{}}),b.exports={pinoErrProto:f,pinoErrorSymbols:{seen:d,rawSymbol:e}}},566653,(a,b,c)=>{"use strict";b.exports=function a(b){if(!f(b))return b;b[i]=void 0;let c=Object.create(g);for(let g in c.type="[object Function]"===j.call(b.constructor)?b.constructor.name:b.name,c.message=d(b),c.stack=e(b),Array.isArray(b.errors)&&(c.aggregateErrors=b.errors.map(b=>a(b))),b)if(void 0===c[g]){let d=b[g];f(d)?"cause"===g||Object.prototype.hasOwnProperty.call(d,i)||(c[g]=a(d)):c[g]=d}return delete b[i],c.raw=b,c};let{messageWithCauses:d,stackWithCauses:e,isErrorLike:f}=a.r(577905),{pinoErrProto:g,pinoErrorSymbols:h}=a.r(445115),{seen:i}=h,{toString:j}=Object.prototype},145446,(a,b,c)=>{"use strict";b.exports=function a(b){if(!d(b))return b;b[g]=void 0;let c=Object.create(e);for(let e in c.type="[object Function]"===h.call(b.constructor)?b.constructor.name:b.name,c.message=b.message,c.stack=b.stack,Array.isArray(b.errors)&&(c.aggregateErrors=b.errors.map(b=>a(b))),d(b.cause)&&!Object.prototype.hasOwnProperty.call(b.cause,g)&&(c.cause=a(b.cause)),b)if(void 0===c[e]){let f=b[e];d(f)?Object.prototype.hasOwnProperty.call(f,g)||(c[e]=a(f)):c[e]=f}return delete b[g],c.raw=b,c};let{isErrorLike:d}=a.r(577905),{pinoErrProto:e,pinoErrorSymbols:f}=a.r(445115),{seen:g}=f,{toString:h}=Object.prototype},919067,(a,b,c)=>{"use strict";b.exports={mapHttpRequest:function(a){return{req:f(a)}},reqSerializer:f};let d=Symbol("pino-raw-req-ref"),e=Object.create({},{id:{enumerable:!0,writable:!0,value:""},method:{enumerable:!0,writable:!0,value:""},url:{enumerable:!0,writable:!0,value:""},query:{enumerable:!0,writable:!0,value:""},params:{enumerable:!0,writable:!0,value:""},headers:{enumerable:!0,writable:!0,value:{}},remoteAddress:{enumerable:!0,writable:!0,value:""},remotePort:{enumerable:!0,writable:!0,value:""},raw:{enumerable:!1,get:function(){return this[d]},set:function(a){this[d]=a}}});function f(a){let b=a.info||a.socket,c=Object.create(e);if(c.id="function"==typeof a.id?a.id():a.id||(a.info?a.info.id:void 0),c.method=a.method,a.originalUrl)c.url=a.originalUrl;else{let b=a.path;c.url="string"==typeof b?b:a.url?a.url.path||a.url:void 0}return a.query&&(c.query=a.query),a.params&&(c.params=a.params),c.headers=a.headers,c.remoteAddress=b&&b.remoteAddress,c.remotePort=b&&b.remotePort,c.raw=a.raw||a,c}Object.defineProperty(e,d,{writable:!0,value:{}})},510139,(a,b,c)=>{"use strict";b.exports={mapHttpResponse:function(a){return{res:f(a)}},resSerializer:f};let d=Symbol("pino-raw-res-ref"),e=Object.create({},{statusCode:{enumerable:!0,writable:!0,value:0},headers:{enumerable:!0,writable:!0,value:""},raw:{enumerable:!1,get:function(){return this[d]},set:function(a){this[d]=a}}});function f(a){let b=Object.create(e);return b.statusCode=a.headersSent?a.statusCode:null,b.headers=a.getHeaders?a.getHeaders():a._headers,b.raw=a,b}Object.defineProperty(e,d,{writable:!0,value:{}})},631046,(a,b,c)=>{"use strict";let d=a.r(566653),e=a.r(145446),f=a.r(919067),g=a.r(510139);b.exports={err:d,errWithCause:e,mapHttpRequest:f.mapHttpRequest,mapHttpResponse:g.mapHttpResponse,req:f.reqSerializer,res:g.resSerializer,wrapErrorSerializer:function(a){return a===d?a:function(b){return a(d(b))}},wrapRequestSerializer:function(a){return a===f.reqSerializer?a:function(b){return a(f.reqSerializer(b))}},wrapResponseSerializer:function(a){return a===g.resSerializer?a:function(b){return a(g.resSerializer(b))}}}},480202,(a,b,c)=>{"use strict";function d(a){let b=[],c="",d=!1,e=!1,f="";for(let g=0;g<a.length;g++){let h=a[g];d||"."!==h?"["===h?(c&&(b.push(c),c=""),d=!0):"]"===h&&d?(b.push(c),c="",d=!1,e=!1):('"'===h||"'"===h)&&d?e?h===f?(e=!1,f=""):c+=h:(e=!0,f=h):c+=h:c&&(b.push(c),c="")}return c&&b.push(c),b}function e(a,b,c){let d=a;for(let a=0;a<b.length-1;a++){let c=b[a];if("object"!=typeof d||null===d||!(c in d)||"object"!=typeof d[c]||null===d[c])return!1;d=d[c]}let e=b[b.length-1];if("*"===e){if(Array.isArray(d))for(let a=0;a<d.length;a++)d[a]=c;else if("object"==typeof d&&null!==d)for(let a in d)Object.prototype.hasOwnProperty.call(d,a)&&(d[a]=c)}else"object"==typeof d&&null!==d&&e in d&&Object.prototype.hasOwnProperty.call(d,e)&&(d[e]=c);return!0}function f(a,b){let c=a;for(let a=0;a<b.length-1;a++){let d=b[a];if("object"!=typeof c||null===c||!(d in c)||"object"!=typeof c[d]||null===c[d])return!1;c=c[d]}let d=b[b.length-1];if("*"===d){if(Array.isArray(c))for(let a=0;a<c.length;a++)c[a]=void 0;else if("object"==typeof c&&null!==c)for(let a in c)Object.prototype.hasOwnProperty.call(c,a)&&delete c[a]}else"object"==typeof c&&null!==c&&d in c&&Object.prototype.hasOwnProperty.call(c,d)&&delete c[d];return!0}let g=Symbol("PATH_NOT_FOUND");b.exports=function(a={}){let{paths:b=[],censor:c="[REDACTED]",serialize:h=JSON.stringify,strict:i=!0,remove:j=!1}=a;if(!Array.isArray(b))throw TypeError("paths must be an array");for(let a of b)!function(a){if("string"!=typeof a)throw Error("Paths must be (non-empty) strings");if(""===a)throw Error("Invalid redaction path ()");if(a.includes("..")||a.includes(","))throw Error(`Invalid redaction path (${a})`);let b=0,c=!1,d="";for(let e=0;e<a.length;e++){let f=a[e];if(('"'===f||"'"===f)&&b>0)c?f===d&&(c=!1,d=""):(c=!0,d=f);else if("["!==f||c){if("]"===f&&!c&&--b<0)throw Error(`Invalid redaction path (${a})`)}else b++}if(0!==b)throw Error(`Invalid redaction path (${a})`)}(a);let k=function(a){if(0===a.length)return null;let b=new Map;for(let c of a){let a=d(c),e=b;for(let b=0;b<a.length;b++){let c=a[b];e.has(c)||e.set(c,new Map),e=e.get(c)}}return b}(b);return function(a){if(i&&(null===a||"object"!=typeof a)&&(null==a||"object"!=typeof a))return h?h(a):a;let l=k?function a(b,c,d=0){if(!c||0===c.size||null===b||"object"!=typeof b)return b;if(b instanceof Date)return new Date(b.getTime());if(Array.isArray(b)){let d=[];for(let e=0;e<b.length;e++){let f=e.toString();c.has(f)||c.has("*")?d[e]=a(b[e],c.get(f)||c.get("*")):d[e]=b[e]}return d}let e=Object.create(Object.getPrototypeOf(b));for(let d in b)Object.prototype.hasOwnProperty.call(b,d)&&(c.has(d)||c.has("*")?e[d]=a(b[d],c.get(d)||c.get("*")):e[d]=b[d]);return e}(a,k):a,m=c;return("function"==typeof c&&(m=c),!function(a,b,c,h=!1){for(let i of b){let b=d(i);if(b.includes("*"))!function a(b,c,d,g,h=!1){let i=c.indexOf("*");if(i===c.length-1){let a=c.slice(0,-1),e=b;for(let b of a){if(null==e||"object"!=typeof e||null===e)return;e=e[b]}if(Array.isArray(e))if(h)for(let a=0;a<e.length;a++)e[a]=void 0;else for(let b=0;b<e.length;b++){let c=[...a,b.toString()],f="function"==typeof d?d(e[b],c):d;e[b]=f}else if("object"==typeof e&&null!==e)if(h){let a=[];for(let b in e)Object.prototype.hasOwnProperty.call(e,b)&&a.push(b);for(let b of a)delete e[b]}else for(let b in e){let c=[...a,b],f="function"==typeof d?d(e[b],c):d;e[b]=f}}else!function(b,c,d,g,h,i=!1){let j=c.slice(0,g),k=c.slice(g+1),l=[];function m(b,c){if(c===j.length){if(Array.isArray(b))for(let a=0;a<b.length;a++)l[c]=a.toString(),m(b[a],c+1);else if("object"==typeof b&&null!==b)for(let a in b)l[c]=a,m(b[a],c+1)}else if(c<j.length){let a=j[c];b&&"object"==typeof b&&null!==b&&a in b&&(l[c]=a,m(b[a],c+1))}else if(k.includes("*"))a(b,k,"function"==typeof d?(a,b)=>d(a,[...l.slice(0,c),...b]):d,h,i);else if(i)f(b,k);else{let a="function"==typeof d?d(function(a,b){let c=a;for(let a of b){if(null==c||"object"!=typeof c||null===c)return;c=c[a]}return c}(b,k),[...l.slice(0,c),...k]):d;e(b,k,a)}}if(0===j.length)m(b,0);else{let a=b;for(let b=0;b<j.length;b++){let c=j[b];if(null==a||"object"!=typeof a||null===a)return;a=a[c],l[b]=c}null!=a&&m(a,j.length)}}(b,c,d,i,g,h)}(a,b,c,i,h);else if(h)f(a,b);else{let d=function(a,b){let c=a;for(let a of b){if(null==c||"object"!=typeof c||null===c||!(a in c))return g;c=c[a]}return c}(a,b);if(d===g)continue;let f="function"==typeof c?c(d,b):c;e(a,b,f)}}}(l,b,m,j),!1===h)?(l.restore=function(){return function a(b){if(null===b||"object"!=typeof b)return b;if(b instanceof Date)return new Date(b.getTime());if(b instanceof Array){let c=[];for(let d=0;d<b.length;d++)c[d]=a(b[d]);return c}if("object"==typeof b){let c=Object.create(Object.getPrototypeOf(b));for(let d in b)Object.prototype.hasOwnProperty.call(b,d)&&(c[d]=a(b[d]));return c}return b}(a)},l):"function"==typeof h?h(l):JSON.stringify(l)}}},889275,(a,b,c)=>{"use strict";let d=Symbol("pino.setLevel"),e=Symbol("pino.getLevel"),f=Symbol("pino.levelVal"),g=Symbol("pino.levelComp"),h=Symbol("pino.useLevelLabels"),i=Symbol("pino.useOnlyCustomLevels"),j=Symbol("pino.mixin"),k=Symbol("pino.lsCache"),l=Symbol("pino.chindings"),m=Symbol("pino.asJson"),o=Symbol("pino.write"),p=Symbol("pino.redactFmt"),q=Symbol("pino.time"),r=Symbol("pino.timeSliceIndex"),s=Symbol("pino.stream"),t=Symbol("pino.stringify"),u=Symbol("pino.stringifySafe"),v=Symbol("pino.stringifiers"),w=Symbol("pino.end"),x=Symbol("pino.formatOpts"),y=Symbol("pino.messageKey"),z=Symbol("pino.errorKey"),A=Symbol("pino.nestedKey"),B=Symbol("pino.nestedKeyStr"),C=Symbol("pino.mixinMergeStrategy"),D=Symbol("pino.msgPrefix"),E=Symbol("pino.wildcardFirst"),F=Symbol.for("pino.serializers"),G=Symbol.for("pino.formatters"),H=Symbol.for("pino.hooks");b.exports={setLevelSym:d,getLevelSym:e,levelValSym:f,levelCompSym:g,useLevelLabelsSym:h,mixinSym:j,lsCacheSym:k,chindingsSym:l,asJsonSym:m,writeSym:o,serializersSym:F,redactFmtSym:p,timeSym:q,timeSliceIndexSym:r,streamSym:s,stringifySym:t,stringifySafeSym:u,stringifiersSym:v,endSym:w,formatOptsSym:x,messageKeySym:y,errorKeySym:z,nestedKeySym:A,wildcardFirstSym:E,needsMetadataGsym:Symbol.for("pino.metadata"),useOnlyCustomLevelsSym:i,formattersSym:G,hooksSym:H,nestedKeyStrSym:B,mixinMergeStrategySym:C,msgPrefixSym:D}},986234,(a,b,c)=>{"use strict";let d=a.r(480202),{redactFmtSym:e,wildcardFirstSym:f}=a.r(889275),g=/[^.[\]]+|\[([^[\]]*?)\]/g,h="[Redacted]";b.exports=function(a,b){let{paths:c,censor:i,remove:j}=function(a){if(Array.isArray(a))return{paths:a,censor:h};let{paths:b,censor:c=h,remove:d}=a;if(!1===Array.isArray(b))throw Error("pino  redact must contain an array of strings");return!0===d&&(c=void 0),{paths:b,censor:c,remove:d}}(a),k=c.reduce((a,b)=>{g.lastIndex=0;let c=g.exec(b),d=g.exec(b),e=void 0!==c[1]?c[1].replace(/^(?:"|'|`)(.*)(?:"|'|`)$/,"$1"):c[0];if("*"===e&&(e=f),null===d)return a[e]=null,a;if(null===a[e])return a;let{index:h}=d,i=`${b.substr(h,b.length-1)}`;return a[e]=a[e]||[],e!==f&&0===a[e].length&&a[e].push(...a[f]||[]),e===f&&Object.keys(a).forEach(function(b){a[b]&&a[b].push(i)}),a[e].push(i),a},{}),l={[e]:d({paths:c,censor:i,serialize:b,strict:!1,remove:j})};return[...Object.keys(k),...Object.getOwnPropertySymbols(k)].reduce((a,c)=>{if(null===k[c])a[c]=a=>((...a)=>"function"==typeof i?b(i(...a)):b(i))(a,[c]);else{let e="function"==typeof i?(a,b)=>i(a,[c,...b]):i;a[c]=d({paths:k[c],censor:e,serialize:b,strict:!1,remove:j})}return a},l)}},362344,(a,b,c)=>{"use strict";let d=1000000n*BigInt(Date.now()),e=process.hrtime.bigint();b.exports={nullTime:()=>"",epochTime:()=>`,"time":${Date.now()}`,unixTime:()=>`,"time":${Math.round(Date.now()/1e3)}`,isoTime:()=>`,"time":"${new Date(Date.now()).toISOString()}"`,isoTimeNano:()=>{let a=d+(process.hrtime.bigint()-e),b=a%1000000000n,c=new Date(Number(a/1000000000n*1000n+b/1000000n)),f=c.getUTCFullYear(),g=(c.getUTCMonth()+1).toString().padStart(2,"0"),h=c.getUTCDate().toString().padStart(2,"0"),i=c.getUTCHours().toString().padStart(2,"0"),j=c.getUTCMinutes().toString().padStart(2,"0"),k=c.getUTCSeconds().toString().padStart(2,"0");return`,"time":"${f}-${g}-${h}T${i}:${j}:${k}.${b.toString().padStart(9,"0")}Z"`}}},687769,(a,b,c)=>{b.exports=a.x("node:events",()=>require("node:events"))},677652,(a,b,c)=>{b.exports=a.x("node:diagnostics_channel",()=>require("node:diagnostics_channel"))},250643,(a,b,c)=>{"use strict";function d(a){try{return JSON.stringify(a)}catch(a){return'"[Circular]"'}}b.exports=function(a,b,c){var e=c&&c.stringify||d;if("object"==typeof a&&null!==a){var f=b.length+1;if(1===f)return a;var g=Array(f);g[0]=e(a);for(var h=1;h<f;h++)g[h]=e(b[h]);return g.join(" ")}if("string"!=typeof a)return a;var i=b.length;if(0===i)return a;for(var j="",k=0,l=-1,m=a&&a.length||0,o=0;o<m;){if(37===a.charCodeAt(o)&&o+1<m){switch(l=l>-1?l:0,a.charCodeAt(o+1)){case 100:case 102:if(k>=i||null==b[k])break;l<o&&(j+=a.slice(l,o)),j+=Number(b[k]),l=o+2,o++;break;case 105:if(k>=i||null==b[k])break;l<o&&(j+=a.slice(l,o)),j+=Math.floor(Number(b[k])),l=o+2,o++;break;case 79:case 111:case 106:if(k>=i||void 0===b[k])break;l<o&&(j+=a.slice(l,o));var p=typeof b[k];if("string"===p){j+="'"+b[k]+"'",l=o+2,o++;break}if("function"===p){j+=b[k].name||"<anonymous>",l=o+2,o++;break}j+=e(b[k]),l=o+2,o++;break;case 115:if(k>=i)break;l<o&&(j+=a.slice(l,o)),j+=String(b[k]),l=o+2,o++;break;case 37:l<o&&(j+=a.slice(l,o)),j+="%",l=o+2,o++,k--}++k}++o}return -1===l?a:(l<m&&(j+=a.slice(l)),j)}},474359,(a,b,c)=>{"use strict";let d=a.r(522734),e=a.r(427699),f=a.r(224361).inherits,g=a.r(814747),h=a.r(327959),i=a.r(449719),j=Buffer.allocUnsafe(0),k="buffer",l="utf8",[m,o]=(process.versions.node||"0.0").split(".").map(Number),p=m>=22&&o>=7;function q(a,b){function c(c,d){if(c){b._reopening=!1,b._writing=!1,b._opening=!1,b.sync?process.nextTick(()=>{b.listenerCount("error")>0&&b.emit("error",c)}):b.emit("error",c);return}let e=b._reopening;b.fd=d,b.file=a,b._reopening=!1,b._opening=!1,b._writing=!1,b.sync?process.nextTick(()=>b.emit("ready")):b.emit("ready"),!b.destroyed&&(!b._writing&&b._len>b.minLength||b._flushPending?b._actualWrite():e&&process.nextTick(()=>b.emit("drain")))}b._opening=!0,b._writing=!0,b._asyncDrainScheduled=!1;let e=b.append?"a":"w",f=b.mode;if(b.sync)try{b.mkdir&&d.mkdirSync(g.dirname(a),{recursive:!0});let h=d.openSync(a,e,f);c(null,h)}catch(a){throw c(a),a}else b.mkdir?d.mkdir(g.dirname(a),{recursive:!0},b=>{if(b)return c(b);d.open(a,e,f,c)}):d.open(a,e,f,c)}function r(a){let b,c;if(!(this instanceof r))return new r(a);let{fd:e,dest:f,minLength:g,maxLength:i,maxWrite:m,periodicFlush:o,sync:p,append:u=!0,mkdir:x,retryEAGAIN:F,fsync:G,contentMode:H,mode:I}=a||{};if(e=e||f,this._len=0,this.fd=-1,this._bufs=[],this._lens=[],this._writing=!1,this._ending=!1,this._reopening=!1,this._asyncDrainScheduled=!1,this._flushPending=!1,this._hwm=Math.max(g||0,16387),this.file=null,this.destroyed=!1,this.minLength=g||0,this.maxLength=i||0,this.maxWrite=m||16384,this._periodicFlush=o||0,this._periodicFlushTimer=void 0,this.sync=p||!1,this.writable=!0,this._fsync=G||!1,this.append=u||!1,this.mode=I,this.retryEAGAIN=F||(()=>!0),this.mkdir=x||!1,H===k)this._writingBuf=j,this.write=w,this.flush=z,this.flushSync=B,this._actualWrite=D,b=()=>d.writeSync(this.fd,this._writingBuf),c=()=>d.write(this.fd,this._writingBuf,this.release);else if(void 0===H||H===l)this._writingBuf="",this.write=v,this.flush=y,this.flushSync=A,this._actualWrite=C,b=()=>d.writeSync(this.fd,this._writingBuf,"utf8"),c=()=>d.write(this.fd,this._writingBuf,"utf8",this.release);else throw Error(`SonicBoom supports "${l}" and "${k}", but passed ${H}`);if("number"==typeof e)this.fd=e,process.nextTick(()=>this.emit("ready"));else if("string"==typeof e)q(e,this);else throw Error("SonicBoom supports only file descriptors and files");if(this.minLength>=this.maxWrite)throw Error(`minLength should be smaller than maxWrite (${this.maxWrite})`);this.release=(a,e)=>{if(a){if(("EAGAIN"===a.code||"EBUSY"===a.code)&&this.retryEAGAIN(a,this._writingBuf.length,this._len-this._writingBuf.length))if(this.sync)try{h(100),this.release(void 0,0)}catch(a){this.release(a)}else setTimeout(c,100);else this._writing=!1,this.emit("error",a);return}this.emit("write",e);let f=s(this._writingBuf,this._len,e);if(this._len=f.len,this._writingBuf=f.writingBuf,this._writingBuf.length){if(!this.sync)return void c();try{do{let a=b(),c=s(this._writingBuf,this._len,a);this._len=c.len,this._writingBuf=c.writingBuf}while(this._writingBuf.length)}catch(a){this.release(a);return}}this._fsync&&d.fsyncSync(this.fd);let g=this._len;this._reopening?(this._writing=!1,this._reopening=!1,this.reopen()):g>this.minLength?this._actualWrite():this._ending?g>0?this._actualWrite():(this._writing=!1,E(this)):(this._writing=!1,this.sync?this._asyncDrainScheduled||(this._asyncDrainScheduled=!0,process.nextTick(t,this)):this.emit("drain"))},this.on("newListener",function(a){"drain"===a&&(this._asyncDrainScheduled=!1)}),0!==this._periodicFlush&&(this._periodicFlushTimer=setInterval(()=>this.flush(null),this._periodicFlush),this._periodicFlushTimer.unref())}function s(a,b,c){return"string"==typeof a&&Buffer.byteLength(a)!==c&&(c=Buffer.from(a).subarray(0,c).toString().length),b=Math.max(b-c,0),{writingBuf:a=a.slice(c),len:b}}function t(a){a.listenerCount("drain")>0&&(a._asyncDrainScheduled=!1,a.emit("drain"))}function u(a,b){return 0===a.length?j:1===a.length?a[0]:Buffer.concat(a,b)}function v(a){if(this.destroyed)throw Error("SonicBoom destroyed");let b=this._len+a.length,c=this._bufs;return this.maxLength&&b>this.maxLength?this.emit("drop",a):(0===c.length||c[c.length-1].length+a.length>this.maxWrite?c.push(""+a):c[c.length-1]+=a,this._len=b,!this._writing&&this._len>=this.minLength&&this._actualWrite()),this._len<this._hwm}function w(a){if(this.destroyed)throw Error("SonicBoom destroyed");let b=this._len+a.length,c=this._bufs,d=this._lens;return this.maxLength&&b>this.maxLength?this.emit("drop",a):(0===c.length||d[d.length-1]+a.length>this.maxWrite?(c.push([a]),d.push(a.length)):(c[c.length-1].push(a),d[d.length-1]+=a.length),this._len=b,!this._writing&&this._len>=this.minLength&&this._actualWrite()),this._len<this._hwm}function x(a){this._flushPending=!0;let b=()=>{if(this._fsync)this._flushPending=!1,a();else try{d.fsync(this.fd,b=>{this._flushPending=!1,a(b)})}catch(b){a(b)}this.off("error",c)},c=c=>{this._flushPending=!1,a(c),this.off("drain",b)};this.once("drain",b),this.once("error",c)}function y(a){if(null!=a&&"function"!=typeof a)throw Error("flush cb must be a function");if(this.destroyed){let b=Error("SonicBoom destroyed");if(a)return void a(b);throw b}this.minLength<=0?a?.():(a&&x.call(this,a),this._writing||(0===this._bufs.length&&this._bufs.push(""),this._actualWrite()))}function z(a){if(null!=a&&"function"!=typeof a)throw Error("flush cb must be a function");if(this.destroyed){let b=Error("SonicBoom destroyed");if(a)return void a(b);throw b}this.minLength<=0?a?.():(a&&x.call(this,a),this._writing||(0===this._bufs.length&&(this._bufs.push([]),this._lens.push(0)),this._actualWrite()))}function A(){if(this.destroyed)throw Error("SonicBoom destroyed");if(this.fd<0)throw Error("sonic boom is not ready yet");!this._writing&&this._writingBuf.length>0&&(this._bufs.unshift(this._writingBuf),this._writingBuf="");let a="";for(;this._bufs.length||a;){a.length<=0&&(a=this._bufs[0]);try{let b=d.writeSync(this.fd,a,"utf8"),c=s(a,this._len,b);a=c.writingBuf,this._len=c.len,a.length<=0&&this._bufs.shift()}catch(b){if(("EAGAIN"===b.code||"EBUSY"===b.code)&&!this.retryEAGAIN(b,a.length,this._len-a.length))throw b;h(100)}}try{d.fsyncSync(this.fd)}catch{}}function B(){if(this.destroyed)throw Error("SonicBoom destroyed");if(this.fd<0)throw Error("sonic boom is not ready yet");!this._writing&&this._writingBuf.length>0&&(this._bufs.unshift([this._writingBuf]),this._writingBuf=j);let a=j;for(;this._bufs.length||a.length;){a.length<=0&&(a=u(this._bufs[0],this._lens[0]));try{let b=d.writeSync(this.fd,a);a=a.subarray(b),this._len=Math.max(this._len-b,0),a.length<=0&&(this._bufs.shift(),this._lens.shift())}catch(b){if(("EAGAIN"===b.code||"EBUSY"===b.code)&&!this.retryEAGAIN(b,a.length,this._len-a.length))throw b;h(100)}}}function C(){let a=this.release;if(this._writing=!0,this._writingBuf=this._writingBuf||this._bufs.shift()||"",this.sync)try{let b=d.writeSync(this.fd,this._writingBuf,"utf8");a(null,b)}catch(b){a(b)}else d.write(this.fd,this._writingBuf,"utf8",a)}function D(){let a=this.release;if(this._writing=!0,this._writingBuf=this._writingBuf.length?this._writingBuf:u(this._bufs.shift(),this._lens.shift()),this.sync)try{let b=d.writeSync(this.fd,this._writingBuf);a(null,b)}catch(b){a(b)}else p&&(this._writingBuf=Buffer.from(this._writingBuf)),d.write(this.fd,this._writingBuf,a)}function E(a){if(-1===a.fd)return void a.once("ready",E.bind(null,a));void 0!==a._periodicFlushTimer&&clearInterval(a._periodicFlushTimer),a.destroyed=!0,a._bufs=[],a._lens=[],i("number"==typeof a.fd,`sonic.fd must be a number, got ${typeof a.fd}`);try{d.fsync(a.fd,function(){1!==a.fd&&2!==a.fd?d.close(a.fd,b):b()})}catch{}function b(b){b?a.emit("error",b):(a._ending&&!a._writing&&a.emit("finish"),a.emit("close"))}}f(r,e),r.prototype.reopen=function(a){if(this.destroyed)throw Error("SonicBoom destroyed");if(this._opening)return void this.once("ready",()=>{this.reopen(a)});if(this._ending)return;if(!this.file)throw Error("Unable to reopen a file descriptor, you must pass a file to SonicBoom");if(a&&(this.file=a),this._reopening=!0,this._writing)return;let b=this.fd;this.once("ready",()=>{b!==this.fd&&d.close(b,a=>{if(a)return this.emit("error",a)})}),q(this.file,this)},r.prototype.end=function(){if(this.destroyed)throw Error("SonicBoom destroyed");this._opening?this.once("ready",()=>{this.end()}):this._ending||(this._ending=!0,this._writing||(this._len>0&&this.fd>=0?this._actualWrite():E(this)))},r.prototype.destroy=function(){this.destroyed||E(this)},r.SonicBoom=r,r.default=r,b.exports=r},89357,(a,b,c)=>{"use strict";let d=a.r(677652),e=a.r(250643),{mapHttpRequest:f,mapHttpResponse:g}=a.r(631046),h=a.r(474359),i=a.r(360012),{lsCacheSym:j,chindingsSym:k,writeSym:l,serializersSym:m,formatOptsSym:o,endSym:p,stringifiersSym:q,stringifySym:r,stringifySafeSym:s,wildcardFirstSym:t,nestedKeySym:u,formattersSym:v,messageKeySym:w,errorKeySym:x,nestedKeyStrSym:y,msgPrefixSym:z}=a.r(889275),{isMainThread:A}=a.r(37702),B=a.r(47325),C=d.tracingChannel("pino_asJson");function D(){}function E(a){let b="",c=0,d=!1,e=255,f=a.length;if(f>100)return JSON.stringify(a);for(var g=0;g<f&&e>=32;g++)(34===(e=a.charCodeAt(g))||92===e)&&(b+=a.slice(c,g)+"\\",c=g,d=!0);return d?b+=a.slice(c):b=a,e<32?JSON.stringify(a):'"'+b+'"'}function F(a,b,c,d){let e,f=this[r],g=this[s],h=this[q],i=this[p],l=this[k],o=this[m],z=this[v],A=this[w],B=this[x],C=this[j][c]+d;C+=l,z.log&&(a=z.log(a));let D=h[t],F="";for(let b in a)if(e=a[b],Object.prototype.hasOwnProperty.call(a,b)&&void 0!==e){o[b]?e=o[b](e):b===B&&o.err&&(e=o.err(e));let a=h[b]||D;switch(typeof e){case"undefined":case"function":continue;case"number":!1===Number.isFinite(e)&&(e=null);case"boolean":a&&(e=a(e));break;case"string":e=(a||E)(e);break;default:e=(a||f)(e,g)}if(void 0===e)continue;F+=","+E(b)+":"+e}let G="";if(void 0!==b){e=o[A]?o[A](b):b;let a=h[A]||D;switch(typeof e){case"function":break;case"number":!1===Number.isFinite(e)&&(e=null);case"boolean":a&&(e=a(e)),G=',"'+A+'":'+e;break;case"string":G=',"'+A+'":'+(e=(a||E)(e));break;default:G=',"'+A+'":'+(e=(a||f)(e,g))}}return this[u]&&F?C+this[y]+F.slice(1)+"}"+G+i:C+F+G+i}function G(a){let b=new h(a);return b.on("error",function a(c){if("EPIPE"===c.code){b.write=D,b.end=D,b.flushSync=D,b.destroy=D;return}b.removeListener("error",a),b.emit("error",c)}),!a.sync&&A&&(i.register(b,H),b.on("close",function(){i.unregister(b)})),b}function H(a,b){a.destroyed||("beforeExit"===b?(a.flush(),a.on("drain",function(){a.end()})):a.flushSync())}b.exports={noop:D,buildSafeSonicBoom:G,asChindings:function(a,b){let c,d=a[k],e=a[r],f=a[s],g=a[q],h=g[t],i=a[m];for(let j in b=(0,a[v].bindings)(b))if(c=b[j],!0===((j.length<5||"level"!==j&&"serializers"!==j&&"formatters"!==j&&"customLevels"!==j)&&b.hasOwnProperty(j)&&void 0!==c)){if(c=i[j]?i[j](c):c,void 0===(c=(g[j]||h||e)(c,f)))continue;d+=',"'+j+'":'+c}return d},asJson:function(a,b,c,d){return!1===C.hasSubscribers?F.call(this,a,b,c,d):C.traceSync(F,{instance:this,arguments},this,a,b,c,d)},genLog:function(a,b){if(!b)return c;return function(...d){b.call(this,d,c,a)};function c(b,...d){if("object"==typeof b){let c,h=b;null!==b&&(b.method&&b.headers&&b.socket?b=f(b):"function"==typeof b.setHeader&&(b=g(b))),null===h&&0===d.length?c=[null]:(h=d.shift(),c=d),"string"==typeof this[z]&&null!=h&&(h=this[z]+h),this[l](b,e(h,c,this[o]),a)}else{let c=void 0===b?d.shift():b;"string"==typeof this[z]&&null!=c&&(c=this[z]+c),this[l](null,e(c,d,this[o]),a)}}},createArgsNormalizer:function(a){return function(b,c,d={},e){if("string"==typeof d)e=G({dest:d}),d={};else if("string"==typeof e){if(d&&d.transport)throw Error("only one of option.transport or stream can be specified");e=G({dest:e})}else if(d instanceof h||d.writable||d._writableState)e=d,d={};else if(d.transport){let a;if(d.transport instanceof h||d.transport.writable||d.transport._writableState)throw Error("option.transport do not allow stream, please pass to option directly. e.g. pino(transport)");if(d.transport.targets&&d.transport.targets.length&&d.formatters&&"function"==typeof d.formatters.level)throw Error("option.transport.targets do not allow custom level formatters");d.customLevels&&(a=d.useOnlyCustomLevels?d.customLevels:Object.assign({},d.levels,d.customLevels)),e=B({caller:c,...d.transport,levels:a})}if((d=Object.assign({},a,d)).serializers=Object.assign({},a.serializers,d.serializers),d.formatters=Object.assign({},a.formatters,d.formatters),d.prettyPrint)throw Error("prettyPrint option is no longer supported, see the pino-pretty package (https://github.com/pinojs/pino-pretty)");let{enabled:f,onChild:g}=d;if(!1===f&&(d.level="silent"),g||(d.onChild=D),!e){var i;e=(i=process.stdout).write!==i.constructor.prototype.write?process.stdout:G({fd:process.stdout.fd||1})}return{opts:d,stream:e}}},stringify:function(a,b){try{return JSON.stringify(a)}catch(c){try{return(b||this[s])(a)}catch(a){return'"[unable to serialize, circular reference is too complex to analyze]"'}}},buildFormatters:function(a,b,c){return{level:a,bindings:b,log:c}},normalizeDestFileDescriptor:function(a){let b=Number(a);return"string"==typeof a&&Number.isFinite(b)?b:void 0===a?1:a}}},292204,(a,b,c)=>{"use strict";let{lsCacheSym:d,levelValSym:e,useOnlyCustomLevelsSym:f,streamSym:g,formattersSym:h,hooksSym:i,levelCompSym:j}=a.r(889275),{noop:k,genLog:l}=a.r(89357),{DEFAULT_LEVELS:m,SORTING_ORDER:o}=a.r(311500),p={fatal:a=>{let b=l(m.fatal,a);return function(...a){let c=this[g];if(b.call(this,...a),"function"==typeof c.flushSync)try{c.flushSync()}catch(a){}}},error:a=>l(m.error,a),warn:a=>l(m.warn,a),info:a=>l(m.info,a),debug:a=>l(m.debug,a),trace:a=>l(m.trace,a)},q=Object.keys(m).reduce((a,b)=>(a[m[b]]=b,a),{});function r(a,b,c){return a===o.DESC?b<=c:b>=c}b.exports={initialLsCache:Object.keys(q).reduce((a,b)=>(a[b]='{"level":'+Number(b),a),{}),genLsCache:function(a){let b=a[h].level,{labels:c}=a.levels,e={};for(let a in c){let d=b(c[a],Number(a));e[a]=JSON.stringify(d).slice(0,-1)}return a[d]=e,a},levelMethods:p,getLevel:function(a){let{levels:b,levelVal:c}=this;return b&&b.labels?b.labels[c]:""},setLevel:function(a){let{labels:b,values:c}=this.levels;if("number"==typeof a){if(void 0===b[a])throw Error("unknown level value"+a);a=b[a]}if(void 0===c[a])throw Error("unknown level "+a);let d=this[e],g=this[e]=c[a],h=this[f],m=this[j],o=this[i].logMethod;for(let a in c){if(!1===m(c[a],g)){this[a]=k;continue}this[a]=!function(a,b){if(b)return!1;switch(a){case"fatal":case"error":case"warn":case"info":case"debug":case"trace":return!0;default:return!1}}(a,h)?l(c[a],o):p[a](o)}this.emit("level-change",a,g,b[d],d,this)},isLevelEnabled:function(a){let{values:b}=this.levels,c=b[a];return void 0!==c&&this[j](c,this[e])},mappings:function(a=null,b=!1){let c=a?Object.keys(a).reduce((b,c)=>(b[a[c]]=c,b),{}):null;return{labels:Object.assign(Object.create(Object.prototype,{Infinity:{value:"silent"}}),b?null:q,c),values:Object.assign(Object.create(Object.prototype,{silent:{value:1/0}}),b?null:m,a)}},assertNoLevelCollisions:function(a,b){let{labels:c,values:d}=a;for(let a in b){if(a in d)throw Error("levels cannot be overridden");if(b[a]in c)throw Error("pre-existing level values cannot be used for new levels")}},assertDefaultLevelFound:function(a,b,c){if("number"==typeof a){if(![].concat(Object.keys(b||{}).map(a=>b[a]),c?[]:Object.keys(q).map(a=>+a),1/0).includes(a))throw Error(`default level:${a} must be included in custom levels`);return}if(!(a in Object.assign(Object.create(Object.prototype,{silent:{value:1/0}}),c?null:m,b)))throw Error(`default level:${a} must be included in custom levels`)},genLevelComparison:function(a){return"string"==typeof a?r.bind(null,a):a},assertLevelComparison:function(a){if("function"!=typeof a&&!("string"==typeof a&&Object.values(o).includes(a)))throw Error('Levels comparison should be one of "ASC", "DESC" or "function" type')}}},349478,(a,b,c)=>{"use strict";b.exports={version:"10.0.0"}},603693,(a,b,c)=>{"use strict";let{EventEmitter:d}=a.r(687769),{lsCacheSym:e,levelValSym:f,setLevelSym:g,getLevelSym:h,chindingsSym:i,parsedChindingsSym:j,mixinSym:k,asJsonSym:l,writeSym:m,mixinMergeStrategySym:o,timeSym:p,timeSliceIndexSym:q,streamSym:r,serializersSym:s,formattersSym:t,errorKeySym:u,messageKeySym:v,useOnlyCustomLevelsSym:w,needsMetadataGsym:x,redactFmtSym:y,stringifySym:z,formatOptsSym:A,stringifiersSym:B,msgPrefixSym:C,hooksSym:D}=a.r(889275),{getLevel:E,setLevel:F,isLevelEnabled:G,mappings:H,initialLsCache:I,genLsCache:J,assertNoLevelCollisions:K}=a.r(292204),{asChindings:L,asJson:M,buildFormatters:N,stringify:O,noop:P}=a.r(89357),{version:Q}=a.r(349478),R=a.r(986234),S={constructor:class{},child:function(a,b){if(!a)throw Error("missing bindings for child Pino");let c=this[s],d=this[t],e=Object.create(this);if(null==b)return e[t].bindings!==T&&(e[t]=N(d.level,T,d.log)),e[i]=L(e,a),this.onChild!==P&&this.onChild(e),e;if(!0===b.hasOwnProperty("serializers")){for(let a in e[s]=Object.create(null),c)e[s][a]=c[a];let a=Object.getOwnPropertySymbols(c);for(var f=0;f<a.length;f++){let b=a[f];e[s][b]=c[b]}for(let a in b.serializers)e[s][a]=b.serializers[a];let d=Object.getOwnPropertySymbols(b.serializers);for(var h=0;h<d.length;h++){let a=d[h];e[s][a]=b.serializers[a]}}else e[s]=c;if(b.hasOwnProperty("formatters")){let{level:a,bindings:c,log:f}=b.formatters;e[t]=N(a||d.level,c||T,f||d.log)}else e[t]=N(d.level,T,d.log);if(!0===b.hasOwnProperty("customLevels")&&(K(this.levels,b.customLevels),e.levels=H(b.customLevels,e[w]),J(e)),"object"==typeof b.redact&&null!==b.redact||Array.isArray(b.redact)){e.redact=b.redact;let a=R(e.redact,O),c={stringify:a[y]};e[z]=O,e[B]=a,e[A]=c}if("string"==typeof b.msgPrefix&&(e[C]=(this[C]||"")+b.msgPrefix),e[i]=L(e,a),void 0!==b.level&&b.level!==this.level||b.hasOwnProperty("customLevels")){let a=b.level||this.level;e[g](a)}return this.onChild(e),e},bindings:function(){let a=this[i],b=JSON.parse(`{${a.substr(1)}}`);return delete b.pid,delete b.hostname,b},setBindings:function(a){let b=L(this,a);this[i]=b,delete this[j]},flush:function(a){if(null!=a&&"function"!=typeof a)throw Error("callback must be a function");let b=this[r];"function"==typeof b.flush?b.flush(a||P):a&&a()},isLevelEnabled:G,version:Q,get level(){return this[h]()},set level(lvl){this[g](lvl)},get levelVal(){return this[f]},set levelVal(n){throw Error("levelVal is read-only")},get msgPrefix(){return this[C]},get[Symbol.toStringTag](){return"Pino"},[e]:I,[m]:function(a,b,c){let d,e=this[p](),f=this[k],g=this[u],h=this[v],i=this[o]||U,j=this[D].streamWrite;null==a?d={}:a instanceof Error?(d={[g]:a},void 0===b&&(b=a.message)):(d=a,void 0===b&&void 0===a[h]&&a[g]&&(b=a[g].message)),f&&(d=i(d,f(d,c,this)));let m=this[l](d,b,c,e),s=this[r];!0===s[x]&&(s.lastLevel=c,s.lastObj=d,s.lastMsg=b,s.lastTime=e.slice(this[q]),s.lastLogger=this),s.write(j?j(m):m)},[l]:M,[h]:E,[g]:F};Object.setPrototypeOf(S,d.prototype),b.exports=function(){return Object.create(S)};let T=a=>a;function U(a,b){return Object.assign(b,a)}},9839,(a,b,c)=>{"use strict";let{hasOwnProperty:d}=Object.prototype,e=o();e.configure=o,e.stringify=e,e.default=e,c.stringify=e,c.configure=o,b.exports=e;let f=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]/;function g(a){return a.length<5e3&&!f.test(a)?`"${a}"`:JSON.stringify(a)}function h(a,b){if(a.length>200||b)return a.sort(b);for(let b=1;b<a.length;b++){let c=a[b],d=b;for(;0!==d&&a[d-1]>c;)a[d]=a[d-1],d--;a[d]=c}return a}let i=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function j(a){return void 0!==i.call(a)&&0!==a.length}function k(a,b,c){a.length<c&&(c=a.length);let d=","===b?"":" ",e=`"0":${d}${a[0]}`;for(let f=1;f<c;f++)e+=`${b}"${f}":${d}${a[f]}`;return e}function l(a,b){let c;if(d.call(a,b)){if("number"!=typeof(c=a[b]))throw TypeError(`The "${b}" argument must be of type number`);if(!Number.isInteger(c))throw TypeError(`The "${b}" argument must be an integer`);if(c<1)throw RangeError(`The "${b}" argument must be >= 1`)}return void 0===c?1/0:c}function m(a){return 1===a?"1 item":`${a} items`}function o(a){let b=function(a){if(d.call(a,"strict")){let b=a.strict;if("boolean"!=typeof b)throw TypeError('The "strict" argument must be of type boolean');if(b)return a=>{let b=`Object can not safely be stringified. Received type ${typeof a}`;throw"function"!=typeof a&&(b+=` (${a.toString()})`),Error(b)}}}(a={...a});b&&(void 0===a.bigint&&(a.bigint=!1),"circularValue"in a||(a.circularValue=Error));let c=function(a){if(d.call(a,"circularValue")){let b=a.circularValue;if("string"==typeof b)return`"${b}"`;if(null==b)return b;if(b===Error||b===TypeError)return{toString(){throw TypeError("Converting circular structure to JSON")}};throw TypeError('The "circularValue" argument must be of type string or the value null or undefined')}return'"[Circular]"'}(a),e=function(a,b){let c;if(d.call(a,b)&&"boolean"!=typeof(c=a[b]))throw TypeError(`The "${b}" argument must be of type boolean`);return void 0===c||c}(a,"bigint"),f=function(a){let b;if(d.call(a,"deterministic")&&"boolean"!=typeof(b=a.deterministic)&&"function"!=typeof b)throw TypeError('The "deterministic" argument must be of type boolean or comparator function');return void 0===b||b}(a),i="function"==typeof f?f:void 0,o=l(a,"maximumDepth"),p=l(a,"maximumBreadth");return function(a,d,l){if(arguments.length>1){let q="";if("number"==typeof l?q=" ".repeat(Math.min(l,10)):"string"==typeof l&&(q=l.slice(0,10)),null!=d){if("function"==typeof d)return function a(d,k,l,q,r,s){let t=k[d];switch("object"==typeof t&&null!==t&&"function"==typeof t.toJSON&&(t=t.toJSON(d)),typeof(t=q.call(k,d,t))){case"string":return g(t);case"object":{if(null===t)return"null";if(-1!==l.indexOf(t))return c;let b="",d=",",e=s;if(Array.isArray(t)){if(0===t.length)return"[]";if(o<l.length+1)return'"[Array]"';l.push(t),""!==r&&(s+=r,b+=`
${s}`,d=`,
${s}`);let c=Math.min(t.length,p),f=0;for(;f<c-1;f++){let c=a(String(f),t,l,q,r,s);b+=void 0!==c?c:"null",b+=d}let g=a(String(f),t,l,q,r,s);if(b+=void 0!==g?g:"null",t.length-1>p){let a=t.length-p-1;b+=`${d}"... ${m(a)} not stringified"`}return""!==r&&(b+=`
${e}`),l.pop(),`[${b}]`}let k=Object.keys(t),u=k.length;if(0===u)return"{}";if(o<l.length+1)return'"[Object]"';let v="",w="";""!==r&&(s+=r,d=`,
${s}`,v=" ");let x=Math.min(u,p);f&&!j(t)&&(k=h(k,i)),l.push(t);for(let c=0;c<x;c++){let e=k[c],f=a(e,t,l,q,r,s);void 0!==f&&(b+=`${w}${g(e)}:${v}${f}`,w=d)}return u>p&&(b+=`${w}"...":${v}"${m(u-p)} not stringified"`,w=d),""!==r&&w.length>1&&(b=`
${s}${b}
${e}`),l.pop(),`{${b}}`}case"number":return isFinite(t)?String(t):b?b(t):"null";case"boolean":return!0===t?"true":"false";case"undefined":return;case"bigint":if(e)return String(t);default:return b?b(t):void 0}}("",{"":a},[],d,q,"");if(Array.isArray(d))return function a(d,f,h,i,j,k){switch("object"==typeof f&&null!==f&&"function"==typeof f.toJSON&&(f=f.toJSON(d)),typeof f){case"string":return g(f);case"object":{if(null===f)return"null";if(-1!==h.indexOf(f))return c;let b=k,d="",e=",";if(Array.isArray(f)){if(0===f.length)return"[]";if(o<h.length+1)return'"[Array]"';h.push(f),""!==j&&(k+=j,d+=`
${k}`,e=`,
${k}`);let c=Math.min(f.length,p),g=0;for(;g<c-1;g++){let b=a(String(g),f[g],h,i,j,k);d+=void 0!==b?b:"null",d+=e}let l=a(String(g),f[g],h,i,j,k);if(d+=void 0!==l?l:"null",f.length-1>p){let a=f.length-p-1;d+=`${e}"... ${m(a)} not stringified"`}return""!==j&&(d+=`
${b}`),h.pop(),`[${d}]`}h.push(f);let l="";""!==j&&(k+=j,e=`,
${k}`,l=" ");let q="";for(let b of i){let c=a(b,f[b],h,i,j,k);void 0!==c&&(d+=`${q}${g(b)}:${l}${c}`,q=e)}return""!==j&&q.length>1&&(d=`
${k}${d}
${b}`),h.pop(),`{${d}}`}case"number":return isFinite(f)?String(f):b?b(f):"null";case"boolean":return!0===f?"true":"false";case"undefined":return;case"bigint":if(e)return String(f);default:return b?b(f):void 0}}("",a,[],function(a){let b=new Set;for(let c of a)("string"==typeof c||"number"==typeof c)&&b.add(String(c));return b}(d),q,"")}if(0!==q.length)return function a(d,l,q,r,s){switch(typeof l){case"string":return g(l);case"object":{if(null===l)return"null";if("function"==typeof l.toJSON){if("object"!=typeof(l=l.toJSON(d)))return a(d,l,q,r,s);if(null===l)return"null"}if(-1!==q.indexOf(l))return c;let b=s;if(Array.isArray(l)){if(0===l.length)return"[]";if(o<q.length+1)return'"[Array]"';q.push(l),s+=r;let c=`
${s}`,d=`,
${s}`,e=Math.min(l.length,p),f=0;for(;f<e-1;f++){let b=a(String(f),l[f],q,r,s);c+=void 0!==b?b:"null",c+=d}let g=a(String(f),l[f],q,r,s);if(c+=void 0!==g?g:"null",l.length-1>p){let a=l.length-p-1;c+=`${d}"... ${m(a)} not stringified"`}return c+=`
${b}`,q.pop(),`[${c}]`}let e=Object.keys(l),t=e.length;if(0===t)return"{}";if(o<q.length+1)return'"[Object]"';s+=r;let u=`,
${s}`,v="",w="",x=Math.min(t,p);j(l)&&(v+=k(l,u,p),e=e.slice(l.length),x-=l.length,w=u),f&&(e=h(e,i)),q.push(l);for(let b=0;b<x;b++){let c=e[b],d=a(c,l[c],q,r,s);void 0!==d&&(v+=`${w}${g(c)}: ${d}`,w=u)}return t>p&&(v+=`${w}"...": "${m(t-p)} not stringified"`,w=u),""!==w&&(v=`
${s}${v}
${b}`),q.pop(),`{${v}}`}case"number":return isFinite(l)?String(l):b?b(l):"null";case"boolean":return!0===l?"true":"false";case"undefined":return;case"bigint":if(e)return String(l);default:return b?b(l):void 0}}("",a,[],q,"")}return function a(d,l,q){switch(typeof l){case"string":return g(l);case"object":{if(null===l)return"null";if("function"==typeof l.toJSON){if("object"!=typeof(l=l.toJSON(d)))return a(d,l,q);if(null===l)return"null"}if(-1!==q.indexOf(l))return c;let b="",e=void 0!==l.length;if(e&&Array.isArray(l)){if(0===l.length)return"[]";if(o<q.length+1)return'"[Array]"';q.push(l);let c=Math.min(l.length,p),d=0;for(;d<c-1;d++){let c=a(String(d),l[d],q);b+=void 0!==c?c:"null",b+=","}let e=a(String(d),l[d],q);if(b+=void 0!==e?e:"null",l.length-1>p){let a=l.length-p-1;b+=`,"... ${m(a)} not stringified"`}return q.pop(),`[${b}]`}let r=Object.keys(l),s=r.length;if(0===s)return"{}";if(o<q.length+1)return'"[Object]"';let t="",u=Math.min(s,p);e&&j(l)&&(b+=k(l,",",p),r=r.slice(l.length),u-=l.length,t=","),f&&(r=h(r,i)),q.push(l);for(let c=0;c<u;c++){let d=r[c],e=a(d,l[d],q);void 0!==e&&(b+=`${t}${g(d)}:${e}`,t=",")}return s>p&&(b+=`${t}"...":"${m(s-p)} not stringified"`),q.pop(),`{${b}}`}case"number":return isFinite(l)?String(l):b?b(l):"null";case"boolean":return!0===l?"true":"false";case"undefined":return;case"bigint":if(e)return String(l);default:return b?b(l):void 0}}("",a,[])}}},626262,(a,b,c)=>{"use strict";let d=a.r(660526),e=a.r(631046),f=a.r(903874),g=a.r(986234),h=a.r(362344),i=a.r(603693),j=a.r(889275),{configure:k}=a.r(9839),{assertDefaultLevelFound:l,mappings:m,genLsCache:o,genLevelComparison:p,assertLevelComparison:q}=a.r(292204),{DEFAULT_LEVELS:r,SORTING_ORDER:s}=a.r(311500),{createArgsNormalizer:t,asChindings:u,buildSafeSonicBoom:v,buildFormatters:w,stringify:x,normalizeDestFileDescriptor:y,noop:z}=a.r(89357),{version:A}=a.r(349478),{chindingsSym:B,redactFmtSym:C,serializersSym:D,timeSym:E,timeSliceIndexSym:F,streamSym:G,stringifySym:H,stringifySafeSym:I,stringifiersSym:J,setLevelSym:K,endSym:L,formatOptsSym:M,messageKeySym:N,errorKeySym:O,nestedKeySym:P,mixinSym:Q,levelCompSym:R,useOnlyCustomLevelsSym:S,formattersSym:T,hooksSym:U,nestedKeyStrSym:V,mixinMergeStrategySym:W,msgPrefixSym:X}=j,{epochTime:Y,nullTime:Z}=h,{pid:$}=process,_=d.hostname(),aa=e.err,ab=t({level:"info",levelComparison:s.ASC,levels:r,messageKey:"msg",errorKey:"err",nestedKey:null,enabled:!0,base:{pid:$,hostname:_},serializers:Object.assign(Object.create(null),{err:aa}),formatters:Object.assign(Object.create(null),{bindings:a=>a,level:(a,b)=>({level:b})}),hooks:{logMethod:void 0,streamWrite:void 0},timestamp:Y,name:void 0,redact:null,customLevels:null,useOnlyCustomLevels:!1,depthLimit:5,edgeLimit:100}),ac=Object.assign(Object.create(null),e);function ad(...a){let b={},{opts:c,stream:d}=ab(b,f(),...a);c.level&&"string"==typeof c.level&&void 0!==r[c.level.toLowerCase()]&&(c.level=c.level.toLowerCase());let{redact:e,crlf:h,serializers:j,timestamp:s,messageKey:t,errorKey:v,nestedKey:y,base:A,name:$,level:_,customLevels:aa,levelComparison:ac,mixin:ae,mixinMergeStrategy:af,useOnlyCustomLevels:ag,formatters:ah,hooks:ai,depthLimit:aj,edgeLimit:ak,onChild:al,msgPrefix:am}=c,an=k({maximumDepth:aj,maximumBreadth:ak}),ao=w(ah.level,ah.bindings,ah.log),ap=x.bind({[I]:an}),aq=e?g(e,ap):{},ar=e?{stringify:aq[C]}:{stringify:ap},as=u.bind(null,{[B]:"",[D]:j,[J]:aq,[H]:x,[I]:an,[T]:ao}),at="";null!==A&&(at=as(void 0===$?A:Object.assign({},A,{name:$})));let au=s instanceof Function?s:s?Y:Z,av=au().indexOf(":")+1;if(ag&&!aa)throw Error("customLevels is required if useOnlyCustomLevels is set true");if(ae&&"function"!=typeof ae)throw Error(`Unknown mixin type "${typeof ae}" - expected "function"`);if(am&&"string"!=typeof am)throw Error(`Unknown msgPrefix type "${typeof am}" - expected "string"`);l(_,aa,ag);let aw=m(aa,ag);return"function"==typeof d.emit&&d.emit("message",{code:"PINO_CONFIG",config:{levels:aw,messageKey:t,errorKey:v}}),q(ac),Object.assign(b,{levels:aw,[R]:p(ac),[S]:ag,[G]:d,[E]:au,[F]:av,[H]:x,[I]:an,[J]:aq,[L]:"}"+(h?"\r\n":"\n"),[M]:ar,[N]:t,[O]:v,[P]:y,[V]:y?`,${JSON.stringify(y)}:{`:"",[D]:j,[Q]:ae,[W]:af,[B]:at,[T]:ao,[U]:ai,silent:z,onChild:al,[X]:am}),Object.setPrototypeOf(b,i()),o(b),b[K](_),b}b.exports=ad,b.exports.destination=(a=process.stdout.fd)=>"object"==typeof a?(a.dest=y(a.dest||process.stdout.fd),v(a)):v({dest:y(a),minLength:0}),b.exports.transport=a.r(47325),b.exports.multistream=a.r(688454),b.exports.levels=m(),b.exports.stdSerializers=ac,b.exports.stdTimeFunctions=Object.assign({},h),b.exports.symbols=j,b.exports.version=A,b.exports.default=ad,b.exports.pino=ad},31620,a=>{"use strict";var b=a.i(626262),c=a.i(920275);let d="custom_context";var e=Object.defineProperty,f=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?e(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class g{constructor(a){f(this,"nodeValue"),f(this,"sizeInBytes"),f(this,"next"),this.nodeValue=a,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class h{constructor(a){f(this,"lengthInNodes"),f(this,"sizeInBytes"),f(this,"head"),f(this,"tail"),f(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=a,this.sizeInBytes=0}append(a){let b=new g(a);if(b.size>this.maxSizeInBytes)throw Error(`[LinkedList] Value too big to insert into list: ${a} with size ${b.size}`);for(;this.size+b.size>this.maxSizeInBytes;)this.shift();this.head?this.tail&&(this.tail.next=b):this.head=b,this.tail=b,this.lengthInNodes++,this.sizeInBytes+=b.size}shift(){if(!this.head)return;let a=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=a.size}toArray(){let a=[],b=this.head;for(;null!==b;)a.push(b.value),b=b.next;return a}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let a=this.head;return{next:()=>{if(!a)return{done:!0,value:null};let b=a.value;return a=a.next,{done:!1,value:b}}}}}var i=Object.defineProperty,j=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?i(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class k{constructor(a,c=1024e3){j(this,"logs"),j(this,"level"),j(this,"levelValue"),j(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=a??"error",this.levelValue=b.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=c,this.logs=new h(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(a,c){c===b.levels.values.error?console.error(a):c===b.levels.values.warn?console.warn(a):c===b.levels.values.debug?console.debug(a):c===b.levels.values.trace?console.trace(a):console.log(a)}appendToLogs(a){this.logs.append((0,c.safeJsonStringify)({timestamp:new Date().toISOString(),log:a}));let b="string"==typeof a?JSON.parse(a).level:a.level;b>=this.levelValue&&this.forwardToConsole(a,b)}getLogs(){return this.logs}clearLogs(){this.logs=new h(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(a){let b=this.getLogArray();return b.push((0,c.safeJsonStringify)({extraMetadata:a})),new Blob(b,{type:"application/json"})}}var l=Object.defineProperty;class m{constructor(a,b=1024e3){((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?l(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"baseChunkLogger"),this.baseChunkLogger=new k(a,b)}write(a){this.baseChunkLogger.appendToLogs(a)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(a){return this.baseChunkLogger.logsToBlob(a)}}var o=Object.defineProperty,p=Object.defineProperties,q=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,u=(a,b,c)=>b in a?o(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,v=(a,b)=>{for(var c in b||(b={}))s.call(b,c)&&u(a,c,b[c]);if(r)for(var c of r(b))t.call(b,c)&&u(a,c,b[c]);return a};function w(a){return p(v({},a),q({level:a?.level||"info"}))}function x(a,b=d){return a[b]||""}function y(a,b,c=d){let e=function(a,b,c=d){let e=x(a,c);return e.trim()?`${e}/${b}`:b}(a,b,c);return function(a,b,c=d){return a[c]=b,a}(a.child({context:e}),e,c)}function z(a){var c;let d;return"u">typeof a.loggerOverride&&"string"!=typeof a.loggerOverride?{logger:a.loggerOverride,chunkLoggerController:null}:(d=new m(null==(c=a.opts)?void 0:c.level,a.maxSizeInBytes),{logger:(0,b.default)(p(v({},a.opts),q({level:"trace"})),d),chunkLoggerController:d})}a.s(["generateChildLogger",()=>y,"generatePlatformLogger",()=>z,"getDefaultLoggerOptions",()=>w,"getLoggerContext",()=>x])},463644,a=>{"use strict";let b,c,d,e,f;var g,h,i=a.i(15388),j=a.i(673620),k=a.i(679628),l=a.i(741721),m=a.i(611210),o=a.i(384815),p=a.i(570224),q=a.i(165782),r=a.i(934008),s=a.i(501060),t=a.i(832819);a.i(682177);var u=a.i(640843),v=a.i(465191),w=a.i(30145),x=a.i(73915),y=a.i(572696),z=a.i(31620);function A(a){let[b,c]=a.split(":");return{namespace:b,reference:c}}function B(a,b=[]){let c=[];return Object.keys(a).forEach(d=>{if(b.length&&!b.includes(d))return;let e=a[d];c.push(...e.accounts)}),c}function C(a,b){return a.includes(":")?[a]:b.chains||[]}var D=Object.defineProperty,E=Object.defineProperties,F=Object.getOwnPropertyDescriptors,G=Object.getOwnPropertySymbols,H=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable,J=(a,b,c)=>b in a?D(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,K=(a,b)=>{for(var c in b||(b={}))H.call(b,c)&&J(a,c,b[c]);if(G)for(var c of G(b))I.call(b,c)&&J(a,c,b[c]);return a},L=(a,b,c)=>J(a,"symbol"!=typeof b?b+"":b,c);let M="react-native",N="node",O="browser";function P(){return"u">typeof process&&"u">typeof process.versions&&"u">typeof process.versions.node}function Q(){return!(0,k.getDocument)()&&!!(0,k.getNavigator)()&&"ReactNative"===navigator.product}function R(){return Q()&&"u">typeof(null==a.g?void 0:a.g.Platform)&&(null==a.g?void 0:a.g.Platform.OS)==="android"}function S(){return Q()&&"u">typeof(null==a.g?void 0:a.g.Platform)&&(null==a.g?void 0:a.g.Platform.OS)==="ios"}function T(){return!P()&&!!(0,k.getNavigator)()&&!!(0,k.getDocument)()}function U(){return Q()?M:P()?N:T()?O:"unknown"}function V(){var b;try{return Q()&&"u">typeof(null==a.g?void 0:a.g.Application)?null==(b=a.g.Application)?void 0:b.applicationId:void 0}catch{return}}function W(a){var b,c;let d=X();try{let e,f;return null!=a&&a.url&&d.url&&new URL(a.url).host!==new URL(d.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${a.url} differs from the actual page url:${d.url}. This is probably unintended and can lead to issues.`),a.url=d.url),null!=(b=a?.icons)&&b.length&&a.icons.length>0&&(a.icons=a.icons.filter(a=>""!==a)),e=K(K({},d),a),f={url:a?.url||d.url,name:a?.name||d.name,description:a?.description||d.description,icons:null!=(c=a?.icons)&&c.length&&a.icons.length>0?a.icons:d.icons},E(e,F(f))}catch(b){return console.warn("Error populating app metadata",b),a||d}}function X(){return(0,l.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]}}function Y(b,c,d){var e;let f,g=function(){if(U()===M&&"u">typeof(null==a.g?void 0:a.g.Platform)){let{OS:b,Version:c}=a.g.Platform;return[b,c].join("-")}let b=(0,i.detect)();if(null===b)return"unknown";let c=b.os?b.os.replace(" ","").toLowerCase():"unknown";return"browser"===b.type?[c,b.name,b.version].join("-"):[c,b.version].join("-")}(),h=(f=U())===O?[f,(null==(e=(0,k.getLocation)())?void 0:e.host)||"unknown"].join(":"):f;return[[b,c].join("-"),["js",d].join("-"),g,h].join("/")}function Z({protocol:a,version:b,relayUrl:c,sdkVersion:d,auth:e,projectId:f,useOnCloseEvent:g,bundleId:h,packageName:i}){var j,k;let l,m=c.split("?"),o=Y(a,b,d),p=(j=m[1]||"",k={auth:e,ua:o,projectId:f,useOnCloseEvent:g||void 0,packageName:i||void 0,bundleId:h||void 0},l=new URLSearchParams(j),Object.entries(k).sort(([a],[b])=>a.localeCompare(b)).forEach(([a,b])=>{null!=b&&l.set(a,String(b))}),l.toString());return m[0]+"?"+p}function $(a,b){return a.filter(a=>b.includes(a)).length===a.length}function _(a){return Object.fromEntries(a.entries())}function aa(a){return new Map(Object.entries(a))}function ab(a=j.FIVE_MINUTES,b){let c,d,e,f,g=(0,j.toMiliseconds)(a||j.FIVE_MINUTES);return{resolve:a=>{e&&c&&(clearTimeout(e),c(a),f=Promise.resolve(a))},reject:a=>{e&&d&&(clearTimeout(e),d(a))},done:()=>new Promise((a,h)=>{if(f)return a(f);e=setTimeout(()=>{let a=Error(b);f=Promise.reject(a),h(a)},g),c=a,d=h})}}function ac(a,b,c){return new Promise(async(d,e)=>{let f=setTimeout(()=>e(Error(c)),b);try{let b=await a;d(b)}catch(a){e(a)}clearTimeout(f)})}function ad(a,b){if("string"==typeof b&&b.startsWith(`${a}:`))return b;if("topic"===a.toLowerCase()){if("string"!=typeof b)throw Error('Value must be "string" for expirer target type: topic');return`topic:${b}`}if("id"===a.toLowerCase()){if("number"!=typeof b)throw Error('Value must be "number" for expirer target type: id');return`id:${b}`}throw Error(`Unknown expirer target type: ${a}`)}function ae(a){return ad("topic",a)}function af(a){return ad("id",a)}function ag(a){let[b,c]=a.split(":"),d={id:void 0,topic:void 0};if("topic"===b&&"string"==typeof c)d.topic=c;else if("id"===b&&Number.isInteger(Number(c)))d.id=Number(c);else throw Error(`Invalid target, expected id:number or topic:string, got ${b}:${c}`);return d}function ah(a,b){return(0,j.fromMiliseconds)((b||Date.now())+(0,j.toMiliseconds)(a))}function ai(a){return Date.now()>=(0,j.toMiliseconds)(a)}function aj(a,b){return`${a}${b?`:${b}`:""}`}function ak(a=[],b=[]){return[...new Set([...a,...b])]}async function al({id:b,topic:c,wcDeepLink:d}){var e,f;try{if(!d)return;let g="string"==typeof d?JSON.parse(d):d,h=g?.href;if("string"!=typeof h)return;let i=function(a,b,c){let d=`requestId=${b}&sessionTopic=${c}`;a.endsWith("/")&&(a=a.slice(0,-1));let e=`${a}`;if(a.startsWith("https://t.me")){let b=a.includes("?")?"&startapp=":"?startapp=";e=`${e}${b}${function(a,b=!1){let c=Buffer.from(a).toString("base64");return b?c.replace(/[=]/g,""):c}(d,!0)}`}else e=`${e}/wc?${d}`;return e}(h,b,c),j=U();if(j===O){let a;if(!(null!=(e=(0,k.getDocument)())&&e.hasFocus()))return void console.warn("Document does not have focus, skipping deeplink.");f=i,a="_self",!function(){try{return window.self!==window.top}catch{return!1}}()?(f.startsWith("https://")||f.startsWith("http://"))&&(a="_blank"):a="_top",window.open(f,a,"noreferrer noopener")}else j===M&&"u">typeof(null==a.g?void 0:a.g.Linking)&&await a.g.Linking.openURL(i)}catch(a){console.error(a)}}async function am(a,b){let c="";try{if(T()&&(c=localStorage.getItem(b)))return c;c=await a.getItem(b)}catch(a){console.error(a)}return c}function an(a,b){if(!a.includes(b))return null;let c=a.split(/([&,?,=])/),d=c.indexOf(b);return c[d+2]}function ao(){return"u">typeof crypto&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,a=>{let b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)})}function ap(){return"u">typeof process&&"true"===process.env.IS_VITEST}function aq(a){return Buffer.from(a,"base64").toString("utf-8")}function ar(a){return new Promise(b=>setTimeout(b,a))}class as{constructor({limit:a}){L(this,"limit"),L(this,"set"),this.limit=a,this.set=new Set}add(a){if(!this.set.has(a)){if(this.set.size>=this.limit){let a=this.set.values().next().value;a&&this.set.delete(a)}this.set.add(a)}}has(a){return this.set.has(a)}}let at=BigInt(0x100000000-1),au=BigInt(32);function av(a,b=!1){return b?{h:Number(a&at),l:Number(a>>au&at)}:{h:0|Number(a>>au&at),l:0|Number(a&at)}}function aw(a,b=!1){let c=a.length,d=new Uint32Array(c),e=new Uint32Array(c);for(let f=0;f<c;f++){let{h:c,l:g}=av(a[f],b);[d[f],e[f]]=[c,g]}return[d,e]}let ax=(a,b,c)=>a>>>c,ay=(a,b,c)=>a<<32-c|b>>>c,az=(a,b,c)=>a>>>c|b<<32-c,aA=(a,b,c)=>a<<32-c|b>>>c,aB=(a,b,c)=>a<<64-c|b>>>c-32,aC=(a,b,c)=>a>>>c-32|b<<64-c;function aD(a,b,c,d){let e=(b>>>0)+(d>>>0);return{h:a+c+(e/0x100000000|0)|0,l:0|e}}let aE=(a,b,c)=>(a>>>0)+(b>>>0)+(c>>>0),aF=(a,b,c,d)=>b+c+d+(a/0x100000000|0)|0,aG=(a,b,c,d)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0),aH=(a,b,c,d,e)=>b+c+d+e+(a/0x100000000|0)|0,aI=(a,b,c,d,e)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0)+(e>>>0),aJ=(a,b,c,d,e,f)=>b+c+d+e+f+(a/0x100000000|0)|0,aK="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function aL(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function aM(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function aN(a,...b){if(!aL(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function aO(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash should be wrapped by utils.createHasher");aM(a.outputLen),aM(a.blockLen)}function aP(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function aQ(a,b){aN(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}function aR(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function aS(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}function aT(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function aU(a,b){return a<<32-b|a>>>b}let aV=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function aW(a){return a<<24&0xff000000|a<<8&0xff0000|a>>>8&65280|a>>>24&255}let aX=aV?a=>a:a=>aW(a),aY=aV?a=>a:function(a){for(let b=0;b<a.length;b++)a[b]=aW(a[b]);return a},aZ="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,a$=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function a_(a){if(aN(a),aZ)return a.toHex();let b="";for(let c=0;c<a.length;c++)b+=a$[a[c]];return b}function a0(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function a1(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(aZ)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=a0(a.charCodeAt(e)),f=a0(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function a2(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}function a3(a){return"string"==typeof a&&(a=a2(a)),aN(a),a}function a4(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];aN(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}class a5{}function a6(a){let b=b=>a().update(a3(b)).digest(),c=a();return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=()=>a(),b}function a7(a=32){if(aK&&"function"==typeof aK.getRandomValues)return aK.getRandomValues(new Uint8Array(a));if(aK&&"function"==typeof aK.randomBytes)return Uint8Array.from(aK.randomBytes(a));throw Error("crypto.getRandomValues must be defined")}let a8=BigInt(0),a9=BigInt(1),ba=BigInt(2),bb=BigInt(7),bc=BigInt(256),bd=BigInt(113),be=[],bf=[],bg=[];for(let a=0,b=a9,c=1,d=0;a<24;a++){[c,d]=[d,(2*c+3*d)%5],be.push(2*(5*d+c)),bf.push((a+1)*(a+2)/2%64);let e=a8;for(let a=0;a<7;a++)(b=(b<<a9^(b>>bb)*bd)%bc)&ba&&(e^=a9<<(a9<<BigInt(a))-a9);bg.push(e)}let bh=aw(bg,!0),bi=bh[0],bj=bh[1],bk=(a,b,c)=>c>32?b<<c-32|a>>>64-c:a<<c|b>>>32-c,bl=(a,b,c)=>c>32?a<<c-32|b>>>64-c:b<<c|a>>>32-c;class bm extends a5{constructor(a,b,c,d=!1,e=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=a,this.suffix=b,this.outputLen=c,this.enableXOF=d,this.rounds=e,aM(c),!(0<a&&a<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=aR(this.state)}clone(){return this._cloneInto()}keccak(){aY(this.state32),function(a,b=24){let c=new Uint32Array(10);for(let d=24-b;d<24;d++){for(let b=0;b<10;b++)c[b]=a[b]^a[b+10]^a[b+20]^a[b+30]^a[b+40];for(let b=0;b<10;b+=2){let d=(b+8)%10,e=(b+2)%10,f=c[e],g=c[e+1],h=bk(f,g,1)^c[d],i=bl(f,g,1)^c[d+1];for(let c=0;c<50;c+=10)a[b+c]^=h,a[b+c+1]^=i}let b=a[2],e=a[3];for(let c=0;c<24;c++){let d=bf[c],f=bk(b,e,d),g=bl(b,e,d),h=be[c];b=a[h],e=a[h+1],a[h]=f,a[h+1]=g}for(let b=0;b<50;b+=10){for(let d=0;d<10;d++)c[d]=a[b+d];for(let d=0;d<10;d++)a[b+d]^=~c[(d+2)%10]&c[(d+4)%10]}a[0]^=bi[d],a[1]^=bj[d]}aS(c)}(this.state32,this.rounds),aY(this.state32),this.posOut=0,this.pos=0}update(a){aP(this),aN(a=a3(a));let{blockLen:b,state:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(b-this.pos,d-e);for(let b=0;b<f;b++)c[this.pos++]^=a[e++];this.pos===b&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:a,suffix:b,pos:c,blockLen:d}=this;a[c]^=b,(128&b)!=0&&c===d-1&&this.keccak(),a[d-1]^=128,this.keccak()}writeInto(a){aP(this,!1),aN(a),this.finish();let b=this.state,{blockLen:c}=this;for(let d=0,e=a.length;d<e;){this.posOut>=c&&this.keccak();let f=Math.min(c-this.posOut,e-d);a.set(b.subarray(this.posOut,this.posOut+f),d),this.posOut+=f,d+=f}return a}xofInto(a){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(a)}xof(a){return aM(a),this.xofInto(new Uint8Array(a))}digestInto(a){if(aQ(a,this),this.finished)throw Error("digest() was already called");return this.writeInto(a),this.destroy(),a}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,aS(this.state)}_cloneInto(a){let{blockLen:b,suffix:c,outputLen:d,rounds:e,enableXOF:f}=this;return a||(a=new bm(b,c,d,f,e)),a.state32.set(this.state32),a.pos=this.pos,a.posOut=this.posOut,a.finished=this.finished,a.rounds=e,a.suffix=c,a.outputLen=d,a.enableXOF=f,a.destroyed=this.destroyed,a}}let bn=a6(()=>new bm(136,1,32));class bo extends a5{constructor(a,b,c,d){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.buffer=new Uint8Array(a),this.view=aT(this.buffer)}update(a){aP(this),aN(a=a3(a));let{view:b,buffer:c,blockLen:d}=this,e=a.length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=aT(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){aP(this),aQ(a,this),this.finished=!0;let{buffer:b,view:c,blockLen:d,isLE:e}=this,{pos:f}=this;b[f++]=128,aS(this.buffer.subarray(f)),this.padOffset>d-f&&(this.process(c,0),f=0);for(let a=f;a<d;a++)b[a]=0;(function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)})(c,d-8,BigInt(8*this.length),e),this.process(c,0);let g=aT(a),h=this.outputLen;if(h%4)throw Error("_sha2: outputLen should be aligned to 32bit");let i=h/4,j=this.get();if(i>j.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<i;a++)g.setUint32(4*a,j[a],e)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.destroyed=f,a.finished=e,a.length=d,a.pos=g,d%b&&a.buffer.set(c),a}clone(){return this._cloneInto()}}let bp=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),bq=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),br=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),bs=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),bt=new Uint32Array(64);class bu extends bo{constructor(a=32){super(64,a,8,!1),this.A=0|bp[0],this.B=0|bp[1],this.C=0|bp[2],this.D=0|bp[3],this.E=0|bp[4],this.F=0|bp[5],this.G=0|bp[6],this.H=0|bp[7]}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)bt[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=bt[a-15],c=bt[a-2],d=aU(b,7)^aU(b,18)^b>>>3,e=aU(c,17)^aU(c,19)^c>>>10;bt[a]=e+bt[a-7]+d+bt[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,o;let b=j+(aU(g,6)^aU(g,11)^aU(g,25))+((k=g)&h^~k&i)+bs[a]+bt[a]|0,p=(aU(c,2)^aU(c,13)^aU(c,22))+((l=c)&(m=d)^l&(o=e)^m&o)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+p|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){aS(bt)}destroy(){this.set(0,0,0,0,0,0,0,0),aS(this.buffer)}}let bv=aw(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),bw=bv[0],bx=bv[1],by=new Uint32Array(80),bz=new Uint32Array(80);class bA extends bo{constructor(a=64){super(128,a,16,!1),this.Ah=0|br[0],this.Al=0|br[1],this.Bh=0|br[2],this.Bl=0|br[3],this.Ch=0|br[4],this.Cl=0|br[5],this.Dh=0|br[6],this.Dl=0|br[7],this.Eh=0|br[8],this.El=0|br[9],this.Fh=0|br[10],this.Fl=0|br[11],this.Gh=0|br[12],this.Gl=0|br[13],this.Hh=0|br[14],this.Hl=0|br[15]}get(){let{Ah:a,Al:b,Bh:c,Bl:d,Ch:e,Cl:f,Dh:g,Dl:h,Eh:i,El:j,Fh:k,Fl:l,Gh:m,Gl:o,Hh:p,Hl:q}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,o,p,q]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,o,p,q){this.Ah=0|a,this.Al=0|b,this.Bh=0|c,this.Bl=0|d,this.Ch=0|e,this.Cl=0|f,this.Dh=0|g,this.Dl=0|h,this.Eh=0|i,this.El=0|j,this.Fh=0|k,this.Fl=0|l,this.Gh=0|m,this.Gl=0|o,this.Hh=0|p,this.Hl=0|q}process(a,b){for(let c=0;c<16;c++,b+=4)by[c]=a.getUint32(b),bz[c]=a.getUint32(b+=4);for(let a=16;a<80;a++){let b=0|by[a-15],c=0|bz[a-15],d=az(b,c,1)^az(b,c,8)^ax(b,c,7),e=aA(b,c,1)^aA(b,c,8)^ay(b,c,7),f=0|by[a-2],g=0|bz[a-2],h=az(f,g,19)^aB(f,g,61)^ax(f,g,6),i=aG(e,aA(f,g,19)^aC(f,g,61)^ay(f,g,6),bz[a-7],bz[a-16]),j=aH(i,d,h,by[a-7],by[a-16]);by[a]=0|j,bz[a]=0|i}let{Ah:c,Al:d,Bh:e,Bl:f,Ch:g,Cl:h,Dh:i,Dl:j,Eh:k,El:l,Fh:m,Fl:o,Gh:p,Gl:q,Hh:r,Hl:s}=this;for(let a=0;a<80;a++){let b=az(k,l,14)^az(k,l,18)^aB(k,l,41),t=aA(k,l,14)^aA(k,l,18)^aC(k,l,41),u=k&m^~k&p,v=aI(s,t,l&o^~l&q,bx[a],bz[a]),w=aJ(v,r,b,u,bw[a],by[a]),x=0|v,y=az(c,d,28)^aB(c,d,34)^aB(c,d,39),z=aA(c,d,28)^aC(c,d,34)^aC(c,d,39),A=c&e^c&g^e&g,B=d&f^d&h^f&h;r=0|p,s=0|q,p=0|m,q=0|o,m=0|k,o=0|l,({h:k,l:l}=aD(0|i,0|j,0|w,0|x)),i=0|g,j=0|h,g=0|e,h=0|f,e=0|c,f=0|d;let C=aE(x,z,B);c=aF(C,w,y,A),d=0|C}({h:c,l:d}=aD(0|this.Ah,0|this.Al,0|c,0|d)),({h:e,l:f}=aD(0|this.Bh,0|this.Bl,0|e,0|f)),({h:g,l:h}=aD(0|this.Ch,0|this.Cl,0|g,0|h)),({h:i,l:j}=aD(0|this.Dh,0|this.Dl,0|i,0|j)),({h:k,l:l}=aD(0|this.Eh,0|this.El,0|k,0|l)),({h:m,l:o}=aD(0|this.Fh,0|this.Fl,0|m,0|o)),({h:p,l:q}=aD(0|this.Gh,0|this.Gl,0|p,0|q)),({h:r,l:s}=aD(0|this.Hh,0|this.Hl,0|r,0|s)),this.set(c,d,e,f,g,h,i,j,k,l,m,o,p,q,r,s)}roundClean(){aS(by,bz)}destroy(){aS(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class bB extends bA{constructor(){super(48),this.Ah=0|bq[0],this.Al=0|bq[1],this.Bh=0|bq[2],this.Bl=0|bq[3],this.Ch=0|bq[4],this.Cl=0|bq[5],this.Dh=0|bq[6],this.Dl=0|bq[7],this.Eh=0|bq[8],this.El=0|bq[9],this.Fh=0|bq[10],this.Fl=0|bq[11],this.Gh=0|bq[12],this.Gl=0|bq[13],this.Hh=0|bq[14],this.Hl=0|bq[15]}}let bC=Uint32Array.from([0x22312194,0xfc2bf72c,0x9f555fa3,0xc84c64c2,0x2393b86b,0x6f53b151,0x96387719,0x5940eabd,0x96283ee2,0xa88effe3,0xbe5e1e25,0x53863992,0x2b0199fc,0x2c85b8aa,0xeb72ddc,0x81c52ca2]);class bD extends bA{constructor(){super(32),this.Ah=0|bC[0],this.Al=0|bC[1],this.Bh=0|bC[2],this.Bl=0|bC[3],this.Ch=0|bC[4],this.Cl=0|bC[5],this.Dh=0|bC[6],this.Dl=0|bC[7],this.Eh=0|bC[8],this.El=0|bC[9],this.Fh=0|bC[10],this.Fl=0|bC[11],this.Gh=0|bC[12],this.Gl=0|bC[13],this.Hh=0|bC[14],this.Hl=0|bC[15]}}let bE=a6(()=>new bu),bF=a6(()=>new bA),bG=a6(()=>new bB),bH=a6(()=>new bD),bI=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),bJ=Uint32Array.from([0xf3bcc908,0x6a09e667,0x84caa73b,0xbb67ae85,0xfe94f82b,0x3c6ef372,0x5f1d36f1,0xa54ff53a,0xade682d1,0x510e527f,0x2b3e6c1f,0x9b05688c,0xfb41bd6b,0x1f83d9ab,0x137e2179,0x5be0cd19]),bK=new Uint32Array(32);function bL(a,b,c,d,e,f){let g=e[f],h=e[f+1],i=bK[2*a],j=bK[2*a+1],k=bK[2*b],l=bK[2*b+1],m=bK[2*c],o=bK[2*c+1],p=bK[2*d],q=bK[2*d+1],r=aE(i,k,g);j=aF(r,j,l,h),i=0|r,({Dh:q,Dl:p}={Dh:q^j,Dl:p^i}),({Dh:q,Dl:p}={Dh:p,Dl:q}),({h:o,l:m}=aD(o,m,q,p)),({Bh:l,Bl:k}={Bh:l^o,Bl:k^m}),({Bh:l,Bl:k}={Bh:az(l,k,24),Bl:aA(l,k,24)}),bK[2*a]=i,bK[2*a+1]=j,bK[2*b]=k,bK[2*b+1]=l,bK[2*c]=m,bK[2*c+1]=o,bK[2*d]=p,bK[2*d+1]=q}function bM(a,b,c,d,e,f){let g=e[f],h=e[f+1],i=bK[2*a],j=bK[2*a+1],k=bK[2*b],l=bK[2*b+1],m=bK[2*c],o=bK[2*c+1],p=bK[2*d],q=bK[2*d+1],r=aE(i,k,g);j=aF(r,j,l,h),i=0|r,({Dh:q,Dl:p}={Dh:q^j,Dl:p^i}),({Dh:q,Dl:p}={Dh:az(q,p,16),Dl:aA(q,p,16)}),({h:o,l:m}=aD(o,m,q,p)),({Bh:l,Bl:k}={Bh:l^o,Bl:k^m}),({Bh:l,Bl:k}={Bh:aB(l,k,63),Bl:aC(l,k,63)}),bK[2*a]=i,bK[2*a+1]=j,bK[2*b]=k,bK[2*b+1]=l,bK[2*c]=m,bK[2*c+1]=o,bK[2*d]=p,bK[2*d+1]=q}class bN extends a5{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,aM(a),aM(b),this.blockLen=a,this.outputLen=b,this.buffer=new Uint8Array(a),this.buffer32=aR(this.buffer)}update(a){aP(this),aN(a=a3(a));let{blockLen:b,buffer:c,buffer32:d}=this,e=a.length,f=a.byteOffset,g=a.buffer;for(let h=0;h<e;){this.pos===b&&(aY(d),this.compress(d,0,!1),aY(d),this.pos=0);let i=Math.min(b-this.pos,e-h),j=f+h;if(i===b&&!(j%4)&&h+i<e){let a=new Uint32Array(g,j,Math.floor((e-h)/4));aY(a);for(let c=0;h+b<e;c+=d.length,h+=b)this.length+=b,this.compress(a,c,!1);aY(a);continue}c.set(a.subarray(h,h+i),this.pos),this.pos+=i,this.length+=i,h+=i}return this}digestInto(a){aP(this),aQ(a,this);let{pos:b,buffer32:c}=this;this.finished=!0,aS(this.buffer.subarray(b)),aY(c),this.compress(c,0,!0),aY(c);let d=aR(a);this.get().forEach((a,b)=>d[b]=aX(a))}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){let{buffer:b,length:c,finished:d,destroyed:e,outputLen:f,pos:g}=this;return a||(a=new this.constructor({dkLen:f})),a.set(...this.get()),a.buffer.set(b),a.destroyed=e,a.finished=d,a.length=c,a.pos=g,a.outputLen=f,a}clone(){return this._cloneInto()}}class bO extends bN{constructor(a={}){const b=void 0===a.dkLen?64:a.dkLen;super(128,b),this.v0l=0|bJ[0],this.v0h=0|bJ[1],this.v1l=0|bJ[2],this.v1h=0|bJ[3],this.v2l=0|bJ[4],this.v2h=0|bJ[5],this.v3l=0|bJ[6],this.v3h=0|bJ[7],this.v4l=0|bJ[8],this.v4h=0|bJ[9],this.v5l=0|bJ[10],this.v5h=0|bJ[11],this.v6l=0|bJ[12],this.v6h=0|bJ[13],this.v7l=0|bJ[14],this.v7h=0|bJ[15],function(a,b={},c,d,e){if(aM(64),a<0||a>64)throw Error("outputLen bigger than keyLen");let{key:f,salt:g,personalization:h}=b;if(void 0!==f&&(f.length<1||f.length>64))throw Error("key length must be undefined or 1..64");if(void 0!==g&&16!==g.length)throw Error("salt must be undefined or 16");if(void 0!==h&&16!==h.length)throw Error("personalization must be undefined or 16")}(b,a,0,0,0);let{key:c,personalization:d,salt:e}=a,f=0;if(void 0!==c&&(f=(c=a3(c)).length),this.v0l^=this.outputLen|f<<8|0x1010000,void 0!==e){const a=aR(e=a3(e));this.v4l^=aX(a[0]),this.v4h^=aX(a[1]),this.v5l^=aX(a[2]),this.v5h^=aX(a[3])}if(void 0!==d){const a=aR(d=a3(d));this.v6l^=aX(a[0]),this.v6h^=aX(a[1]),this.v7l^=aX(a[2]),this.v7h^=aX(a[3])}if(void 0!==c){const a=new Uint8Array(this.blockLen);a.set(c),this.update(a)}}get(){let{v0l:a,v0h:b,v1l:c,v1h:d,v2l:e,v2h:f,v3l:g,v3h:h,v4l:i,v4h:j,v5l:k,v5h:l,v6l:m,v6h:o,v7l:p,v7h:q}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,o,p,q]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,o,p,q){this.v0l=0|a,this.v0h=0|b,this.v1l=0|c,this.v1h=0|d,this.v2l=0|e,this.v2h=0|f,this.v3l=0|g,this.v3h=0|h,this.v4l=0|i,this.v4h=0|j,this.v5l=0|k,this.v5h=0|l,this.v6l=0|m,this.v6h=0|o,this.v7l=0|p,this.v7h=0|q}compress(a,b,c){this.get().forEach((a,b)=>bK[b]=a),bK.set(bJ,16);let{h:d,l:e}=av(BigInt(this.length));bK[24]=bJ[8]^e,bK[25]=bJ[9]^d,c&&(bK[28]=~bK[28],bK[29]=~bK[29]);let f=0;for(let c=0;c<12;c++)bL(0,4,8,12,a,b+2*bI[f++]),bM(0,4,8,12,a,b+2*bI[f++]),bL(1,5,9,13,a,b+2*bI[f++]),bM(1,5,9,13,a,b+2*bI[f++]),bL(2,6,10,14,a,b+2*bI[f++]),bM(2,6,10,14,a,b+2*bI[f++]),bL(3,7,11,15,a,b+2*bI[f++]),bM(3,7,11,15,a,b+2*bI[f++]),bL(0,5,10,15,a,b+2*bI[f++]),bM(0,5,10,15,a,b+2*bI[f++]),bL(1,6,11,12,a,b+2*bI[f++]),bM(1,6,11,12,a,b+2*bI[f++]),bL(2,7,8,13,a,b+2*bI[f++]),bM(2,7,8,13,a,b+2*bI[f++]),bL(3,4,9,14,a,b+2*bI[f++]),bM(3,4,9,14,a,b+2*bI[f++]);this.v0l^=bK[0]^bK[16],this.v0h^=bK[1]^bK[17],this.v1l^=bK[2]^bK[18],this.v1h^=bK[3]^bK[19],this.v2l^=bK[4]^bK[20],this.v2h^=bK[5]^bK[21],this.v3l^=bK[6]^bK[22],this.v3h^=bK[7]^bK[23],this.v4l^=bK[8]^bK[24],this.v4h^=bK[9]^bK[25],this.v5l^=bK[10]^bK[26],this.v5h^=bK[11]^bK[27],this.v6l^=bK[12]^bK[28],this.v6h^=bK[13]^bK[29],this.v7l^=bK[14]^bK[30],this.v7h^=bK[15]^bK[31],aS(bK)}destroy(){this.destroyed=!0,aS(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let bP=(g=a=>new bO(a),(b=(a,b)=>g(b).update(a3(a)).digest()).outputLen=(c=g({})).outputLen,b.blockLen=c.blockLen,b.create=a=>g(a),b);function bQ(a){let b=`Ethereum Signed Message:
${a.length}`,c=new TextEncoder().encode(b+a);return"0x"+Buffer.from(bn(c)).toString("hex")}async function bR(a,b,c,d,e,f){switch(c.t){case"eip191":var g,h,i;let j;return await (g=a,h=b,i=c.s,j=m.Signature.fromHex(i),o.Secp256k1.recoverAddress({payload:bQ(h),signature:j}).toLowerCase()===g.toLowerCase());case"eip1271":return await bS(a,b,c.s,d,e,f);default:throw Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${c.t}`)}}async function bS(a,b,c,d,e,f){let g=A(d);if(!g.namespace||!g.reference)throw Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${d}`);try{let g="0x1626ba7e",h=c.substring(2),i=(h.length/2).toString(16).padStart(64,"0"),j=(b.startsWith("0x")?b:bQ(b)).substring(2),k=g+j+"0000000000000000000000000000000000000000000000000000000000000040"+i+h,l=await fetch(`${f||"https://rpc.walletconnect.org/v1"}/?chainId=${d}&projectId=${e}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Date.now()+Math.floor(1e3*Math.random()),jsonrpc:"2.0",method:"eth_call",params:[{to:a,data:k},"latest"]})}),{result:m}=await l.json();return!!m&&m.slice(0,g.length).toLowerCase()===g.toLowerCase()}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function bT(a){let b=atob(a),c=new Uint8Array(b.length);for(let a=0;a<b.length;a++)c[a]=b.charCodeAt(a);let d=c[0];if(0===d)throw Error("No signatures found");if(c.length<1+64*d)throw Error("Transaction data too short for claimed signature count");if(c.length<100)throw Error("Transaction too short");let e=Buffer.from(a,"base64").slice(1,65);return p.default.encode(e)}function bU(a){let b=new Uint8Array(Buffer.from(a,"base64")),c=Array.from("TransactionData::").map(a=>a.charCodeAt(0)),d=new Uint8Array(c.length+b.length);d.set(c),d.set(b,c.length);let e=bP(d,{dkLen:32});return p.default.encode(e)}function bV(a){let b=new Uint8Array(bE(function(a){if(a instanceof Uint8Array)return a;if(Array.isArray(a))return new Uint8Array(a);if("object"==typeof a&&null!=a&&a.data)return new Uint8Array(Object.values(a.data));if("object"==typeof a&&a)return new Uint8Array(Object.values(a));throw Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}(a)));return p.default.encode(b)}function bW(a){let b=Buffer.from(a,"base64"),c=(0,q.decode)(b).txn;if(!c)throw Error("Invalid signed transaction: missing 'txn' field");let d=(0,r.encode)(c),e=Buffer.from("TX"),f=bH(Buffer.concat([e,Buffer.from(d)]));return s.base32.encode(f).replace(/=+$/,"")}function bX(a){let b=[],c=BigInt(a);for(;c>=BigInt(128);)b.push(Number(c&BigInt(127)|BigInt(128))),c>>=BigInt(7);return b.push(Number(c)),Buffer.from(b)}function bY(a){let b=Buffer.from(a.signed.bodyBytes,"base64"),c=Buffer.from(a.signed.authInfoBytes,"base64"),d=Buffer.from(a.signature.signature,"base64"),e=[];e.push(Buffer.from([10])),e.push(bX(b.length)),e.push(b),e.push(Buffer.from([18])),e.push(bX(c.length)),e.push(c),e.push(Buffer.from([26])),e.push(bX(d.length)),e.push(d);let f=bE(Buffer.concat(e));return Buffer.from(f).toString("hex").toUpperCase()}function bZ(a){var b,c;let d=[];try{if("string"==typeof a)return d.push(a),d;if("object"!=typeof a)return d;null!=a&&a.id&&d.push(a.id);let e=null==(c=null==(b=a?.capabilities)?void 0:b.caip345)?void 0:c.transactionHashes;e&&d.push(...e)}catch(a){console.warn("getWalletSendCallsHashes failed: ",a)}return d}var b$=Object.defineProperty,b_=Object.defineProperties,b0=Object.getOwnPropertyDescriptors,b1=Object.getOwnPropertySymbols,b2=Object.prototype.hasOwnProperty,b3=Object.prototype.propertyIsEnumerable,b4=(a,b,c)=>b in a?b$(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c;let b5="did:pkh:",b6={eip155:"Ethereum",solana:"Solana",bip122:"Bitcoin"},b7=a=>a?.split(":"),b8=a=>{let b=a&&b7(a);if(b)return b[2]+":"+b[3]},b9=a=>{let b=a&&b7(a);if(b)return b.pop()};async function ca(a){let{cacao:b,projectId:c}=a,{s:d,p:e}=b,f=cb(e,e.iss),g=b9(e.iss);return await bR(g,f,d,b8(e.iss),c)}let cb=(a,b)=>{let c=(a=>{let b=a&&b7(a);if(b)return a.includes(b5)?b[2]:b[0]})(b);if(!c)throw Error("Invalid issuer: "+b);let d=`${a.domain} wants you to sign in with your ${c?b6[c]||c:""} account:`,e=b9(b);if(!a.aud&&!a.uri)throw Error("Either `aud` or `uri` is required to construct the message");let f=a.statement||void 0,g=`URI: ${a.aud||a.uri}`,h=`Version: ${a.version}`,i=`Chain ID: ${(a=>{let b=a&&b7(a);if(b)return a.includes(b5)?b[3]:b[1]})(b)}`,j=`Nonce: ${a.nonce}`,k=`Issued At: ${a.iat}`,l=a.exp?`Expiration Time: ${a.exp}`:void 0,m=a.nbf?`Not Before: ${a.nbf}`:void 0,o=a.requestId?`Request ID: ${a.requestId}`:void 0,p=a.resources?`Resources:${a.resources.map(a=>`
- ${a}`).join("")}`:void 0,q=cj(a.resources);return q&&(f=function(a="",b){cc(b);let c="I further authorize the stated URI to perform the following actions on my behalf: ";if(a.includes(c))return a;let d=[],e=0;Object.keys(b.att).forEach(a=>{let c=Object.keys(b.att[a]).map(a=>({ability:a.split("/")[0],action:a.split("/")[1]}));c.sort((a,b)=>a.action.localeCompare(b.action));let f={};c.forEach(a=>{f[a.ability]||(f[a.ability]=[]),f[a.ability].push(a.action)});let g=Object.keys(f).map(b=>(e++,`(${e}) '${b}': '${f[b].join("', '")}' for '${a}'.`));d.push(g.join(", ").replace(".,","."))});let f=d.join(" "),g=`${c}${f}`;return`${a?a+" ":""}${g}`}(f,ce(q))),[d,e,"",f,"",g,h,i,j,k,l,m,o,p].filter(a=>null!=a).join(`
`)};function cc(a){if(!a)throw Error("No recap provided, value is undefined");if(!a.att)throw Error("No `att` property found");let b=Object.keys(a.att);if(!(null!=b&&b.length))throw Error("No resources found in `att` property");b.forEach(b=>{let c=a.att[b];if(Array.isArray(c)||"object"!=typeof c)throw Error(`Resource must be an object: ${b}`);if(!Object.keys(c).length)throw Error(`Resource object is empty: ${b}`);Object.keys(c).forEach(a=>{let b=c[a];if(!Array.isArray(b))throw Error(`Ability limits ${a} must be an array of objects, found: ${b}`);if(!b.length)throw Error(`Value of ${a} is empty array, must be an array with objects`);b.forEach(b=>{if("object"!=typeof b)throw Error(`Ability limits (${a}) must be an array of objects, found: ${b}`)})})})}function cd(a){return cc(a),`urn:recap:${Buffer.from(JSON.stringify(a)).toString("base64").replace(/=/g,"")}`}function ce(a){var b;let c=(b=a.replace("urn:recap:",""),JSON.parse(Buffer.from(b,"base64").toString("utf-8")));return cc(c),c}function cf(a,b,c){return cd(function(a,b,c,d={}){return c?.sort((a,b)=>a.localeCompare(b)),{att:{[a]:function(a,b,c={}){return Object.assign({},...(b=b?.sort((a,b)=>a.localeCompare(b))).map(b=>({[`${a}/${b}`]:[c]})))}(b,c,d)}}}(a,b,c))}function cg(a,b){var c,d;let e,f;return cd((c=ce(a),d=ce(b),cc(c),cc(d),e=Object.keys(c.att).concat(Object.keys(d.att)).sort((a,b)=>a.localeCompare(b)),f={att:{}},e.forEach(a=>{var b,e;Object.keys((null==(b=c.att)?void 0:b[a])||{}).concat(Object.keys((null==(e=d.att)?void 0:e[a])||{})).sort((a,b)=>a.localeCompare(b)).forEach(b=>{var e,g;f.att[a]=b_(((a,b)=>{for(var c in b||(b={}))b2.call(b,c)&&b4(a,c,b[c]);if(b1)for(var c of b1(b))b3.call(b,c)&&b4(a,c,b[c]);return a})({},f.att[a]),b0({[b]:(null==(e=c.att[a])?void 0:e[b])||(null==(g=d.att[a])?void 0:g[b])}))})}),f))}function ch(a){var b;let c=ce(a);cc(c);let d=null==(b=c.att)?void 0:b.eip155;return d?Object.keys(d).map(a=>a.split("/")[1]):[]}function ci(a){let b=ce(a);cc(b);let c=[];return Object.values(b.att).forEach(a=>{Object.values(a).forEach(a=>{var b;null!=(b=a?.[0])&&b.chains&&c.push(a[0].chains)})}),[...new Set(c.flat())]}function cj(a){if(!a)return;let b=a?.[a.length-1];return b&&b.includes("urn:recap:")?b:void 0}function ck(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function cl(a){if("boolean"!=typeof a)throw Error(`boolean expected, not ${a}`)}function cm(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function cn(a,...b){if(!ck(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function co(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function cp(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function cq(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}let cr=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function cs(a){if("string"==typeof a)a=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(a);else if(ck(a))a=cv(a);else throw Error("Uint8Array expected, got "+typeof a);return a}function ct(a,b,c=!0){if(void 0===b)return new Uint8Array(a);if(b.length!==a)throw Error("invalid output length, expected "+a+", got: "+b.length);if(c&&b.byteOffset%4!=0)throw Error("invalid output, must be aligned");return b}function cu(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)}function cv(a){return Uint8Array.from(a)}let cw=a=>Uint8Array.from(a.split("").map(a=>a.charCodeAt(0))),cx=cw("expand 16-byte k"),cy=cw("expand 32-byte k"),cz=cp(cx),cA=cp(cy);function cB(a,b){return a<<b|a>>>32-b}function cC(a){return a.byteOffset%4==0}let cD=0x100000000-1,cE=new Uint32Array,cF=(a,b)=>255&a[b++]|(255&a[b++])<<8;class cG{constructor(a){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,cn(a=cs(a),32);const b=cF(a,0),c=cF(a,2),d=cF(a,4),e=cF(a,6),f=cF(a,8),g=cF(a,10),h=cF(a,12),i=cF(a,14);this.r[0]=8191&b,this.r[1]=(b>>>13|c<<3)&8191,this.r[2]=(c>>>10|d<<6)&7939,this.r[3]=(d>>>7|e<<9)&8191,this.r[4]=(e>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|g<<2)&8191,this.r[7]=(g>>>11|h<<5)&8065,this.r[8]=(h>>>8|i<<8)&8191,this.r[9]=i>>>5&127;for(let b=0;b<8;b++)this.pad[b]=cF(a,16+2*b)}process(a,b,c=!1){let{h:d,r:e}=this,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],o=e[8],p=e[9],q=cF(a,b+0),r=cF(a,b+2),s=cF(a,b+4),t=cF(a,b+6),u=cF(a,b+8),v=cF(a,b+10),w=cF(a,b+12),x=cF(a,b+14),y=d[0]+(8191&q),z=d[1]+((q>>>13|r<<3)&8191),A=d[2]+((r>>>10|s<<6)&8191),B=d[3]+((s>>>7|t<<9)&8191),C=d[4]+((t>>>4|u<<12)&8191),D=d[5]+(u>>>1&8191),E=d[6]+((u>>>14|v<<2)&8191),F=d[7]+((v>>>11|w<<5)&8191),G=d[8]+((w>>>8|x<<8)&8191),H=d[9]+(x>>>5|2048*!c),I=0,J=0+y*f+5*p*z+5*o*A+5*m*B+5*l*C;I=J>>>13,J&=8191,J+=5*k*D+5*j*E+5*i*F+5*h*G+5*g*H,I+=J>>>13,J&=8191;let K=I+y*g+z*f+5*p*A+5*o*B+5*m*C;I=K>>>13,K&=8191,K+=5*l*D+5*k*E+5*j*F+5*i*G+5*h*H,I+=K>>>13,K&=8191;let L=I+y*h+z*g+A*f+5*p*B+5*o*C;I=L>>>13,L&=8191,L+=5*m*D+5*l*E+5*k*F+5*j*G+5*i*H,I+=L>>>13,L&=8191;let M=I+y*i+z*h+A*g+B*f+5*p*C;I=M>>>13,M&=8191,M+=5*o*D+5*m*E+5*l*F+5*k*G+5*j*H,I+=M>>>13,M&=8191;let N=I+y*j+z*i+A*h+B*g+C*f;I=N>>>13,N&=8191,N+=5*p*D+5*o*E+5*m*F+5*l*G+5*k*H,I+=N>>>13,N&=8191;let O=I+y*k+z*j+A*i+B*h+C*g;I=O>>>13,O&=8191,O+=D*f+5*p*E+5*o*F+5*m*G+5*l*H,I+=O>>>13,O&=8191;let P=I+y*l+z*k+A*j+B*i+C*h;I=P>>>13,P&=8191,P+=D*g+E*f+5*p*F+5*o*G+5*m*H,I+=P>>>13,P&=8191;let Q=I+y*m+z*l+A*k+B*j+C*i;I=Q>>>13,Q&=8191,Q+=D*h+E*g+F*f+5*p*G+5*o*H,I+=Q>>>13,Q&=8191;let R=I+y*o+z*m+A*l+B*k+C*j;I=R>>>13,R&=8191,R+=D*i+E*h+F*g+G*f+5*p*H,I+=R>>>13,R&=8191;let S=I+y*p+z*o+A*m+B*l+C*k;I=S>>>13,S&=8191,S+=D*j+E*i+F*h+G*g+H*f,I+=S>>>13,S&=8191,J=8191&(I=(I=(I<<2)+I|0)+J|0),I>>>=13,K+=I,d[0]=J,d[1]=K,d[2]=L,d[3]=M,d[4]=N,d[5]=O,d[6]=P,d[7]=Q,d[8]=R,d[9]=S}finalize(){let{h:a,pad:b}=this,c=new Uint16Array(10),d=a[1]>>>13;a[1]&=8191;for(let b=2;b<10;b++)a[b]+=d,d=a[b]>>>13,a[b]&=8191;a[0]+=5*d,d=a[0]>>>13,a[0]&=8191,a[1]+=d,d=a[1]>>>13,a[1]&=8191,a[2]+=d,c[0]=a[0]+5,d=c[0]>>>13,c[0]&=8191;for(let b=1;b<10;b++)c[b]=a[b]+d,d=c[b]>>>13,c[b]&=8191;c[9]-=8192;let e=(1^d)-1;for(let a=0;a<10;a++)c[a]&=e;e=~e;for(let b=0;b<10;b++)a[b]=a[b]&e|c[b];a[0]=(a[0]|a[1]<<13)&65535,a[1]=(a[1]>>>3|a[2]<<10)&65535,a[2]=(a[2]>>>6|a[3]<<7)&65535,a[3]=(a[3]>>>9|a[4]<<4)&65535,a[4]=(a[4]>>>12|a[5]<<1|a[6]<<14)&65535,a[5]=(a[6]>>>2|a[7]<<11)&65535,a[6]=(a[7]>>>5|a[8]<<8)&65535,a[7]=(a[8]>>>8|a[9]<<5)&65535;let f=a[0]+b[0];a[0]=65535&f;for(let c=1;c<8;c++)f=(a[c]+b[c]|0)+(f>>>16)|0,a[c]=65535&f;cq(c)}update(a){co(this),cn(a=cs(a));let{buffer:b,blockLen:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(c-this.pos,d-e);if(f===c){for(;c<=d-e;e+=c)this.process(a,e);continue}b.set(a.subarray(e,e+f),this.pos),this.pos+=f,e+=f,this.pos===c&&(this.process(b,0,!1),this.pos=0)}return this}destroy(){cq(this.h,this.r,this.buffer,this.pad)}digestInto(a){co(this),function(a,b){cn(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}(a,this),this.finished=!0;let{buffer:b,h:c}=this,{pos:d}=this;if(d){for(b[d++]=1;d<16;d++)b[d]=0;this.process(b,0,!0)}this.finalize();let e=0;for(let b=0;b<8;b++)a[e++]=c[b]>>>0,a[e++]=c[b]>>>8;return a}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}}let cH=(h=a=>new cG(a),(d=(a,b)=>h(b).update(cs(a)).digest()).outputLen=(e=h(new Uint8Array(32))).outputLen,d.blockLen=e.blockLen,d.create=a=>h(a),d),cI=function(a,b){let{allowShortKeys:c,extendNonceFn:d,counterLength:e,counterRight:f,rounds:g}=function(a,b){if(null==b||"object"!=typeof b)throw Error("options must be defined");return Object.assign(a,b)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},b);if("function"!=typeof a)throw Error("core must be a function");return cm(e),cm(g),cl(f),cl(c),(b,h,i,j,k=0)=>{cn(b),cn(h),cn(i);let l=i.length;if(void 0===j&&(j=new Uint8Array(l)),cn(j),cm(k),k<0||k>=cD)throw Error("arx: counter overflow");if(j.length<l)throw Error(`arx: output (${j.length}) is shorter than data (${l})`);let m=[],o=b.length,p,q;if(32===o)m.push(p=cv(b)),q=cA;else if(16===o&&c)(p=new Uint8Array(32)).set(b),p.set(b,16),q=cz,m.push(p);else throw Error(`arx: invalid 32-byte key, got length=${o}`);cC(h)||m.push(h=cv(h));let r=cp(p);if(d){if(24!==h.length)throw Error("arx: extended nonce must be 24 bytes");d(q,r,cp(h.subarray(0,16)),r),h=h.subarray(16)}let s=16-e;if(s!==h.length)throw Error(`arx: nonce must be ${s} or 16 bytes`);if(12!==s){let a=new Uint8Array(12);a.set(h,f?0:12-h.length),h=a,m.push(h)}return function(a,b,c,d,e,f,g,h){let i=e.length,j=new Uint8Array(64),k=cp(j),l=cC(e)&&cC(f),m=l?cp(e):cE,o=l?cp(f):cE;for(let p=0;p<i;g++){if(a(b,c,d,k,g,h),g>=cD)throw Error("arx: counter overflow");let q=Math.min(64,i-p);if(l&&64===q){let a=p/4;if(p%4!=0)throw Error("arx: invalid block position");for(let b=0,c;b<16;b++)o[c=a+b]=m[c]^k[b];p+=64;continue}for(let a=0,b;a<q;a++)f[b=p+a]=e[b]^j[a];p+=q}}(a,q,r,cp(h),i,j,k,g),cq(...m),j}}(function(a,b,c,d,e,f=20){let g=a[0],h=a[1],i=a[2],j=a[3],k=b[0],l=b[1],m=b[2],o=b[3],p=b[4],q=b[5],r=b[6],s=b[7],t=c[0],u=c[1],v=c[2],w=g,x=h,y=i,z=j,A=k,B=l,C=m,D=o,E=p,F=q,G=r,H=s,I=e,J=t,K=u,L=v;for(let a=0;a<f;a+=2)E=E+(I=cB(I^(w=w+A|0),16))|0,w=w+(A=cB(A^E,12))|0,E=E+(I=cB(I^w,8))|0,A=cB(A^E,7),F=F+(J=cB(J^(x=x+B|0),16))|0,x=x+(B=cB(B^F,12))|0,F=F+(J=cB(J^x,8))|0,B=cB(B^F,7),G=G+(K=cB(K^(y=y+C|0),16))|0,y=y+(C=cB(C^G,12))|0,G=G+(K=cB(K^y,8))|0,C=cB(C^G,7),H=H+(L=cB(L^(z=z+D|0),16))|0,z=z+(D=cB(D^H,12))|0,H=H+(L=cB(L^z,8))|0,D=cB(D^H,7),G=G+(L=cB(L^(w=w+B|0),16))|0,w=w+(B=cB(B^G,12))|0,G=G+(L=cB(L^w,8))|0,B=cB(B^G,7),H=H+(I=cB(I^(x=x+C|0),16))|0,x=x+(C=cB(C^H,12))|0,H=H+(I=cB(I^x,8))|0,C=cB(C^H,7),E=E+(J=cB(J^(y=y+D|0),16))|0,y=y+(D=cB(D^E,12))|0,E=E+(J=cB(J^y,8))|0,D=cB(D^E,7),F=F+(K=cB(K^(z=z+A|0),16))|0,z=z+(A=cB(A^F,12))|0,F=F+(K=cB(K^z,8))|0,A=cB(A^F,7);let M=0;d[M++]=g+w|0,d[M++]=h+x|0,d[M++]=i+y|0,d[M++]=j+z|0,d[M++]=k+A|0,d[M++]=l+B|0,d[M++]=m+C|0,d[M++]=o+D|0,d[M++]=p+E|0,d[M++]=q+F|0,d[M++]=r+G|0,d[M++]=s+H|0,d[M++]=e+I|0,d[M++]=t+J|0,d[M++]=u+K|0,d[M++]=v+L|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),cJ=new Uint8Array(16),cK=(a,b)=>{a.update(b);let c=b.length%16;c&&a.update(cJ.subarray(c))},cL=new Uint8Array(32);function cM(a,b,c,d,e){var f,g;let h,i,j=a(b,c,cL),k=cH.create(j);e&&cK(k,e),cK(k,d);let l=(f=d.length,g=e?e.length:0,cl(!0),cu(i=new DataView((h=new Uint8Array(16)).buffer,h.byteOffset,h.byteLength),0,BigInt(g),!0),cu(i,8,BigInt(f),!0),h);k.update(l);let m=k.digest();return cq(j,l),m}let cN=((a,b)=>{function c(d,...e){if(cn(d),!cr)throw Error("Non little-endian hardware is not yet supported");if(void 0!==a.nonceLength){let b=e[0];if(!b)throw Error("nonce / iv required");a.varSizeNonce?cn(b):cn(b,a.nonceLength)}let f=a.tagLength;f&&void 0!==e[1]&&cn(e[1]);let g=b(d,...e),h=(a,b)=>{if(void 0!==b){if(2!==a)throw Error("cipher output not supported");cn(b)}},i=!1;return{encrypt(a,b){if(i)throw Error("cannot encrypt() twice with same key + nonce");return i=!0,cn(a),h(g.encrypt.length,b),g.encrypt(a,b)},decrypt(a,b){if(cn(a),f&&a.length<f)throw Error("invalid ciphertext length: smaller than tagLength="+f);return h(g.decrypt.length,b),g.decrypt(a,b)}}}return Object.assign(c,a),c})({blockSize:64,nonceLength:12,tagLength:16},(a,b,c)=>({encrypt(d,e){let f=d.length;(e=ct(f+16,e,!1)).set(d);let g=e.subarray(0,-16);cI(a,b,g,g,1);let h=cM(cI,a,b,g,c);return e.set(h,f),cq(h),e},decrypt(d,e){e=ct(d.length-16,e,!1);let f=d.subarray(0,-16),g=d.subarray(-16),h=cM(cI,a,b,f,c);if(!function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c}(g,h))throw Error("invalid tag");return e.set(d.subarray(0,-16)),cI(a,b,e,e,1),cq(h),e}}));class cO extends a5{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,aO(a);const c=a3(b);if(this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const d=this.blockLen,e=new Uint8Array(d);e.set(c.length>d?a.create().update(c).digest():c);for(let a=0;a<e.length;a++)e[a]^=54;this.iHash.update(e),this.oHash=a.create();for(let a=0;a<e.length;a++)e[a]^=106;this.oHash.update(e),aS(e)}update(a){return aP(this),this.iHash.update(a),this}digestInto(a){aP(this),aN(a,this.outputLen),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||(a=Object.create(Object.getPrototypeOf(this),{}));let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let cP=(a,b,c)=>new cO(a,b).update(c).digest();cP.create=(a,b)=>new cO(a,b);let cQ=Uint8Array.from([0]),cR=Uint8Array.of(),cS=BigInt(0),cT=BigInt(1);function cU(a,b=""){if("boolean"!=typeof a)throw Error((b&&`"${b}"`)+"expected boolean, got type="+typeof a);return a}function cV(a,b,c=""){let d=aL(a),e=a?.length,f=void 0!==b;if(!d||f&&e!==b)throw Error((c&&`"${c}" `)+"expected Uint8Array"+(f?` of length ${b}`:"")+", got "+(d?`length=${e}`:`type=${typeof a}`));return a}function cW(a){let b=a.toString(16);return 1&b.length?"0"+b:b}function cX(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?cS:BigInt("0x"+a)}function cY(a){return aN(a),cX(a_(Uint8Array.from(a).reverse()))}function cZ(a,b){return a1(a.toString(16).padStart(2*b,"0"))}function c$(a,b){return cZ(a,b).reverse()}function c_(a,b,c){let d;if("string"==typeof b)try{d=a1(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(aL(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}let c0=a=>"bigint"==typeof a&&cS<=a;function c1(a,b,c,d){if(!(c0(b)&&c0(c)&&c0(d))||!(c<=b)||!(b<d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}function c2(a){let b;for(b=0;a>cS;a>>=cT,b+=1);return b}let c3=a=>(cT<<BigInt(a))-cT;function c4(a,b,c={}){if(!a||"object"!=typeof a)throw Error("expected valid options object");function d(b,c,d){let e=a[b];if(d&&void 0===e)return;let f=typeof e;if(f!==c||null===e)throw Error(`param "${b}" is invalid: expected ${c}, got ${f}`)}Object.entries(b).forEach(([a,b])=>d(a,b,!1)),Object.entries(c).forEach(([a,b])=>d(a,b,!0))}function c5(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let c6=BigInt(0),c7=BigInt(1),c8=BigInt(2),c9=BigInt(3),da=BigInt(4),db=BigInt(5),dc=BigInt(7),dd=BigInt(8),de=BigInt(9),df=BigInt(16);function dg(a,b){let c=a%b;return c>=c6?c:b+c}function dh(a,b,c){let d=a;for(;b-- >c6;)d*=d,d%=c;return d}function di(a,b){if(a===c6)throw Error("invert: expected non-zero number");if(b<=c6)throw Error("invert: expected positive modulus, got "+b);let c=dg(a,b),d=b,e=c6,f=c7;for(;c!==c6;){let a=d/c,b=d%c,g=e-f*a;d=c,c=b,e=f,f=g}if(d!==c7)throw Error("invert: does not exist");return dg(e,b)}function dj(a,b,c){if(!a.eql(a.sqr(b),c))throw Error("Cannot find square root")}function dk(a,b){let c=(a.ORDER+c7)/da,d=a.pow(b,c);return dj(a,d,b),d}function dl(a,b){let c=(a.ORDER-db)/dd,d=a.mul(b,c8),e=a.pow(d,c),f=a.mul(b,e),g=a.mul(a.mul(f,c8),e),h=a.mul(f,a.sub(g,a.ONE));return dj(a,h,b),h}function dm(a){if(a<c9)throw Error("sqrt is not defined for small field");let b=a-c7,c=0;for(;b%c8===c6;)b/=c8,c++;let d=c8,e=ds(a);for(;1===dq(e,d);)if(d++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===c)return dk;let f=e.pow(d,b),g=(b+c7)/c8;return function(a,d){if(a.is0(d))return d;if(1!==dq(a,d))throw Error("Cannot find square root");let e=c,h=a.mul(a.ONE,f),i=a.pow(d,b),j=a.pow(d,g);for(;!a.eql(i,a.ONE);){if(a.is0(i))return a.ZERO;let b=1,c=a.sqr(i);for(;!a.eql(c,a.ONE);)if(b++,c=a.sqr(c),b===e)throw Error("Cannot find square root");let d=c7<<BigInt(e-b-1),f=a.pow(h,d);e=b,h=a.sqr(f),i=a.mul(i,h),j=a.mul(j,f)}return j}}let dn=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function dp(a,b,c=!1){let d=Array(b.length).fill(c?a.ZERO:void 0),e=b.reduce((b,c,e)=>a.is0(c)?b:(d[e]=b,a.mul(b,c)),a.ONE),f=a.inv(e);return b.reduceRight((b,c,e)=>a.is0(c)?b:(d[e]=a.mul(b,d[e]),a.mul(b,c)),f),d}function dq(a,b){let c=(a.ORDER-c7)/c8,d=a.pow(b,c),e=a.eql(d,a.ONE),f=a.eql(d,a.ZERO),g=a.eql(d,a.neg(a.ONE));if(!e&&!f&&!g)throw Error("invalid Legendre symbol result");return e?1:f?0:-1}function dr(a,b){void 0!==b&&aM(b);let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function ds(a,b,c=!1,d={}){let e;if(a<=c6)throw Error("invalid field: expected ORDER > 0, got "+a);let f,g,h=!1,i;if("object"==typeof b&&null!=b){if(d.sqrt||c)throw Error("cannot specify opts in two arguments");b.BITS&&(f=b.BITS),b.sqrt&&(g=b.sqrt),"boolean"==typeof b.isLE&&(c=b.isLE),"boolean"==typeof b.modFromBytes&&(h=b.modFromBytes),i=b.allowedLengths}else"number"==typeof b&&(f=b),d.sqrt&&(g=d.sqrt);let{nBitLength:j,nByteLength:k}=dr(a,f);if(k>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let l=Object.freeze({ORDER:a,isLE:c,BITS:j,BYTES:k,MASK:c3(j),ZERO:c6,ONE:c7,allowedLengths:i,create:b=>dg(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return c6<=b&&b<a},is0:a=>a===c6,isValidNot0:a=>!l.is0(a)&&l.isValid(a),isOdd:a=>(a&c7)===c7,neg:b=>dg(-b,a),eql:(a,b)=>a===b,sqr:b=>dg(b*b,a),add:(b,c)=>dg(b+c,a),sub:(b,c)=>dg(b-c,a),mul:(b,c)=>dg(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<c6)throw Error("invalid exponent, negatives unsupported");if(c===c6)return a.ONE;if(c===c7)return b;let d=a.ONE,e=b;for(;c>c6;)c&c7&&(d=a.mul(d,e)),e=a.sqr(e),c>>=c7;return d})(l,a,b),div:(b,c)=>dg(b*di(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>di(b,a),sqrt:g||(b=>{let c,d,f,g,h,i;return e||(e=a%da===c9?dk:a%dd===db?dl:a%df===de?(c=ds(a),f=(d=dm(a))(c,c.neg(c.ONE)),g=d(c,f),h=d(c,c.neg(f)),i=(a+dc)/df,(a,b)=>{let c=a.pow(b,i),d=a.mul(c,f),e=a.mul(c,g),j=a.mul(c,h),k=a.eql(a.sqr(d),b),l=a.eql(a.sqr(e),b);c=a.cmov(c,d,k),d=a.cmov(j,e,l);let m=a.eql(a.sqr(d),b),o=a.cmov(c,d,m);return dj(a,o,b),o}):dm(a)),e(l,b)}),toBytes:a=>c?c$(a,k):cZ(a,k),fromBytes:(b,d=!0)=>{if(i){if(!i.includes(b.length)||b.length>k)throw Error("Field.fromBytes: expected "+i+" bytes, got "+b.length);let a=new Uint8Array(k);a.set(b,c?0:a.length-b.length),b=a}if(b.length!==k)throw Error("Field.fromBytes: expected "+k+" bytes, got "+b.length);let e=c?cY(b):cX(a_(b));if(h&&(e=dg(e,a)),!d&&!l.isValid(e))throw Error("invalid field element: outside of range 0..ORDER");return e},invertBatch:a=>dp(l,a),cmov:(a,b,c)=>c?b:a});return Object.freeze(l)}function dt(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function du(a){let b=dt(a);return b+Math.ceil(b/2)}let dv=BigInt(0),dw=BigInt(1);function dx(a,b){let c=b.negate();return a?c:b}function dy(a,b){let c=dp(a.Fp,b.map(a=>a.Z));return b.map((b,d)=>a.fromAffine(b.toAffine(c[d])))}function dz(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function dA(a,b){dz(a,b);let c=Math.ceil(b/a)+1,d=2**(a-1),e=2**a;return{windows:c,windowSize:d,mask:c3(a),maxNumber:e,shiftBy:BigInt(a)}}function dB(a,b,c){let{windowSize:d,mask:e,maxNumber:f,shiftBy:g}=c,h=Number(a&e),i=a>>g;h>d&&(h-=f,i+=dw);let j=b*d;return{nextN:i,offset:j+Math.abs(h)-1,isZero:0===h,isNeg:h<0,isNegF:b%2!=0,offsetF:j}}let dC=new WeakMap,dD=new WeakMap;function dE(a){return dD.get(a)||1}function dF(a){if(a!==dv)throw Error("invalid wNAF")}class dG{constructor(a,b){this.BASE=a.BASE,this.ZERO=a.ZERO,this.Fn=a.Fn,this.bits=b}_unsafeLadder(a,b,c=this.ZERO){let d=a;for(;b>dv;)b&dw&&(c=c.add(d)),d=d.double(),b>>=dw;return c}precomputeWindow(a,b){let{windows:c,windowSize:d}=dA(b,this.bits),e=[],f=a,g=f;for(let a=0;a<c;a++){g=f,e.push(g);for(let a=1;a<d;a++)g=g.add(f),e.push(g);f=g.double()}return e}wNAF(a,b,c){if(!this.Fn.isValid(c))throw Error("invalid scalar");let d=this.ZERO,e=this.BASE,f=dA(a,this.bits);for(let a=0;a<f.windows;a++){let{nextN:g,offset:h,isZero:i,isNeg:j,isNegF:k,offsetF:l}=dB(c,a,f);c=g,i?e=e.add(dx(k,b[l])):d=d.add(dx(j,b[h]))}return dF(c),{p:d,f:e}}wNAFUnsafe(a,b,c,d=this.ZERO){let e=dA(a,this.bits);for(let a=0;a<e.windows&&c!==dv;a++){let{nextN:f,offset:g,isZero:h,isNeg:i}=dB(c,a,e);if(c=f,!h){let a=b[g];d=d.add(i?a.negate():a)}}return dF(c),d}getPrecomputes(a,b,c){let d=dC.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&("function"==typeof c&&(d=c(d)),dC.set(b,d))),d}cached(a,b,c){let d=dE(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)}unsafe(a,b,c,d){let e=dE(a);return 1===e?this._unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)}createCache(a,b){dz(b,this.bits),dD.set(a,b),dC.delete(a)}hasCache(a){return 1!==dE(a)}}function dH(a,b,c){if(!b)return ds(a,{isLE:c});if(b.ORDER!==a)throw Error("Field.ORDER must match order: Fp == p, Fn == n");return c4(b,dn.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"})),b}BigInt(0),BigInt(1),BigInt(2),BigInt(8),a2("HashToScalar-");let dI=BigInt(0),dJ=BigInt(1),dK=BigInt(2),dL=BigInt(1),dM=BigInt(2),dN=BigInt(3),dO=BigInt(5),dP=BigInt(8),dQ=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),dR={p:dQ,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:dP,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")},dS=function(a){let{P:b,type:c,adjustScalarBytes:d,powPminus2:e,randomBytes:f}=(c4(a,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...a})),g="x25519"===c;if(!g&&"x448"!==c)throw Error("invalid type");let h=f||a7,i=g?255:448,j=g?32:56,k=BigInt(g?9:5),l=BigInt(g?121665:39081),m=g?dK**BigInt(254):dK**BigInt(447),o=m+(g?BigInt(8)*dK**BigInt(251)-dJ:BigInt(4)*dK**BigInt(445)-dJ)+dJ,p=a=>dg(a,b),q=c$(p(k),j);function r(a,c){let f,h=function(a,c){c1("u",a,dI,b),c1("scalar",c,m,o);let d=dJ,f=dI,g=a,h=dJ,j=dI;for(let b=BigInt(i-1);b>=dI;b--){let e=c>>b&dJ;j^=e,({x_2:d,x_3:g}=t(j,d,g)),({x_2:f,x_3:h}=t(j,f,h)),j=e;let i=d+f,k=p(i*i),m=d-f,o=p(m*m),q=k-o,r=g+h,s=p((g-h)*i),u=p(r*m),v=s+u,w=s-u;g=p(v*v),h=p(a*p(w*w)),d=p(k*o),f=p(q*(k+p(l*q)))}return{x_2:d,x_3:g}=t(j,d,g),{x_2:f,x_3:h}=t(j,f,h),p(d*e(f))}((f=c_("u coordinate",c,j),g&&(f[31]&=127),p(cY(f))),cY(d(c_("scalar",a,j))));if(h===dI)throw Error("invalid private or public key received");return c$(p(h),j)}function s(a){return r(a,q)}function t(a,b,c){let d=p(a*(b-c));return{x_2:b=p(b-d),x_3:c=p(c+d)}}let u={secretKey:j,publicKey:j,seed:j},v=(a=h(j))=>(aN(a,u.seed),a);return{keygen:function(a){let b=v(a);return{secretKey:b,publicKey:s(b)}},getSharedSecret:(a,b)=>r(a,b),getPublicKey:a=>s(a),scalarMult:r,scalarMultBase:s,utils:{randomSecretKey:v,randomPrivateKey:v},GuBytes:q.slice(),lengths:u}}({P:f=ds(dR.p,{isLE:!0}).ORDER,type:"x25519",powPminus2:a=>{let b,c,d,e,g,h,i,j,k,l,m,o,p,q,{pow_p_5_8:r,b2:s}=(b=BigInt(10),c=BigInt(20),d=BigInt(40),e=BigInt(80),h=dh(g=a*a%dQ*a%dQ,dM,dQ)*g%dQ,i=dh(h,dL,dQ)*a%dQ,j=dh(i,dO,dQ)*i%dQ,k=dh(j,b,dQ)*j%dQ,l=dh(k,c,dQ)*k%dQ,m=dh(l,d,dQ)*l%dQ,o=dh(m,e,dQ)*m%dQ,p=dh(o,e,dQ)*m%dQ,q=dh(p,b,dQ)*j%dQ,{pow_p_5_8:dh(q,dM,dQ)*a%dQ,b2:g});return dg(dh(r,dN,f)*s,f)},adjustScalarBytes:function(a){return a[0]&=248,a[31]&=127,a[31]|=64,a}}),dT=(a,b)=>(a+(a>=0?b:-b)/dZ)/b;function dU(a){if(!["compact","recovered","der"].includes(a))throw Error('Signature format must be "compact", "recovered", or "der"');return a}function dV(a,b){let c={};for(let d of Object.keys(b))c[d]=void 0===a[d]?b[d]:a[d];return cU(c.lowS,"lowS"),cU(c.prehash,"prehash"),void 0!==c.format&&dU(c.format),c}let dW={Err:class extends Error{constructor(a=""){super(a)}},_tlv:{encode:(a,b)=>{let{Err:c}=dW;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(1&b.length)throw new c("tlv.encode: unpadded data");let d=b.length/2,e=cW(d);if(e.length/2&128)throw new c("tlv.encode: long form length too big");let f=d>127?cW(e.length/2|128):"";return cW(a)+f+e+b},decode(a,b){let{Err:c}=dW,d=0;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(b.length<2||b[d++]!==a)throw new c("tlv.decode: wrong tlv");let e=b[d++],f=0;if(128&e){let a=127&e;if(!a)throw new c("tlv.decode(long): indefinite length not supported");if(a>4)throw new c("tlv.decode(long): byte length is too big");let g=b.subarray(d,d+a);if(g.length!==a)throw new c("tlv.decode: length bytes not complete");if(0===g[0])throw new c("tlv.decode(long): zero leftmost byte");for(let a of g)f=f<<8|a;if(d+=a,f<128)throw new c("tlv.decode(long): not minimal encoding")}else f=e;let g=b.subarray(d,d+f);if(g.length!==f)throw new c("tlv.decode: wrong value length");return{v:g,l:b.subarray(d+f)}}},_int:{encode(a){let{Err:b}=dW;if(a<dX)throw new b("integer: negative integers are not allowed");let c=cW(a);if(8&Number.parseInt(c[0],16)&&(c="00"+c),1&c.length)throw new b("unexpected DER parsing assertion: unpadded hex");return c},decode(a){let{Err:b}=dW;if(128&a[0])throw new b("invalid signature integer: negative");if(0===a[0]&&!(128&a[1]))throw new b("invalid signature integer: unnecessary leading zero");return cX(a_(a))}},toSig(a){let{Err:b,_int:c,_tlv:d}=dW,e=c_("signature",a),{v:f,l:g}=d.decode(48,e);if(g.length)throw new b("invalid signature: left bytes after parsing");let{v:h,l:i}=d.decode(2,f),{v:j,l:k}=d.decode(2,i);if(k.length)throw new b("invalid signature: left bytes after parsing");return{r:c.decode(h),s:c.decode(j)}},hexFromSig(a){let{_tlv:b,_int:c}=dW,d=b.encode(2,c.encode(a.r)),e=b.encode(2,c.encode(a.s));return b.encode(48,d+e)}},dX=BigInt(0),dY=BigInt(1),dZ=BigInt(2),d$=BigInt(3),d_=BigInt(4);function d0(a,b){let c,{BYTES:d}=a;if("bigint"==typeof b)c=b;else{let e=c_("private key",b);try{c=a.fromBytes(e)}catch{throw Error(`invalid private key: expected ui8a of size ${d}, got ${typeof b}`)}}if(!a.isValidNot0(c))throw Error("invalid private key: out of range [1..N-1]");return c}function d1(a){return Uint8Array.of(a?2:3)}function d2(a,b){return{secretKey:b.BYTES,publicKey:1+a.BYTES,publicKeyUncompressed:1+2*a.BYTES,publicKeyHasPrefix:!0,signature:2*b.BYTES}}function d3(a,b){let c=b=>(function(a){let b,{CURVE:c,curveOpts:d,hash:e,ecdsaOpts:f}=function(a){let b,c,d,e,{CURVE:f,curveOpts:g}=(b={a:a.a,b:a.b,p:a.Fp.ORDER,n:a.n,h:a.h,Gx:a.Gx,Gy:a.Gy},c=a.Fp,d=a.allowedPrivateKeyLengths?Array.from(new Set(a.allowedPrivateKeyLengths.map(a=>Math.ceil(a/2)))):void 0,e={Fp:c,Fn:ds(b.n,{BITS:a.nBitLength,allowedLengths:d,modFromBytes:a.wrapPrivateKey}),allowInfinityPoint:a.allowInfinityPoint,endo:a.endo,isTorsionFree:a.isTorsionFree,clearCofactor:a.clearCofactor,fromBytes:a.fromBytes,toBytes:a.toBytes},{CURVE:b,curveOpts:e}),h={hmac:a.hmac,randomBytes:a.randomBytes,lowS:a.lowS,bits2int:a.bits2int,bits2int_modN:a.bits2int_modN};return{CURVE:f,curveOpts:g,hash:a.hash,ecdsaOpts:h}}(a),g=function(a,b,c={}){aO(b),c4(c,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let d=c.randomBytes||a7,e=c.hmac||((a,...c)=>cP(b,a,a4(...c))),{Fp:f,Fn:g}=a,{ORDER:h,BITS:i}=g,{keygen:j,getPublicKey:k,getSharedSecret:l,utils:m,lengths:o}=function(a,b={}){let{Fn:c}=a,d=b.randomBytes||a7,e=Object.assign(d2(a.Fp,c),{seed:du(c.ORDER)});function f(a){try{return!!d0(c,a)}catch{return!1}}function g(a=d(e.seed)){return function(a,b,c=!1){let d=a.length,e=dt(b),f=du(b);if(d<16||d<f||d>1024)throw Error("expected "+f+"-1024 bytes of input, got "+d);let g=dg(c?cY(a):cX(a_(a)),b-c7)+c7;return c?c$(g,e):cZ(g,e)}(cV(a,e.seed,"seed"),c.ORDER)}function h(b,d=!0){return a.BASE.multiply(d0(c,b)).toBytes(d)}function i(b){if("bigint"==typeof b)return!1;if(b instanceof a)return!0;let{secretKey:d,publicKey:f,publicKeyUncompressed:g}=e;if(c.allowedLengths||d===f)return;let h=c_("key",b).length;return h===f||h===g}return Object.freeze({getPublicKey:h,getSharedSecret:function(b,d,e=!0){if(!0===i(b))throw Error("first arg must be private key");if(!1===i(d))throw Error("second arg must be public key");let f=d0(c,b);return a.fromHex(d).multiply(f).toBytes(e)},keygen:function(a){let b=g(a);return{secretKey:b,publicKey:h(b)}},Point:a,utils:{isValidSecretKey:f,isValidPublicKey:function(b,c){let{publicKey:d,publicKeyUncompressed:f}=e;try{let e=b.length;return(!0!==c||e===d)&&(!1!==c||e===f)&&!!a.fromBytes(b)}catch{return!1}},randomSecretKey:g,isValidPrivateKey:f,randomPrivateKey:g,normPrivateKeyToScalar:a=>d0(c,a),precompute:(b=8,c=a.BASE)=>c.precompute(b,!1)},lengths:e})}(a,c),p={prehash:!1,lowS:"boolean"==typeof c.lowS&&c.lowS,format:void 0,extraEntropy:!1},q="compact";function r(a,b){if(!g.isValidNot0(b))throw Error(`invalid signature ${a}: out of range 1..Point.Fn.ORDER`);return b}class s{constructor(a,b,c){this.r=r("r",a),this.s=r("s",b),null!=c&&(this.recovery=c),Object.freeze(this)}static fromBytes(a,b=q){var c,d;let e,f;if(c=a,dU(d=b),f=o.signature,cV(c,"compact"===d?f:"recovered"===d?f+1:void 0,`${d} signature`),"der"===b){let{r:b,s:c}=dW.toSig(cV(a));return new s(b,c)}"recovered"===b&&(e=a[0],b="compact",a=a.subarray(1));let h=g.BYTES,i=a.subarray(0,h),j=a.subarray(h,2*h);return new s(g.fromBytes(i),g.fromBytes(j),e)}static fromHex(a,b){return this.fromBytes(a1(a),b)}addRecoveryBit(a){return new s(this.r,this.s,a)}recoverPublicKey(b){let c=f.ORDER,{r:d,s:e,recovery:i}=this;if(null==i||![0,1,2,3].includes(i))throw Error("recovery id invalid");if(h*dZ<c&&i>1)throw Error("recovery id is ambiguous for h>1 curve");let j=2===i||3===i?d+h:d;if(!f.isValid(j))throw Error("recovery id 2 or 3 invalid");let k=f.toBytes(j),l=a.fromBytes(a4(d1((1&i)==0),k)),m=g.inv(j),o=u(c_("msgHash",b)),p=g.create(-o*m),q=g.create(e*m),r=a.BASE.multiplyUnsafe(p).add(l.multiplyUnsafe(q));if(r.is0())throw Error("point at infinify");return r.assertValidity(),r}hasHighS(){return this.s>h>>dY}toBytes(a=q){if(dU(a),"der"===a)return a1(dW.hexFromSig(this));let b=g.toBytes(this.r),c=g.toBytes(this.s);if("recovered"===a){if(null==this.recovery)throw Error("recovery bit must be present");return a4(Uint8Array.of(this.recovery),b,c)}return a4(b,c)}toHex(a){return a_(this.toBytes(a))}assertValidity(){}static fromCompact(a){return s.fromBytes(c_("sig",a),"compact")}static fromDER(a){return s.fromBytes(c_("sig",a),"der")}normalizeS(){return this.hasHighS()?new s(this.r,g.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return a_(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return a_(this.toBytes("compact"))}}let t=c.bits2int||function(a){if(a.length>8192)throw Error("input is too large");let b=cX(a_(a)),c=8*a.length-i;return c>0?b>>BigInt(c):b},u=c.bits2int_modN||function(a){return g.create(t(a))},v=c3(i);function w(a){return c1("num < 2^"+i,a,dX,v),g.toBytes(a)}function x(a,c){return cV(a,void 0,"message"),c?cV(b(a),void 0,"prehashed message"):a}return Object.freeze({keygen:j,getPublicKey:k,getSharedSecret:l,utils:m,lengths:o,Point:a,sign:function(c,f,i={}){let{seed:j,k2sig:k}=function(b,c,e){if(["recovered","canonical"].some(a=>a in e))throw Error("sign() legacy options not supported");let{lowS:f,prehash:i,extraEntropy:j}=dV(e,p),k=u(b=x(b,i)),l=d0(g,c),m=[w(l),w(k)];if(null!=j&&!1!==j){let a=!0===j?d(o.secretKey):j;m.push(c_("extraEntropy",a))}return{seed:a4(...m),k2sig:function(b){let c=t(b);if(!g.isValidNot0(c))return;let d=g.inv(c),e=a.BASE.multiply(c).toAffine(),i=g.create(e.x);if(i===dX)return;let j=g.create(d*g.create(k+i*l));if(j===dX)return;let m=2*(e.x!==i)|Number(e.y&dY),o=j;return f&&j>h>>dY&&(o=g.neg(j),m^=1),new s(i,o,m)}}}(c=c_("message",c),f,i);return(function(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=a=>new Uint8Array(a),e=d(a),f=d(a),g=0,h=()=>{e.fill(1),f.fill(0),g=0},i=(...a)=>c(f,e,...a),j=(a=d(0))=>{f=i(Uint8Array.of(0),a),e=i(),0!==a.length&&(f=i(Uint8Array.of(1),a),e=i())},k=()=>{if(g++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(e=i()).slice();c.push(b),a+=e.length}return a4(...c)};return(a,b)=>{let c;for(h(),j(a);!(c=b(k()));)j();return h(),c}})(b.outputLen,g.BYTES,e)(j,k)},verify:function(b,c,d,e={}){let{lowS:f,prehash:h,format:i}=dV(e,p);if(d=c_("publicKey",d),c=x(c_("message",c),h),"strict"in e)throw Error("options.strict was renamed to lowS");let j=void 0===i?function(a){let b,c="string"==typeof a||aL(a),d=!c&&null!==a&&"object"==typeof a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!c&&!d)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(d)b=new s(a.r,a.s);else if(c){try{b=s.fromBytes(c_("sig",a),"der")}catch(a){if(!(a instanceof dW.Err))throw a}if(!b)try{b=s.fromBytes(c_("sig",a),"compact")}catch{return!1}}return b||!1}(b):s.fromBytes(c_("sig",b),i);if(!1===j)return!1;try{let b=a.fromBytes(d);if(f&&j.hasHighS())return!1;let{r:e,s:h}=j,i=u(c),k=g.inv(h),l=g.create(i*k),m=g.create(e*k),o=a.BASE.multiplyUnsafe(l).add(b.multiplyUnsafe(m));return!o.is0()&&g.create(o.x)===e}catch{return!1}},recoverPublicKey:function(a,b,c={}){let{prehash:d}=dV(c,p);return b=x(b,d),s.fromBytes(a,"recovered").recoverPublicKey(b).toBytes()},Signature:s,hash:b})}(function(a,b={}){let c=function(a,b,c={},d){if(void 0===d&&(d="edwards"===a),!b||"object"!=typeof b)throw Error(`expected valid ${a} CURVE object`);for(let a of["p","n","h"]){let c=b[a];if(!("bigint"==typeof c&&c>dv))throw Error(`CURVE.${a} must be positive bigint`)}let e=dH(b.p,c.Fp,d),f=dH(b.n,c.Fn,d);for(let c of["Gx","Gy","a","weierstrass"===a?"b":"d"])if(!e.isValid(b[c]))throw Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return{CURVE:b=Object.freeze(Object.assign({},b)),Fp:e,Fn:f}}("weierstrass",a,b),{Fp:d,Fn:e}=c,f=c.CURVE,{h:g,n:h}=f;c4(b,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:i}=b;if(i&&(!d.is0(f.a)||"bigint"!=typeof i.beta||!Array.isArray(i.basises)))throw Error('invalid endo: expected "beta": bigint and "basises": array');let j=d2(d,e);function k(){if(!d.isOdd)throw Error("compression is not supported: Field does not have .isOdd()")}let l=b.toBytes||function(a,b,c){let{x:e,y:f}=b.toAffine(),g=d.toBytes(e);return(cU(c,"isCompressed"),c)?(k(),a4(d1(!d.isOdd(f)),g)):a4(Uint8Array.of(4),g,d.toBytes(f))},m=b.fromBytes||function(a){cV(a,void 0,"Point");let{publicKey:b,publicKeyUncompressed:c}=j,e=a.length,f=a[0],g=a.subarray(1);if(e===b&&(2===f||3===f)){let a,b=d.fromBytes(g);if(!d.isValid(b))throw Error("bad point: is not on curve, wrong x");let c=o(b);try{a=d.sqrt(c)}catch(a){throw Error("bad point: is not on curve, sqrt error"+(a instanceof Error?": "+a.message:""))}return k(),(1&f)==1!==d.isOdd(a)&&(a=d.neg(a)),{x:b,y:a}}if(e===c&&4===f){let a=d.BYTES,b=d.fromBytes(g.subarray(0,a)),c=d.fromBytes(g.subarray(a,2*a));if(!p(b,c))throw Error("bad point: is not on curve");return{x:b,y:c}}throw Error(`bad point: got length ${e}, expected compressed=${b} or uncompressed=${c}`)};function o(a){let b=d.sqr(a),c=d.mul(b,a);return d.add(d.add(c,d.mul(a,f.a)),f.b)}function p(a,b){let c=d.sqr(b),e=o(a);return d.eql(c,e)}if(!p(f.Gx,f.Gy))throw Error("bad curve params: generator point");let q=d.mul(d.pow(f.a,d$),d_),r=d.mul(d.sqr(f.b),BigInt(27));if(d.is0(d.add(q,r)))throw Error("bad curve params: a or b");function s(a,b,c=!1){if(!d.isValid(b)||c&&d.is0(b))throw Error(`bad point coordinate ${a}`);return b}function t(a){if(!(a instanceof y))throw Error("ProjectivePoint expected")}function u(a){if(!i||!i.basises)throw Error("no endo");return function(a,b,c){let[[d,e],[f,g]]=b,h=dT(g*a,c),i=dT(-e*a,c),j=a-h*d-i*f,k=-h*e-i*g,l=j<dX,m=k<dX;l&&(j=-j),m&&(k=-k);let o=c3(Math.ceil(c2(c)/2))+dY;if(j<dX||j>=o||k<dX||k>=o)throw Error("splitScalar (endomorphism): failed, k="+a);return{k1neg:l,k1:j,k2neg:m,k2:k}}(a,i.basises,e.ORDER)}let v=c5((a,b)=>{let{X:c,Y:e,Z:f}=a;if(d.eql(f,d.ONE))return{x:c,y:e};let g=a.is0();null==b&&(b=g?d.ONE:d.inv(f));let h=d.mul(c,b),i=d.mul(e,b),j=d.mul(f,b);if(g)return{x:d.ZERO,y:d.ZERO};if(!d.eql(j,d.ONE))throw Error("invZ was invalid");return{x:h,y:i}}),w=c5(a=>{if(a.is0()){if(b.allowInfinityPoint&&!d.is0(a.Y))return;throw Error("bad point: ZERO")}let{x:c,y:e}=a.toAffine();if(!d.isValid(c)||!d.isValid(e))throw Error("bad point: x or y not field elements");if(!p(c,e))throw Error("bad point: equation left != right");if(!a.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});function x(a,b,c,e,f){return c=new y(d.mul(c.X,a),c.Y,c.Z),b=dx(e,b),c=dx(f,c),b.add(c)}class y{constructor(a,b,c){this.X=s("x",a),this.Y=s("y",b,!0),this.Z=s("z",c),Object.freeze(this)}static CURVE(){return f}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!d.isValid(b)||!d.isValid(c))throw Error("invalid affine point");if(a instanceof y)throw Error("projective point not allowed");return d.is0(b)&&d.is0(c)?y.ZERO:new y(b,c,d.ONE)}static fromBytes(a){let b=y.fromAffine(m(cV(a,void 0,"point")));return b.assertValidity(),b}static fromHex(a){return y.fromBytes(c_("pointHex",a))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(a=8,b=!0){return A.createCache(this,a),b||this.multiply(d$),this}assertValidity(){w(this)}hasEvenY(){let{y:a}=this.toAffine();if(!d.isOdd)throw Error("Field doesn't support isOdd");return!d.isOdd(a)}equals(a){t(a);let{X:b,Y:c,Z:e}=this,{X:f,Y:g,Z:h}=a,i=d.eql(d.mul(b,h),d.mul(f,e)),j=d.eql(d.mul(c,h),d.mul(g,e));return i&&j}negate(){return new y(this.X,d.neg(this.Y),this.Z)}double(){let{a:a,b}=f,c=d.mul(b,d$),{X:e,Y:g,Z:h}=this,i=d.ZERO,j=d.ZERO,k=d.ZERO,l=d.mul(e,e),m=d.mul(g,g),o=d.mul(h,h),p=d.mul(e,g);return p=d.add(p,p),k=d.mul(e,h),k=d.add(k,k),i=d.mul(a,k),j=d.mul(c,o),j=d.add(i,j),i=d.sub(m,j),j=d.add(m,j),j=d.mul(i,j),i=d.mul(p,i),k=d.mul(c,k),o=d.mul(a,o),p=d.sub(l,o),p=d.mul(a,p),p=d.add(p,k),k=d.add(l,l),l=d.add(k,l),l=d.add(l,o),l=d.mul(l,p),j=d.add(j,l),o=d.mul(g,h),o=d.add(o,o),l=d.mul(o,p),i=d.sub(i,l),k=d.mul(o,m),k=d.add(k,k),new y(i,j,k=d.add(k,k))}add(a){t(a);let{X:b,Y:c,Z:e}=this,{X:g,Y:h,Z:i}=a,j=d.ZERO,k=d.ZERO,l=d.ZERO,m=f.a,o=d.mul(f.b,d$),p=d.mul(b,g),q=d.mul(c,h),r=d.mul(e,i),s=d.add(b,c),u=d.add(g,h);s=d.mul(s,u),u=d.add(p,q),s=d.sub(s,u),u=d.add(b,e);let v=d.add(g,i);return u=d.mul(u,v),v=d.add(p,r),u=d.sub(u,v),v=d.add(c,e),j=d.add(h,i),v=d.mul(v,j),j=d.add(q,r),v=d.sub(v,j),l=d.mul(m,u),j=d.mul(o,r),l=d.add(j,l),j=d.sub(q,l),l=d.add(q,l),k=d.mul(j,l),q=d.add(p,p),q=d.add(q,p),r=d.mul(m,r),u=d.mul(o,u),q=d.add(q,r),r=d.sub(p,r),r=d.mul(m,r),u=d.add(u,r),p=d.mul(q,u),k=d.add(k,p),p=d.mul(v,u),j=d.mul(s,j),j=d.sub(j,p),p=d.mul(s,q),l=d.mul(v,l),new y(j,k,l=d.add(l,p))}subtract(a){return this.add(a.negate())}is0(){return this.equals(y.ZERO)}multiply(a){let c,d,{endo:f}=b;if(!e.isValidNot0(a))throw Error("invalid scalar: out of range");let g=a=>A.cached(this,a,a=>dy(y,a));if(f){let{k1neg:b,k1:e,k2neg:h,k2:i}=u(a),{p:j,f:k}=g(e),{p:l,f:m}=g(i);d=k.add(m),c=x(f.beta,j,l,b,h)}else{let{p:b,f:e}=g(a);c=b,d=e}return dy(y,[c,d])[0]}multiplyUnsafe(a){let{endo:c}=b;if(!e.isValid(a))throw Error("invalid scalar: out of range");if(a===dX||this.is0())return y.ZERO;if(a===dY)return this;if(A.hasCache(this))return this.multiply(a);if(!c)return A.unsafe(this,a);{let{k1neg:b,k1:d,k2neg:e,k2:f}=u(a),{p1:g,p2:h}=function(a,b,c,d){let e=b,f=a.ZERO,g=a.ZERO;for(;c>dv||d>dv;)c&dw&&(f=f.add(e)),d&dw&&(g=g.add(e)),e=e.double(),c>>=dw,d>>=dw;return{p1:f,p2:g}}(y,this,d,f);return x(c.beta,g,h,b,e)}}multiplyAndAddUnsafe(a,b,c){let d=this.multiplyUnsafe(b).add(a.multiplyUnsafe(c));return d.is0()?void 0:d}toAffine(a){return v(this,a)}isTorsionFree(){let{isTorsionFree:a}=b;return g===dY||(a?a(y,this):A.unsafe(this,h).is0())}clearCofactor(){let{clearCofactor:a}=b;return g===dY?this:a?a(y,this):this.multiplyUnsafe(g)}isSmallOrder(){return this.multiplyUnsafe(g).is0()}toBytes(a=!0){return cU(a,"isCompressed"),this.assertValidity(),l(y,this,a)}toHex(a=!0){return a_(this.toBytes(a))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(a=!0){return this.toBytes(a)}_setWindowSize(a){this.precompute(a)}static normalizeZ(a){return dy(y,a)}static msm(a,b){return function(a,b,c,d){(function(a,b){if(!Array.isArray(a))throw Error("array expected");a.forEach((a,c)=>{if(!(a instanceof b))throw Error("invalid point at index "+c)})})(c,a),function(a,b){if(!Array.isArray(a))throw Error("array of scalars expected");a.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)})}(d,b);let e=c.length,f=d.length;if(e!==f)throw Error("arrays of points and scalars must have equal length");let g=a.ZERO,h=c2(BigInt(e)),i=1;h>12?i=h-3:h>4?i=h-2:h>0&&(i=2);let j=c3(i),k=Array(Number(j)+1).fill(g),l=Math.floor((b.BITS-1)/i)*i,m=g;for(let a=l;a>=0;a-=i){k.fill(g);for(let b=0;b<f;b++){let e=Number(d[b]>>BigInt(a)&j);k[e]=k[e].add(c[b])}let b=g;for(let a=k.length-1,c=g;a>0;a--)c=c.add(k[a]),b=b.add(c);if(m=m.add(b),0!==a)for(let a=0;a<i;a++)m=m.double()}return m}(y,e,a,b)}static fromPrivateKey(a){return y.BASE.multiply(d0(e,a))}}y.BASE=new y(f.Gx,f.Gy,d.ONE),y.ZERO=new y(d.ZERO,d.ONE,d.ZERO),y.Fp=d,y.Fn=e;let z=e.BITS,A=new dG(y,b.endo?Math.ceil(z/2):z);return y.BASE.precompute(8),y}(c,d),e,f);return b=g.Point,Object.assign({},g,{ProjectivePoint:b,CURVE:Object.assign({},a,dr(b.Fn.ORDER,b.Fn.BITS))})})({...a,hash:b});return{...c(b),create:c}}let d4={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},d5={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},d6={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},d7=ds(d4.p),d8=ds(d5.p),d9=ds(d6.p),ea=d3({...d4,Fp:d7,lowS:!1},bE);d3({...d5,Fp:d8,lowS:!1},bG),d3({...d6,Fp:d9,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},bF);let eb="base10",ec="base16",ed="base64pad",ee="base64url",ef="utf8";function eg(){let a=dS.utils.randomPrivateKey(),b=dS.getPublicKey(a);return{privateKey:(0,u.toString)(a,ec),publicKey:(0,u.toString)(b,ec)}}function eh(){let a=a7(32);return(0,u.toString)(a,ec)}function ei(a,b){var c,d;let e=dS.getSharedSecret((0,v.fromString)(a,ec),(0,v.fromString)(b,ec)),f=(c=void 0,function(a,b,c,d=32){aO(a),aM(d);let e=a.outputLen;if(d>255*e)throw Error("Length should be <= 255*HashLen");let f=Math.ceil(d/e);void 0===c&&(c=cR);let g=new Uint8Array(f*e),h=cP.create(a,b),i=h._cloneInto(),j=new Uint8Array(h.outputLen);for(let a=0;a<f;a++)cQ[0]=a+1,i.update(0===a?cR:j).update(c).update(cQ).digestInto(j),g.set(j,e*a),h._cloneInto(i);return h.destroy(),i.destroy(),aS(j,cQ),g.slice(0,d)}(bE,(d=void 0,aO(bE),void 0===d&&(d=new Uint8Array(bE.outputLen)),cP(bE,a3(d),a3(e))),c,32));return(0,u.toString)(f,ec)}function ej(a){let b=bE((0,v.fromString)(a,ec));return(0,u.toString)(b,ec)}function ek(a){let b=bE((0,v.fromString)(a,ef));return(0,u.toString)(b,ec)}function el(a){return(0,v.fromString)(`${a}`,eb)}function em(a){return Number((0,u.toString)(a,eb))}function en(a){return a.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function eo(a){let b=a.replace(/-/g,"+").replace(/_/g,"/"),c=(4-b.length%4)%4;return b+"=".repeat(c)}function ep(a){let b=el("u">typeof a.type?a.type:0);if(1===em(b)&&typeof a.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");let c="u">typeof a.senderPublicKey?(0,v.fromString)(a.senderPublicKey,ec):void 0,d="u">typeof a.iv?(0,v.fromString)(a.iv,ec):a7(12),e=et({type:b,sealed:cN((0,v.fromString)(a.symKey,ec),d).encrypt((0,v.fromString)(a.message,ef)),iv:d,senderPublicKey:c});return a.encoding===ee?en(e):e}function eq(a){let b=(0,v.fromString)(a.symKey,ec),{sealed:c,iv:d}=eu({encoded:a.encoded,encoding:a.encoding}),e=cN(b,d).decrypt(c);if(null===e)throw Error("Failed to decrypt");return(0,u.toString)(e,ef)}function er(a,b){let c=el(2),d=a7(12),e=et({type:c,sealed:(0,v.fromString)(a,ef),iv:d});return b===ee?en(e):e}function es(a,b){let{sealed:c}=eu({encoded:a,encoding:b});return(0,u.toString)(c,ef)}function et(a){if(2===em(a.type))return(0,u.toString)((0,w.concat)([a.type,a.sealed]),ed);if(1===em(a.type)){if(typeof a.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");return(0,u.toString)((0,w.concat)([a.type,a.senderPublicKey,a.iv,a.sealed]),ed)}return(0,u.toString)((0,w.concat)([a.type,a.iv,a.sealed]),ed)}function eu(a){let b=(a.encoding||ed)===ee?eo(a.encoded):a.encoded,c=(0,v.fromString)(b,ed),d=c.slice(0,1);if(1===em(d)){let a=c.slice(1,33),b=c.slice(33,45);return{type:d,sealed:c.slice(45),iv:b,senderPublicKey:a}}if(2===em(d))return{type:d,sealed:c.slice(1),iv:a7(12)};let e=c.slice(1,13);return{type:d,sealed:c.slice(13),iv:e}}function ev(a,b){let c=eu({encoded:a,encoding:b?.encoding});return ew({type:em(c.type),senderPublicKey:"u">typeof c.senderPublicKey?(0,u.toString)(c.senderPublicKey,ec):void 0,receiverPublicKey:b?.receiverPublicKey})}function ew(a){let b=a?.type||0;if(1===b){if(typeof a?.senderPublicKey>"u")throw Error("missing sender public key");if(typeof a?.receiverPublicKey>"u")throw Error("missing receiver public key")}return{type:b,senderPublicKey:a?.senderPublicKey,receiverPublicKey:a?.receiverPublicKey}}function ex(a){return 1===a.type&&"string"==typeof a.senderPublicKey&&"string"==typeof a.receiverPublicKey}function ey(a){return 2===a.type}function ez(a,b){let c,d,[e,f,g]=a.split("."),h=Buffer.from(eo(g),"base64");if(64!==h.length)throw Error("Invalid signature length");let i=h.slice(0,32),j=h.slice(32,64),k=bE(`${e}.${f}`),l=(c=Buffer.from(b.x,"base64"),d=Buffer.from(b.y,"base64"),(0,w.concat)([new Uint8Array([4]),c,d]));if(!ea.verify((0,w.concat)([i,j]),k,l))throw Error("Invalid signature");return(0,t.decodeJWT)(a).payload}function eA(a){return a?.relay||{protocol:"irn"}}function eB(a){let b=x.RELAY_JSONRPC[a];if(typeof b>"u")throw Error(`Relay Protocol not supported: ${a}`);return b}var eC=Object.defineProperty,eD=Object.defineProperties,eE=Object.getOwnPropertyDescriptors,eF=Object.getOwnPropertySymbols,eG=Object.prototype.hasOwnProperty,eH=Object.prototype.propertyIsEnumerable,eI=(a,b,c)=>b in a?eC(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,eJ=(a,b)=>{for(var c in b||(b={}))eG.call(b,c)&&eI(a,c,b[c]);if(eF)for(var c of eF(b))eH.call(b,c)&&eI(a,c,b[c]);return a};function eK(a){var b;if(!a.includes("wc:")){let b=aq(a);null!=b&&b.includes("wc:")&&(a=b)}let c=(a=(a=a.includes("wc://")?a.replace("wc://",""):a).includes("wc:")?a.replace("wc:",""):a).indexOf(":"),d=-1!==a.indexOf("?")?a.indexOf("?"):void 0,e=a.substring(0,c),f=a.substring(c+1,d).split("@"),g=Object.fromEntries(new URLSearchParams("u">typeof d?a.substring(d):"").entries()),h="string"==typeof g.methods?g.methods.split(","):void 0;return{protocol:e,topic:(b=f[0]).startsWith("//")?b.substring(2):b,version:parseInt(f[1],10),symKey:g.symKey,relay:function(a,b="-"){let c={},d="relay"+b;return Object.keys(a).forEach(b=>{if(b.startsWith(d)){let e=b.replace(d,""),f=a[b];c[e]=f}}),c}(g),methods:h,expiryTimestamp:g.expiryTimestamp?parseInt(g.expiryTimestamp,10):void 0}}function eL(a){let b=new URLSearchParams;return Object.entries(eJ(eJ(eD(eJ({},function(a,b="-"){let c={};return Object.keys(a).forEach(d=>{a[d]&&(c["relay"+b+d]=a[d])}),c}(a.relay)),eE({symKey:a.symKey})),a.expiryTimestamp&&{expiryTimestamp:a.expiryTimestamp.toString()}),a.methods&&{methods:a.methods.join(",")})).sort(([a],[b])=>a.localeCompare(b)).forEach(([a,c])=>{void 0!==c&&b.append(a,String(c))}),`${a.protocol}:${a.topic}@${a.version}?${b}`}function eM(a,b,c){return`${a}?wc_ev=${c}&topic=${b}`}var eN=Object.defineProperty,eO=Object.defineProperties,eP=Object.getOwnPropertyDescriptors,eQ=Object.getOwnPropertySymbols,eR=Object.prototype.hasOwnProperty,eS=Object.prototype.propertyIsEnumerable,eT=(a,b,c)=>b in a?eN(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,eU=(a,b)=>{for(var c in b||(b={}))eR.call(b,c)&&eT(a,c,b[c]);if(eQ)for(var c of eQ(b))eS.call(b,c)&&eT(a,c,b[c]);return a},eV=(a,b)=>eO(a,eP(b));function eW(a){let b=[];return a.forEach(a=>{let[c,d]=a.split(":");b.push(`${c}:${d}`)}),b}function eX(a){let b=[];return Object.values(a).forEach(a=>{b.push(...eW(a.accounts))}),[...new Set(b)]}function eY(a){let b=[];return Object.values(a).forEach(a=>{b.push(...a.methods)}),[...new Set(b)]}function eZ(a){let b=[];return Object.values(a).forEach(a=>{b.push(...a.events)}),[...new Set(b)]}function e$(a){return a.includes(":")}function e_(a){return e$(a)?a.split(":")[0]:a}function e0(a){var b,c,d;let e={};if(!e8(a))return e;for(let[f,g]of Object.entries(a)){let a=e$(f)?[f]:g.chains,h=g.methods||[],i=g.events||[],j=e_(f);e[j]=eV(eU({},e[j]),{chains:ak(a,null==(b=e[j])?void 0:b.chains),methods:ak(h,null==(c=e[j])?void 0:c.methods),events:ak(i,null==(d=e[j])?void 0:d.events)})}return e}function e1(a,b){var c;let d,e=(c=b=b.map(a=>a.replace("did:pkh:","")),d={},c?.forEach(a=>{var b;let[c,e]=a.split(":");d[c]||(d[c]={accounts:[],chains:[],events:[],methods:[]}),d[c].accounts.push(a),null==(b=d[c].chains)||b.push(`${c}:${e}`)}),d);for(let[b,c]of Object.entries(e))c.methods?c.methods=ak(c.methods,a):c.methods=a,c.events=["chainChanged","accountsChanged"];return e}function e2(a,b){var c,d,e,f,g,h;let i=e0(a),j=e0(b),k={};for(let a of Object.keys(i).concat(Object.keys(j)))k[a]={chains:ak(null==(c=i[a])?void 0:c.chains,null==(d=j[a])?void 0:d.chains),methods:ak(null==(e=i[a])?void 0:e.methods,null==(f=j[a])?void 0:f.methods),events:ak(null==(g=i[a])?void 0:g.events,null==(h=j[a])?void 0:h.events)};return k}let e3={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},e4={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function e5(a,b){let{message:c,code:d}=e4[a];return{message:b?`${c} ${b}`:c,code:d}}function e6(a,b){let{message:c,code:d}=e3[a];return{message:b?`${c} ${b}`:c,code:d}}function e7(a,b){return!!Array.isArray(a)&&(!("u">typeof b)||!a.length||a.every(b))}function e8(a){return Object.getPrototypeOf(a)===Object.prototype&&Object.keys(a).length}function e9(a){return typeof a>"u"}function fa(a,b){return!!(b&&e9(a))||"string"==typeof a&&!!a.trim().length}function fb(a,b){return!!(b&&e9(a))||"number"==typeof a&&!isNaN(a)}function fc(a,b){let{requiredNamespaces:c}=b,d=Object.keys(a.namespaces),e=Object.keys(c),f=!0;return!!$(e,d)&&(d.forEach(b=>{let{accounts:d,methods:e,events:g}=a.namespaces[b],h=eW(d),i=c[b];$(C(b,i),h)&&$(i.methods,e)&&$(i.events,g)||(f=!1)}),f)}function fd(a){return!!(fa(a,!1)&&a.includes(":"))&&2===a.split(":").length}function fe(a){function b(a){try{return"u">typeof new URL(a)}catch{return!1}}try{if(fa(a,!1)){if(b(a))return!0;let c=aq(a);return b(c)}}catch{}return!1}function ff(a){var b;return null==(b=a?.proposer)?void 0:b.publicKey}function fg(a){return a?.topic}function fh(a,b){let c=null;return fa(a?.publicKey,!1)||(c=e5("MISSING_OR_INVALID",`${b} controller public key should be a string`)),c}function fi(a){let b=!0;return e7(a)?a.length&&(b=a.every(a=>fa(a,!1))):b=!1,b}function fj(a,b){let c=null;return Object.values(a).forEach(a=>{var d;let e;if(c)return;let f=(d=`${b}, namespace`,e=null,fi(a?.methods)?fi(a?.events)||(e=e6("UNSUPPORTED_EVENTS",`${d}, events should be an array of strings or empty array for no events`)):e=e6("UNSUPPORTED_METHODS",`${d}, methods should be an array of strings or empty array for no methods`),e);f&&(c=f)}),c}function fk(a,b,c){let d=null;if(a&&e8(a)){let e,f=fj(a,b);f&&(d=f);let g=(e=null,Object.entries(a).forEach(([a,d])=>{var f,g;let h;if(e)return;let i=(f=C(a,d),g=`${b} ${c}`,h=null,e7(f)&&f.length?f.forEach(a=>{h||fd(a)||(h=e6("UNSUPPORTED_CHAINS",`${g}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):fd(a)||(h=e6("UNSUPPORTED_CHAINS",`${g}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),h);i&&(e=i)}),e);g&&(d=g)}else d=e5("MISSING_OR_INVALID",`${b}, ${c} should be an object with data`);return d}function fl(a,b){let c=null;if(a&&e8(a)){let d,e=fj(a,b);e&&(c=e);let f=(d=null,Object.values(a).forEach(a=>{var c,e;let f;if(d)return;let g=(c=a?.accounts,e=`${b} namespace`,f=null,e7(c)?c.forEach(a=>{f||function(a){if(fa(a,!1)&&a.includes(":")){let b=a.split(":");if(3===b.length){let a=b[0]+":"+b[1];return!!b[2]&&fd(a)}}return!1}(a)||(f=e6("UNSUPPORTED_ACCOUNTS",`${e}, account ${a} should be a string and conform to "namespace:chainId:address" format`))}):f=e6("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),f);g&&(d=g)}),d);f&&(c=f)}else c=e5("MISSING_OR_INVALID",`${b}, namespaces should be an object with data`);return c}function fm(a){return fa(a.protocol,!0)}function fn(a,b){let c=!1;return b&&!a?c=!0:a&&e7(a)&&a.length&&a.forEach(a=>{c=fm(a)}),c}function fo(a){return"number"==typeof a}function fp(a){return"u">typeof a}function fq(a){return!(!a||"object"!=typeof a||!a.code||!fb(a.code,!1)||!a.message||!fa(a.message,!1))}function fr(a){return!(e9(a)||!fa(a.method,!1))}function fs(a){return!(e9(a)||e9(a.result)&&e9(a.error)||!fb(a.id,!1)||!fa(a.jsonrpc,!1))}function ft(a){return!(e9(a)||!fa(a.name,!1))}function fu(a,b){return!(!fd(b)||!eX(a).includes(b))}function fv(a,b,c){let d;return!!fa(c,!1)&&(d=[],Object.values(a).forEach(a=>{eW(a.accounts).includes(b)&&d.push(...a.methods)}),d).includes(c)}function fw(a,b,c){let d;return!!fa(c,!1)&&(d=[],Object.values(a).forEach(a=>{eW(a.accounts).includes(b)&&d.push(...a.events)}),d).includes(c)}function fx(a,b,c){var d,e;let f,g,h=null,i=(f={},Object.keys(d=a).forEach(a=>{var b;a.includes(":")?f[a]=d[a]:null==(b=d[a].chains)||b.forEach(b=>{f[b]={methods:d[a].methods,events:d[a].events}})}),f),j=(g={},Object.keys(e=b).forEach(a=>{if(a.includes(":"))g[a]=e[a];else{let b=eW(e[a].accounts);b?.forEach(b=>{g[b]={accounts:e[a].accounts.filter(a=>a.includes(`${b}:`)),methods:e[a].methods,events:e[a].events}})}}),g),k=Object.keys(i),l=Object.keys(j),m=fy(Object.keys(a)),o=fy(Object.keys(b)),p=m.filter(a=>!o.includes(a));return p.length&&(h=e5("NON_CONFORMING_NAMESPACES",`${c} namespaces keys don't satisfy requiredNamespaces.
      Required: ${p.toString()}
      Received: ${Object.keys(b).toString()}`)),$(k,l)||(h=e5("NON_CONFORMING_NAMESPACES",`${c} namespaces chains don't satisfy required namespaces.
      Required: ${k.toString()}
      Approved: ${l.toString()}`)),Object.keys(b).forEach(a=>{if(!a.includes(":")||h)return;let d=eW(b[a].accounts);d.includes(a)||(h=e5("NON_CONFORMING_NAMESPACES",`${c} namespaces accounts don't satisfy namespace accounts for ${a}
        Required: ${a}
        Approved: ${d.toString()}`))}),k.forEach(a=>{h||($(i[a].methods,j[a].methods)?$(i[a].events,j[a].events)||(h=e5("NON_CONFORMING_NAMESPACES",`${c} namespaces events don't satisfy namespace events for ${a}`)):h=e5("NON_CONFORMING_NAMESPACES",`${c} namespaces methods don't satisfy namespace methods for ${a}`))}),h}function fy(a){return[...new Set(a.map(a=>a.includes(":")?a.split(":")[0]:a))]}function fz(a,b){return fb(a,!1)&&a<=b.max&&a>=b.min}function fA(){let a=U();return new Promise(b=>{switch(a){case O:b(T()&&navigator?.onLine);break;case M:b(fB());break;default:b(!0)}})}async function fB(){if(Q()&&null!=a.g&&a.g.NetInfo){let b=await (null==a.g?void 0:a.g.NetInfo.fetch());return b?.isConnected}return!0}function fC(b){var c,d;switch(U()){case O:c=b,!Q()&&T()&&(window.addEventListener("online",()=>c(!0)),window.addEventListener("offline",()=>c(!1)));break;case M:d=b,Q()&&null!=a.g&&a.g.NetInfo&&a.g?.NetInfo.addEventListener(a=>d(a?.isConnected))}}function fD(){var a;return!(T()&&(0,k.getDocument)())||(null==(a=(0,k.getDocument)())?void 0:a.visibilityState)==="visible"}let fE={};class fF{static get(a){return fE[a]}static set(a,b){fE[a]=b}static delete(a){delete fE[a]}}function fG(a){return new Uint8Array(a.replace(/^0x/,"").match(/.{1,2}/g).map(a=>parseInt(a,16)))}function fH(a){let b,c,d=Uint8Array.from(Buffer.from(a.signature,"hex")),e=function({publicKey:a,signature:b,payload:c}){var d,e,f;let g,h=fG(c.method),i=128|parseInt((null==(d=c.version)?void 0:d.toString())||"4"),j=(e=c.address,42===(g=p.default.decode(e)[0])?0:60===g?2:1),k="00"===c.era?new Uint8Array([0]):fG(c.era);if(1!==k.length&&2!==k.length)throw Error("Invalid era length");let l=parseInt(c.nonce,16),m=new Uint8Array([255&l,l>>8&255]),o=new Uint8Array([0,...a,j,...b,...k,...m,...function(a){if(a<BigInt(1)<<BigInt(6))return new Uint8Array([Number(a<<BigInt(2))]);if(a<BigInt(1)<<BigInt(14)){let b=a<<BigInt(2)|BigInt(1);return new Uint8Array([Number(b&BigInt(255)),Number(b>>BigInt(8)&BigInt(255))])}if(a<BigInt(1)<<BigInt(30)){let b=a<<BigInt(2)|BigInt(2);return new Uint8Array([Number(b&BigInt(255)),Number(b>>BigInt(8)&BigInt(255)),Number(b>>BigInt(16)&BigInt(255)),Number(b>>BigInt(24)&BigInt(255))])}throw Error("BigInt compact encoding not supported > 2^30")}(BigInt(`0x${(f=c.tip).startsWith("0x")?f.slice(2):f}`)),...h]);return new Uint8Array([...function(a){if(a<64)return new Uint8Array([a<<2]);if(a<16384){let b=a<<2|1;return new Uint8Array([255&b,b>>8&255])}if(a<0x40000000){let b=a<<2|2;return new Uint8Array([255&b,b>>8&255,b>>16&255,b>>24&255])}throw Error("Compact encoding > 2^30 not supported")}(o.length+1),i,...o])}({publicKey:function(a){let b=p.default.decode(a);if(b.length<33)throw Error("Too short to contain a public key");return b.slice(1,33)}(a.transaction.address),signature:d,payload:a.transaction});return b=fG(Buffer.from(e).toString("hex")),c=(0,y.blake2b)(b,void 0,32),"0x"+Buffer.from(c).toString("hex")}function fI({logger:a,name:b}){let c="string"==typeof a?(0,z.generatePlatformLogger)({opts:{level:a,name:b}}).logger:a;return c.level="string"==typeof a?a:a.level,c}a.s(["BASE16",()=>ec,"BASE64",()=>ed,"BASE64URL",()=>ee,"LimitedSet",()=>as,"MemoryStore",()=>fF,"TYPE_1",()=>1,"TYPE_2",()=>2,"buildNamespacesFromAuth",()=>e1,"buildSignedExtrinsicHash",()=>fH,"calcExpiry",()=>ah,"createDelayedPromise",()=>ab,"createEncodedRecap",()=>cf,"createExpiringPromise",()=>ac,"createLogger",()=>fI,"decodeTypeByte",()=>em,"decodeTypeTwoEnvelope",()=>es,"decrypt",()=>eq,"deriveSymKey",()=>ei,"deserialize",()=>eu,"encodeTypeTwoEnvelope",()=>er,"encrypt",()=>ep,"engineEvent",()=>aj,"extractSolanaTransactionId",()=>bT,"formatIdTarget",()=>af,"formatMessage",()=>cb,"formatRelayRpcUrl",()=>Z,"formatTopicTarget",()=>ae,"formatUA",()=>Y,"formatUri",()=>eL,"generateKeyPair",()=>eg,"generateRandomBytes32",()=>eh,"getAccountsFromNamespaces",()=>B,"getAlgorandTransactionId",()=>bW,"getAppId",()=>V,"getAppMetadata",()=>X,"getChainsFromRecap",()=>ci,"getDeepLink",()=>am,"getDidAddress",()=>b9,"getInternalError",()=>e5,"getLinkModeURL",()=>eM,"getMethodsFromRecap",()=>ch,"getNamespacedDidChainId",()=>b8,"getNamespacesChains",()=>eX,"getNamespacesEvents",()=>eZ,"getNamespacesMethods",()=>eY,"getNearTransactionIdFromSignedTransaction",()=>bV,"getRecapFromResources",()=>cj,"getRelayProtocolApi",()=>eB,"getRelayProtocolName",()=>eA,"getSdkError",()=>e6,"getSearchParamFromURL",()=>an,"getSignDirectHash",()=>bY,"getSuiDigest",()=>bU,"getWalletSendCallsHashes",()=>bZ,"handleDeeplinkRedirect",()=>al,"hashKey",()=>ej,"hashMessage",()=>ek,"isAndroid",()=>R,"isAppVisible",()=>fD,"isBrowser",()=>T,"isCaipNamespace",()=>e$,"isConformingNamespaces",()=>fx,"isExpired",()=>ai,"isIos",()=>S,"isNode",()=>P,"isOnline",()=>fA,"isProposalStruct",()=>ff,"isReactNative",()=>Q,"isSessionCompatible",()=>fc,"isSessionStruct",()=>fg,"isTestRun",()=>ap,"isTypeOneEnvelope",()=>ex,"isTypeTwoEnvelope",()=>ey,"isUndefined",()=>e9,"isValidArray",()=>e7,"isValidController",()=>fh,"isValidErrorReason",()=>fq,"isValidEvent",()=>ft,"isValidId",()=>fo,"isValidNamespaces",()=>fl,"isValidNamespacesChainId",()=>fu,"isValidNamespacesEvent",()=>fw,"isValidNamespacesRequest",()=>fv,"isValidObject",()=>e8,"isValidParams",()=>fp,"isValidRelay",()=>fm,"isValidRelays",()=>fn,"isValidRequest",()=>fr,"isValidRequestExpiry",()=>fz,"isValidRequiredNamespaces",()=>fk,"isValidResponse",()=>fs,"isValidString",()=>fa,"isValidUrl",()=>fe,"mapToObj",()=>_,"mergeArrays",()=>ak,"mergeEncodedRecaps",()=>cg,"mergeRequiredAndOptionalNamespaces",()=>e2,"objToMap",()=>aa,"parseChainId",()=>A,"parseExpirerTarget",()=>ag,"parseNamespaceKey",()=>e_,"parseUri",()=>eK,"populateAppMetadata",()=>W,"sleep",()=>ar,"subscribeToNetworkChange",()=>fC,"uuidv4",()=>ao,"validateDecoding",()=>ev,"validateEncoding",()=>ew,"validateSignedCacao",()=>ca,"verifyP256Jwt",()=>ez])},241958,693172,157938,712307,a=>{"use strict";var b=a.i(427699),c=a.i(673620);class d{}a.s(["IEvents",()=>d],693172),a.s([],157938);class e extends d{constructor(a){super()}}let f=c.FIVE_SECONDS,g={pulse:"heartbeat_pulse"};class h extends e{constructor(a){super(a),this.events=new b.EventEmitter,this.interval=f,this.interval=a?.interval||f}static async init(a){let b=new h(a);return await b.init(),b}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),(0,c.toMiliseconds)(this.interval))}pulse(){this.events.emit(g.pulse)}}a.s(["HEARTBEAT_EVENTS",()=>g,"HeartBeat",()=>h],241958);let i=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,j=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,k=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function l(a,b){var c;return"__proto__"===a||"constructor"===a&&b&&"object"==typeof b&&"prototype"in b?void(c=a,console.warn(`[destr] Dropping "${c}" key to prevent prototype pollution.`)):b}function m(a,b={}){if("string"!=typeof a)return a;if('"'===a[0]&&'"'===a[a.length-1]&&-1===a.indexOf("\\"))return a.slice(1,-1);let c=a.trim();if(c.length<=9)switch(c.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return NaN;case"infinity":return 1/0;case"-infinity":return-1/0}if(!k.test(a)){if(b.strict)throw SyntaxError("[destr] Invalid JSON");return a}try{if(i.test(a)||j.test(a)){if(b.strict)throw Error("[destr] Possible prototype pollution");return JSON.parse(a,l)}return JSON.parse(a)}catch(c){if(b.strict)throw c;return a}}function o(a,...b){try{var c;return(c=a(...b))&&"function"==typeof c.then?c:Promise.resolve(c)}catch(a){return Promise.reject(a)}}function p(a){let b,c;if(b=typeof a,null===a||"object"!==b&&"function"!==b)return String(a);if(!(c=Object.getPrototypeOf(a))||c.isPrototypeOf(Object)||Array.isArray(a))return JSON.stringify(a);if("function"==typeof a.toJSON)return p(a.toJSON());throw Error("[unstorage] Cannot stringify value!")}let q="base64:";function r(a){return a&&a.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function s(a){return(a=r(a))?a+":":""}function t(a={}){let b,c={mounts:{"":a.driver||(b=new Map,{name:"memory",getInstance:()=>b,hasItem:a=>b.has(a),getItem:a=>b.get(a)??null,getItemRaw:a=>b.get(a)??null,setItem(a,c){b.set(a,c)},setItemRaw(a,c){b.set(a,c)},removeItem(a){b.delete(a)},getKeys:()=>[...b.keys()],clear(){b.clear()},dispose(){b.clear()}})},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},d=a=>{for(let b of c.mountpoints)if(a.startsWith(b))return{base:b,relativeKey:a.slice(b.length),driver:c.mounts[b]};return{base:"",relativeKey:a,driver:c.mounts[""]}},e=(a,b)=>c.mountpoints.filter(c=>c.startsWith(a)||b&&a.startsWith(c)).map(b=>({relativeBase:a.length>b.length?a.slice(b.length):void 0,mountpoint:b,driver:c.mounts[b]})),f=(a,b)=>{if(c.watching)for(let d of(b=r(b),c.watchListeners))d(a,b)},g=async()=>{if(!c.watching)for(let a in c.watching=!0,c.mounts)c.unwatch[a]=await u(c.mounts[a],f,a)},h=async()=>{if(c.watching){for(let a in c.unwatch)await c.unwatch[a]();c.unwatch={},c.watching=!1}},i=(a,b,c)=>{let e=new Map,f=a=>{let b=e.get(a.base);return b||(b={driver:a.driver,base:a.base,items:[]},e.set(a.base,b)),b};for(let c of a){let a="string"==typeof c,e=r(a?c:c.key),g=a?void 0:c.value,h=a||!c.options?b:{...b,...c.options},i=d(e);f(i).items.push({key:e,value:g,relativeKey:i.relativeKey,options:h})}return Promise.all([...e.values()].map(a=>c(a))).then(a=>a.flat())},j={hasItem(a,b={}){let{relativeKey:c,driver:e}=d(a=r(a));return o(e.hasItem,c,b)},getItem(a,b={}){let{relativeKey:c,driver:e}=d(a=r(a));return o(e.getItem,c,b).then(a=>m(a))},getItems:(a,b={})=>i(a,b,a=>a.driver.getItems?o(a.driver.getItems,a.items.map(a=>({key:a.relativeKey,options:a.options})),b).then(b=>b.map(b=>({key:function(...a){return r(a.join(":"))}(a.base,b.key),value:m(b.value)}))):Promise.all(a.items.map(b=>o(a.driver.getItem,b.relativeKey,b.options).then(a=>({key:b.key,value:m(a)}))))),getItemRaw(a,b={}){let{relativeKey:c,driver:e}=d(a=r(a));return e.getItemRaw?o(e.getItemRaw,c,b):o(e.getItem,c,b).then(a=>{var b;return"string"==typeof a&&a.startsWith(q)?(b=a.slice(q.length),globalThis.Buffer?Buffer.from(b,"base64"):Uint8Array.from(globalThis.atob(b),a=>a.codePointAt(0))):a})},async setItem(a,b,c={}){if(void 0===b)return j.removeItem(a);let{relativeKey:e,driver:g}=d(a=r(a));g.setItem&&(await o(g.setItem,e,p(b),c),g.watch||f("update",a))},async setItems(a,b){await i(a,b,async a=>{if(a.driver.setItems)return o(a.driver.setItems,a.items.map(a=>({key:a.relativeKey,value:p(a.value),options:a.options})),b);a.driver.setItem&&await Promise.all(a.items.map(b=>o(a.driver.setItem,b.relativeKey,p(b.value),b.options)))})},async setItemRaw(a,b,c={}){if(void 0===b)return j.removeItem(a,c);let{relativeKey:e,driver:g}=d(a=r(a));if(g.setItemRaw)await o(g.setItemRaw,e,b,c);else{var h;if(!g.setItem)return;await o(g.setItem,e,"string"==typeof b?b:q+(h=b,globalThis.Buffer?Buffer.from(h).toString("base64"):globalThis.btoa(String.fromCodePoint(...h))),c)}g.watch||f("update",a)},async removeItem(a,b={}){"boolean"==typeof b&&(b={removeMeta:b});let{relativeKey:c,driver:e}=d(a=r(a));e.removeItem&&(await o(e.removeItem,c,b),(b.removeMeta||b.removeMata)&&await o(e.removeItem,c+"$",b),e.watch||f("remove",a))},async getMeta(a,b={}){"boolean"==typeof b&&(b={nativeOnly:b});let{relativeKey:c,driver:e}=d(a=r(a)),f=Object.create(null);if(e.getMeta&&Object.assign(f,await o(e.getMeta,c,b)),!b.nativeOnly){let a=await o(e.getItem,c+"$",b).then(a=>m(a));a&&"object"==typeof a&&("string"==typeof a.atime&&(a.atime=new Date(a.atime)),"string"==typeof a.mtime&&(a.mtime=new Date(a.mtime)),Object.assign(f,a))}return f},setMeta(a,b,c={}){return this.setItem(a+"$",b,c)},removeMeta(a,b={}){return this.removeItem(a+"$",b)},async getKeys(a,b={}){let c=e(a=s(a),!0),d=[],f=[],g=!0;for(let a of c){for(let c of(a.driver.flags?.maxDepth||(g=!1),await o(a.driver.getKeys,a.relativeBase,b))){let b=a.mountpoint+r(c);d.some(a=>b.startsWith(a))||f.push(b)}d=[a.mountpoint,...d.filter(b=>!b.startsWith(a.mountpoint))]}let h=void 0!==b.maxDepth&&!g;return f.filter(c=>{var d;return(!h||function(a,b){if(void 0===b)return!0;let c=0,d=a.indexOf(":");for(;d>-1;)c++,d=a.indexOf(":",d+1);return c<=b}(c,b.maxDepth))&&((d=a)?c.startsWith(d)&&"$"!==c[c.length-1]:"$"!==c[c.length-1])})},async clear(a,b={}){a=s(a),await Promise.all(e(a,!1).map(async a=>a.driver.clear?o(a.driver.clear,a.relativeBase,b):a.driver.removeItem?Promise.all((await a.driver.getKeys(a.relativeBase||"",b)).map(c=>a.driver.removeItem(c,b))):void 0))},async dispose(){await Promise.all(Object.values(c.mounts).map(a=>v(a)))},watch:async a=>(await g(),c.watchListeners.push(a),async()=>{c.watchListeners=c.watchListeners.filter(b=>b!==a),0===c.watchListeners.length&&await h()}),async unwatch(){c.watchListeners=[],await h()},mount(a,b){if((a=s(a))&&c.mounts[a])throw Error(`already mounted at ${a}`);return a&&(c.mountpoints.push(a),c.mountpoints.sort((a,b)=>b.length-a.length)),c.mounts[a]=b,c.watching&&Promise.resolve(u(b,f,a)).then(b=>{c.unwatch[a]=b}).catch(console.error),j},async unmount(a,b=!0){(a=s(a))&&c.mounts[a]&&(c.watching&&a in c.unwatch&&(c.unwatch[a]?.(),delete c.unwatch[a]),b&&await v(c.mounts[a]),c.mountpoints=c.mountpoints.filter(b=>b!==a),delete c.mounts[a])},getMount(a=""){let b=d(a=r(a)+":");return{driver:b.driver,base:b.base}},getMounts:(a="",b={})=>e(a=r(a),b.parents).map(a=>({driver:a.driver,base:a.mountpoint})),keys:(a,b={})=>j.getKeys(a,b),get:(a,b={})=>j.getItem(a,b),set:(a,b,c={})=>j.setItem(a,b,c),has:(a,b={})=>j.hasItem(a,b),del:(a,b={})=>j.removeItem(a,b),remove:(a,b={})=>j.removeItem(a,b)};return j}function u(a,b,c){return a.watch?a.watch((a,d)=>b(a,c+d)):()=>{}}async function v(a){"function"==typeof a.dispose&&await o(a.dispose)}a.s(["createStorage",()=>t],712307)},424291,a=>{"use strict";var b=a.i(712307),c=a.i(404703),d=a.i(920275);class e{constructor(){this.indexedDb=(0,b.createStorage)({driver:((a={})=>{let b,d=a.base&&a.base.length>0?`${a.base}:`:"";return a.dbName&&a.storeName&&(b=(0,c.createStore)(a.dbName,a.storeName)),{name:"idb-keyval",options:a,hasItem:async a=>!(typeof await (0,c.get)(d+a,b)>"u"),getItem:async a=>await (0,c.get)(d+a,b)??null,setItem:(a,e)=>(0,c.set)(d+a,e,b),removeItem:a=>(0,c.del)(d+a,b),getKeys:()=>(0,c.keys)(b),clear:()=>(0,c.clear)(b)}})({dbName:"WALLET_CONNECT_V2_INDEXED_DB",storeName:"keyvaluestorage"})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(a=>[a.key,a.value])}async getItem(a){let b=await this.indexedDb.getItem(a);if(null!==b)return b}async setItem(a,b){await this.indexedDb.setItem(a,(0,d.safeJsonStringify)(b))}async removeItem(a){await this.indexedDb.removeItem(a)}}var f="u">typeof globalThis?globalThis:a.g,g={exports:{}};function h(a){var b;return[a[0],(0,d.safeJsonParse)(null!=(b=a[1])?b:"")]}function i(){}i.prototype.getItem=function(a){return this.hasOwnProperty(a)?String(this[a]):null},i.prototype.setItem=function(a,b){this[a]=String(b)},i.prototype.removeItem=function(a){delete this[a]},i.prototype.clear=function(){let a=this;Object.keys(a).forEach(function(b){a[b]=void 0,delete a[b]})},i.prototype.key=function(a){return a=a||0,Object.keys(this)[a]},i.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),"u">typeof f&&f.localStorage?g.exports=f.localStorage:g.exports=new i;class j{constructor(){this.localStorage=g.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(h)}async getItem(a){let b=this.localStorage.getItem(a);if(null!==b)return(0,d.safeJsonParse)(b)}async setItem(a,b){this.localStorage.setItem(a,(0,d.safeJsonStringify)(b))}async removeItem(a){this.localStorage.removeItem(a)}}let k=async(a,b,c)=>{let d="wc_storage_version",e=await b.getItem(d);if(e&&e>=1)return void c(b);let f=await a.getKeys();if(!f.length)return void c(b);let g=[];for(;f.length;){let c=f.shift();if(!c)continue;let d=c.toLowerCase();if(d.includes("wc@")||d.includes("walletconnect")||d.includes("wc_")||d.includes("wallet_connect")){let d=await a.getItem(c);await b.setItem(c,d),g.push(c)}}await b.setItem(d,1),c(b),l(a,g)},l=async(a,b)=>{b.length&&b.forEach(async b=>{await a.removeItem(b)})};class m{constructor(){this.initialized=!1,this.setInitialized=a=>{this.storage=a,this.initialized=!0};const a=new j;this.storage=a;try{const b=new e;k(a,b,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(a){return await this.initialize(),this.storage.getItem(a)}async setItem(a,b){return await this.initialize(),this.storage.setItem(a,b)}async removeItem(a){return await this.initialize(),this.storage.removeItem(a)}async initialize(){this.initialized||await new Promise(a=>{let b=setInterval(()=>{this.initialized&&(clearInterval(b),a())},20)})}}a.s(["default",()=>m])},474045,a=>{"use strict";a.i(157938);var b=a.i(693172),c=a.i(427699),d=Object.defineProperty,e=(a,b,c)=>{let e;return(e="symbol"!=typeof b?b+"":b)in a?d(a,e,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[e]=c};class f extends b.IEvents{constructor(a){super(),this.opts=a,e(this,"protocol","wc"),e(this,"version",2)}}var g=Object.defineProperty;class h extends b.IEvents{constructor(a,b){super(),this.core=a,this.logger=b,((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?g(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"records",new Map)}}class i{constructor(a,b){this.logger=a,this.core=b}}class j extends b.IEvents{constructor(a,b){super(),this.relayer=a,this.logger=b}}class k extends b.IEvents{constructor(a){super()}}class l{constructor(a,b,c,d){this.core=a,this.logger=b,this.name=c}}class m extends b.IEvents{constructor(a,b){super(),this.relayer=a,this.logger=b}}class o extends b.IEvents{constructor(a,b){super(),this.core=a,this.logger=b}}class p{constructor(a,b,c){this.core=a,this.logger=b,this.store=c}}class q{constructor(a,b){this.projectId=a,this.logger=b}}class r{constructor(a,b,c){this.core=a,this.logger=b,this.telemetryEnabled=c}}var s=Object.defineProperty,t=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?s(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};c.default;class u{constructor(a){this.opts=a,t(this,"protocol","wc"),t(this,"version",2)}}c.EventEmitter;class v{constructor(a){this.client=a}}a.s(["ICore",()=>f,"IEchoClient",()=>q,"IEngine",()=>v,"IEventClient",()=>r,"IExpirer",()=>o,"IJsonRpcHistory",()=>h,"IMessageTracker",()=>i,"IPublisher",()=>j,"IRelayer",()=>k,"ISignClient",()=>u,"IStore",()=>l,"ISubscriber",()=>m,"IVerify",()=>p])},588047,a=>{"use strict";var b=function(a,c){return(b=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(a,c)};function c(a,c){function d(){this.constructor=a}b(a,c),a.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}var d=function(){return(d=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};function e(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c}function f(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g}function g(a,b){return function(c,d){b(c,d,a)}}function h(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)}function i(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})}function j(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(f){return function(h){var i=[f,h];if(c)throw TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&i[0]?d.return:i[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,i[1])).done)return e;switch(d=0,e&&(i=[2&i[0],e.value]),i[0]){case 0:case 1:e=i;break;case 4:return g.label++,{value:i[1],done:!1};case 5:g.label++,d=i[1],i=[0];continue;case 7:i=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===i[0]||2===i[0])){g=0;continue}if(3===i[0]&&(!e||i[1]>e[0]&&i[1]<e[3])){g.label=i[1];break}if(6===i[0]&&g.label<e[1]){g.label=e[1],e=i;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(i);break}e[2]&&g.ops.pop(),g.trys.pop();continue}i=b.call(a,g)}catch(a){i=[6,a],d=0}finally{c=e=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}}}function k(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}function l(a,b){for(var c in a)"default"===c||b.hasOwnProperty(c)||(b[c]=a[c])}function m(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")}function o(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,e,f=c.call(a),g=[];try{for(;(void 0===b||b-- >0)&&!(d=f.next()).done;)g.push(d.value)}catch(a){e={error:a}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(e)throw e.error}}return g}function p(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(o(arguments[b]));return a}function q(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d}function r(a){return this instanceof r?(this.v=a,this):new r(a)}function s(a,b,c){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var d,e=c.apply(a,b||[]),f=[];return d={},g("next"),g("throw"),g("return"),d[Symbol.asyncIterator]=function(){return this},d;function g(a){e[a]&&(d[a]=function(b){return new Promise(function(c,d){f.push([a,b,c,d])>1||h(a,b)})})}function h(a,b){try{var c;(c=e[a](b)).value instanceof r?Promise.resolve(c.value.v).then(i,j):k(f[0][2],c)}catch(a){k(f[0][3],a)}}function i(a){h("next",a)}function j(a){h("throw",a)}function k(a,b){a(b),f.shift(),f.length&&h(f[0][0],f[0][1])}}function t(a){var b,c;return b={},d("next"),d("throw",function(a){throw a}),d("return"),b[Symbol.iterator]=function(){return this},b;function d(d,e){b[d]=a[d]?function(b){return(c=!c)?{value:r(a[d](b)),done:"return"===d}:e?e(b):b}:e}}function u(a){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var b,c=a[Symbol.asyncIterator];return c?c.call(a):(a=m(a),b={},d("next"),d("throw"),d("return"),b[Symbol.asyncIterator]=function(){return this},b);function d(c){b[c]=a[c]&&function(b){return new Promise(function(d,e){var f,g,h;f=d,g=e,h=(b=a[c](b)).done,Promise.resolve(b.value).then(function(a){f({value:a,done:h})},g)})}}}function v(a,b){return Object.defineProperty?Object.defineProperty(a,"raw",{value:b}):a.raw=b,a}function w(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function x(a){return a&&a.__esModule?a:{default:a}}function y(a,b){if(!b.has(a))throw TypeError("attempted to get private field on non-instance");return b.get(a)}function z(a,b,c){if(!b.has(a))throw TypeError("attempted to set private field on non-instance");return b.set(a,c),c}a.s(["__assign",()=>d,"__asyncDelegator",()=>t,"__asyncGenerator",()=>s,"__asyncValues",()=>u,"__await",()=>r,"__awaiter",()=>i,"__classPrivateFieldGet",()=>y,"__classPrivateFieldSet",()=>z,"__createBinding",()=>k,"__decorate",()=>f,"__exportStar",()=>l,"__extends",()=>c,"__generator",()=>j,"__importDefault",()=>x,"__importStar",()=>w,"__makeTemplateObject",()=>v,"__metadata",()=>h,"__param",()=>g,"__read",()=>o,"__rest",()=>e,"__spread",()=>p,"__spreadArrays",()=>q,"__values",()=>m])},283435,(a,b,c)=>{"use strict";function d(){return(null===a.g||void 0===a.g?void 0:a.g.crypto)||(null===a.g||void 0===a.g?void 0:a.g.msCrypto)||{}}function e(){let a=d();return a.subtle||a.webkitSubtle}Object.defineProperty(c,"__esModule",{value:!0}),c.isBrowserCryptoAvailable=c.getSubtleCrypto=c.getBrowerCrypto=void 0,c.getBrowerCrypto=d,c.getSubtleCrypto=e,c.isBrowserCryptoAvailable=function(){return!!d()&&!!e()}},666818,(a,b,c)=>{"use strict";function d(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product}function e(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}Object.defineProperty(c,"__esModule",{value:!0}),c.isBrowser=c.isNode=c.isReactNative=void 0,c.isReactNative=d,c.isNode=e,c.isBrowser=function(){return!d()&&!e()}},42289,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(588047);d.__exportStar(a.r(283435),c),d.__exportStar(a.r(666818),c)},783855,(a,b,c)=>{"use strict";b.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}}},424321,(a,b,c)=>{"use strict";let{EMPTY_BUFFER:d}=a.r(783855);function e(a,b){if(0===a.length)return d;if(1===a.length)return a[0];let c=Buffer.allocUnsafe(b),e=0;for(let b=0;b<a.length;b++){let d=a[b];c.set(d,e),e+=d.length}return e<b?c.slice(0,e):c}function f(a,b,c,d,e){for(let f=0;f<e;f++)c[d+f]=a[f]^b[3&f]}function g(a,b){let c=a.length;for(let d=0;d<c;d++)a[d]^=b[3&d]}function h(a){return a.byteLength===a.buffer.byteLength?a.buffer:a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength)}function i(a){let b;return(i.readOnly=!0,Buffer.isBuffer(a))?a:(a instanceof ArrayBuffer?b=Buffer.from(a):ArrayBuffer.isView(a)?b=Buffer.from(a.buffer,a.byteOffset,a.byteLength):(b=Buffer.from(a),i.readOnly=!1),b)}try{let c=a.r(202625),d=c.BufferUtil||c;b.exports={concat:e,mask(a,b,c,e,g){g<48?f(a,b,c,e,g):d.mask(a,b,c,e,g)},toArrayBuffer:h,toBuffer:i,unmask(a,b){a.length<32?g(a,b):d.unmask(a,b)}}}catch(a){b.exports={concat:e,mask:f,toArrayBuffer:h,toBuffer:i,unmask:g}}},303099,(a,b,c)=>{"use strict";let d=Symbol("kDone"),e=Symbol("kRun");b.exports=class{constructor(a){this[d]=()=>{this.pending--,this[e]()},this.concurrency=a||1/0,this.jobs=[],this.pending=0}add(a){this.jobs.push(a),this[e]()}[e](){if(this.pending!==this.concurrency&&this.jobs.length){let a=this.jobs.shift();this.pending++,a(this[d])}}}},90739,(a,b,c)=>{"use strict";let d,e=a.r(406461),f=a.r(424321),g=a.r(303099),{kStatusCode:h,NOOP:i}=a.r(783855),j=Buffer.from([0,0,255,255]),k=Symbol("permessage-deflate"),l=Symbol("total-length"),m=Symbol("callback"),o=Symbol("buffers"),p=Symbol("error");function q(a){this[o].push(a),this[l]+=a.length}function r(a){(this[l]+=a.length,this[k]._maxPayload<1||this[l]<=this[k]._maxPayload)?this[o].push(a):(this[p]=RangeError("Max payload size exceeded"),this[p].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[p][h]=1009,this.removeListener("data",r),this.reset())}function s(a){this[k]._inflate=null,a[h]=1007,this[m](a)}b.exports=class{constructor(a,b,c){this._maxPayload=0|c,this._options=a||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!b,this._deflate=null,this._inflate=null,this.params=null,d||(d=new g(void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10))}static get extensionName(){return"permessage-deflate"}offer(){let a={};return this._options.serverNoContextTakeover&&(a.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(a.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(a.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?a.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(a.client_max_window_bits=!0),a}accept(a){return a=this.normalizeParams(a),this.params=this._isServer?this.acceptAsServer(a):this.acceptAsClient(a),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let a=this._deflate[m];this._deflate.close(),this._deflate=null,a&&a(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(a){let b=this._options,c=a.find(a=>(!1!==b.serverNoContextTakeover||!a.server_no_context_takeover)&&(!a.server_max_window_bits||!1!==b.serverMaxWindowBits&&("number"!=typeof b.serverMaxWindowBits||!(b.serverMaxWindowBits>a.server_max_window_bits)))&&("number"!=typeof b.clientMaxWindowBits||!!a.client_max_window_bits));if(!c)throw Error("None of the extension offers can be accepted");return b.serverNoContextTakeover&&(c.server_no_context_takeover=!0),b.clientNoContextTakeover&&(c.client_no_context_takeover=!0),"number"==typeof b.serverMaxWindowBits&&(c.server_max_window_bits=b.serverMaxWindowBits),"number"==typeof b.clientMaxWindowBits?c.client_max_window_bits=b.clientMaxWindowBits:(!0===c.client_max_window_bits||!1===b.clientMaxWindowBits)&&delete c.client_max_window_bits,c}acceptAsClient(a){let b=a[0];if(!1===this._options.clientNoContextTakeover&&b.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(b.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&b.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(b.client_max_window_bits=this._options.clientMaxWindowBits);return b}normalizeParams(a){return a.forEach(a=>{Object.keys(a).forEach(b=>{let c=a[b];if(c.length>1)throw Error(`Parameter "${b}" must have only a single value`);if(c=c[0],"client_max_window_bits"===b){if(!0!==c){let a=+c;if(!Number.isInteger(a)||a<8||a>15)throw TypeError(`Invalid value for parameter "${b}": ${c}`);c=a}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${b}": ${c}`)}else if("server_max_window_bits"===b){let a=+c;if(!Number.isInteger(a)||a<8||a>15)throw TypeError(`Invalid value for parameter "${b}": ${c}`);c=a}else if("client_no_context_takeover"===b||"server_no_context_takeover"===b){if(!0!==c)throw TypeError(`Invalid value for parameter "${b}": ${c}`)}else throw Error(`Unknown parameter "${b}"`);a[b]=c})}),a}decompress(a,b,c){d.add(d=>{this._decompress(a,b,(a,b)=>{d(),c(a,b)})})}compress(a,b,c){d.add(d=>{this._compress(a,b,(a,b)=>{d(),c(a,b)})})}_decompress(a,b,c){let d=this._isServer?"client":"server";if(!this._inflate){let a=`${d}_max_window_bits`,b="number"!=typeof this.params[a]?e.Z_DEFAULT_WINDOWBITS:this.params[a];this._inflate=e.createInflateRaw({...this._options.zlibInflateOptions,windowBits:b}),this._inflate[k]=this,this._inflate[l]=0,this._inflate[o]=[],this._inflate.on("error",s),this._inflate.on("data",r)}this._inflate[m]=c,this._inflate.write(a),b&&this._inflate.write(j),this._inflate.flush(()=>{let a=this._inflate[p];if(a){this._inflate.close(),this._inflate=null,c(a);return}let e=f.concat(this._inflate[o],this._inflate[l]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[l]=0,this._inflate[o]=[],b&&this.params[`${d}_no_context_takeover`]&&this._inflate.reset()),c(null,e)})}_compress(a,b,c){let d=this._isServer?"server":"client";if(!this._deflate){let a=`${d}_max_window_bits`,b="number"!=typeof this.params[a]?e.Z_DEFAULT_WINDOWBITS:this.params[a];this._deflate=e.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:b}),this._deflate[l]=0,this._deflate[o]=[],this._deflate.on("error",i),this._deflate.on("data",q)}this._deflate[m]=c,this._deflate.write(a),this._deflate.flush(e.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let a=f.concat(this._deflate[o],this._deflate[l]);b&&(a=a.slice(0,a.length-4)),this._deflate[m]=null,this._deflate[l]=0,this._deflate[o]=[],b&&this.params[`${d}_no_context_takeover`]&&this._deflate.reset(),c(null,a)})}}},780553,(a,b,c)=>{"use strict";function d(a){return a>=1e3&&a<=1014&&1004!==a&&1005!==a&&1006!==a||a>=3e3&&a<=4999}function e(a){let b=a.length,c=0;for(;c<b;)if((128&a[c])==0)c++;else if((224&a[c])==192){if(c+1===b||(192&a[c+1])!=128||(254&a[c])==192)return!1;c+=2}else if((240&a[c])==224){if(c+2>=b||(192&a[c+1])!=128||(192&a[c+2])!=128||224===a[c]&&(224&a[c+1])==128||237===a[c]&&(224&a[c+1])==160)return!1;c+=3}else{if((248&a[c])!=240||c+3>=b||(192&a[c+1])!=128||(192&a[c+2])!=128||(192&a[c+3])!=128||240===a[c]&&(240&a[c+1])==128||244===a[c]&&a[c+1]>143||a[c]>244)return!1;c+=4}return!0}try{let c=a.r(399873);"object"==typeof c&&(c=c.Validation.isValidUTF8),b.exports={isValidStatusCode:d,isValidUTF8:a=>a.length<150?e(a):c(a)}}catch(a){b.exports={isValidStatusCode:d,isValidUTF8:e}}},303833,(a,b,c)=>{"use strict";let{Writable:d}=a.r(688947),e=a.r(90739),{BINARY_TYPES:f,EMPTY_BUFFER:g,kStatusCode:h,kWebSocket:i}=a.r(783855),{concat:j,toArrayBuffer:k,unmask:l}=a.r(424321),{isValidStatusCode:m,isValidUTF8:o}=a.r(780553);function p(a,b,c,d,e){let f=new a(c?`Invalid WebSocket frame: ${b}`:b);return Error.captureStackTrace(f,p),f.code=e,f[h]=d,f}b.exports=class extends d{constructor(a,b,c,d){super(),this._binaryType=a||f[0],this[i]=void 0,this._extensions=b||{},this._isServer=!!c,this._maxPayload=0|d,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=0,this._loop=!1}_write(a,b,c){if(8===this._opcode&&0==this._state)return c();this._bufferedBytes+=a.length,this._buffers.push(a),this.startLoop(c)}consume(a){if(this._bufferedBytes-=a,a===this._buffers[0].length)return this._buffers.shift();if(a<this._buffers[0].length){let b=this._buffers[0];return this._buffers[0]=b.slice(a),b.slice(0,a)}let b=Buffer.allocUnsafe(a);do{let c=this._buffers[0],d=b.length-a;a>=c.length?b.set(this._buffers.shift(),d):(b.set(new Uint8Array(c.buffer,c.byteOffset,a),d),this._buffers[0]=c.slice(a)),a-=c.length}while(a>0)return b}startLoop(a){let b;this._loop=!0;do switch(this._state){case 0:b=this.getInfo();break;case 1:b=this.getPayloadLength16();break;case 2:b=this.getPayloadLength64();break;case 3:this.getMask();break;case 4:b=this.getData(a);break;default:this._loop=!1;return}while(this._loop)a(b)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let a=this.consume(2);if((48&a[0])!=0)return this._loop=!1,p(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");let b=(64&a[0])==64;if(b&&!this._extensions[e.extensionName])return this._loop=!1,p(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(128&a[0])==128,this._opcode=15&a[0],this._payloadLength=127&a[1],0===this._opcode){if(b)return this._loop=!1,p(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,p(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return this._loop=!1,p(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=b}else{if(!(this._opcode>7)||!(this._opcode<11))return this._loop=!1,p(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin)return this._loop=!1,p(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(b)return this._loop=!1,p(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125)return this._loop=!1,p(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=(128&a[1])==128,this._isServer){if(!this._masked)return this._loop=!1,p(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,p(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(126===this._payloadLength)this._state=1;else{if(127!==this._payloadLength)return this.haveLength();this._state=2}}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let a=this.consume(8),b=a.readUInt32BE(0);return b>2097151?(this._loop=!1,p(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=0x100000000*b+a.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,p(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=3:this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(a){let b=g;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}b=this.consume(this._payloadLength),this._masked&&l(b,this._mask)}if(this._opcode>7)return this.controlMessage(b);if(this._compressed){this._state=5,this.decompress(b,a);return}return b.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(b)),this.dataMessage()}decompress(a,b){this._extensions[e.extensionName].decompress(a,this._fin,(a,c)=>{if(a)return b(a);if(c.length){if(this._messageLength+=c.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return b(p(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(c)}let d=this.dataMessage();if(d)return b(d);this.startLoop(b)})}dataMessage(){if(this._fin){let a=this._messageLength,b=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let c;c="nodebuffer"===this._binaryType?j(b,a):"arraybuffer"===this._binaryType?k(j(b,a)):b,this.emit("message",c)}else{let c=j(b,a);if(!o(c))return this._loop=!1,p(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",c.toString())}}this._state=0}controlMessage(a){if(8===this._opcode)if(this._loop=!1,0===a.length)this.emit("conclude",1005,""),this.end();else{if(1===a.length)return p(RangeError,"invalid payload length 1",!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");let b=a.readUInt16BE(0);if(!m(b))return p(RangeError,`invalid status code ${b}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");let c=a.slice(2);if(!o(c))return p(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",b,c.toString()),this.end()}else 9===this._opcode?this.emit("ping",a):this.emit("pong",a);this._state=0}}},218307,(a,b,c)=>{"use strict";a.r(504446),a.r(755004);let{randomFillSync:d}=a.r(254799),e=a.r(90739),{EMPTY_BUFFER:f}=a.r(783855),{isValidStatusCode:g}=a.r(780553),{mask:h,toBuffer:i}=a.r(424321),j=Buffer.alloc(4);class k{constructor(a,b){this._extensions=b||{},this._socket=a,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(a,b){let c=b.mask&&b.readOnly,e=b.mask?6:2,f=a.length;a.length>=65536?(e+=8,f=127):a.length>125&&(e+=2,f=126);let g=Buffer.allocUnsafe(c?a.length+e:e);return(g[0]=b.fin?128|b.opcode:b.opcode,b.rsv1&&(g[0]|=64),g[1]=f,126===f?g.writeUInt16BE(a.length,2):127===f&&(g.writeUInt32BE(0,2),g.writeUInt32BE(a.length,6)),b.mask)?(d(j,0,4),g[1]|=128,g[e-4]=j[0],g[e-3]=j[1],g[e-2]=j[2],g[e-1]=j[3],c)?(h(a,j,g,e,a.length),[g]):(h(a,j,a,0,a.length),[g,a]):[g,a]}close(a,b,c,d){let e;if(void 0===a)e=f;else if("number"==typeof a&&g(a))if(void 0===b||""===b)(e=Buffer.allocUnsafe(2)).writeUInt16BE(a,0);else{let c=Buffer.byteLength(b);if(c>123)throw RangeError("The message must not be greater than 123 bytes");(e=Buffer.allocUnsafe(2+c)).writeUInt16BE(a,0),e.write(b,2)}else throw TypeError("First argument must be a valid error code number");this._deflating?this.enqueue([this.doClose,e,c,d]):this.doClose(e,c,d)}doClose(a,b,c){this.sendFrame(k.frame(a,{fin:!0,rsv1:!1,opcode:8,mask:b,readOnly:!1}),c)}ping(a,b,c){let d=i(a);if(d.length>125)throw RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPing,d,b,i.readOnly,c]):this.doPing(d,b,i.readOnly,c)}doPing(a,b,c,d){this.sendFrame(k.frame(a,{fin:!0,rsv1:!1,opcode:9,mask:b,readOnly:c}),d)}pong(a,b,c){let d=i(a);if(d.length>125)throw RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPong,d,b,i.readOnly,c]):this.doPong(d,b,i.readOnly,c)}doPong(a,b,c,d){this.sendFrame(k.frame(a,{fin:!0,rsv1:!1,opcode:10,mask:b,readOnly:c}),d)}send(a,b,c){let d=i(a),f=this._extensions[e.extensionName],g=b.binary?2:1,h=b.compress;if(this._firstFragment?(this._firstFragment=!1,h&&f&&(h=d.length>=f._threshold),this._compress=h):(h=!1,g=0),b.fin&&(this._firstFragment=!0),f){let a={fin:b.fin,rsv1:h,opcode:g,mask:b.mask,readOnly:i.readOnly};this._deflating?this.enqueue([this.dispatch,d,this._compress,a,c]):this.dispatch(d,this._compress,a,c)}else this.sendFrame(k.frame(d,{fin:b.fin,rsv1:!1,opcode:g,mask:b.mask,readOnly:i.readOnly}),c)}dispatch(a,b,c,d){if(!b)return void this.sendFrame(k.frame(a,c),d);let f=this._extensions[e.extensionName];this._bufferedBytes+=a.length,this._deflating=!0,f.compress(a,c.fin,(b,e)=>{if(this._socket.destroyed){let a=Error("The socket was closed while data was being compressed");"function"==typeof d&&d(a);for(let b=0;b<this._queue.length;b++){let c=this._queue[b][4];"function"==typeof c&&c(a)}return}this._bufferedBytes-=a.length,this._deflating=!1,c.readOnly=!1,this.sendFrame(k.frame(e,c),d),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let a=this._queue.shift();this._bufferedBytes-=a[1].length,Reflect.apply(a[0],this,a.slice(1))}}enqueue(a){this._bufferedBytes+=a[1].length,this._queue.push(a)}sendFrame(a,b){2===a.length?(this._socket.cork(),this._socket.write(a[0]),this._socket.write(a[1],b),this._socket.uncork()):this._socket.write(a[0],b)}}b.exports=k},975134,(a,b,c)=>{"use strict";class d{constructor(a,b){this.target=b,this.type=a}}class e extends d{constructor(a,b){super("message",b),this.data=a}}class f extends d{constructor(a,b,c){super("close",c),this.wasClean=c._closeFrameReceived&&c._closeFrameSent,this.reason=b,this.code=a}}class g extends d{constructor(a){super("open",a)}}class h extends d{constructor(a,b){super("error",b),this.message=a.message,this.error=a}}b.exports={addEventListener(a,b,c){if("function"!=typeof b)return;function d(a){b.call(this,new e(a,this))}function i(a,c){b.call(this,new f(a,c,this))}function j(a){b.call(this,new h(a,this))}function k(){b.call(this,new g(this))}let l=c&&c.once?"once":"on";"message"===a?(d._listener=b,this[l](a,d)):"close"===a?(i._listener=b,this[l](a,i)):"error"===a?(j._listener=b,this[l](a,j)):"open"===a?(k._listener=b,this[l](a,k)):this[l](a,b)},removeEventListener(a,b){let c=this.listeners(a);for(let d=0;d<c.length;d++)(c[d]===b||c[d]._listener===b)&&this.removeListener(a,c[d])}}},852882,(a,b,c)=>{"use strict";let d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function e(a,b,c){void 0===a[b]?a[b]=[c]:a[b].push(c)}b.exports={format:function(a){return Object.keys(a).map(b=>{let c=a[b];return Array.isArray(c)||(c=[c]),c.map(a=>[b].concat(Object.keys(a).map(b=>{let c=a[b];return Array.isArray(c)||(c=[c]),c.map(a=>!0===a?b:`${b}=${a}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(a){let b,c,f=Object.create(null);if(void 0===a||""===a)return f;let g=Object.create(null),h=!1,i=!1,j=!1,k=-1,l=-1,m=0;for(;m<a.length;m++){let o=a.charCodeAt(m);if(void 0===b)if(-1===l&&1===d[o])-1===k&&(k=m);else if(32===o||9===o)-1===l&&-1!==k&&(l=m);else if(59===o||44===o){if(-1===k)throw SyntaxError(`Unexpected character at index ${m}`);-1===l&&(l=m);let c=a.slice(k,l);44===o?(e(f,c,g),g=Object.create(null)):b=c,k=l=-1}else throw SyntaxError(`Unexpected character at index ${m}`);else if(void 0===c)if(-1===l&&1===d[o])-1===k&&(k=m);else if(32===o||9===o)-1===l&&-1!==k&&(l=m);else if(59===o||44===o){if(-1===k)throw SyntaxError(`Unexpected character at index ${m}`);-1===l&&(l=m),e(g,a.slice(k,l),!0),44===o&&(e(f,b,g),g=Object.create(null),b=void 0),k=l=-1}else if(61===o&&-1!==k&&-1===l)c=a.slice(k,m),k=l=-1;else throw SyntaxError(`Unexpected character at index ${m}`);else if(i){if(1!==d[o])throw SyntaxError(`Unexpected character at index ${m}`);-1===k?k=m:h||(h=!0),i=!1}else if(j)if(1===d[o])-1===k&&(k=m);else if(34===o&&-1!==k)j=!1,l=m;else if(92===o)i=!0;else throw SyntaxError(`Unexpected character at index ${m}`);else if(34===o&&61===a.charCodeAt(m-1))j=!0;else if(-1===l&&1===d[o])-1===k&&(k=m);else if(-1!==k&&(32===o||9===o))-1===l&&(l=m);else if(59===o||44===o){if(-1===k)throw SyntaxError(`Unexpected character at index ${m}`);-1===l&&(l=m);let d=a.slice(k,l);h&&(d=d.replace(/\\/g,""),h=!1),e(g,c,d),44===o&&(e(f,b,g),g=Object.create(null),b=void 0),c=void 0,k=l=-1}else throw SyntaxError(`Unexpected character at index ${m}`)}if(-1===k||j)throw SyntaxError("Unexpected end of input");-1===l&&(l=m);let o=a.slice(k,l);return void 0===b?e(f,o,g):(void 0===c?e(g,o,!0):h?e(g,c,o.replace(/\\/g,"")):e(g,c,o),e(f,b,g)),f}}},413523,(a,b,c)=>{"use strict";let d=a.r(427699),e=a.r(524836),f=a.r(921517),g=a.r(504446),h=a.r(755004),{randomBytes:i,createHash:j}=a.r(254799),{Readable:k}=a.r(688947),{URL:l}=a.r(792509),m=a.r(90739),o=a.r(303833),p=a.r(218307),{BINARY_TYPES:q,EMPTY_BUFFER:r,GUID:s,kStatusCode:t,kWebSocket:u,NOOP:v}=a.r(783855),{addEventListener:w,removeEventListener:x}=a.r(975134),{format:y,parse:z}=a.r(852882),{toBuffer:A}=a.r(424321),B=["CONNECTING","OPEN","CLOSING","CLOSED"],C=[8,13];class D extends d{constructor(a,b,c){super(),this._binaryType=q[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._extensions={},this._protocol="",this._readyState=D.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==a?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,Array.isArray(b)?b=b.join(", "):"object"==typeof b&&null!==b&&(c=b,b=void 0),function a(b,c,d,g){let h,k,o={protocolVersion:C[1],maxPayload:0x6400000,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...g,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,host:void 0,path:void 0,port:void 0};if(!C.includes(o.protocolVersion))throw RangeError(`Unsupported protocol version: ${o.protocolVersion} (supported versions: ${C.join(", ")})`);c instanceof l?(h=c,b._url=c.href):(h=new l(c),b._url=c);let p="ws+unix:"===h.protocol;if(!h.host&&(!p||!h.pathname)){let a=Error(`Invalid URL: ${b.url}`);if(0!==b._redirects)return void E(b,a);throw a}let q="wss:"===h.protocol||"https:"===h.protocol,r=q?443:80,t=i(16).toString("base64"),u=q?e.get:f.get;if(o.createConnection=q?G:F,o.defaultPort=o.defaultPort||r,o.port=h.port||r,o.host=h.hostname.startsWith("[")?h.hostname.slice(1,-1):h.hostname,o.headers={"Sec-WebSocket-Version":o.protocolVersion,"Sec-WebSocket-Key":t,Connection:"Upgrade",Upgrade:"websocket",...o.headers},o.path=h.pathname+h.search,o.timeout=o.handshakeTimeout,o.perMessageDeflate&&(k=new m(!0!==o.perMessageDeflate?o.perMessageDeflate:{},!1,o.maxPayload),o.headers["Sec-WebSocket-Extensions"]=y({[m.extensionName]:k.offer()})),d&&(o.headers["Sec-WebSocket-Protocol"]=d),o.origin&&(o.protocolVersion<13?o.headers["Sec-WebSocket-Origin"]=o.origin:o.headers.Origin=o.origin),(h.username||h.password)&&(o.auth=`${h.username}:${h.password}`),p){let a=o.path.split(":");o.socketPath=a[0],o.path=a[1]}if(o.followRedirects){if(0===b._redirects){b._originalUnixSocket=p,b._originalSecure=q,b._originalHostOrSocketPath=p?o.socketPath:h.host;let a=g&&g.headers;if(g={...g,headers:{}},a)for(let[b,c]of Object.entries(a))g.headers[b.toLowerCase()]=c}else{let a=p?!!b._originalUnixSocket&&o.socketPath===b._originalHostOrSocketPath:!b._originalUnixSocket&&h.host===b._originalHostOrSocketPath;a&&(!b._originalSecure||q)||(delete o.headers.authorization,delete o.headers.cookie,a||delete o.headers.host,o.auth=void 0)}o.auth&&!g.headers.authorization&&(g.headers.authorization="Basic "+Buffer.from(o.auth).toString("base64"))}let v=b._req=u(o);o.timeout&&v.on("timeout",()=>{H(b,v,"Opening handshake has timed out")}),v.on("error",a=>{null===v||v.aborted||(v=b._req=null,E(b,a))}),v.on("response",e=>{let f=e.headers.location,h=e.statusCode;if(f&&o.followRedirects&&h>=300&&h<400){let e;if(++b._redirects>o.maxRedirects)return void H(b,v,"Maximum redirects exceeded");v.abort();try{e=new l(f,c)}catch(a){E(b,a);return}a(b,e,d,g)}else b.emit("unexpected-response",v,e)||H(b,v,`Unexpected server response: ${e.statusCode}`)}),v.on("upgrade",(a,c,e)=>{let f;if(b.emit("upgrade",a),b.readyState!==D.CONNECTING)return;v=b._req=null;let g=a.headers.upgrade;if(void 0===g||"websocket"!==g.toLowerCase())return void H(b,c,"Invalid Upgrade header");let h=j("sha1").update(t+s).digest("base64");if(a.headers["sec-websocket-accept"]!==h)return void H(b,c,"Invalid Sec-WebSocket-Accept header");let i=a.headers["sec-websocket-protocol"],l=(d||"").split(/, */);if(!d&&i?f="Server sent a subprotocol but none was requested":d&&!i?f="Server sent no subprotocol":i&&!l.includes(i)&&(f="Server sent an invalid subprotocol"),f)return void H(b,c,f);i&&(b._protocol=i);let p=a.headers["sec-websocket-extensions"];if(void 0!==p){let a;if(!k)return void H(b,c,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");try{a=z(p)}catch(a){H(b,c,"Invalid Sec-WebSocket-Extensions header");return}let d=Object.keys(a);if(d.length){if(1!==d.length||d[0]!==m.extensionName)return void H(b,c,"Server indicated an extension that was not requested");try{k.accept(a[m.extensionName])}catch(a){H(b,c,"Invalid Sec-WebSocket-Extensions header");return}b._extensions[m.extensionName]=k}}b.setSocket(c,e,o.maxPayload)})}(this,a,b,c)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(a){q.includes(a)&&(this._binaryType=a,this._receiver&&(this._receiver._binaryType=a))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get onclose(){}set onclose(a){}get onerror(){}set onerror(a){}get onopen(){}set onopen(a){}get onmessage(){}set onmessage(a){}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(a,b,c){let d=new o(this.binaryType,this._extensions,this._isServer,c);this._sender=new p(a,this._extensions),this._receiver=d,this._socket=a,d[u]=this,a[u]=this,d.on("conclude",J),d.on("drain",K),d.on("error",L),d.on("message",N),d.on("ping",O),d.on("pong",P),a.setTimeout(0),a.setNoDelay(),b.length>0&&a.unshift(b),a.on("close",R),a.on("data",S),a.on("end",T),a.on("error",U),this._readyState=D.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=D.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[m.extensionName]&&this._extensions[m.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=D.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(a,b){if(this.readyState!==D.CLOSED){if(this.readyState===D.CONNECTING)return H(this,this._req,"WebSocket was closed before the connection was established");if(this.readyState===D.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=D.CLOSING,this._sender.close(a,b,!this._isServer,a=>{!a&&(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),3e4)}}ping(a,b,c){if(this.readyState===D.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof a?(c=a,a=b=void 0):"function"==typeof b&&(c=b,b=void 0),"number"==typeof a&&(a=a.toString()),this.readyState!==D.OPEN)?I(this,a,c):(void 0===b&&(b=!this._isServer),this._sender.ping(a||r,b,c))}pong(a,b,c){if(this.readyState===D.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof a?(c=a,a=b=void 0):"function"==typeof b&&(c=b,b=void 0),"number"==typeof a&&(a=a.toString()),this.readyState!==D.OPEN)?I(this,a,c):(void 0===b&&(b=!this._isServer),this._sender.pong(a||r,b,c))}send(a,b,c){if(this.readyState===D.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof b&&(c=b,b={}),"number"==typeof a&&(a=a.toString()),this.readyState!==D.OPEN)return void I(this,a,c);let d={binary:"string"!=typeof a,mask:!this._isServer,compress:!0,fin:!0,...b};this._extensions[m.extensionName]||(d.compress=!1),this._sender.send(a||r,d,c)}terminate(){if(this.readyState!==D.CLOSED){if(this.readyState===D.CONNECTING)return H(this,this._req,"WebSocket was closed before the connection was established");this._socket&&(this._readyState=D.CLOSING,this._socket.destroy())}}}function E(a,b){a._readyState=D.CLOSING,a.emit("error",b),a.emitClose()}function F(a){return a.path=a.socketPath,g.connect(a)}function G(a){return a.path=void 0,a.servername||""===a.servername||(a.servername=g.isIP(a.host)?"":a.host),h.connect(a)}function H(a,b,c){a._readyState=D.CLOSING;let d=Error(c);Error.captureStackTrace(d,H),b.setHeader?(b.abort(),b.socket&&!b.socket.destroyed&&b.socket.destroy(),b.once("abort",a.emitClose.bind(a)),a.emit("error",d)):(b.destroy(d),b.once("error",a.emit.bind(a,"error")),b.once("close",a.emitClose.bind(a)))}function I(a,b,c){if(b){let c=A(b).length;a._socket?a._sender._bufferedBytes+=c:a._bufferedAmount+=c}c&&c(Error(`WebSocket is not open: readyState ${a.readyState} (${B[a.readyState]})`))}function J(a,b){let c=this[u];c._closeFrameReceived=!0,c._closeMessage=b,c._closeCode=a,void 0!==c._socket[u]&&(c._socket.removeListener("data",S),process.nextTick(Q,c._socket),1005===a?c.close():c.close(a,b))}function K(){this[u]._socket.resume()}function L(a){let b=this[u];void 0!==b._socket[u]&&(b._socket.removeListener("data",S),process.nextTick(Q,b._socket),b.close(a[t])),b.emit("error",a)}function M(){this[u].emitClose()}function N(a){this[u].emit("message",a)}function O(a){let b=this[u];b.pong(a,!b._isServer,v),b.emit("ping",a)}function P(a){this[u].emit("pong",a)}function Q(a){a.resume()}function R(){let a,b=this[u];this.removeListener("close",R),this.removeListener("data",S),this.removeListener("end",T),b._readyState=D.CLOSING,this._readableState.endEmitted||b._closeFrameReceived||b._receiver._writableState.errorEmitted||null===(a=b._socket.read())||b._receiver.write(a),b._receiver.end(),this[u]=void 0,clearTimeout(b._closeTimer),b._receiver._writableState.finished||b._receiver._writableState.errorEmitted?b.emitClose():(b._receiver.on("error",M),b._receiver.on("finish",M))}function S(a){this[u]._receiver.write(a)||this.pause()}function T(){let a=this[u];a._readyState=D.CLOSING,a._receiver.end(),this.end()}function U(){let a=this[u];this.removeListener("error",U),this.on("error",v),a&&(a._readyState=D.CLOSING,this.destroy())}Object.defineProperty(D,"CONNECTING",{enumerable:!0,value:B.indexOf("CONNECTING")}),Object.defineProperty(D.prototype,"CONNECTING",{enumerable:!0,value:B.indexOf("CONNECTING")}),Object.defineProperty(D,"OPEN",{enumerable:!0,value:B.indexOf("OPEN")}),Object.defineProperty(D.prototype,"OPEN",{enumerable:!0,value:B.indexOf("OPEN")}),Object.defineProperty(D,"CLOSING",{enumerable:!0,value:B.indexOf("CLOSING")}),Object.defineProperty(D.prototype,"CLOSING",{enumerable:!0,value:B.indexOf("CLOSING")}),Object.defineProperty(D,"CLOSED",{enumerable:!0,value:B.indexOf("CLOSED")}),Object.defineProperty(D.prototype,"CLOSED",{enumerable:!0,value:B.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","protocol","readyState","url"].forEach(a=>{Object.defineProperty(D.prototype,a,{enumerable:!0})}),["open","error","close","message"].forEach(a=>{Object.defineProperty(D.prototype,`on${a}`,{enumerable:!0,get(){let b=this.listeners(a);for(let a=0;a<b.length;a++)if(b[a]._listener)return b[a]._listener},set(b){let c=this.listeners(a);for(let b=0;b<c.length;b++)c[b]._listener&&this.removeListener(a,c[b]);this.addEventListener(a,b)}})}),D.prototype.addEventListener=w,D.prototype.removeEventListener=x,b.exports=D},127493,(a,b,c)=>{"use strict";let{Duplex:d}=a.r(688947);function e(a){a.emit("close")}function f(){!this.destroyed&&this._writableState.finished&&this.destroy()}function g(a){this.removeListener("error",g),this.destroy(),0===this.listenerCount("error")&&this.emit("error",a)}b.exports=function(a,b){let c=!0,h=!0;function i(){c&&a._socket.resume()}a.readyState===a.CONNECTING?a.once("open",function(){a._receiver.removeAllListeners("drain"),a._receiver.on("drain",i)}):(a._receiver.removeAllListeners("drain"),a._receiver.on("drain",i));let j=new d({...b,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return a.on("message",function(b){j.push(b)||(c=!1,a._socket.pause())}),a.once("error",function(a){j.destroyed||(h=!1,j.destroy(a))}),a.once("close",function(){j.destroyed||j.push(null)}),j._destroy=function(b,c){if(a.readyState===a.CLOSED){c(b),process.nextTick(e,j);return}let d=!1;a.once("error",function(a){d=!0,c(a)}),a.once("close",function(){d||c(b),process.nextTick(e,j)}),h&&a.terminate()},j._final=function(b){a.readyState===a.CONNECTING?a.once("open",function(){j._final(b)}):null!==a._socket&&(a._socket._writableState.finished?(b(),j._readableState.endEmitted&&j.destroy()):(a._socket.once("finish",function(){b()}),a.close()))},j._read=function(){(a.readyState===a.OPEN||a.readyState===a.CLOSING)&&!c&&(c=!0,a._receiver._writableState.needDrain||a._socket.resume())},j._write=function(b,c,d){a.readyState===a.CONNECTING?a.once("open",function(){j._write(b,c,d)}):a.send(b,d)},j.on("end",f),j.on("error",g),j}},356492,(a,b,c)=>{"use strict";let d=a.r(427699),e=a.r(921517);a.r(524836),a.r(504446),a.r(755004);let{createHash:f}=a.r(254799),g=a.r(90739),h=a.r(413523),{format:i,parse:j}=a.r(852882),{GUID:k,kWebSocket:l}=a.r(783855),m=/^[+/0-9A-Za-z]{22}==$/;function o(a){a._state=2,a.emit("close")}function p(){this.destroy()}function q(a,b,c,d){a.writable&&(c=c||e.STATUS_CODES[b],d={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(c),...d},a.write(`HTTP/1.1 ${b} ${e.STATUS_CODES[b]}\r
`+Object.keys(d).map(a=>`${a}: ${d[a]}`).join("\r\n")+"\r\n\r\n"+c)),a.removeListener("error",p),a.destroy()}function r(a){return a.trim()}b.exports=class extends d{constructor(a,b){if(super(),null==(a={maxPayload:0x6400000,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,...a}).port&&!a.server&&!a.noServer||null!=a.port&&(a.server||a.noServer)||a.server&&a.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=a.port?(this._server=e.createServer((a,b)=>{let c=e.STATUS_CODES[426];b.writeHead(426,{"Content-Length":c.length,"Content-Type":"text/plain"}),b.end(c)}),this._server.listen(a.port,a.host,a.backlog,b)):a.server&&(this._server=a.server),this._server){const a=this.emit.bind(this,"connection");this._removeListeners=function(a,b){for(let c of Object.keys(b))a.on(c,b[c]);return function(){for(let c of Object.keys(b))a.removeListener(c,b[c])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(b,c,d)=>{this.handleUpgrade(b,c,d,a)}})}!0===a.perMessageDeflate&&(a.perMessageDeflate={}),a.clientTracking&&(this.clients=new Set),this.options=a,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(a){if(a&&this.once("close",a),2===this._state)return void process.nextTick(o,this);if(1===this._state)return;if(this._state=1,this.clients)for(let a of this.clients)a.terminate();let b=this._server;b&&(this._removeListeners(),this._removeListeners=this._server=null,null!=this.options.port)?b.close(o.bind(void 0,this)):process.nextTick(o,this)}shouldHandle(a){if(this.options.path){let b=a.url.indexOf("?");if((-1!==b?a.url.slice(0,b):a.url)!==this.options.path)return!1}return!0}handleUpgrade(a,b,c,d){b.on("error",p);let e=void 0!==a.headers["sec-websocket-key"]&&a.headers["sec-websocket-key"].trim(),f=a.headers.upgrade,h=+a.headers["sec-websocket-version"],i={};if("GET"!==a.method||void 0===f||"websocket"!==f.toLowerCase()||!e||!m.test(e)||8!==h&&13!==h||!this.shouldHandle(a))return q(b,400);if(this.options.perMessageDeflate){let c=new g(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let b=j(a.headers["sec-websocket-extensions"]);b[g.extensionName]&&(c.accept(b[g.extensionName]),i[g.extensionName]=c)}catch(a){return q(b,400)}}if(this.options.verifyClient){let f={origin:a.headers[`${8===h?"sec-websocket-origin":"origin"}`],secure:!!(a.socket.authorized||a.socket.encrypted),req:a};if(2===this.options.verifyClient.length)return void this.options.verifyClient(f,(f,g,h,j)=>{if(!f)return q(b,g||401,h,j);this.completeUpgrade(e,i,a,b,c,d)});if(!this.options.verifyClient(f))return q(b,401)}this.completeUpgrade(e,i,a,b,c,d)}completeUpgrade(a,b,c,d,e,j){if(!d.readable||!d.writable)return d.destroy();if(d[l])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return q(d,503);let m=f("sha1").update(a+k).digest("base64"),o=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${m}`],s=new h(null),t=c.headers["sec-websocket-protocol"];if(t&&(t=t.split(",").map(r),(t=this.options.handleProtocols?this.options.handleProtocols(t,c):t[0])&&(o.push(`Sec-WebSocket-Protocol: ${t}`),s._protocol=t)),b[g.extensionName]){let a=b[g.extensionName].params,c=i({[g.extensionName]:[a]});o.push(`Sec-WebSocket-Extensions: ${c}`),s._extensions=b}this.emit("headers",o,c),d.write(o.concat("\r\n").join("\r\n")),d.removeListener("error",p),s.setSocket(d,e,this.options.maxPayload),this.clients&&(this.clients.add(s),s.on("close",()=>this.clients.delete(s))),j(s,c)}}},769084,(a,b,c)=>{"use strict";let d=a.r(413523);d.createWebSocketStream=a.r(127493),d.Server=a.r(356492),d.Receiver=a.r(303833),d.Sender=a.r(218307),b.exports=d},837591,(a,b,c)=>{let d=a.r(671277),e=d.default||d,f=function(a,b){return/^\/\//.test(a)&&(a="https:"+a),e.call(this,a,b)};f.ponyfill=!0,b.exports=c=f,c.fetch=f,c.Headers=d.Headers,c.Request=d.Request,c.Response=d.Response,c.default=f},109260,a=>{"use strict";let b;var c=a.i(427699),d=a.i(241958),e=a.i(424291),f=a.i(31620),g=a.i(474045),h=a.i(673620),i=a.i(920275),j=a.i(832819),k=a.i(463644);let l=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var o=f-e;o!==f&&0===g[o];)o++;for(var p=new Uint8Array(d+(f-o)),q=d;o!==f;)p[q++]=g[o++];return p}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,o=g-1;(0!==l||m<d)&&-1!==o;o--,m++)l+=256*j[o]>>>0,j[o]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var p=g-d;p!==g&&0===j[p];)p++;for(var q=i.repeat(c);p<g;++p)q+=a.charAt(j[p]);return q},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}},m=new Uint8Array(0),o=a=>a.reduce((a,b)=>a+b.toString(16).padStart(2,"0"),""),p=a=>{let b=a.match(/../g);return b?new Uint8Array(b.map(a=>parseInt(a,16))):m},q=(a,b)=>{if(a===b)return!0;if(a.byteLength!==b.byteLength)return!1;for(let c=0;c<a.byteLength;c++)if(a[c]!==b[c])return!1;return!0},r=a=>{if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")},s=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),t=a=>new TextEncoder().encode(a),u=a=>new TextDecoder().decode(a);a.s(["coerce",()=>r,"empty",()=>m,"equals",()=>q,"fromHex",()=>p,"fromString",()=>t,"isBinary",()=>s,"toHex",()=>o,"toString",()=>u],50917);class v{constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class w{constructor(a,b,c){if(this.name=a,this.prefix=b,void 0===b.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=b.codePointAt(0),this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return y(this,a)}}class x{constructor(a){this.decoders=a}or(a){return y(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let y=(a,b)=>new x({...a.decoders||{[a.prefix]:a},...b.decoders||{[b.prefix]:b}});class z{constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new v(a,b,c),this.decoder=new w(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}let A=({name:a,prefix:b,encode:c,decode:d})=>new z(a,b,c,d),B=({prefix:a,name:b,alphabet:c})=>{let{encode:d,decode:e}=l(c,b);return A({prefix:a,name:b,encode:d,decode:a=>r(e(a))})},C=({name:a,prefix:b,bitsPerChar:c,alphabet:d})=>A({prefix:b,name:a,encode:a=>((a,b,c)=>{let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(g&&(f+=b[e&h<<c-g]),d)for(;f.length*c&7;)f+="=";return f})(a,d,c),decode:b=>((a,b,c,d)=>{let e={};for(let a=0;a<b.length;++a)e[b[a]]=a;let f=a.length;for(;"="===a[f-1];)--f;let g=new Uint8Array(f*c/8|0),h=0,i=0,j=0;for(let b=0;b<f;++b){let f=e[a[b]];if(void 0===f)throw SyntaxError(`Non-${d} character`);i=i<<c|f,(h+=c)>=8&&(h-=8,g[j++]=255&i>>h)}if(h>=c||255&i<<8-h)throw SyntaxError("Unexpected end of data");return g})(b,d,c,a)}),D=A({prefix:"\0",name:"identity",encode:a=>u(a),decode:a=>t(a)});a.s(["identity",0,D],88214);var E=a.i(88214);let F=C({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});a.s(["base2",0,F],383220);var G=a.i(383220);let H=C({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});a.s(["base8",0,H],301516);var I=a.i(301516);let J=B({prefix:"9",name:"base10",alphabet:"0123456789"});a.s(["base10",0,J],914868);var K=a.i(914868);let L=C({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),M=C({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});a.s(["base16",0,L,"base16upper",0,M],174758);var N=a.i(174758);let O=C({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),P=C({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Q=C({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),R=C({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),S=C({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),T=C({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),U=C({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),V=C({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),W=C({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});a.s(["base32",0,O,"base32hex",0,S,"base32hexpad",0,U,"base32hexpadupper",0,V,"base32hexupper",0,T,"base32pad",0,Q,"base32padupper",0,R,"base32upper",0,P,"base32z",0,W],896527);var X=a.i(896527);let Y=B({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Z=B({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});a.s(["base36",0,Y,"base36upper",0,Z],199143);var $=a.i(199143);let _=B({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),aa=B({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});a.s(["base58btc",0,_,"base58flickr",0,aa],142013);var ab=a.i(142013);let ac=C({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ad=C({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ae=C({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),af=C({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});a.s(["base64",0,ac,"base64pad",0,ad,"base64url",0,ae,"base64urlpad",0,af],611116);var ag=a.i(611116);let ah=Array.from("\uD83D\uDE80\uD83E\uDE90\uD83D\uDEF0\uD83C\uDF0C\uD83C\uDF11\uD83C\uDF12\uD83C\uDF13\uD83C\uDF14\uD83C\uDF15\uD83C\uDF16\uD83C\uDF17\uD83C\uDF18\uD83C\uDF0D\uD83C\uDF0F\uD83C\uDF0E\uD83D\uDC09\uD83D\uDCBB\uD83D\uDDA5\uD83D\uDCBE\uD83D\uDCBF\uD83D\uDE02\uD83D\uDE0D\uD83E\uDD23\uD83D\uDE0A\uD83D\uDE4F\uD83D\uDC95\uD83D\uDE2D\uD83D\uDE18\uD83D\uDC4D\uD83D\uDE05\uD83D\uDC4F\uD83D\uDE01\uD83D\uDD25\uD83E\uDD70\uD83D\uDC94\uD83D\uDC96\uD83D\uDC99\uD83D\uDE22\uD83E\uDD14\uD83D\uDE06\uD83D\uDE44\uD83D\uDCAA\uD83D\uDE09\uD83D\uDC4C\uD83E\uDD17\uD83D\uDC9C\uD83D\uDE14\uD83D\uDE0E\uD83D\uDE07\uD83C\uDF39\uD83E\uDD26\uD83C\uDF89\uD83D\uDC9E\uD83E\uDD37\uD83D\uDE31\uD83D\uDE0C\uD83C\uDF38\uD83D\uDE4C\uD83D\uDE0B\uD83D\uDC97\uD83D\uDC9A\uD83D\uDE0F\uD83D\uDC9B\uD83D\uDE42\uD83D\uDC93\uD83E\uDD29\uD83D\uDE04\uD83D\uDE00\uD83D\uDDA4\uD83D\uDE03\uD83D\uDCAF\uD83D\uDE48\uD83D\uDC47\uD83C\uDFB6\uD83D\uDE12\uD83E\uDD2D\uD83D\uDE1C\uD83D\uDC8B\uD83D\uDC40\uD83D\uDE2A\uD83D\uDE11\uD83D\uDCA5\uD83D\uDE4B\uD83D\uDE1E\uD83D\uDE29\uD83D\uDE21\uD83E\uDD2A\uD83D\uDC4A\uD83E\uDD73\uD83D\uDE25\uD83E\uDD24\uD83D\uDC49\uD83D\uDC83\uD83D\uDE33\uD83D\uDE1A\uD83D\uDE1D\uD83D\uDE34\uD83C\uDF1F\uD83D\uDE2C\uD83D\uDE43\uD83C\uDF40\uD83C\uDF37\uD83D\uDE3B\uD83D\uDE13\uD83E\uDD7A\uD83C\uDF08\uD83D\uDE08\uD83E\uDD18\uD83D\uDCA6\uD83D\uDE23\uD83C\uDFC3\uD83D\uDC90\uD83C\uDF8A\uD83D\uDC98\uD83D\uDE20\uD83D\uDE15\uD83C\uDF3A\uD83C\uDF82\uD83C\uDF3B\uD83D\uDE10\uD83D\uDD95\uD83D\uDC9D\uD83D\uDE4A\uD83D\uDE39\uD83D\uDDE3\uD83D\uDCAB\uD83D\uDC80\uD83D\uDC51\uD83C\uDFB5\uD83E\uDD1E\uD83D\uDE1B\uD83D\uDD34\uD83D\uDE24\uD83C\uDF3C\uD83D\uDE2B\uD83E\uDD19\uD83C\uDFC6\uD83E\uDD2B\uD83D\uDC48\uD83D\uDE2E\uD83D\uDE46\uD83C\uDF7B\uD83C\uDF43\uD83D\uDC36\uD83D\uDC81\uD83D\uDE32\uD83C\uDF3F\uD83E\uDDE1\uD83C\uDF81\uD83C\uDF1E\uD83C\uDF88\uD83D\uDC4B\uD83D\uDE30\uD83E\uDD28\uD83D\uDE36\uD83E\uDD1D\uD83D\uDEB6\uD83D\uDCB0\uD83C\uDF53\uD83D\uDCA2\uD83E\uDD1F\uD83D\uDE41\uD83D\uDEA8\uD83D\uDCA8\uD83E\uDD2C\uD83C\uDF80\uD83C\uDF7A\uD83E\uDD13\uD83D\uDE19\uD83D\uDC9F\uD83C\uDF31\uD83D\uDE16\uD83D\uDC76\uD83E\uDD74\uD83D\uDC8E\uD83D\uDCB8\uD83D\uDE28\uD83C\uDF1A\uD83E\uDD8B\uD83D\uDE37\uD83D\uDD7A\uD83D\uDE45\uD83D\uDE1F\uD83D\uDE35\uD83D\uDC4E\uD83E\uDD32\uD83E\uDD20\uD83E\uDD27\uD83D\uDCCC\uD83D\uDD35\uD83D\uDC85\uD83E\uDDD0\uD83D\uDC3E\uD83C\uDF52\uD83D\uDE17\uD83E\uDD11\uD83C\uDF0A\uD83E\uDD2F\uD83D\uDC37\uD83D\uDCA7\uD83D\uDE2F\uD83D\uDC86\uD83D\uDC46\uD83C\uDFA4\uD83D\uDE47\uD83C\uDF51\uD83C\uDF34\uD83D\uDCA3\uD83D\uDC38\uD83D\uDC8C\uD83D\uDCCD\uD83E\uDD40\uD83E\uDD22\uD83D\uDC45\uD83D\uDCA1\uD83D\uDCA9\uD83D\uDC50\uD83D\uDCF8\uD83D\uDC7B\uD83E\uDD10\uD83E\uDD2E\uD83C\uDFBC\uD83E\uDD75\uD83D\uDEA9\uD83C\uDF4E\uD83C\uDF4A\uD83D\uDC7C\uD83D\uDC8D\uD83D\uDCE3\uD83E\uDD42"),ai=ah.reduce((a,b,c)=>(a[c]=b,a),[]),aj=ah.reduce((a,b,c)=>(a[b.codePointAt(0)]=c,a),[]),ak=A({prefix:"\uD83D\uDE80",name:"base256emoji",encode:function(a){return a.reduce((a,b)=>a+=ai[b],"")},decode:function(a){let b=[];for(let c of a){let a=aj[c.codePointAt(0)];if(void 0===a)throw Error(`Non-base256emoji character: ${c}`);b.push(a)}return new Uint8Array(b)}});a.s(["base256emoji",0,ak],877756);var al=a.i(877756),am=a.i(254799);function an(a,b,c){b=b||[];for(var d=c=c||0;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,an.bytes=c-d+1,b}function ao(a,b){var c,d=0,b=b||0,e=0,f=b,g=a.length;do{if(f>=g)throw ao.bytes=0,RangeError("Could not decode varint");c=a[f++],d+=e<28?(127&c)<<e:(127&c)*Math.pow(2,e),e+=7}while(c>=128)return ao.bytes=f-b,d}let ap=(a,b=0)=>[ao(a,b),ao.bytes],aq=(a,b,c=0)=>(an(a,b,c),b),ar=a=>{var b;return(b=a)<128?1:b<16384?2:b<2097152?3:b<0x10000000?4:b<0x800000000?5:b<0x40000000000?6:b<0x2000000000000?7:b<0x100000000000000?8:b<0x8000000000000000?9:10};a.s(["decode",0,ap,"encodeTo",0,aq,"encodingLength",0,ar],701405);let as=(a,b)=>{let c=b.byteLength,d=ar(a),e=d+ar(c),f=new Uint8Array(e+c);return aq(a,f,0),aq(c,f,d),f.set(b,e),new av(a,c,b,f)},at=a=>{let b=r(a),[c,d]=ap(b),[e,f]=ap(b.subarray(d)),g=b.subarray(d+f);if(g.byteLength!==e)throw Error("Incorrect length");return new av(c,e,g,b)},au=(a,b)=>a===b||a.code===b.code&&a.size===b.size&&q(a.bytes,b.bytes);class av{constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}a.s(["Digest",()=>av,"create",0,as,"decode",0,at,"equals",0,au],847321);let aw=({name:a,code:b,encode:c})=>new ax(a,b,c);class ax{constructor(a,b,c){this.name=a,this.code=b,this.encode=c}digest(a){if(a instanceof Uint8Array){let b=this.encode(a);return b instanceof Uint8Array?as(this.code,b):b.then(a=>as(this.code,a))}throw Error("Unknown type, must be binary type")}}a.s(["Hasher",()=>ax,"from",0,aw],796266);let ay=aw({name:"sha2-256",code:18,encode:a=>r(am.default.createHash("sha256").update(a).digest())}),az=aw({name:"sha2-512",code:19,encode:a=>r(am.default.createHash("sha512").update(a).digest())});a.s(["sha256",0,ay,"sha512",0,az],498857);var aA=a.i(498857);a.s(["identity",0,{code:0,name:"identity",encode:r,digest:a=>as(0,r(a))}],855141);var aB=a.i(855141);a.s(["code",0,85,"decode",0,a=>r(a),"encode",0,a=>r(a),"name",0,"raw"],420966),a.i(420966);let aC=new TextEncoder,aD=new TextDecoder;a.s(["code",0,512,"decode",0,a=>JSON.parse(aD.decode(a)),"encode",0,a=>aC.encode(JSON.stringify(a)),"name",0,"json"],573599),a.i(573599);class aE{constructor(a,b,c,d){this.code=b,this.version=a,this.multihash=c,this.bytes=d,this.byteOffset=d.byteOffset,this.byteLength=d.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:aN,byteLength:aN,code:aM,version:aM,multihash:aM,bytes:aM,_baseCache:aN,asCID:aN})}toV0(){if(0===this.version)return this;{let{code:a,multihash:b}=this;if(a!==aI)throw Error("Cannot convert a non dag-pb CID to CIDv0");if(b.code!==aJ)throw Error("Cannot convert non sha2-256 multihash CID to CIDv0");return aE.createV0(b)}}toV1(){switch(this.version){case 0:{let{code:a,digest:b}=this.multihash,c=as(a,b);return aE.createV1(this.code,c)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(a){return a&&this.code===a.code&&this.version===a.version&&au(this.multihash,a.multihash)}toString(a){let{bytes:b,version:c,_baseCache:d}=this;return 0===c?aG(b,d,a||_.encoder):aH(b,d,a||O.encoder)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(a){return aO(/^0\.0/,aP),!!(a&&(a[aL]||a.asCID===a))}get toBaseEncodedString(){throw Error("Deprecated, use .toString()")}get codec(){throw Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw Error('"multibaseName" property is deprecated')}get prefix(){throw Error('"prefix" property is deprecated')}static asCID(a){if(a instanceof aE)return a;if(null!=a&&a.asCID===a){let{version:b,code:c,multihash:d,bytes:e}=a;return new aE(b,c,d,e||aK(b,c,d.bytes))}if(null==a||!0!==a[aL])return null;{let{version:b,multihash:c,code:d}=a,e=at(c);return aE.create(b,d,e)}}static create(a,b,c){if("number"!=typeof b)throw Error("String codecs are no longer supported");switch(a){case 0:if(b===aI)return new aE(a,b,c,c.bytes);throw Error(`Version 0 CID must use dag-pb (code: ${aI}) block encoding`);case 1:{let d=aK(a,b,c.bytes);return new aE(a,b,c,d)}default:throw Error("Invalid version")}}static createV0(a){return aE.create(0,aI,a)}static createV1(a,b){return aE.create(1,a,b)}static decode(a){let[b,c]=aE.decodeFirst(a);if(c.length)throw Error("Incorrect length");return b}static decodeFirst(a){let b=aE.inspectBytes(a),c=b.size-b.multihashSize,d=r(a.subarray(c,c+b.multihashSize));if(d.byteLength!==b.multihashSize)throw Error("Incorrect length");let e=d.subarray(b.multihashSize-b.digestSize),f=new av(b.multihashCode,b.digestSize,e,d);return[0===b.version?aE.createV0(f):aE.createV1(b.codec,f),a.subarray(b.size)]}static inspectBytes(a){let b=0,c=()=>{let[c,d]=ap(a.subarray(b));return b+=d,c},d=c(),e=aI;if(18===d?(d=0,b=0):1===d&&(e=c()),0!==d&&1!==d)throw RangeError(`Invalid CID version ${d}`);let f=b,g=c(),h=c(),i=b+h;return{version:d,codec:e,multihashCode:g,digestSize:h,multihashSize:i-f,size:i}}static parse(a,b){let[c,d]=aF(a,b),e=aE.decode(d);return e._baseCache.set(c,a),e}}let aF=(a,b)=>{switch(a[0]){case"Q":{let c=b||_;return[_.prefix,c.decode(`${_.prefix}${a}`)]}case _.prefix:{let c=b||_;return[_.prefix,c.decode(a)]}case O.prefix:{let c=b||O;return[O.prefix,c.decode(a)]}default:if(null==b)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[a[0],b.decode(a)]}},aG=(a,b,c)=>{let{prefix:d}=c;if(d!==_.prefix)throw Error(`Cannot string encode V0 in ${c.name} encoding`);let e=b.get(d);if(null!=e)return e;{let e=c.encode(a).slice(1);return b.set(d,e),e}},aH=(a,b,c)=>{let{prefix:d}=c,e=b.get(d);if(null!=e)return e;{let e=c.encode(a);return b.set(d,e),e}},aI=112,aJ=18,aK=(a,b,c)=>{let d=ar(a),e=d+ar(b),f=new Uint8Array(e+c.byteLength);return aq(a,f,0),aq(b,f,d),f.set(c,e),f},aL=Symbol.for("@ipld/js-cid/CID"),aM={writable:!1,configurable:!1,enumerable:!0},aN={writable:!1,enumerable:!1,configurable:!1},aO=(a,b)=>{if(a.test("0.0.0-dev"))console.warn(b);else throw Error(b)},aP=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`;a.i(701405),a.i(50917),a.i(796266),a.i(847321);let aQ={...E,...G,...I,...K,...N,...X,...$,...ab,...ag,...al};function aR(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}({...aA,...aB});let aS=aR("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),aT=aR("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=function(a=0){if(null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe){var b;return b=globalThis.Buffer.allocUnsafe(a),null!=globalThis.Buffer?new Uint8Array(b.buffer,b.byteOffset,b.byteLength):b}return new Uint8Array(a)}((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),aU={utf8:aS,"utf-8":aS,hex:aQ.base16,latin1:aT,ascii:aT,binary:aT,...aQ},aV="INTERNAL_ERROR",aW="SERVER_ERROR",aX=[-32700,-32600,-32601,-32602,-32603],aY={PARSE_ERROR:{code:-32700,message:"Parse error"},INVALID_REQUEST:{code:-32600,message:"Invalid Request"},METHOD_NOT_FOUND:{code:-32601,message:"Method not found"},INVALID_PARAMS:{code:-32602,message:"Invalid params"},[aV]:{code:-32603,message:"Internal error"},[aW]:{code:-32e3,message:"Server error"}};function aZ(a){return Object.keys(aY).includes(a)?aY[a]:aY[aW]}function a$(a,b,c){return a.message.includes("getaddrinfo ENOTFOUND")||a.message.includes("connect ECONNREFUSED")?Error(`Unavailable ${c} RPC url at ${b}`):a}var a_=a.i(42289);function a0(a=3){return Date.now()*Math.pow(10,a)+Math.floor(Math.random()*Math.pow(10,a))}function a1(a=6){return BigInt(a0(a))}function a2(a,b,c){return{id:c||a0(),jsonrpc:"2.0",method:a,params:b}}function a3(a,b){return{id:a,jsonrpc:"2.0",result:b}}function a4(a,b,c){var d,e,f,g;let h;return{id:a,jsonrpc:"2.0",error:(d=b,e=c,void 0===d?aZ(aV):("string"==typeof d&&(d=Object.assign(Object.assign({},aZ(aW)),{message:d})),void 0!==e&&(d.data=e),f=d.code,aX.includes(f)&&(g=d.code,d=(h=Object.values(aY).find(a=>a.code===g))||aY[aW]),d))}}a_.isNode;class a5{}class a6 extends a5{constructor(){super()}}class a7 extends a6{constructor(a){super()}}function a8(a,b){let c=function(a){let b=a.match(RegExp(/^\w+:/,"gi"));if(b&&b.length)return b[0]}(a);return void 0!==c&&new RegExp(b).test(c)}function a9(a){return a8(a,"^https?:")}function ba(a){return a8(a,"^wss?:")}function bb(a){return"object"==typeof a&&"id"in a&&"jsonrpc"in a&&"2.0"===a.jsonrpc}function bc(a){return bb(a)&&"method"in a}function bd(a){return bb(a)&&(be(a)||bf(a))}function be(a){return"result"in a}function bf(a){return"error"in a}class bg extends a7{constructor(a){super(a),this.events=new c.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(a),this.connection.connected&&this.registerEventListeners()}async connect(a=this.connection){await this.open(a)}async disconnect(){await this.close()}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async request(a,b){return this.requestStrict(a2(a.method,a.params||[],a.id||a1().toString()),b)}async requestStrict(a,b){return new Promise(async(c,d)=>{if(!this.connection.connected)try{await this.open()}catch(a){d(a)}this.events.on(`${a.id}`,a=>{bf(a)?d(a.error):c(a.result)});try{await this.connection.send(a,b)}catch(a){d(a)}})}setConnection(a=this.connection){return a}onPayload(a){this.events.emit("payload",a),bd(a)?this.events.emit(`${a.id}`,a):this.events.emit("message",{type:a.method,data:a.params})}onClose(a){a&&3e3===a.code&&this.events.emit("error",Error(`WebSocket connection closed abnormally with code: ${a.code} ${a.reason?`(${a.reason})`:""}`)),this.events.emit("disconnect")}async open(a=this.connection){this.connection===a&&this.connection.connected||(this.connection.connected&&this.close(),"string"==typeof a&&(await this.connection.open(a),a=this.connection),this.connection=this.setConnection(a),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",a=>this.onPayload(a)),this.connection.on("close",a=>this.onClose(a)),this.connection.on("error",a=>this.events.emit("error",a)),this.connection.on("register_error",a=>this.onClose()),this.hasRegisteredEventListeners=!0)}}let bh=a=>a.split("?")[0],bi="u">typeof WebSocket?WebSocket:"u">typeof a.g.WebSocket?a.g.WebSocket:"u">typeof self&&"u">typeof self.WebSocket?self.WebSocket:a.r(769084);class bj{constructor(a){if(this.url=a,this.events=new c.EventEmitter,this.registering=!1,!ba(a))throw Error(`Provided URL is not compatible with WebSocket connection: ${a}`);this.url=a}get connected(){return"u">typeof this.socket}get connecting(){return this.registering}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async open(a=this.url){await this.register(a)}async close(){return new Promise((a,b)=>{typeof this.socket>"u"?b(Error("Connection already closed")):(this.socket.onclose=b=>{this.onClose(b),a()},this.socket.close())})}async send(a){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send((0,i.safeJsonStringify)(a))}catch(b){this.onError(a.id,b)}}register(b=this.url){if(!ba(b))throw Error(`Provided URL is not compatible with WebSocket connection: ${b}`);if(this.registering){let a=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=a||this.events.listenerCount("open")>=a)&&this.events.setMaxListeners(a+1),new Promise((a,b)=>{this.events.once("register_error",a=>{this.resetMaxListeners(),b(a)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return b(Error("WebSocket connection is missing or invalid"));a(this.socket)})})}return this.url=b,this.registering=!0,new Promise((c,d)=>{let e=(0,a_.isReactNative)()?void 0:{rejectUnauthorized:!RegExp("wss?://localhost(:d{2,5})?").test(b)},f=new bi(b,[],e);"u">typeof WebSocket||"u">typeof a.g.WebSocket||"u">typeof self&&"u">typeof self.WebSocket?f.onerror=a=>{d(this.emitError(a.error))}:f.on("error",a=>{d(this.emitError(a))}),f.onopen=()=>{this.onOpen(f),c(f)}})}onOpen(a){a.onmessage=a=>this.onPayload(a),a.onclose=a=>this.onClose(a),this.socket=a,this.registering=!1,this.events.emit("open")}onClose(a){this.socket=void 0,this.registering=!1,this.events.emit("close",a)}onPayload(a){if(typeof a.data>"u")return;let b="string"==typeof a.data?(0,i.safeJsonParse)(a.data):a.data;this.events.emit("payload",b)}onError(a,b){let c=this.parseError(b),d=a4(a,c.message||c.toString());this.events.emit("payload",d)}parseError(a,b=this.url){return a$(a,bh(b),"WS")}resetMaxListeners(){this.events.getMaxListeners()>10&&this.events.setMaxListeners(10)}emitError(a){let b=this.parseError(Error(a?.message||`WebSocket connection failed for host: ${bh(this.url)}`));return this.events.emit("register_error",b),b}}var bk=a.i(679628);let bl="core",bm=`wc@2:${bl}:`,bn={database:":memory:"},bo="client_ed25519_seed",bp=h.ONE_DAY,bq=h.SIX_HOURS,br="wss://relay.walletconnect.org",bs="relayer_message",bt="relayer_message_ack",bu="relayer_connection_stalled",bv="relayer_publish",bw="payload",bx="connect",by="disconnect",bz="error",bA="2.23.0",bB="link_mode",bC="relay",bD="inbound",bE="WALLETCONNECT_LINK_MODE_APPS",bF="subscription_created",bG="subscription_deleted",bH=(h.THIRTY_DAYS,h.FIVE_SECONDS,h.THIRTY_DAYS,{wc_pairingDelete:{req:{ttl:h.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:h.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:h.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:h.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:h.ONE_DAY,prompt:!1,tag:0},res:{ttl:h.ONE_DAY,prompt:!1,tag:0}}}),bI="pairing_create",bJ="pairing_delete",bK="history_created",bL="history_updated",bM="history_deleted",bN="expirer_created",bO="expirer_deleted",bP="expirer_expired",bQ=(h.ONE_DAY,"https://verify.walletconnect.org"),bR=`${bQ}/v3`,bS=["https://verify.walletconnect.com",bQ],bT="malformed_pairing_uri",bU="session_approve_started";var bV=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var o=f-e;o!==f&&0===g[o];)o++;for(var p=new Uint8Array(d+(f-o)),q=d;o!==f;)p[q++]=g[o++];return p}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,o=g-1;(0!==l||m<d)&&-1!==o;o--,m++)l+=256*j[o]>>>0,j[o]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var p=g-d;p!==g&&0===j[p];)p++;for(var q=i.repeat(c);p<g;++p)q+=a.charAt(j[p]);return q},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}};let bW=a=>{if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")};class bX{constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class bY{constructor(a,b,c){if(this.name=a,this.prefix=b,void 0===b.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=b.codePointAt(0),this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return b$(this,a)}}class bZ{constructor(a){this.decoders=a}or(a){return b$(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let b$=(a,b)=>new bZ({...a.decoders||{[a.prefix]:a},...b.decoders||{[b.prefix]:b}});class b_{constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new bX(a,b,c),this.decoder=new bY(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}let b0=({name:a,prefix:b,encode:c,decode:d})=>new b_(a,b,c,d),b1=({prefix:a,name:b,alphabet:c})=>{let{encode:d,decode:e}=bV(c,b);return b0({prefix:a,name:b,encode:d,decode:a=>bW(e(a))})},b2=({name:a,prefix:b,bitsPerChar:c,alphabet:d})=>b0({prefix:b,name:a,encode:a=>((a,b,c)=>{let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(g&&(f+=b[e&h<<c-g]),d)for(;f.length*c&7;)f+="=";return f})(a,d,c),decode:b=>((a,b,c,d)=>{let e={};for(let a=0;a<b.length;++a)e[b[a]]=a;let f=a.length;for(;"="===a[f-1];)--f;let g=new Uint8Array(f*c/8|0),h=0,i=0,j=0;for(let b=0;b<f;++b){let f=e[a[b]];if(void 0===f)throw SyntaxError(`Non-${d} character`);i=i<<c|f,(h+=c)>=8&&(h-=8,g[j++]=255&i>>h)}if(h>=c||255&i<<8-h)throw SyntaxError("Unexpected end of data");return g})(b,d,c,a)});var b3=Object.freeze({__proto__:null,identity:b0({prefix:"\0",name:"identity",encode:a=>new TextDecoder().decode(a),decode:a=>new TextEncoder().encode(a)})}),b4=Object.freeze({__proto__:null,base2:b2({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})}),b5=Object.freeze({__proto__:null,base8:b2({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})}),b6=Object.freeze({__proto__:null,base10:b1({prefix:"9",name:"base10",alphabet:"0123456789"})}),b7=Object.freeze({__proto__:null,base16:b2({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper:b2({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})}),b8=Object.freeze({__proto__:null,base32:b2({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper:b2({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad:b2({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper:b2({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex:b2({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper:b2({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad:b2({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper:b2({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z:b2({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})}),b9=Object.freeze({__proto__:null,base36:b1({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper:b1({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})}),ca=Object.freeze({__proto__:null,base58btc:b1({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr:b1({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})}),cb=Object.freeze({__proto__:null,base64:b2({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad:b2({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url:b2({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad:b2({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});let cc=Array.from(""),cd=cc.reduce((a,b,c)=>(a[c]=b,a),[]),ce=cc.reduce((a,b,c)=>(a[b.codePointAt(0)]=c,a),[]);var cf=Object.freeze({__proto__:null,base256emoji:b0({prefix:"",name:"base256emoji",encode:function(a){return a.reduce((a,b)=>a+=cd[b],"")},decode:function(a){let b=[];for(let c of a){let a=ce[c.codePointAt(0)];if(void 0===a)throw Error(`Non-base256emoji character: ${c}`);b.push(a)}return new Uint8Array(b)}})});function cg(a,b,c){b=b||[],c=c||0;for(var d=c;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,cg.bytes=c-d+1,b}var ch=function(a){return a<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:a<0x800000000?5:a<0x40000000000?6:a<0x2000000000000?7:a<0x100000000000000?8:a<0x8000000000000000?9:10};let ci=(a,b,c=0)=>(cg(a,b,c),b),cj=(a,b)=>{let c=b.byteLength,d=ch(a),e=d+ch(c),f=new Uint8Array(e+c);return ci(a,f,0),ci(c,f,d),f.set(b,e),new ck(a,c,b,f)};class ck{constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}let cl=({name:a,code:b,encode:c})=>new cm(a,b,c);class cm{constructor(a,b,c){this.name=a,this.code=b,this.encode=c}digest(a){if(a instanceof Uint8Array){let b=this.encode(a);return b instanceof Uint8Array?cj(this.code,b):b.then(a=>cj(this.code,a))}throw Error("Unknown type, must be binary type")}}let cn=a=>async b=>new Uint8Array(await crypto.subtle.digest(a,b));var co=Object.freeze({__proto__:null,sha256:cl({name:"sha2-256",code:18,encode:cn("SHA-256")}),sha512:cl({name:"sha2-512",code:19,encode:cn("SHA-512")})}),cp=Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:bW,digest:a=>cj(0,bW(a))}});new TextEncoder,new TextDecoder;let cq={...b3,...b4,...b5,...b6,...b7,...b8,...b9,...ca,...cb,...cf};function cr(a){return null!=globalThis.Buffer?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function cs(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}({...co,...cp});let ct=cs("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),cu=cs("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=function(a=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?cr(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),cv={utf8:ct,"utf-8":ct,hex:cq.base16,latin1:cu,ascii:cu,binary:cu,...cq};var cw=Object.defineProperty,cx=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?cw(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class cy{constructor(a,b){this.core=a,this.logger=b,cx(this,"keychain",new Map),cx(this,"name","keychain"),cx(this,"version","0.3"),cx(this,"initialized",!1),cx(this,"storagePrefix",bm),cx(this,"init",async()=>{if(!this.initialized){let a=await this.getKeyChain();"u">typeof a&&(this.keychain=a),this.initialized=!0}}),cx(this,"has",a=>(this.isInitialized(),this.keychain.has(a))),cx(this,"set",async(a,b)=>{this.isInitialized(),this.keychain.set(a,b),await this.persist()}),cx(this,"get",a=>{this.isInitialized();let b=this.keychain.get(a);if(typeof b>"u"){let{message:b}=(0,k.getInternalError)("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}),cx(this,"del",async a=>{this.isInitialized(),this.keychain.delete(a),await this.persist()}),this.core=a,this.logger=(0,f.generateChildLogger)(b,this.name)}get context(){return(0,f.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(a){await this.core.storage.setItem(this.storageKey,(0,k.mapToObj)(a))}async getKeyChain(){let a=await this.core.storage.getItem(this.storageKey);return"u">typeof a?(0,k.objToMap)(a):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:a}=(0,k.getInternalError)("NOT_INITIALIZED",this.name);throw Error(a)}}}var cz=Object.defineProperty,cA=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?cz(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class cB{constructor(a,b,c){this.core=a,this.logger=b,cA(this,"name","crypto"),cA(this,"keychain"),cA(this,"randomSessionIdentifier",(0,k.generateRandomBytes32)()),cA(this,"initialized",!1),cA(this,"clientId"),cA(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),cA(this,"hasKeys",a=>(this.isInitialized(),this.keychain.has(a))),cA(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;let a=await this.getClientSeed(),b=j.generateKeyPair(a),c=j.encodeIss(b.publicKey);return this.clientId=c,c}),cA(this,"generateKeyPair",()=>{this.isInitialized();let a=(0,k.generateKeyPair)();return this.setPrivateKey(a.publicKey,a.privateKey)}),cA(this,"signJWT",async a=>{this.isInitialized();let b=await this.getClientSeed(),c=j.generateKeyPair(b),d=this.randomSessionIdentifier;return await j.signJWT(d,a,bp,c)}),cA(this,"generateSharedKey",(a,b,c)=>{this.isInitialized();let d=this.getPrivateKey(a),e=(0,k.deriveSymKey)(d,b);return this.setSymKey(e,c)}),cA(this,"setSymKey",async(a,b)=>{this.isInitialized();let c=b||(0,k.hashKey)(a);return await this.keychain.set(c,a),c}),cA(this,"deleteKeyPair",async a=>{this.isInitialized(),await this.keychain.del(a)}),cA(this,"deleteSymKey",async a=>{this.isInitialized(),await this.keychain.del(a)}),cA(this,"encode",async(a,b,c)=>{this.isInitialized();let d=(0,k.validateEncoding)(c),e=(0,i.safeJsonStringify)(b);if((0,k.isTypeTwoEnvelope)(d))return(0,k.encodeTypeTwoEnvelope)(e,c?.encoding);if((0,k.isTypeOneEnvelope)(d)){let b=d.senderPublicKey,c=d.receiverPublicKey;a=await this.generateSharedKey(b,c)}let f=this.getSymKey(a),{type:g,senderPublicKey:h}=d;return(0,k.encrypt)({type:g,symKey:f,message:e,senderPublicKey:h,encoding:c?.encoding})}),cA(this,"decode",async(a,b,c)=>{this.isInitialized();let d=(0,k.validateDecoding)(b,c);if((0,k.isTypeTwoEnvelope)(d)){let a=(0,k.decodeTypeTwoEnvelope)(b,c?.encoding);return(0,i.safeJsonParse)(a)}if((0,k.isTypeOneEnvelope)(d)){let b=d.receiverPublicKey,c=d.senderPublicKey;a=await this.generateSharedKey(b,c)}try{let d=this.getSymKey(a),e=(0,k.decrypt)({symKey:d,encoded:b,encoding:c?.encoding});return(0,i.safeJsonParse)(e)}catch(b){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(b)}}),cA(this,"getPayloadType",(a,b=k.BASE64)=>{let c=(0,k.deserialize)({encoded:a,encoding:b});return(0,k.decodeTypeByte)(c.type)}),cA(this,"getPayloadSenderPublicKey",(a,b=k.BASE64)=>{let c=(0,k.deserialize)({encoded:a,encoding:b});return c.senderPublicKey?function(a,b="utf8"){let c=aU[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?globalThis.Buffer.from(a.buffer,a.byteOffset,a.byteLength).toString("utf8"):c.encoder.encode(a).substring(1)}(c.senderPublicKey,k.BASE16):void 0}),this.core=a,this.logger=(0,f.generateChildLogger)(b,this.name),this.keychain=c||new cy(this.core,this.logger)}get context(){return(0,f.getLoggerContext)(this.logger)}async setPrivateKey(a,b){return await this.keychain.set(a,b),a}getPrivateKey(a){return this.keychain.get(a)}async getClientSeed(){let a="";try{a=this.keychain.get(bo)}catch{a=(0,k.generateRandomBytes32)(),await this.keychain.set(bo,a)}return function(a,b="utf8"){let c=cv[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?cr(globalThis.Buffer.from(a,"utf-8")):c.decoder.decode(`${c.prefix}${a}`)}(a,"base16")}getSymKey(a){return this.keychain.get(a)}isInitialized(){if(!this.initialized){let{message:a}=(0,k.getInternalError)("NOT_INITIALIZED",this.name);throw Error(a)}}}var cC=Object.defineProperty,cD=Object.defineProperties,cE=Object.getOwnPropertyDescriptors,cF=Object.getOwnPropertySymbols,cG=Object.prototype.hasOwnProperty,cH=Object.prototype.propertyIsEnumerable,cI=(a,b,c)=>b in a?cC(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,cJ=(a,b,c)=>cI(a,"symbol"!=typeof b?b+"":b,c);class cK extends g.IMessageTracker{constructor(a,b){super(a,b),this.logger=a,this.core=b,cJ(this,"messages",new Map),cJ(this,"messagesWithoutClientAck",new Map),cJ(this,"name","messages"),cJ(this,"version","0.3"),cJ(this,"initialized",!1),cJ(this,"storagePrefix",bm),cJ(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let a=await this.getRelayerMessages();"u">typeof a&&(this.messages=a);let b=await this.getRelayerMessagesWithoutClientAck();"u">typeof b&&(this.messagesWithoutClientAck=b),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(a){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(a)}finally{this.initialized=!0}}}),cJ(this,"set",async(a,b,c)=>{this.isInitialized();let d=(0,k.hashMessage)(b),e=this.messages.get(a);if(typeof e>"u"&&(e={}),"u">typeof e[d])return d;if(e[d]=b,this.messages.set(a,e),c===bD){let c=this.messagesWithoutClientAck.get(a)||{};this.messagesWithoutClientAck.set(a,cD(((a,b)=>{for(var c in b||(b={}))cG.call(b,c)&&cI(a,c,b[c]);if(cF)for(var c of cF(b))cH.call(b,c)&&cI(a,c,b[c]);return a})({},c),cE({[d]:b})))}return await this.persist(),d}),cJ(this,"get",a=>{this.isInitialized();let b=this.messages.get(a);return typeof b>"u"&&(b={}),b}),cJ(this,"getWithoutAck",a=>{this.isInitialized();let b={};for(let c of a){let a=this.messagesWithoutClientAck.get(c)||{};b[c]=Object.values(a)}return b}),cJ(this,"has",(a,b)=>(this.isInitialized(),"u">typeof this.get(a)[(0,k.hashMessage)(b)])),cJ(this,"ack",async(a,b)=>{this.isInitialized();let c=this.messagesWithoutClientAck.get(a);if(typeof c>"u")return;let d=(0,k.hashMessage)(b);delete c[d],0===Object.keys(c).length?this.messagesWithoutClientAck.delete(a):this.messagesWithoutClientAck.set(a,c),await this.persist()}),cJ(this,"del",async a=>{this.isInitialized(),this.messages.delete(a),this.messagesWithoutClientAck.delete(a),await this.persist()}),this.logger=(0,f.generateChildLogger)(a,this.name),this.core=b}get context(){return(0,f.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(a){await this.core.storage.setItem(this.storageKey,(0,k.mapToObj)(a))}async setRelayerMessagesWithoutClientAck(a){await this.core.storage.setItem(this.storageKeyWithoutClientAck,(0,k.mapToObj)(a))}async getRelayerMessages(){let a=await this.core.storage.getItem(this.storageKey);return"u">typeof a?(0,k.objToMap)(a):void 0}async getRelayerMessagesWithoutClientAck(){let a=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return"u">typeof a?(0,k.objToMap)(a):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:a}=(0,k.getInternalError)("NOT_INITIALIZED",this.name);throw Error(a)}}}var cL=Object.defineProperty,cM=Object.defineProperties,cN=Object.getOwnPropertyDescriptors,cO=Object.getOwnPropertySymbols,cP=Object.prototype.hasOwnProperty,cQ=Object.prototype.propertyIsEnumerable,cR=(a,b,c)=>b in a?cL(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,cS=(a,b)=>{for(var c in b||(b={}))cP.call(b,c)&&cR(a,c,b[c]);if(cO)for(var c of cO(b))cQ.call(b,c)&&cR(a,c,b[c]);return a},cT=(a,b,c)=>cR(a,"symbol"!=typeof b?b+"":b,c);class cU extends g.IPublisher{constructor(a,b){super(a,b),this.relayer=a,this.logger=b,cT(this,"events",new c.EventEmitter),cT(this,"name","publisher"),cT(this,"queue",new Map),cT(this,"publishTimeout",(0,h.toMiliseconds)(h.ONE_MINUTE)),cT(this,"initialPublishTimeout",(0,h.toMiliseconds)(15*h.ONE_SECOND)),cT(this,"needsTransportRestart",!1),cT(this,"publish",async(a,b,c)=>{var d,e,f,g,h;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:a,message:b,opts:c}});let i=c?.ttl||bq,j=c?.prompt||!1,l=c?.tag||0,m=c?.id||a1().toString(),o=(0,k.getRelayProtocolApi)((0,k.getRelayProtocolName)().protocol),p={id:m,method:c?.publishMethod||o.publish,params:cS({topic:a,message:b,ttl:i,prompt:j,tag:l,attestation:c?.attestation},c?.tvf)},q=`Failed to publish payload, please try again. id:${m} tag:${l}`;try{(0,k.isUndefined)(null==(d=p.params)?void 0:d.prompt)&&(null==(e=p.params)||delete e.prompt),(0,k.isUndefined)(null==(f=p.params)?void 0:f.tag)&&(null==(g=p.params)||delete g.tag);let h=new Promise(async a=>{let b=({id:c})=>{var d;(null==(d=p.id)?void 0:d.toString())===c.toString()&&(this.removeRequestFromQueue(c),this.relayer.events.removeListener(bv,b),a())};this.relayer.events.on(bv,b);let d=(0,k.createExpiringPromise)(new Promise((a,b)=>{this.rpcPublish(p,c).then(a).catch(a=>{this.logger.warn(a,a?.message),b(a)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${m} tag:${l}`);try{await d,this.events.removeListener(bv,b)}catch(a){this.queue.set(m,{request:p,opts:c,attempt:1}),this.logger.warn(a,a?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:m,topic:a,message:b,opts:c}}),await (0,k.createExpiringPromise)(h,this.publishTimeout,q)}catch(a){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(a),null!=(h=c?.internal)&&h.throwOnFailedPublish)throw a}finally{this.queue.delete(m)}}),cT(this,"publishCustom",async a=>{var b,c,d,e,f;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:a});let{payload:g,opts:i={}}=a,{attestation:j,tvf:l,publishMethod:m,prompt:o,tag:p,ttl:q=h.FIVE_MINUTES}=i,r=i.id||a1().toString(),s=(0,k.getRelayProtocolApi)((0,k.getRelayProtocolName)().protocol),t=m||s.publish,u={id:r,method:t,params:cS(cM(cS({},g),cN({ttl:q,prompt:o,tag:p,attestation:j})),l)},v=`Failed to publish custom payload, please try again. id:${r} tag:${p}`;try{(0,k.isUndefined)(null==(b=u.params)?void 0:b.prompt)&&(null==(c=u.params)||delete c.prompt),(0,k.isUndefined)(null==(d=u.params)?void 0:d.tag)&&(null==(e=u.params)||delete e.tag);let a=new Promise(async a=>{let b=({id:c})=>{var d;(null==(d=u.id)?void 0:d.toString())===c.toString()&&(this.removeRequestFromQueue(c),this.relayer.events.removeListener(bv,b),a())};this.relayer.events.on(bv,b);let c=(0,k.createExpiringPromise)(new Promise((a,b)=>{this.rpcPublish(u,i).then(a).catch(a=>{this.logger.warn(a,a?.message),b(a)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${t} id:${r} tag:${p}`);try{await c,this.events.removeListener(bv,b)}catch(a){this.queue.set(r,{request:u,opts:i,attempt:1}),this.logger.warn(a,a?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:r,payload:g,opts:i}}),await (0,k.createExpiringPromise)(a,this.publishTimeout,v)}catch(a){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(a),null!=(f=i?.internal)&&f.throwOnFailedPublish)throw a}finally{this.queue.delete(r)}}),cT(this,"on",(a,b)=>{this.events.on(a,b)}),cT(this,"once",(a,b)=>{this.events.once(a,b)}),cT(this,"off",(a,b)=>{this.events.off(a,b)}),cT(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.relayer=a,this.logger=(0,f.generateChildLogger)(b,this.name),this.registerEventListeners()}get context(){return(0,f.getLoggerContext)(this.logger)}async rpcPublish(a,b){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:a});let c=await this.relayer.request(a);return this.relayer.events.emit(bv,cS(cS({},a),b)),this.logger.debug("Successfully Published Payload"),c}removeRequestFromQueue(a){this.queue.delete(a)}checkQueue(){this.queue.forEach(async(a,b)=>{var c;let d=a.attempt+1;this.queue.set(b,cM(cS({},a),cN({attempt:d}))),this.logger.warn({},`Publisher: queue->publishing: ${a.request.id}, tag: ${null==(c=a.request.params)?void 0:c.tag}, attempt: ${d}`),await this.rpcPublish(a.request,a.opts),this.logger.warn({},`Publisher: queue->published: ${a.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(d.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(bu);return}this.checkQueue()}),this.relayer.on(bt,a=>{this.removeRequestFromQueue(a.id.toString())})}}var cV=Object.defineProperty,cW=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?cV(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class cX{constructor(){cW(this,"map",new Map),cW(this,"set",(a,b)=>{let c=this.get(a);this.exists(a,b)||this.map.set(a,[...c,b])}),cW(this,"get",a=>this.map.get(a)||[]),cW(this,"exists",(a,b)=>this.get(a).includes(b)),cW(this,"delete",(a,b)=>{if(typeof b>"u")return void this.map.delete(a);if(!this.map.has(a))return;let c=this.get(a);if(!this.exists(a,b))return;let d=c.filter(a=>a!==b);d.length?this.map.set(a,d):this.map.delete(a)}),cW(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var cY=Object.defineProperty,cZ=Object.defineProperties,c$=Object.getOwnPropertyDescriptors,c_=Object.getOwnPropertySymbols,c0=Object.prototype.hasOwnProperty,c1=Object.prototype.propertyIsEnumerable,c2=(a,b,c)=>b in a?cY(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,c3=(a,b)=>{for(var c in b||(b={}))c0.call(b,c)&&c2(a,c,b[c]);if(c_)for(var c of c_(b))c1.call(b,c)&&c2(a,c,b[c]);return a},c4=(a,b,c)=>c2(a,"symbol"!=typeof b?b+"":b,c);class c5 extends g.ISubscriber{constructor(a,b){super(a,b),this.relayer=a,this.logger=b,c4(this,"subscriptions",new Map),c4(this,"topicMap",new cX),c4(this,"events",new c.EventEmitter),c4(this,"name","subscription"),c4(this,"version","0.3"),c4(this,"pending",new Map),c4(this,"cached",[]),c4(this,"initialized",!1),c4(this,"storagePrefix",bm),c4(this,"subscribeTimeout",(0,h.toMiliseconds)(h.ONE_MINUTE)),c4(this,"initialSubscribeTimeout",(0,h.toMiliseconds)(15*h.ONE_SECOND)),c4(this,"clientId"),c4(this,"batchSubscribeTopicsLimit",500),c4(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),c4(this,"subscribe",async(a,b)=>{var c;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:a,opts:b}});try{let d=(0,k.getRelayProtocolName)(b),e={topic:a,relay:d,transportType:b?.transportType};null!=(c=b?.internal)&&c.skipSubscribe||this.pending.set(a,e);let f=await this.rpcSubscribe(a,d,b);return"string"==typeof f&&(this.onSubscribe(f,e),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:a,opts:b}})),f}catch(a){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(a),a}}),c4(this,"unsubscribe",async(a,b)=>{this.isInitialized(),"u">typeof b?.id?await this.unsubscribeById(a,b.id,b):await this.unsubscribeByTopic(a,b)}),c4(this,"isSubscribed",a=>new Promise(b=>{b(this.topicMap.topics.includes(a))})),c4(this,"isKnownTopic",a=>new Promise(b=>{b(this.topicMap.topics.includes(a)||this.pending.has(a)||this.cached.some(b=>b.topic===a))})),c4(this,"on",(a,b)=>{this.events.on(a,b)}),c4(this,"once",(a,b)=>{this.events.once(a,b)}),c4(this,"off",(a,b)=>{this.events.off(a,b)}),c4(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),c4(this,"start",async()=>{await this.onConnect()}),c4(this,"stop",async()=>{await this.onDisconnect()}),c4(this,"restart",async()=>{await this.restore(),await this.onRestart()}),c4(this,"checkPending",async()=>{if(0===this.pending.size&&(!this.initialized||!this.relayer.connected))return;let a=[];this.pending.forEach(b=>{a.push(b)}),await this.batchSubscribe(a)}),c4(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(d.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.events.on(bF,async a=>{this.logger.info(`Emitting ${bF}`),this.logger.debug({type:"event",event:bF,data:a}),await this.persist()}),this.events.on(bG,async a=>{this.logger.info(`Emitting ${bG}`),this.logger.debug({type:"event",event:bG,data:a}),await this.persist()})}),this.relayer=a,this.logger=(0,f.generateChildLogger)(b,this.name),this.clientId=""}get context(){return(0,f.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(a,b){let c=!1;try{c=this.getSubscription(a).topic===b}catch{}return c}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(a,b){let c=this.topicMap.get(a);await Promise.all(c.map(async c=>await this.unsubscribeById(a,c,b)))}async unsubscribeById(a,b,c){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:a,id:b,opts:c}});try{let d=(0,k.getRelayProtocolName)(c);await this.restartToComplete({topic:a,id:b,relay:d}),await this.rpcUnsubscribe(a,b,d);let e=(0,k.getSdkError)("USER_DISCONNECTED",`${this.name}, ${a}`);await this.onUnsubscribe(a,b,e),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:a,id:b,opts:c}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(a,b,c){var d,e;let f=await this.getSubscriptionId(a);if(null!=(d=c?.internal)&&d.skipSubscribe)return f;c&&c?.transportType!==bC||await this.restartToComplete({topic:a,id:a,relay:b});let g={method:(0,k.getRelayProtocolApi)(b.protocol).subscribe,params:{topic:a}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:g});let i=null==(e=c?.internal)?void 0:e.throwOnFailedPublish;try{if(c?.transportType===bB)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(g).catch(a=>this.logger.warn(a))},(0,h.toMiliseconds)(h.ONE_SECOND)),f;let b=new Promise(async b=>{let c=d=>{d.topic===a&&(this.events.removeListener(bF,c),b(d.id))};this.events.on(bF,c);try{let d=await (0,k.createExpiringPromise)(new Promise((a,b)=>{this.relayer.request(g).catch(a=>{this.logger.warn(a,a?.message),b(a)}).then(a)}),this.initialSubscribeTimeout,`Subscribing to ${a} failed, please try again`);this.events.removeListener(bF,c),b(d)}catch{}}),d=await (0,k.createExpiringPromise)(b,this.subscribeTimeout,`Subscribing to ${a} failed, please try again`);if(!d&&i)throw Error(`Subscribing to ${a} failed, please try again`);return d?f:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(bu),i)throw a}return null}async rpcBatchSubscribe(a){if(!a.length)return;let b=a[0].relay,c={method:(0,k.getRelayProtocolApi)(b.protocol).batchSubscribe,params:{topics:a.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:c});try{await await (0,k.createExpiringPromise)(new Promise(a=>{this.relayer.request(c).catch(a=>this.logger.warn(a)).then(a)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(bu)}}async rpcBatchFetchMessages(a){let b;if(!a.length)return;let c=a[0].relay,d={method:(0,k.getRelayProtocolApi)(c.protocol).batchFetchMessages,params:{topics:a.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:d});try{b=await await (0,k.createExpiringPromise)(new Promise((a,b)=>{this.relayer.request(d).catch(a=>{this.logger.warn(a),b(a)}).then(a)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(bu)}return b}rpcUnsubscribe(a,b,c){let d={method:(0,k.getRelayProtocolApi)(c.protocol).unsubscribe,params:{topic:a,id:b}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:d}),this.relayer.request(d)}onSubscribe(a,b){this.setSubscription(a,cZ(c3({},b),c$({id:a}))),this.pending.delete(b.topic)}onBatchSubscribe(a){a.length&&a.forEach(a=>{this.setSubscription(a.id,c3({},a)),this.pending.delete(a.topic)})}async onUnsubscribe(a,b,c){this.events.removeAllListeners(b),this.hasSubscription(b,a)&&this.deleteSubscription(b,c),await this.relayer.messages.del(a)}async setRelayerSubscriptions(a){await this.relayer.core.storage.setItem(this.storageKey,a)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(a,b){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:a,subscription:b}),this.addSubscription(a,b)}addSubscription(a,b){this.subscriptions.set(a,c3({},b)),this.topicMap.set(b.topic,a),this.events.emit(bF,b)}getSubscription(a){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:a});let b=this.subscriptions.get(a);if(!b){let{message:b}=(0,k.getInternalError)("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}deleteSubscription(a,b){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:a,reason:b});let c=this.getSubscription(a);this.subscriptions.delete(a),this.topicMap.delete(c.topic,a),this.events.emit(bG,cZ(c3({},c),c$({reason:b})))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit("subscription_sync")}async onRestart(){if(this.cached.length){let a=[...this.cached],b=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let c=0;c<b;c++){let b=a.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(b)}}this.events.emit("subscription_resubscribed")}async restore(){try{let a=await this.getRelayerSubscriptions();if(typeof a>"u"||!a.length)return;if(this.subscriptions.size&&!a.every(a=>{var b;return a.topic===(null==(b=this.subscriptions.get(a.id))?void 0:b.topic)})){let{message:a}=(0,k.getInternalError)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(a){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(a)}}async batchSubscribe(a){a.length&&(await this.rpcBatchSubscribe(a),this.onBatchSubscribe(await Promise.all(a.map(async a=>cZ(c3({},a),c$({id:await this.getSubscriptionId(a.topic)}))))))}async batchFetchMessages(a){if(!a.length)return;this.logger.trace(`Fetching batch messages for ${a.length} subscriptions`);let b=await this.rpcBatchFetchMessages(a);b&&b.messages&&(await (0,k.sleep)((0,h.toMiliseconds)(h.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(b.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:a}=(0,k.getInternalError)("NOT_INITIALIZED",this.name);throw Error(a)}}async restartToComplete(a){this.relayer.connected||this.relayer.connecting||(this.cached.push(a),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(a){return(0,k.hashMessage)(a+await this.getClientId())}}var c6=Object.defineProperty,c7=Object.getOwnPropertySymbols,c8=Object.prototype.hasOwnProperty,c9=Object.prototype.propertyIsEnumerable,da=(a,b,c)=>b in a?c6(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,db=(a,b)=>{for(var c in b||(b={}))c8.call(b,c)&&da(a,c,b[c]);if(c7)for(var c of c7(b))c9.call(b,c)&&da(a,c,b[c]);return a},dc=(a,b,c)=>da(a,"symbol"!=typeof b?b+"":b,c);class dd extends g.IRelayer{constructor(a){var b;super(a),dc(this,"protocol","wc"),dc(this,"version",2),dc(this,"core"),dc(this,"logger"),dc(this,"events",new c.EventEmitter),dc(this,"provider"),dc(this,"messages"),dc(this,"subscriber"),dc(this,"publisher"),dc(this,"name","relayer"),dc(this,"transportExplicitlyClosed",!1),dc(this,"initialized",!1),dc(this,"connectionAttemptInProgress",!1),dc(this,"relayUrl"),dc(this,"projectId"),dc(this,"packageName"),dc(this,"bundleId"),dc(this,"hasExperiencedNetworkDisruption",!1),dc(this,"pingTimeout"),dc(this,"heartBeatTimeout",(0,h.toMiliseconds)(h.THIRTY_SECONDS+h.FIVE_SECONDS)),dc(this,"reconnectTimeout"),dc(this,"connectPromise"),dc(this,"reconnectInProgress",!1),dc(this,"requestsInFlight",[]),dc(this,"connectTimeout",(0,h.toMiliseconds)(15*h.ONE_SECOND)),dc(this,"request",async a=>{var b,c;this.logger.debug("Publishing Request Payload");let d=a.id||a1().toString();await this.toEstablishConnection();try{this.logger.trace({id:d,method:a.method,topic:null==(b=a.params)?void 0:b.topic},"relayer.request - publishing...");let e=`${d}:${(null==(c=a.params)?void 0:c.tag)||""}`;this.requestsInFlight.push(e);let f=await this.provider.request(a);return this.requestsInFlight=this.requestsInFlight.filter(a=>a!==e),f}catch(a){throw this.logger.debug(`Failed to Publish Request: ${d}`),a}}),dc(this,"resetPingTimeout",()=>{(0,k.isNode)()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var a,b,c,d;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(d=null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.terminate)||d.call(c)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),dc(this,"onPayloadHandler",a=>{this.onProviderPayload(a),this.resetPingTimeout()}),dc(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit("relayer_connect")}),dc(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),dc(this,"onProviderErrorHandler",a=>{this.logger.fatal(`Fatal socket error: ${a.message}`),this.events.emit("relayer_error",a),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),dc(this,"registerProviderListeners",()=>{this.provider.on(bw,this.onPayloadHandler),this.provider.on(bx,this.onConnectHandler),this.provider.on(by,this.onDisconnectHandler),this.provider.on(bz,this.onProviderErrorHandler)}),this.core=a.core,this.logger=(0,k.createLogger)({logger:null!=(b=a.logger)?b:"error",name:this.name}),this.messages=new cK(this.logger,a.core),this.subscriber=new c5(this,this.logger),this.publisher=new cU(this,this.logger),this.projectId=a?.projectId,this.relayUrl=a?.relayUrl||br,(0,k.isAndroid)()?this.packageName=(0,k.getAppId)():(0,k.isIos)()&&(this.bundleId=(0,k.getAppId)()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(a=>this.logger.warn(a,a?.message))}get context(){return(0,f.getLoggerContext)(this.logger)}get connected(){var a,b,c;return(null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.readyState)===1}get connecting(){var a,b,c;return(null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.readyState)===0||void 0!==this.connectPromise}async publish(a,b,c){this.isInitialized(),await this.publisher.publish(a,b,c),await this.recordMessageEvent({topic:a,message:b,publishedAt:Date.now(),transportType:bC},"outbound")}async publishCustom(a){this.isInitialized(),await this.publisher.publishCustom(a)}async subscribe(a,b){var c,d,e;this.isInitialized(),null!=b&&b.transportType&&b?.transportType!=="relay"||await this.toEstablishConnection();let f=typeof(null==(c=b?.internal)?void 0:c.throwOnFailedPublish)>"u"||(null==(d=b?.internal)?void 0:d.throwOnFailedPublish),g=(null==(e=this.subscriber.topicMap.get(a))?void 0:e[0])||"",h,i=b=>{b.topic===a&&(this.subscriber.off(bF,i),h())};return await Promise.all([new Promise(a=>{h=a,this.subscriber.on(bF,i)}),new Promise(async(c,d)=>{g=await this.subscriber.subscribe(a,db({internal:{throwOnFailedPublish:f}},b)).catch(a=>{f&&d(a)})||g,c()})]),g}async unsubscribe(a,b){this.isInitialized(),await this.subscriber.unsubscribe(a,b)}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await (0,k.createExpiringPromise)(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(a){if(!this.subscriber.hasAnyTopics)return void this.logger.info("Starting WS connection skipped because the client has no topics to work with.");if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(b,c)=>{await this.connect(a).then(b).catch(c).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(a){this.logger.debug({},"Restarting transport..."),this.connectionAttemptInProgress||(this.relayUrl=a||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await (0,k.isOnline)())throw Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(a){if(a?.length===0)return void this.logger.trace("Batch message events is empty. Ignoring...");let b=a.sort((a,b)=>a.publishedAt-b.publishedAt);for(let a of(this.logger.debug(`Batch of ${b.length} message events sorted`),b))try{await this.onMessageEvent(a)}catch(a){this.logger.warn(a,"Error while processing batch message event: "+a?.message)}this.logger.trace(`Batch of ${b.length} message events processed`)}async onLinkMessageEvent(a,b){let{topic:c}=a;if(!b.sessionExists){let a=(0,k.calcExpiry)(h.FIVE_MINUTES);await this.core.pairing.pairings.set(c,{topic:c,expiry:a,relay:{protocol:"irn"},active:!1})}this.events.emit(bs,a),await this.recordMessageEvent(a,bD)}async connect(a){await this.confirmOnlineStateOrThrow(),a&&a!==this.relayUrl&&(this.relayUrl=a,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let b=1;for(;b<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${b}...`),await this.createProvider(),await new Promise(async(a,b)=>{let c=()=>{b(Error("Connection interrupted while trying to connect"))};this.provider.once(by,c),await (0,k.createExpiringPromise)(new Promise((a,b)=>{this.provider.connect().then(a).catch(b)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(a=>{b(a)}).finally(()=>{this.provider.off(by,c),clearTimeout(this.reconnectTimeout)}),await new Promise(async(a,c)=>{let d=()=>{b(Error("Connection interrupted while trying to subscribe"))};this.provider.once(by,d),await this.subscriber.start().then(a).catch(c).finally(()=>{this.provider.off(by,d)})}),this.hasExperiencedNetworkDisruption=!1,a()})}catch(a){await this.subscriber.stop(),this.logger.warn({},a.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${b}`);break}await new Promise(a=>setTimeout(a,(0,h.toMiliseconds)(+b))),b++}}startPingTimeout(){var a,b,c,d,e;if((0,k.isNode)())try{null!=(b=null==(a=this.provider)?void 0:a.connection)&&b.socket&&(null==(e=null==(d=null==(c=this.provider)?void 0:c.connection)?void 0:d.socket)||e.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(a){this.logger.warn(a,a?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let a=await this.core.crypto.signJWT(this.relayUrl);this.provider=new bg(new bj((0,k.formatRelayRpcUrl)({sdkVersion:bA,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:a,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(a,b){let{topic:c,message:d}=a;await this.messages.set(c,d,b)}async shouldIgnoreMessageEvent(a){let{topic:b,message:c}=a;if(!c||0===c.length)return this.logger.warn(`Ignoring invalid/empty message: ${c}`),!0;if(!await this.subscriber.isKnownTopic(b))return this.logger.warn(`Ignoring message for unknown topic ${b}`),!0;let d=this.messages.has(b,c);return d&&this.logger.warn(`Ignoring duplicate message: ${c}`),d}async onProviderPayload(a){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:a}),bc(a)){if(!a.method.endsWith("_subscription"))return;let b=a.params,{topic:c,message:d,publishedAt:e,attestation:f}=b.data,g={topic:c,message:d,publishedAt:e,transportType:bC,attestation:f};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(db({type:"event",event:b.id},g)),this.events.emit(b.id,g),await this.acknowledgePayload(a),await this.onMessageEvent(g)}else bd(a)&&this.events.emit(bt,a)}async onMessageEvent(a){await this.shouldIgnoreMessageEvent(a)||(await this.recordMessageEvent(a,bD),this.events.emit(bs,a))}async acknowledgePayload(a){let b=a3(a.id,!0);await this.provider.connection.send(b)}unregisterProviderListeners(){this.provider.off(bw,this.onPayloadHandler),this.provider.off(bx,this.onConnectHandler),this.provider.off(by,this.onDisconnectHandler),this.provider.off(bz,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let a=await (0,k.isOnline)();(0,k.subscribeToNetworkChange)(async b=>{a!==b&&(a=b,b?await this.transportOpen().catch(a=>this.logger.error(a,a?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(d.HEARTBEAT_EVENTS.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&(0,k.isAppVisible)())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(a){this.logger.warn(a,a?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit("relayer_disconnect"),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(a=>this.logger.error(a,a?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,h.toMiliseconds)(.1)))))}isInitialized(){if(!this.initialized){let{message:a}=(0,k.getInternalError)("NOT_INITIALIZED",this.name);throw Error(a)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise)return void await this.connectPromise;await this.connect()}}}function de(a){return Object.getOwnPropertySymbols(a).filter(b=>Object.prototype.propertyIsEnumerable.call(a,b))}function df(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":Object.prototype.toString.call(a)}let dg="[object Arguments]",dh="[object Object]";function di(){}function dj(a){if(!a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&"[object Object]"===Object.prototype.toString.call(a)}var dk=Object.defineProperty,dl=Object.getOwnPropertySymbols,dm=Object.prototype.hasOwnProperty,dn=Object.prototype.propertyIsEnumerable,dp=(a,b,c)=>b in a?dk(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,dq=(a,b)=>{for(var c in b||(b={}))dm.call(b,c)&&dp(a,c,b[c]);if(dl)for(var c of dl(b))dn.call(b,c)&&dp(a,c,b[c]);return a},dr=(a,b,c)=>dp(a,"symbol"!=typeof b?b+"":b,c);class ds extends g.IStore{constructor(a,b,c,d=bm,e){super(a,b,c,d),this.core=a,this.logger=b,this.name=c,dr(this,"map",new Map),dr(this,"version","0.3"),dr(this,"cached",[]),dr(this,"initialized",!1),dr(this,"getKey"),dr(this,"storagePrefix",bm),dr(this,"recentlyDeleted",[]),dr(this,"recentlyDeletedLimit",200),dr(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{this.getKey&&null!==a&&!(0,k.isUndefined)(a)?this.map.set(this.getKey(a),a):(0,k.isProposalStruct)(a)?this.map.set(a.id,a):(0,k.isSessionStruct)(a)&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)}),dr(this,"set",async(a,b)=>{this.isInitialized(),this.map.has(a)?await this.update(a,b):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:b}),this.map.set(a,b),await this.persist())}),dr(this,"get",a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a))),dr(this,"getAll",a=>(this.isInitialized(),a?this.values.filter(b=>Object.keys(a).every(c=>{var d;return d=b[c],function a(b,c,d,e,f,g,h){let i=h(b,c,d,e,f,g);if(void 0!==i)return i;if(typeof b==typeof c)switch(typeof b){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return b===c;case"number":return b===c||Object.is(b,c)}return function b(c,d,e,f){if(Object.is(c,d))return!0;let g=df(c),h=df(d);if(g===dg&&(g=dh),h===dg&&(h=dh),g!==h)return!1;switch(g){case"[object String]":return c.toString()===d.toString();case"[object Number]":{let a=c.valueOf(),b=d.valueOf();return a===b||Number.isNaN(a)&&Number.isNaN(b)}case"[object Boolean]":case"[object Date]":case"[object Symbol]":return Object.is(c.valueOf(),d.valueOf());case"[object RegExp]":return c.source===d.source&&c.flags===d.flags;case"[object Function]":return c===d}let i=(e=e??new Map).get(c),j=e.get(d);if(null!=i&&null!=j)return i===d;e.set(c,d),e.set(d,c);try{switch(g){case"[object Map]":if(c.size!==d.size)return!1;for(let[b,g]of c.entries())if(!d.has(b)||!a(g,d.get(b),b,c,d,e,f))return!1;return!0;case"[object Set]":{if(c.size!==d.size)return!1;let b=Array.from(c.values()),g=Array.from(d.values());for(let h=0;h<b.length;h++){let i=b[h],j=g.findIndex(b=>a(i,b,void 0,c,d,e,f));if(-1===j)return!1;g.splice(j,1)}return!0}case"[object Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object BigUint64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object BigInt64Array]":case"[object Float32Array]":case"[object Float64Array]":if("u">typeof Buffer&&Buffer.isBuffer(c)!==Buffer.isBuffer(d)||c.length!==d.length)return!1;for(let b=0;b<c.length;b++)if(!a(c[b],d[b],b,c,d,e,f))return!1;return!0;case"[object ArrayBuffer]":return c.byteLength===d.byteLength&&b(new Uint8Array(c),new Uint8Array(d),e,f);case"[object DataView]":return c.byteLength===d.byteLength&&c.byteOffset===d.byteOffset&&b(new Uint8Array(c),new Uint8Array(d),e,f);case"[object Error]":return c.name===d.name&&c.message===d.message;case dh:{if(!(b(c.constructor,d.constructor,e,f)||dj(c)&&dj(d)))return!1;let g=[...Object.keys(c),...de(c)],h=[...Object.keys(d),...de(d)];if(g.length!==h.length)return!1;for(let b=0;b<g.length;b++){let h=g[b],i=c[h];if(!Object.hasOwn(d,h))return!1;let j=d[h];if(!a(i,j,h,c,d,e,f))return!1}return!0}default:return!1}}finally{e.delete(c),e.delete(d)}}(b,c,g,h)}(d,a[c],void 0,void 0,void 0,void 0,di)})):this.values)),dr(this,"update",async(a,b)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:b});let c=dq(dq({},this.getData(a)),b);this.map.set(a,c),await this.persist()}),dr(this,"delete",async(a,b)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:b}),this.map.delete(a),this.addToRecentlyDeleted(a),await this.persist())}),this.logger=(0,f.generateChildLogger)(b,this.name),this.storagePrefix=d,this.getKey=e}get context(){return(0,f.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(a){this.recentlyDeleted.push(a),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(a){await this.core.storage.setItem(this.storageKey,a)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(a){let b=this.map.get(a);if(!b){if(this.recentlyDeleted.includes(a)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${a}`);throw this.logger.error(b),Error(b)}let{message:b}=(0,k.getInternalError)("NO_MATCHING_KEY",`${this.name}: ${a}`);throw this.logger.error(b),Error(b)}return b}async persist(){await this.setDataStore(this.values)}async restore(){try{let a=await this.getDataStore();if(typeof a>"u"||!a.length)return;if(this.map.size){let{message:a}=(0,k.getInternalError)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(a){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(a)}}isInitialized(){if(!this.initialized){let{message:a}=(0,k.getInternalError)("NOT_INITIALIZED",this.name);throw Error(a)}}}var dt=Object.defineProperty,du=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?dt(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class dv{constructor(a,b){this.core=a,this.logger=b,du(this,"name","pairing"),du(this,"version","0.3"),du(this,"events",new c.default),du(this,"pairings"),du(this,"initialized",!1),du(this,"storagePrefix",bm),du(this,"ignoredPayloadTypes",[k.TYPE_1]),du(this,"registeredMethods",[]),du(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),du(this,"register",({methods:a})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...a])]}),du(this,"create",async a=>{this.isInitialized();let b=(0,k.generateRandomBytes32)(),c=await this.core.crypto.setSymKey(b),d=(0,k.calcExpiry)(h.FIVE_MINUTES),e={protocol:"irn"},f={topic:c,expiry:d,relay:e,active:!1,methods:a?.methods},g=(0,k.formatUri)({protocol:this.core.protocol,version:this.core.version,topic:c,symKey:b,relay:e,expiryTimestamp:d,methods:a?.methods});return this.events.emit(bI,f),this.core.expirer.set(c,d),await this.pairings.set(c,f),await this.core.relayer.subscribe(c,{transportType:a?.transportType,internal:a?.internal}),{topic:c,uri:g}}),du(this,"pair",async a=>{let b;this.isInitialized();let c=this.core.eventClient.createEvent({properties:{topic:a?.uri,trace:["pairing_started"]}});this.isValidPair(a,c);let{topic:d,symKey:e,relay:f,expiryTimestamp:g,methods:i}=(0,k.parseUri)(a.uri);if(c.props.properties.topic=d,c.addTrace("pairing_uri_validation_success"),c.addTrace("pairing_uri_not_expired"),this.pairings.keys.includes(d)){if(b=this.pairings.get(d),c.addTrace("existing_pairing"),b.active)throw c.setError("active_pairing_already_exists"),Error(`Pairing already exists: ${d}. Please try again with a new connection URI.`);c.addTrace("pairing_not_expired")}let j=g||(0,k.calcExpiry)(h.FIVE_MINUTES),l={topic:d,relay:f,expiry:j,active:!1,methods:i};this.core.expirer.set(d,j),await this.pairings.set(d,l),c.addTrace("store_new_pairing"),a.activatePairing&&await this.activate({topic:d}),this.events.emit(bI,l),c.addTrace("emit_inactive_pairing"),this.core.crypto.keychain.has(d)||await this.core.crypto.setSymKey(e,d),c.addTrace("subscribing_pairing_topic");try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{c.setError("no_internet_connection")}try{await this.core.relayer.subscribe(d,{relay:f})}catch(a){throw c.setError("subscribe_pairing_topic_failure"),a}return c.addTrace("subscribe_pairing_topic_success"),l}),du(this,"activate",async({topic:a})=>{this.isInitialized();let b=(0,k.calcExpiry)(h.FIVE_MINUTES);this.core.expirer.set(a,b),await this.pairings.update(a,{active:!0,expiry:b})}),du(this,"ping",async a=>{this.isInitialized(),await this.isValidPing(a),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:b}=a;if(this.pairings.keys.includes(b)){let a=await this.sendRequest(b,"wc_pairingPing",{}),{done:c,resolve:d,reject:e}=(0,k.createDelayedPromise)();this.events.once((0,k.engineEvent)("pairing_ping",a),({error:a})=>{a?e(a):d()}),await c()}}),du(this,"updateExpiry",async({topic:a,expiry:b})=>{this.isInitialized(),await this.pairings.update(a,{expiry:b})}),du(this,"updateMetadata",async({topic:a,metadata:b})=>{this.isInitialized(),await this.pairings.update(a,{peerMetadata:b})}),du(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),du(this,"disconnect",async a=>{this.isInitialized(),await this.isValidDisconnect(a);let{topic:b}=a;this.pairings.keys.includes(b)&&(await this.sendRequest(b,"wc_pairingDelete",(0,k.getSdkError)("USER_DISCONNECTED")),await this.deletePairing(b))}),du(this,"formatUriFromPairing",a=>{this.isInitialized();let{topic:b,relay:c,expiry:d,methods:e}=a,f=this.core.crypto.keychain.get(b);return(0,k.formatUri)({protocol:this.core.protocol,version:this.core.version,topic:b,symKey:f,relay:c,expiryTimestamp:d,methods:e})}),du(this,"sendRequest",async(a,b,c)=>{let d=a2(b,c),e=await this.core.crypto.encode(a,d),f=bH[b].req;return this.core.history.set(a,d),this.core.relayer.publish(a,e,f),d.id}),du(this,"sendResult",async(a,b,c)=>{let d=a3(a,c),e=await this.core.crypto.encode(b,d),f=bH[(await this.core.history.get(b,a)).request.method].res;await this.core.relayer.publish(b,e,f),await this.core.history.resolve(d)}),du(this,"sendError",async(a,b,c)=>{let d=a4(a,c),e=await this.core.crypto.encode(b,d),f=(await this.core.history.get(b,a)).request.method,g=bH[f]?bH[f].res:bH.unregistered_method.res;await this.core.relayer.publish(b,e,g),await this.core.history.resolve(d)}),du(this,"deletePairing",async(a,b)=>{await this.core.relayer.unsubscribe(a),await Promise.all([this.pairings.delete(a,(0,k.getSdkError)("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(a),b?Promise.resolve():this.core.expirer.del(a)])}),du(this,"cleanup",async()=>{let a=this.pairings.getAll().filter(a=>(0,k.isExpired)(a.expiry));await Promise.all(a.map(a=>this.deletePairing(a.topic)))}),du(this,"onRelayEventRequest",async a=>{let{topic:b,payload:c}=a;switch(c.method){case"wc_pairingPing":return await this.onPairingPingRequest(b,c);case"wc_pairingDelete":return await this.onPairingDeleteRequest(b,c);default:return await this.onUnknownRpcMethodRequest(b,c)}}),du(this,"onRelayEventResponse",async a=>{let{topic:b,payload:c}=a,d=(await this.core.history.get(b,c.id)).request.method;return"wc_pairingPing"===d?this.onPairingPingResponse(b,c):this.onUnknownRpcMethodResponse(d)}),du(this,"onPairingPingRequest",async(a,b)=>{let{id:c}=b;try{this.isValidPing({topic:a}),await this.sendResult(c,a,!0),this.events.emit("pairing_ping",{id:c,topic:a})}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),du(this,"onPairingPingResponse",(a,b)=>{let{id:c}=b;setTimeout(()=>{be(b)?this.events.emit((0,k.engineEvent)("pairing_ping",c),{}):bf(b)&&this.events.emit((0,k.engineEvent)("pairing_ping",c),{error:b.error})},500)}),du(this,"onPairingDeleteRequest",async(a,b)=>{let{id:c}=b;try{this.isValidDisconnect({topic:a}),await this.deletePairing(a),this.events.emit(bJ,{id:c,topic:a})}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),du(this,"onUnknownRpcMethodRequest",async(a,b)=>{let{id:c,method:d}=b;try{if(this.registeredMethods.includes(d))return;let b=(0,k.getSdkError)("WC_METHOD_UNSUPPORTED",d);await this.sendError(c,a,b),this.logger.error(b)}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),du(this,"onUnknownRpcMethodResponse",a=>{this.registeredMethods.includes(a)||this.logger.error((0,k.getSdkError)("WC_METHOD_UNSUPPORTED",a))}),du(this,"isValidPair",(a,b)=>{var c;if(!(0,k.isValidParams)(a)){let{message:c}=(0,k.getInternalError)("MISSING_OR_INVALID",`pair() params: ${a}`);throw b.setError(bT),Error(c)}if(!(0,k.isValidUrl)(a.uri)){let{message:c}=(0,k.getInternalError)("MISSING_OR_INVALID",`pair() uri: ${a.uri}`);throw b.setError(bT),Error(c)}let d=(0,k.parseUri)(a?.uri);if(!(null!=(c=d?.relay)&&c.protocol)){let{message:a}=(0,k.getInternalError)("MISSING_OR_INVALID","pair() uri#relay-protocol");throw b.setError(bT),Error(a)}if(!(null!=d&&d.symKey)){let{message:a}=(0,k.getInternalError)("MISSING_OR_INVALID","pair() uri#symKey");throw b.setError(bT),Error(a)}if(null!=d&&d.expiryTimestamp&&(0,h.toMiliseconds)(d?.expiryTimestamp)<Date.now()){b.setError("pairing_expired");let{message:a}=(0,k.getInternalError)("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw Error(a)}}),du(this,"isValidPing",async a=>{if(!(0,k.isValidParams)(a)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`ping() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidPairingTopic(b)}),du(this,"isValidDisconnect",async a=>{if(!(0,k.isValidParams)(a)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`disconnect() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidPairingTopic(b)}),du(this,"isValidPairingTopic",async a=>{if(!(0,k.isValidString)(a,!1)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`pairing topic should be a string: ${a}`);throw Error(b)}if(!this.pairings.keys.includes(a)){let{message:b}=(0,k.getInternalError)("NO_MATCHING_KEY",`pairing topic doesn't exist: ${a}`);throw Error(b)}if((0,k.isExpired)(this.pairings.get(a).expiry)){await this.deletePairing(a);let{message:b}=(0,k.getInternalError)("EXPIRED",`pairing topic: ${a}`);throw Error(b)}}),this.core=a,this.logger=(0,f.generateChildLogger)(b,this.name),this.pairings=new ds(this.core,this.logger,this.name,this.storagePrefix)}get context(){return(0,f.getLoggerContext)(this.logger)}isInitialized(){if(!this.initialized){let{message:a}=(0,k.getInternalError)("NOT_INITIALIZED",this.name);throw Error(a)}}registerRelayerEvents(){this.core.relayer.on(bs,async a=>{let{topic:b,message:c,transportType:d}=a;if(this.pairings.keys.includes(b)&&d!==bB&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(c)))try{let a=await this.core.crypto.decode(b,c);bc(a)?(this.core.history.set(b,a),await this.onRelayEventRequest({topic:b,payload:a})):bd(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:b,payload:a}),this.core.history.delete(b,a.id)),await this.core.relayer.messages.ack(b,c)}catch(a){this.logger.error(a)}})}registerExpirerEvents(){this.core.expirer.on(bP,async a=>{let{topic:b}=(0,k.parseExpirerTarget)(a.target);b&&this.pairings.keys.includes(b)&&(await this.deletePairing(b,!0),this.events.emit("pairing_expire",{topic:b}))})}}var dw=Object.defineProperty,dx=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?dw(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class dy extends g.IJsonRpcHistory{constructor(a,b){super(a,b),this.core=a,this.logger=b,dx(this,"records",new Map),dx(this,"events",new c.EventEmitter),dx(this,"name","history"),dx(this,"version","0.3"),dx(this,"cached",[]),dx(this,"initialized",!1),dx(this,"storagePrefix",bm),dx(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>this.records.set(a.id,a)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),dx(this,"set",(a,b,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:a,request:b,chainId:c}),this.records.has(b.id))return;let d={id:b.id,topic:a,request:{method:b.method,params:b.params||null},chainId:c,expiry:(0,k.calcExpiry)(h.THIRTY_DAYS)};this.records.set(d.id,d),this.persist(),this.events.emit(bK,d)}),dx(this,"resolve",async a=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:a}),!this.records.has(a.id))return;let b=await this.getRecord(a.id);typeof b.response>"u"&&(b.response=bf(a)?{error:a.error}:{result:a.result},this.records.set(b.id,b),this.persist(),this.events.emit(bL,b))}),dx(this,"get",async(a,b)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:a,id:b}),await this.getRecord(b))),dx(this,"delete",(a,b)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:b}),this.values.forEach(c=>{c.topic===a&&("u">typeof b&&c.id!==b||(this.records.delete(c.id),this.events.emit(bM,c)))}),this.persist()}),dx(this,"exists",async(a,b)=>(this.isInitialized(),!!this.records.has(b)&&(await this.getRecord(b)).topic===a)),dx(this,"on",(a,b)=>{this.events.on(a,b)}),dx(this,"once",(a,b)=>{this.events.once(a,b)}),dx(this,"off",(a,b)=>{this.events.off(a,b)}),dx(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.logger=(0,f.generateChildLogger)(b,this.name)}get context(){return(0,f.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let a=[];return this.values.forEach(b=>{if("u">typeof b.response)return;let c={topic:b.topic,request:a2(b.request.method,b.request.params,b.id),chainId:b.chainId};return a.push(c)}),a}async setJsonRpcRecords(a){await this.core.storage.setItem(this.storageKey,a)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(a){this.isInitialized();let b=this.records.get(a);if(!b){let{message:b}=(0,k.getInternalError)("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit("history_sync")}async restore(){try{let a=await this.getJsonRpcRecords();if(typeof a>"u"||!a.length)return;if(this.records.size){let{message:a}=(0,k.getInternalError)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(a){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(a)}}registerEventListeners(){this.events.on(bK,a=>{this.logger.info(`Emitting ${bK}`),this.logger.debug({type:"event",event:bK,record:a})}),this.events.on(bL,a=>{this.logger.info(`Emitting ${bL}`),this.logger.debug({type:"event",event:bL,record:a})}),this.events.on(bM,a=>{this.logger.info(`Emitting ${bM}`),this.logger.debug({type:"event",event:bM,record:a})}),this.core.heartbeat.on(d.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let a=!1;this.records.forEach(b=>{(0,h.toMiliseconds)(b.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${b.id}`),this.records.delete(b.id),this.events.emit(bM,b,!1),a=!0)}),a&&this.persist()}catch(a){this.logger.warn(a)}}isInitialized(){if(!this.initialized){let{message:a}=(0,k.getInternalError)("NOT_INITIALIZED",this.name);throw Error(a)}}}var dz=Object.defineProperty,dA=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?dz(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class dB extends g.IExpirer{constructor(a,b){super(a,b),this.core=a,this.logger=b,dA(this,"expirations",new Map),dA(this,"events",new c.EventEmitter),dA(this,"name","expirer"),dA(this,"version","0.3"),dA(this,"cached",[]),dA(this,"initialized",!1),dA(this,"storagePrefix",bm),dA(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>this.expirations.set(a.target,a)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),dA(this,"has",a=>{try{let b=this.formatTarget(a);return"u">typeof this.getExpiration(b)}catch{return!1}}),dA(this,"set",(a,b)=>{this.isInitialized();let c=this.formatTarget(a),d={target:c,expiry:b};this.expirations.set(c,d),this.checkExpiry(c,d),this.events.emit(bN,{target:c,expiration:d})}),dA(this,"get",a=>{this.isInitialized();let b=this.formatTarget(a);return this.getExpiration(b)}),dA(this,"del",a=>{if(this.isInitialized(),this.has(a)){let b=this.formatTarget(a),c=this.getExpiration(b);this.expirations.delete(b),this.events.emit(bO,{target:b,expiration:c})}}),dA(this,"on",(a,b)=>{this.events.on(a,b)}),dA(this,"once",(a,b)=>{this.events.once(a,b)}),dA(this,"off",(a,b)=>{this.events.off(a,b)}),dA(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.logger=(0,f.generateChildLogger)(b,this.name)}get context(){return(0,f.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(a){if("string"==typeof a)return(0,k.formatTopicTarget)(a);if("number"==typeof a)return(0,k.formatIdTarget)(a);let{message:b}=(0,k.getInternalError)("UNKNOWN_TYPE",`Target type: ${typeof a}`);throw Error(b)}async setExpirations(a){await this.core.storage.setItem(this.storageKey,a)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit("expirer_sync")}async restore(){try{let a=await this.getExpirations();if(typeof a>"u"||!a.length)return;if(this.expirations.size){let{message:a}=(0,k.getInternalError)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(a){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(a)}}getExpiration(a){let b=this.expirations.get(a);if(!b){let{message:b}=(0,k.getInternalError)("NO_MATCHING_KEY",`${this.name}: ${a}`);throw this.logger.warn(b),Error(b)}return b}checkExpiry(a,b){let{expiry:c}=b;(0,h.toMiliseconds)(c)-Date.now()<=0&&this.expire(a,b)}expire(a,b){this.expirations.delete(a),this.events.emit(bP,{target:a,expiration:b})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((a,b)=>this.checkExpiry(b,a))}registerEventListeners(){this.core.heartbeat.on(d.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(bN,a=>{this.logger.info(`Emitting ${bN}`),this.logger.debug({type:"event",event:bN,data:a}),this.persist()}),this.events.on(bP,a=>{this.logger.info(`Emitting ${bP}`),this.logger.debug({type:"event",event:bP,data:a}),this.persist()}),this.events.on(bO,a=>{this.logger.info(`Emitting ${bO}`),this.logger.debug({type:"event",event:bO,data:a}),this.persist()})}isInitialized(){if(!this.initialized){let{message:a}=(0,k.getInternalError)("NOT_INITIALIZED",this.name);throw Error(a)}}}var dC=Object.defineProperty,dD=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?dC(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class dE extends g.IVerify{constructor(a,b,c){super(a,b,c),this.core=a,this.logger=b,this.store=c,dD(this,"name","verify-api"),dD(this,"abortController"),dD(this,"isDevEnv"),dD(this,"verifyUrlV3",bR),dD(this,"storagePrefix",bm),dD(this,"version",2),dD(this,"publicKey"),dD(this,"fetchPromise"),dD(this,"init",async()=>{var a;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,h.toMiliseconds)(null==(a=this.publicKey)?void 0:a.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),dD(this,"register",async a=>{if(!(0,k.isBrowser)()||this.isDevEnv)return;let b=window.location.origin,{id:c,decryptedId:d}=a,e=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${b}&id=${c}&decryptedId=${d}`;try{let a=(0,bk.getDocument)(),b=this.startAbortTimer(5*h.ONE_SECOND),d=await new Promise((d,f)=>{let g=()=>{window.removeEventListener("message",i),a.body.removeChild(h),f("attestation aborted")};this.abortController.signal.addEventListener("abort",g);let h=a.createElement("iframe");h.src=e,h.style.display="none",h.addEventListener("error",g,{signal:this.abortController.signal});let i=e=>{if(e.data&&"string"==typeof e.data)try{let f=JSON.parse(e.data);if("verify_attestation"===f.type){if((0,j.decodeJWT)(f.attestation).payload.id!==c)return;clearInterval(b),a.body.removeChild(h),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",i),d(null===f.attestation?"":f.attestation)}}catch(a){this.logger.warn(a)}};a.body.appendChild(h),window.addEventListener("message",i,{signal:this.abortController.signal})});return this.logger.debug(d,"jwt attestation"),d}catch(a){this.logger.warn(a)}return""}),dD(this,"resolve",async a=>{if(this.isDevEnv)return"";let{attestationId:b,hash:c,encryptedId:d}=a;if(""===b)return void this.logger.debug("resolve: attestationId is empty, skipping");if(b){if((0,j.decodeJWT)(b).payload.id!==d)return;let a=await this.isValidJwtAttestation(b);if(a)return a.isVerified?a:void this.logger.warn("resolve: jwt attestation: origin url not verified")}if(!c)return;let e=this.getVerifyUrl(a?.verifyUrl);return this.fetchAttestation(c,e)}),dD(this,"fetchAttestation",async(a,b)=>{this.logger.debug(`resolving attestation: ${a} from url: ${b}`);let c=this.startAbortTimer(5*h.ONE_SECOND),d=await fetch(`${b}/attestation/${a}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(c),200===d.status?await d.json():void 0}),dD(this,"getVerifyUrl",a=>{let b=a||bQ;return bS.includes(b)||(this.logger.info(`verify url: ${b}, not included in trusted list, assigning default: ${bQ}`),b=bQ),b}),dD(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let a=this.startAbortTimer(h.FIVE_SECONDS),b=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(a),await b.json()}catch(a){this.logger.warn(a)}}),dD(this,"persistPublicKey",async a=>{this.logger.debug(a,"persisting public key to local storage"),await this.store.setItem(this.storeKey,a),this.publicKey=a}),dD(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),dD(this,"isValidJwtAttestation",async a=>{let b=await this.getPublicKey();try{if(b)return this.validateAttestation(a,b)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}let c=await this.fetchAndPersistPublicKey();try{if(c)return this.validateAttestation(a,c)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),dD(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),dD(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async a=>{let b=await this.fetchPublicKey();b&&(await this.persistPublicKey(b),a(b))});let a=await this.fetchPromise;return this.fetchPromise=void 0,a}),dD(this,"validateAttestation",(a,b)=>{let c=(0,k.verifyP256Jwt)(a,b.publicKey),d={hasExpired:(0,h.toMiliseconds)(c.exp)<Date.now(),payload:c};if(d.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),Error("JWT attestation expired");return{origin:d.payload.origin,isScam:d.payload.isScam,isVerified:d.payload.isVerified}}),this.logger=(0,f.generateChildLogger)(b,this.name),this.abortController=new AbortController,this.isDevEnv=(0,k.isTestRun)(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return(0,f.getLoggerContext)(this.logger)}startAbortTimer(a){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,h.toMiliseconds)(a))}}var dF=Object.defineProperty,dG=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?dF(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class dH extends g.IEchoClient{constructor(a,b){super(a,b),this.projectId=a,this.logger=b,dG(this,"context","echo"),dG(this,"registerDeviceToken",async a=>{let{clientId:b,token:c,notificationType:d,enableEncrypted:e=!1}=a,f=`https://echo.walletconnect.com/${this.projectId}/clients`;await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:b,type:d,token:c,always_raw:e})})}),this.logger=(0,f.generateChildLogger)(b,this.context)}}var dI=Object.defineProperty,dJ=Object.getOwnPropertySymbols,dK=Object.prototype.hasOwnProperty,dL=Object.prototype.propertyIsEnumerable,dM=(a,b,c)=>b in a?dI(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,dN=(a,b)=>{for(var c in b||(b={}))dK.call(b,c)&&dM(a,c,b[c]);if(dJ)for(var c of dJ(b))dL.call(b,c)&&dM(a,c,b[c]);return a},dO=(a,b,c)=>dM(a,"symbol"!=typeof b?b+"":b,c);class dP extends g.IEventClient{constructor(a,b,c=!0){super(a,b,c),this.core=a,this.logger=b,dO(this,"context","event-client"),dO(this,"storagePrefix",bm),dO(this,"storageVersion",.1),dO(this,"events",new Map),dO(this,"shouldPersist",!1),dO(this,"init",async()=>{if(!(0,k.isTestRun)())try{let a={eventId:(0,k.uuidv4)(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:(0,k.formatUA)(this.core.relayer.protocol,this.core.relayer.version,bA)}}};await this.sendEvent([a])}catch(a){this.logger.warn(a)}}),dO(this,"createEvent",a=>{let{event:b="ERROR",type:c="",properties:{topic:d,trace:e}}=a,f=(0,k.uuidv4)(),g=this.core.projectId||"",h=dN({eventId:f,timestamp:Date.now(),props:{event:b,type:c,properties:{topic:d,trace:e}},bundleId:g,domain:this.getAppDomain()},this.setMethods(f));return this.telemetryEnabled&&(this.events.set(f,h),this.shouldPersist=!0),h}),dO(this,"getEvent",a=>{let{eventId:b,topic:c}=a;if(b)return this.events.get(b);let d=Array.from(this.events.values()).find(a=>a.props.properties.topic===c);if(d)return dN(dN({},d),this.setMethods(d.eventId))}),dO(this,"deleteEvent",a=>{let{eventId:b}=a;this.events.delete(b),this.shouldPersist=!0}),dO(this,"setEventListeners",()=>{this.core.heartbeat.on(d.HEARTBEAT_EVENTS.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(a=>{(0,h.fromMiliseconds)(Date.now())-(0,h.fromMiliseconds)(a.timestamp)>86400&&(this.events.delete(a.eventId),this.shouldPersist=!0)})})}),dO(this,"setMethods",a=>({addTrace:b=>this.addTrace(a,b),setError:b=>this.setError(a,b)})),dO(this,"addTrace",(a,b)=>{let c=this.events.get(a);c&&(c.props.properties.trace.push(b),this.events.set(a,c),this.shouldPersist=!0)}),dO(this,"setError",(a,b)=>{let c=this.events.get(a);c&&(c.props.type=b,c.timestamp=Date.now(),this.events.set(a,c),this.shouldPersist=!0)}),dO(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),dO(this,"restore",async()=>{try{let a=await this.core.storage.getItem(this.storageKey)||[];if(!a.length)return;a.forEach(a=>{this.events.set(a.eventId,dN(dN({},a),this.setMethods(a.eventId)))})}catch(a){this.logger.warn(a)}}),dO(this,"submit",async()=>{if(!this.telemetryEnabled||0===this.events.size)return;let a=[];for(let[b,c]of this.events)c.props.type&&a.push(c);if(0!==a.length)try{if((await this.sendEvent(a)).ok)for(let b of a)this.events.delete(b.eventId),this.shouldPersist=!0}catch(a){this.logger.warn(a)}}),dO(this,"sendEvent",async a=>{let b=this.getAppDomain()?"":"&sp=desktop";return await fetch(`https://pulse.walletconnect.org/batch?projectId=${this.core.projectId}&st=events_sdk&sv=js-${bA}${b}`,{method:"POST",body:JSON.stringify(a)})}),dO(this,"getAppDomain",()=>(0,k.getAppMetadata)().url),this.logger=(0,f.generateChildLogger)(b,this.context),this.telemetryEnabled=c,c?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var dQ=Object.defineProperty,dR=Object.getOwnPropertySymbols,dS=Object.prototype.hasOwnProperty,dT=Object.prototype.propertyIsEnumerable,dU=(a,b,c)=>b in a?dQ(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,dV=(a,b)=>{for(var c in b||(b={}))dS.call(b,c)&&dU(a,c,b[c]);if(dR)for(var c of dR(b))dT.call(b,c)&&dU(a,c,b[c]);return a},dW=(a,b,c)=>dU(a,"symbol"!=typeof b?b+"":b,c);class dX extends g.ICore{constructor(a){var b;super(a),dW(this,"protocol","wc"),dW(this,"version",2),dW(this,"name",bl),dW(this,"relayUrl"),dW(this,"projectId"),dW(this,"customStoragePrefix"),dW(this,"events",new c.EventEmitter),dW(this,"logger"),dW(this,"heartbeat"),dW(this,"relayer"),dW(this,"crypto"),dW(this,"storage"),dW(this,"history"),dW(this,"expirer"),dW(this,"pairing"),dW(this,"verify"),dW(this,"echoClient"),dW(this,"linkModeSupportedApps"),dW(this,"eventClient"),dW(this,"initialized",!1),dW(this,"logChunkController"),dW(this,"on",(a,b)=>this.events.on(a,b)),dW(this,"once",(a,b)=>this.events.once(a,b)),dW(this,"off",(a,b)=>this.events.off(a,b)),dW(this,"removeListener",(a,b)=>this.events.removeListener(a,b)),dW(this,"dispatchEnvelope",({topic:a,message:b,sessionExists:c})=>{if(!a||!b)return;let d={topic:a,message:b,publishedAt:Date.now(),transportType:bB};this.relayer.onLinkMessageEvent(d,{sessionExists:c})});const g=this.getGlobalCore(a?.customStoragePrefix);if(g)try{return this.customStoragePrefix=g.customStoragePrefix,this.logger=g.logger,this.heartbeat=g.heartbeat,this.crypto=g.crypto,this.history=g.history,this.expirer=g.expirer,this.storage=g.storage,this.relayer=g.relayer,this.pairing=g.pairing,this.verify=g.verify,this.echoClient=g.echoClient,this.linkModeSupportedApps=g.linkModeSupportedApps,this.eventClient=g.eventClient,this.initialized=g.initialized,this.logChunkController=g.logChunkController,g}catch(a){console.warn("Failed to copy global core",a)}this.projectId=a?.projectId,this.relayUrl=a?.relayUrl||br,this.customStoragePrefix=null!=a&&a.customStoragePrefix?`:${a.customStoragePrefix}`:"";const h=(0,f.getDefaultLoggerOptions)({level:"string"==typeof a?.logger&&a.logger?a.logger:"error",name:bl}),{logger:i,chunkLoggerController:j}=(0,f.generatePlatformLogger)({opts:h,maxSizeInBytes:a?.maxLogBlobSizeInBytes,loggerOverride:a?.logger});this.logChunkController=j,null!=(b=this.logChunkController)&&b.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,b;null!=(a=this.logChunkController)&&a.downloadLogsBlobInBrowser&&(null==(b=this.logChunkController)||b.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=(0,f.generateChildLogger)(i,this.name),this.heartbeat=new d.HeartBeat,this.crypto=new cB(this,this.logger,a?.keychain),this.history=new dy(this,this.logger),this.expirer=new dB(this,this.logger),this.storage=null!=a&&a.storage?a.storage:new e.default(dV(dV({},bn),a?.storageOptions)),this.relayer=new dd({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new dv(this,this.logger),this.verify=new dE(this,this.logger,this.storage),this.echoClient=new dH(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new dP(this,this.logger,a?.telemetryEnabled),this.setGlobalCore(this)}static async init(a){let b=new dX(a);await b.initialize();let c=await b.crypto.getClientId();return await b.storage.setItem("WALLETCONNECT_CLIENT_ID",c),b}get context(){return(0,f.getLoggerContext)(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var a;return null==(a=this.logChunkController)?void 0:a.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(a){this.linkModeSupportedApps.includes(a)||(this.linkModeSupportedApps.push(a),await this.storage.setItem(bE,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(bE)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(a){throw this.logger.warn(a,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(a.message),a}}getGlobalCore(a=""){try{if(this.isGlobalCoreDisabled())return;let b=`_walletConnectCore_${a}`,c=`${b}_count`;return globalThis[c]=(globalThis[c]||0)+1,globalThis[c]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[c]} times.`),globalThis[b]}catch(a){console.warn("Failed to get global WalletConnect core",a);return}}setGlobalCore(a){var b;try{if(this.isGlobalCoreDisabled())return;let c=`_walletConnectCore_${(null==(b=a.opts)?void 0:b.customStoragePrefix)||""}`;globalThis[c]=a}catch(a){console.warn("Failed to set global WalletConnect core",a)}}isGlobalCoreDisabled(){try{return"u">typeof process&&"true"===process.env.DISABLE_GLOBAL_CORE}catch{return!0}}}var dY=g;let dZ="client",d$=`wc@2:${dZ}:`,d_="WALLETCONNECT_DEEPLINK_CHOICE",d0=(h.THIRTY_DAYS,"Proposal expired"),d1=h.SEVEN_DAYS,d2={wc_sessionPropose:{req:{ttl:h.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:h.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:h.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:h.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:h.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:h.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:h.ONE_DAY,prompt:!1,tag:1104},res:{ttl:h.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:h.ONE_DAY,prompt:!1,tag:1106},res:{ttl:h.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:h.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:h.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:h.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:h.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:h.ONE_DAY,prompt:!1,tag:1112},res:{ttl:h.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:h.ONE_DAY,prompt:!1,tag:1114},res:{ttl:h.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:h.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:h.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:h.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:h.FIVE_MINUTES,prompt:!1,tag:1119}}},d3={min:h.FIVE_MINUTES,max:h.SEVEN_DAYS},d4="IDLE",d5="ACTIVE",d6={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},d7=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],d8="wc@1.5:auth:",d9=`${d8}:PUB_KEY`;var ea=Object.defineProperty,eb=Object.defineProperties,ec=Object.getOwnPropertyDescriptors,ed=Object.getOwnPropertySymbols,ee=Object.prototype.hasOwnProperty,ef=Object.prototype.propertyIsEnumerable,eg=(a,b,c)=>b in a?ea(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,eh=(a,b)=>{for(var c in b||(b={}))ee.call(b,c)&&eg(a,c,b[c]);if(ed)for(var c of ed(b))ef.call(b,c)&&eg(a,c,b[c]);return a},ei=(a,b,c)=>eg(a,"symbol"!=typeof b?b+"":b,c);class ej extends dY.IEngine{constructor(b){super(b),ei(this,"name","engine"),ei(this,"events",new c.default),ei(this,"initialized",!1),ei(this,"requestQueue",{state:d4,queue:[]}),ei(this,"sessionRequestQueue",{state:d4,queue:[]}),ei(this,"emittedSessionRequests",new k.LimitedSet({limit:500})),ei(this,"requestQueueDelay",h.ONE_SECOND),ei(this,"expectedPairingMethodMap",new Map),ei(this,"recentlyDeletedMap",new Map),ei(this,"recentlyDeletedLimit",200),ei(this,"relayMessageCache",[]),ei(this,"pendingSessions",new Map),ei(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(d2)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,h.toMiliseconds)(this.requestQueueDelay)))}),ei(this,"connect",async a=>{var b;this.isInitialized(),await this.confirmOnlineStateOrThrow();let c=eb(eh({},a),ec({requiredNamespaces:a.requiredNamespaces||{},optionalNamespaces:a.optionalNamespaces||{}}));await this.isValidConnect(c),c.optionalNamespaces=(0,k.mergeRequiredAndOptionalNamespaces)(c.requiredNamespaces,c.optionalNamespaces),c.requiredNamespaces={};let{pairingTopic:d,requiredNamespaces:e,optionalNamespaces:f,sessionProperties:g,scopedProperties:i,relays:j,authentication:l,walletPay:m}=c,o=(null==(b=l?.[0])?void 0:b.ttl)||d2.wc_sessionPropose.req.ttl||h.FIVE_MINUTES;this.validateRequestExpiry(o);let p=d,q,r=!1;try{if(p){let a=this.client.core.pairing.pairings.get(p);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),r=a.active}}catch(a){throw this.client.logger.error(`connect() -> pairing.get(${p}) failed`),a}if(!p||!r){let{topic:a,uri:b}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});p=a,q=b}if(!p){let{message:a}=(0,k.getInternalError)("NO_MATCHING_KEY",`connect() pairing topic: ${p}`);throw Error(a)}let s=await this.client.core.crypto.generateKeyPair(),t=(0,k.calcExpiry)(o),u=eh(eb(eh(eh({requiredNamespaces:e,optionalNamespaces:f,relays:j??[{protocol:"irn"}],proposer:{publicKey:s,metadata:this.client.metadata},expiryTimestamp:t,pairingTopic:p},g&&{sessionProperties:g}),i&&{scopedProperties:i}),ec({id:a0()})),(l||m)&&{requests:{authentication:l?.map(a=>{let{domain:b,chains:c,nonce:d,uri:e,exp:f,nbf:g,type:h,statement:i,requestId:j,resources:k,signatureTypes:l}=a;return{domain:b,chains:c,nonce:d,type:h??"caip122",aud:e,version:"1",iat:new Date().toISOString(),exp:f,nbf:g,statement:i,requestId:j,resources:k,signatureTypes:l}}),walletPay:m}}),v=(0,k.engineEvent)("session_connect",u.id),{reject:w,resolve:x,done:y}=(0,k.createDelayedPromise)(o,d0),z=({id:a})=>{a===u.id&&(this.client.events.off("proposal_expire",z),this.pendingSessions.delete(u.id),this.events.emit(v,{error:{message:d0,code:0}}))};return this.client.events.on("proposal_expire",z),this.events.once(v,({error:a,session:b})=>{this.client.events.off("proposal_expire",z),a?w(a):b&&x(b)}),await this.setProposal(u.id,u),await this.sendProposeSession({proposal:u,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:u.id}}}).catch(a=>{throw this.deleteProposal(u.id),a}),{uri:q,approval:y}}),ei(this,"pair",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(a)}catch(a){throw this.client.logger.error("pair() failed"),a}}),ei(this,"approve",async a=>{var b,c,d;let e=this.client.core.eventClient.createEvent({properties:{topic:null==(b=a?.id)?void 0:b.toString(),trace:[bU]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(a){throw e.setError("no_internet_connection"),a}try{await this.isValidProposalId(a?.id)}catch(b){throw this.client.logger.error(`approve() -> proposal.get(${a?.id}) failed`),e.setError("proposal_not_found"),b}try{await this.isValidApprove(a)}catch(a){throw this.client.logger.error("approve() -> isValidApprove() failed"),e.setError("session_approve_namespace_validation_failure"),a}let{id:f,relayProtocol:g,namespaces:h,sessionProperties:i,scopedProperties:j,sessionConfig:l,proposalRequestsResponses:m}=a,o=this.client.proposal.get(f);this.client.core.eventClient.deleteEvent({eventId:e.eventId});let{pairingTopic:p,proposer:q,requiredNamespaces:r,optionalNamespaces:s}=o,t=null==(c=this.client.core.eventClient)?void 0:c.getEvent({topic:p});t||(t=null==(d=this.client.core.eventClient)?void 0:d.createEvent({type:bU,properties:{topic:p,trace:[bU,"session_namespaces_validation_success"]}}));let u=await this.client.core.crypto.generateKeyPair(),v=q.publicKey,w=await this.client.core.crypto.generateSharedKey(u,v),x=eb(eh(eh(eh({relay:{protocol:g??"irn"},namespaces:h,controller:{publicKey:u,metadata:this.client.metadata},expiry:(0,k.calcExpiry)(d1)},i&&{sessionProperties:i}),j&&{scopedProperties:j}),l&&{sessionConfig:l}),ec({proposalRequestsResponses:m}));t.addTrace("subscribing_session_topic");try{await this.client.core.relayer.subscribe(w,{transportType:bC,internal:{skipSubscribe:!0}})}catch(a){throw t.setError("subscribe_session_topic_failure"),a}t.addTrace("subscribe_session_topic_success");let y=eb(eh({},x),ec({topic:w,requiredNamespaces:r,optionalNamespaces:s,pairingTopic:p,acknowledged:!1,self:x.controller,peer:{publicKey:q.publicKey,metadata:q.metadata},controller:u,transportType:bC,authentication:m?.authentication,walletPayResult:m?.walletPay}));await this.client.session.set(w,y),t.addTrace("store_session");try{await this.sendApproveSession({sessionTopic:w,proposal:o,pairingProposalResponse:{relay:{protocol:g??"irn"},responderPublicKey:u},sessionSettleRequest:x,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:eh({correlationId:f},this.getTVFApproveParams(y))}}),t.addTrace("session_approve_publish_success")}catch(a){throw this.client.logger.error(a),this.client.session.delete(w,(0,k.getSdkError)("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(w),a}return this.client.core.eventClient.deleteEvent({eventId:t.eventId}),await this.client.core.pairing.updateMetadata({topic:p,metadata:q.metadata}),await this.deleteProposal(f),await this.client.core.pairing.activate({topic:p}),await this.setExpiry(w,(0,k.calcExpiry)(d1)),{topic:w,acknowledged:()=>Promise.resolve(this.client.session.get(w))}}),ei(this,"reject",async a=>{let b;this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(a)}catch(a){throw this.client.logger.error("reject() -> isValidReject() failed"),a}let{id:c,reason:d}=a;try{b=this.client.proposal.get(c).pairingTopic}catch(a){throw this.client.logger.error(`reject() -> proposal.get(${c}) failed`),a}b&&await this.sendError({id:c,topic:b,error:d,rpcOpts:d2.wc_sessionPropose.reject}),await this.deleteProposal(c)}),ei(this,"update",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(a)}catch(a){throw this.client.logger.error("update() -> isValidUpdate() failed"),a}let{topic:b,namespaces:c}=a,{done:d,resolve:e,reject:f}=(0,k.createDelayedPromise)(h.FIVE_MINUTES,"Session update request expired without receiving any acknowledgement"),g=a0(),i=a1().toString(),j=this.client.session.get(b).namespaces;return this.events.once((0,k.engineEvent)("session_update",g),({error:a})=>{a?f(a):e()}),await this.client.session.update(b,{namespaces:c}),await this.sendRequest({topic:b,method:"wc_sessionUpdate",params:{namespaces:c},throwOnFailedPublish:!0,clientRpcId:g,relayRpcId:i}).catch(a=>{this.client.logger.error(a),this.client.session.update(b,{namespaces:j}),f(a)}),{acknowledged:d}}),ei(this,"extend",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(a)}catch(a){throw this.client.logger.error("extend() -> isValidExtend() failed"),a}let{topic:b}=a,c=a0(),{done:d,resolve:e,reject:f}=(0,k.createDelayedPromise)(h.FIVE_MINUTES,"Session extend request expired without receiving any acknowledgement");return this.events.once((0,k.engineEvent)("session_extend",c),({error:a})=>{a?f(a):e()}),await this.setExpiry(b,(0,k.calcExpiry)(d1)),this.sendRequest({topic:b,method:"wc_sessionExtend",params:{},clientRpcId:c,throwOnFailedPublish:!0}).catch(a=>{f(a)}),{acknowledged:d}}),ei(this,"request",async a=>{this.isInitialized();try{await this.isValidRequest(a)}catch(a){throw this.client.logger.error("request() -> isValidRequest() failed"),a}let{chainId:b,request:c,topic:d,expiry:e=d2.wc_sessionRequest.req.ttl}=a,f=this.client.session.get(d);f?.transportType===bC&&await this.confirmOnlineStateOrThrow();let g=a0(),h=a1().toString(),{done:i,resolve:j,reject:l}=(0,k.createDelayedPromise)(e,"Request expired. Please try again.");this.events.once((0,k.engineEvent)("session_request",g),({error:a,result:b})=>{a?l(a):j(b)});let m="wc_sessionRequest",o=this.getAppLinkIfEnabled(f.peer.metadata,f.transportType);if(o)return await this.sendRequest({clientRpcId:g,relayRpcId:h,topic:d,method:m,params:{request:eb(eh({},c),ec({expiryTimestamp:(0,k.calcExpiry)(e)})),chainId:b},expiry:e,throwOnFailedPublish:!0,appLink:o}).catch(a=>l(a)),this.client.events.emit("session_request_sent",{topic:d,request:c,chainId:b,id:g}),await i();let p={request:eb(eh({},c),ec({expiryTimestamp:(0,k.calcExpiry)(e)})),chainId:b};return await Promise.all([new Promise(async a=>{await this.sendRequest({clientRpcId:g,relayRpcId:h,topic:d,method:m,params:p,expiry:e,throwOnFailedPublish:!0,tvf:this.getTVFParams(g,p)}).catch(a=>l(a)),this.client.events.emit("session_request_sent",{topic:d,request:c,chainId:b,id:g}),a()}),new Promise(async a=>{var b;if(!(null!=(b=f.sessionConfig)&&b.disableDeepLink)){let a=await (0,k.getDeepLink)(this.client.core.storage,d_);await (0,k.handleDeeplinkRedirect)({id:g,topic:d,wcDeepLink:a})}a()}),i()]).then(a=>a[2])}),ei(this,"respond",async a=>{var b,c;this.isInitialized();let d=this.client.core.eventClient.createEvent({properties:{topic:a?.topic||(null==(c=null==(b=a?.response)?void 0:b.id)?void 0:c.toString()),trace:["session_request_response_started"]}});try{await this.isValidRespond(a)}catch(a){throw d.addTrace(a?.message),d.setError("session_request_response_validation_failure"),a}d.addTrace("session_request_response_validation_success");let{topic:e,response:f}=a,{id:g}=f,h=this.client.session.get(e);h.transportType===bC&&await this.confirmOnlineStateOrThrow();let i=this.getAppLinkIfEnabled(h.peer.metadata,h.transportType);try{d.addTrace("session_request_response_publish_started"),be(f)?await this.sendResult({id:g,topic:e,result:f.result,throwOnFailedPublish:!0,appLink:i}):bf(f)&&await this.sendError({id:g,topic:e,error:f.error,appLink:i}),this.cleanupAfterResponse(a)}catch(a){throw d.addTrace(a?.message),d.setError("session_request_response_publish_failure"),a}}),ei(this,"ping",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(a)}catch(a){throw this.client.logger.error("ping() -> isValidPing() failed"),a}let{topic:b}=a;if(this.client.session.keys.includes(b)){let a=a0(),c=a1().toString(),{done:d,resolve:e,reject:f}=(0,k.createDelayedPromise)(h.FIVE_MINUTES,"Ping request expired without receiving any acknowledgement");this.events.once((0,k.engineEvent)("session_ping",a),({error:a})=>{a?f(a):e()}),await Promise.all([this.sendRequest({topic:b,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:c}),d()])}else this.client.core.pairing.pairings.keys.includes(b)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:b}))}),ei(this,"emit",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(a);let{topic:b,event:c,chainId:d}=a,e=a1().toString(),f=a0();await this.sendRequest({topic:b,method:"wc_sessionEvent",params:{event:c,chainId:d},throwOnFailedPublish:!0,relayRpcId:e,clientRpcId:f})}),ei(this,"disconnect",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(a);let{topic:b}=a;if(this.client.session.keys.includes(b))await this.sendRequest({topic:b,method:"wc_sessionDelete",params:(0,k.getSdkError)("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:b,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(b))await this.client.core.pairing.disconnect({topic:b});else{let{message:a}=(0,k.getInternalError)("MISMATCHED_TOPIC",`Session or pairing topic not found: ${b}`);throw Error(a)}}),ei(this,"find",a=>(this.isInitialized(),this.client.session.getAll().filter(b=>(0,k.isSessionCompatible)(b,a)))),ei(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),ei(this,"authenticate",async(a,b)=>{var c;let d;this.isInitialized(),this.isValidAuthenticate(a);let e=b&&this.client.core.linkModeSupportedApps.includes(b)&&(null==(c=this.client.metadata.redirect)?void 0:c.linkMode),f=e?bB:bC;f===bC&&await this.confirmOnlineStateOrThrow();let{chains:g,statement:h="",uri:i,domain:j,nonce:l,type:m,exp:o,nbf:p,methods:q=[],expiry:r}=a,s=[...a.resources||[]],{topic:t,uri:u}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:f});this.client.logger.info({message:"Generated new pairing",pairing:{topic:t,uri:u}});let v=await this.client.core.crypto.generateKeyPair(),w=(0,k.hashKey)(v);if(await Promise.all([this.client.auth.authKeys.set(d9,{responseTopic:w,publicKey:v}),this.client.auth.pairingTopics.set(w,{topic:w,pairingTopic:t})]),await this.client.core.relayer.subscribe(w,{transportType:f}),this.client.logger.info(`sending request to new pairing topic: ${t}`),q.length>0){let{namespace:a}=(0,k.parseChainId)(g[0]),b=(0,k.createEncodedRecap)(a,"request",q);(0,k.getRecapFromResources)(s)&&(b=(0,k.mergeEncodedRecaps)(b,s.pop())),s.push(b)}let x=r&&r>d2.wc_sessionAuthenticate.req.ttl?r:d2.wc_sessionAuthenticate.req.ttl,y={authPayload:{type:m??"caip122",chains:g,statement:h,aud:i,domain:j,version:"1",nonce:l,iat:new Date().toISOString(),exp:o,nbf:p,resources:s},requester:{publicKey:v,metadata:this.client.metadata},expiryTimestamp:(0,k.calcExpiry)(x)},z={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:g,methods:[...new Set(["personal_sign",...q])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:t,proposer:{publicKey:v,metadata:this.client.metadata},expiryTimestamp:(0,k.calcExpiry)(d2.wc_sessionPropose.req.ttl),id:a0()},{done:A,resolve:B,reject:C}=(0,k.createDelayedPromise)(x,"Request expired"),D=a0(),E=(0,k.engineEvent)("session_connect",z.id),F=(0,k.engineEvent)("session_request",D),G=async({error:a,session:b})=>{this.events.off(F,H),a?C(a):b&&B({session:b})},H=async a=>{var c,d,e;let g;if(await this.deletePendingAuthRequest(D,{message:"fulfilled",code:0}),a.error){let b=(0,k.getSdkError)("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return a.error.code===b.code?void 0:(this.events.off(E,G),C(a.error.message))}await this.deleteProposal(z.id),this.events.off(E,G);let{cacaos:h,responder:i}=a.result,j=[],l=[];for(let a of h){await (0,k.validateSignedCacao)({cacao:a,projectId:this.client.core.projectId})||(this.client.logger.error(a,"Signature verification failed"),C((0,k.getSdkError)("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:b}=a,c=(0,k.getRecapFromResources)(b.resources),d=[(0,k.getNamespacedDidChainId)(b.iss)],e=(0,k.getDidAddress)(b.iss);if(c){let a=(0,k.getMethodsFromRecap)(c),b=(0,k.getChainsFromRecap)(c);j.push(...a),d.push(...b)}for(let a of d)l.push(`${a}:${e}`)}let m=await this.client.core.crypto.generateSharedKey(v,i.publicKey);j.length>0&&(g={topic:m,acknowledged:!0,self:{publicKey:v,metadata:this.client.metadata},peer:i,controller:i.publicKey,expiry:(0,k.calcExpiry)(d1),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:t,namespaces:(0,k.buildNamespacesFromAuth)([...new Set(j)],[...new Set(l)]),transportType:f},await this.client.core.relayer.subscribe(m,{transportType:f}),await this.client.session.set(m,g),t&&await this.client.core.pairing.updateMetadata({topic:t,metadata:i.metadata}),g=this.client.session.get(m)),null!=(c=this.client.metadata.redirect)&&c.linkMode&&null!=(d=i.metadata.redirect)&&d.linkMode&&null!=(e=i.metadata.redirect)&&e.universal&&b&&(this.client.core.addLinkModeSupportedApp(i.metadata.redirect.universal),this.client.session.update(m,{transportType:bB})),B({auths:h,session:g})};this.events.once(E,G),this.events.once(F,H);try{if(e){let a=a2("wc_sessionAuthenticate",y,D);this.client.core.history.set(t,a);let c=await this.client.core.crypto.encode("",a,{type:k.TYPE_2,encoding:k.BASE64URL});d=(0,k.getLinkModeURL)(b,t,c)}else await Promise.all([this.sendRequest({topic:t,method:"wc_sessionAuthenticate",params:y,expiry:a.expiry,throwOnFailedPublish:!0,clientRpcId:D}),this.sendRequest({topic:t,method:"wc_sessionPropose",params:z,expiry:d2.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:z.id})])}catch(a){throw this.events.off(E,G),this.events.off(F,H),a}return await this.setProposal(z.id,z),await this.setAuthRequest(D,{request:eb(eh({},y),ec({verifyContext:{}})),pairingTopic:t,transportType:f}),{uri:d??u,response:A}}),ei(this,"approveSessionAuthenticate",async a=>{let b,{id:c,auths:d}=a,e=this.client.core.eventClient.createEvent({properties:{topic:c.toString(),trace:["authenticated_session_approve_started"]}});try{this.isInitialized()}catch(a){throw e.setError("no_internet_connection"),a}let f=this.getPendingAuthRequest(c);if(!f)throw e.setError("authenticated_session_pending_request_not_found"),Error(`Could not find pending auth request with id ${c}`);let g=f.transportType||bC;g===bC&&await this.confirmOnlineStateOrThrow();let h=f.requester.publicKey,i=await this.client.core.crypto.generateKeyPair(),j=(0,k.hashKey)(h),l={type:k.TYPE_1,receiverPublicKey:h,senderPublicKey:i},m=[],o=[];for(let a of d){if(!await (0,k.validateSignedCacao)({cacao:a,projectId:this.client.core.projectId})){e.setError("invalid_cacao");let a=(0,k.getSdkError)("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:c,topic:j,error:a,encodeOpts:l}),Error(a.message)}e.addTrace("cacaos_verified");let{p:b}=a,d=(0,k.getRecapFromResources)(b.resources),f=[(0,k.getNamespacedDidChainId)(b.iss)],g=(0,k.getDidAddress)(b.iss);if(d){let a=(0,k.getMethodsFromRecap)(d),b=(0,k.getChainsFromRecap)(d);m.push(...a),f.push(...b)}for(let a of f)o.push(`${a}:${g}`)}let p=await this.client.core.crypto.generateSharedKey(i,h);if(e.addTrace("create_authenticated_session_topic"),m?.length>0){b={topic:p,acknowledged:!0,self:{publicKey:i,metadata:this.client.metadata},peer:{publicKey:h,metadata:f.requester.metadata},controller:h,expiry:(0,k.calcExpiry)(d1),authentication:d,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:f.pairingTopic,namespaces:(0,k.buildNamespacesFromAuth)([...new Set(m)],[...new Set(o)]),transportType:g},e.addTrace("subscribing_authenticated_session_topic");try{await this.client.core.relayer.subscribe(p,{transportType:g})}catch(a){throw e.setError("subscribe_authenticated_session_topic_failure"),a}e.addTrace("subscribe_authenticated_session_topic_success"),await this.client.session.set(p,b),e.addTrace("store_authenticated_session"),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:f.requester.metadata})}e.addTrace("publishing_authenticated_session_approve");try{await this.sendResult({topic:j,id:c,result:{cacaos:d,responder:{publicKey:i,metadata:this.client.metadata}},encodeOpts:l,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(f.requester.metadata,g)})}catch(a){throw e.setError("authenticated_session_approve_publish_failure"),a}return await this.client.auth.requests.delete(c,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:f.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:e.eventId}),{session:b}}),ei(this,"rejectSessionAuthenticate",async a=>{this.isInitialized();let{id:b,reason:c}=a,d=this.getPendingAuthRequest(b);if(!d)throw Error(`Could not find pending auth request with id ${b}`);d.transportType===bC&&await this.confirmOnlineStateOrThrow();let e=d.requester.publicKey,f=await this.client.core.crypto.generateKeyPair(),g=(0,k.hashKey)(e),h={type:k.TYPE_1,receiverPublicKey:e,senderPublicKey:f};await this.sendError({id:b,topic:g,error:c,encodeOpts:h,rpcOpts:d2.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(d.requester.metadata,d.transportType)}),await this.client.auth.requests.delete(b,{message:"rejected",code:0}),await this.deleteProposal(b)}),ei(this,"formatAuthMessage",a=>{this.isInitialized();let{request:b,iss:c}=a;return(0,k.formatMessage)(b,c)}),ei(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(0!==this.relayMessageCache.length)for(;this.relayMessageCache.length>0;)try{let a=this.relayMessageCache.shift();a&&await this.onRelayMessage(a)}catch(a){this.client.logger.error(a)}},50)}),ei(this,"cleanupDuplicatePairings",async a=>{if(a.pairingTopic)try{let b=this.client.core.pairing.pairings.get(a.pairingTopic),c=this.client.core.pairing.pairings.getAll().filter(c=>{var d,e;return(null==(d=c.peerMetadata)?void 0:d.url)&&(null==(e=c.peerMetadata)?void 0:e.url)===a.peer.metadata.url&&c.topic&&c.topic!==b.topic});if(0===c.length)return;this.client.logger.info(`Cleaning up ${c.length} duplicate pairing(s)`),await Promise.all(c.map(a=>this.client.core.pairing.disconnect({topic:a.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(a){this.client.logger.error(a)}}),ei(this,"deleteSession",async a=>{var b;let{topic:c,expirerHasDeleted:d=!1,emitEvent:e=!0,id:f=0}=a,{self:g}=this.client.session.get(c);await this.client.core.relayer.unsubscribe(c),await this.client.session.delete(c,(0,k.getSdkError)("USER_DISCONNECTED")),this.addToRecentlyDeleted(c,"session"),this.client.core.crypto.keychain.has(g.publicKey)&&await this.client.core.crypto.deleteKeyPair(g.publicKey),this.client.core.crypto.keychain.has(c)&&await this.client.core.crypto.deleteSymKey(c),d||this.client.core.expirer.del(c),this.client.core.storage.removeItem(d_).catch(a=>this.client.logger.warn(a)),c===(null==(b=this.sessionRequestQueue.queue[0])?void 0:b.topic)&&(this.sessionRequestQueue.state=d4),await Promise.all(this.getPendingSessionRequests().filter(a=>a.topic===c).map(a=>this.deletePendingSessionRequest(a.id,(0,k.getSdkError)("USER_DISCONNECTED")))),e&&this.client.events.emit("session_delete",{id:f,topic:c})}),ei(this,"deleteProposal",async(a,b)=>{if(b)try{let b=this.client.proposal.get(a),c=this.client.core.eventClient.getEvent({topic:b.pairingTopic});c?.setError("proposal_expired")}catch{}await Promise.all([this.client.proposal.delete(a,(0,k.getSdkError)("USER_DISCONNECTED")),b?Promise.resolve():this.client.core.expirer.del(a)]),this.addToRecentlyDeleted(a,"proposal")}),ei(this,"deletePendingSessionRequest",async(a,b,c=!1)=>{await Promise.all([this.client.pendingRequest.delete(a,b),c?Promise.resolve():this.client.core.expirer.del(a)]),this.addToRecentlyDeleted(a,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(b=>b.id!==a),c&&(this.sessionRequestQueue.state=d4,this.client.events.emit("session_request_expire",{id:a}))}),ei(this,"deletePendingAuthRequest",async(a,b,c=!1)=>{await Promise.all([this.client.auth.requests.delete(a,b),c?Promise.resolve():this.client.core.expirer.del(a)])}),ei(this,"setExpiry",async(a,b)=>{this.client.session.keys.includes(a)&&(this.client.core.expirer.set(a,b),await this.client.session.update(a,{expiry:b}))}),ei(this,"setProposal",async(a,b)=>{this.client.core.expirer.set(a,(0,k.calcExpiry)(d2.wc_sessionPropose.req.ttl)),await this.client.proposal.set(a,b)}),ei(this,"setAuthRequest",async(a,b)=>{let{request:c,pairingTopic:d,transportType:e=bC}=b;this.client.core.expirer.set(a,c.expiryTimestamp),await this.client.auth.requests.set(a,{authPayload:c.authPayload,requester:c.requester,expiryTimestamp:c.expiryTimestamp,id:a,pairingTopic:d,verifyContext:c.verifyContext,transportType:e})}),ei(this,"setPendingSessionRequest",async a=>{let{id:b,topic:c,params:d,verifyContext:e}=a,f=d.request.expiryTimestamp||(0,k.calcExpiry)(d2.wc_sessionRequest.req.ttl);this.client.core.expirer.set(b,f),await this.client.pendingRequest.set(b,{id:b,topic:c,params:d,verifyContext:e})}),ei(this,"sendRequest",async b=>{let c,d,{topic:e,method:f,params:g,expiry:h,relayRpcId:i,clientRpcId:j,throwOnFailedPublish:l,appLink:m,tvf:o,publishOpts:p={}}=b,q=a2(f,g,j),r=!!m;try{let a=r?k.BASE64URL:k.BASE64;c=await this.client.core.crypto.encode(e,q,{encoding:a})}catch(a){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${e} failed`),a}if(d7.includes(f)){let a=(0,k.hashMessage)(JSON.stringify(q)),b=(0,k.hashMessage)(c);d=await this.client.core.verify.register({id:b,decryptedId:a})}let s=eh(eh({},d2[f].req),p);if(s.attestation=d,h&&(s.ttl=h),i&&(s.id=i),this.client.core.history.set(e,q),r){let b=(0,k.getLinkModeURL)(m,e,c);await a.g.Linking.openURL(b,this.client.name)}else{let a;s.tvf=eb(eh({},o),ec({correlationId:q.id})),l?(a=eh({},s.internal),s.internal=eb(a,ec({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(e,c,s)):this.client.core.relayer.publish(e,c,s).catch(a=>this.client.logger.error(a))}return q.id}),ei(this,"sendProposeSession",async a=>{let{proposal:b,publishOpts:c}=a,d=a2("wc_sessionPropose",b,b.id);this.client.core.history.set(b.pairingTopic,d);let e=await this.client.core.crypto.encode(b.pairingTopic,d,{encoding:k.BASE64}),f=(0,k.hashMessage)(JSON.stringify(d)),g=(0,k.hashMessage)(e),h=await this.client.core.verify.register({id:g,decryptedId:f});await this.client.core.relayer.publishCustom({payload:{pairingTopic:b.pairingTopic,sessionProposal:e},opts:eb(eh({},c),ec({publishMethod:"wc_proposeSession",attestation:h}))})}),ei(this,"sendApproveSession",async a=>{let{sessionTopic:b,pairingProposalResponse:c,proposal:d,sessionSettleRequest:e,publishOpts:f}=a,g=a3(d.id,c),h=await this.client.core.crypto.encode(d.pairingTopic,g,{encoding:k.BASE64}),i=a2("wc_sessionSettle",e,f?.id),j=await this.client.core.crypto.encode(b,i,{encoding:k.BASE64});this.client.core.history.set(b,i),await this.client.core.relayer.publishCustom({payload:{sessionTopic:b,pairingTopic:d.pairingTopic,sessionProposalResponse:h,sessionSettlementRequest:j},opts:eb(eh({},f),ec({publishMethod:"wc_approveSession"}))})}),ei(this,"sendResult",async b=>{let c,d,e,{id:f,topic:g,result:h,throwOnFailedPublish:i,encodeOpts:j,appLink:l}=b,m=a3(f,h),o=l&&"u">typeof(null==a.g?void 0:a.g.Linking);try{let a,b,d=o?k.BASE64URL:k.BASE64;c=await this.client.core.crypto.encode(g,m,(a=eh({},j||{}),b={encoding:d},eb(a,ec(b))))}catch(a){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${g} failed`),a}try{let a=(d=await this.client.core.history.get(g,f)).request;try{e=this.getTVFParams(f,a.params,h)}catch(a){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${a?.message}`)}}catch(a){throw this.client.logger.error(`sendResult() -> history.get(${g}, ${f}) failed`),a}if(o){let b=(0,k.getLinkModeURL)(l,g,c);await a.g.Linking.openURL(b,this.client.name)}else{let a,b=d2[d.request.method].res;b.tvf=eb(eh({},e),ec({correlationId:f})),i?(a=eh({},b.internal),b.internal=eb(a,ec({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(g,c,b)):this.client.core.relayer.publish(g,c,b).catch(a=>this.client.logger.error(a))}await this.client.core.history.resolve(m)}),ei(this,"sendError",async b=>{let c,d,{id:e,topic:f,error:g,encodeOpts:h,rpcOpts:i,appLink:j}=b,l=a4(e,g),m=j&&"u">typeof(null==a.g?void 0:a.g.Linking);try{let a,b,d=m?k.BASE64URL:k.BASE64;c=await this.client.core.crypto.encode(f,l,(a=eh({},h||{}),b={encoding:d},eb(a,ec(b))))}catch(a){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${f} failed`),a}try{d=await this.client.core.history.get(f,e)}catch(a){throw this.client.logger.error(`sendError() -> history.get(${f}, ${e}) failed`),a}if(m){let b=(0,k.getLinkModeURL)(j,f,c);await a.g.Linking.openURL(b,this.client.name)}else{let a=d.request.method,b=i||d2[a].res;this.client.core.relayer.publish(f,c,b)}await this.client.core.history.resolve(l)}),ei(this,"cleanup",async()=>{let a=[],b=[];this.client.session.getAll().forEach(b=>{let c=!1;(0,k.isExpired)(b.expiry)&&(c=!0),this.client.core.crypto.keychain.has(b.topic)||(c=!0),c&&a.push(b.topic)}),this.client.proposal.getAll().forEach(a=>{(0,k.isExpired)(a.expiryTimestamp)&&b.push(a.id)}),await Promise.all([...a.map(a=>this.deleteSession({topic:a})),...b.map(a=>this.deleteProposal(a))])}),ei(this,"onProviderMessageEvent",async a=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(a):await this.onRelayMessage(a)}),ei(this,"onRelayEventRequest",async a=>{this.requestQueue.queue.push(a),await this.processRequestsQueue()}),ei(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===d5)return void this.client.logger.info("Request queue already active, skipping...");for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=d5;let a=this.requestQueue.queue.shift();if(a)try{await this.processRequest(a)}catch(a){this.client.logger.warn(a)}}this.requestQueue.state=d4}),ei(this,"processRequest",async a=>{let{topic:b,payload:c,attestation:d,transportType:e,encryptedId:f}=a,g=c.method;if(!this.shouldIgnorePairingRequest({topic:b,requestMethod:g}))switch(g){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:b,payload:c,attestation:d,encryptedId:f});case"wc_sessionSettle":return await this.onSessionSettleRequest(b,c);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(b,c);case"wc_sessionExtend":return await this.onSessionExtendRequest(b,c);case"wc_sessionPing":return await this.onSessionPingRequest(b,c);case"wc_sessionDelete":return await this.onSessionDeleteRequest(b,c);case"wc_sessionRequest":return await this.onSessionRequest({topic:b,payload:c,attestation:d,encryptedId:f,transportType:e});case"wc_sessionEvent":return await this.onSessionEventRequest(b,c);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:b,payload:c,attestation:d,encryptedId:f,transportType:e});default:return this.client.logger.info(`Unsupported request method ${g}`)}}),ei(this,"onRelayEventResponse",async a=>{let{topic:b,payload:c,transportType:d}=a,e=(await this.client.core.history.get(b,c.id)).request.method;switch(e){case"wc_sessionPropose":return this.onSessionProposeResponse(b,c,d);case"wc_sessionSettle":return this.onSessionSettleResponse(b,c);case"wc_sessionUpdate":return this.onSessionUpdateResponse(b,c);case"wc_sessionExtend":return this.onSessionExtendResponse(b,c);case"wc_sessionPing":return this.onSessionPingResponse(b,c);case"wc_sessionRequest":return this.onSessionRequestResponse(b,c);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(b,c);default:return this.client.logger.info(`Unsupported response method ${e}`)}}),ei(this,"onRelayEventUnknownPayload",a=>{let{topic:b}=a,{message:c}=(0,k.getInternalError)("MISSING_OR_INVALID",`Decoded payload on topic ${b} is not identifiable as a JSON-RPC request or a response.`);throw Error(c)}),ei(this,"shouldIgnorePairingRequest",a=>{let{topic:b,requestMethod:c}=a,d=this.expectedPairingMethodMap.get(b);return!(!d||d.includes(c))&&!!(d.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),ei(this,"onSessionProposeRequest",async a=>{let{topic:b,payload:c,attestation:d,encryptedId:e}=a,{params:f,id:g}=c;try{let a=this.client.core.eventClient.getEvent({topic:b});0===this.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),a?.setError("proposal_listener_not_found")),this.isValidConnect(eh({},c.params));let h=f.expiryTimestamp||(0,k.calcExpiry)(d2.wc_sessionPropose.req.ttl),i=eh({id:g,pairingTopic:b,expiryTimestamp:h,attestation:d,encryptedId:e},f);await this.setProposal(g,i);let j=await this.getVerifyContext({attestationId:d,hash:(0,k.hashMessage)(JSON.stringify(c)),encryptedId:e,metadata:i.proposer.metadata});a?.addTrace("emit_session_proposal"),this.client.events.emit("session_proposal",{id:g,params:i,verifyContext:j})}catch(a){await this.sendError({id:g,topic:b,error:a,rpcOpts:d2.wc_sessionPropose.autoReject}),this.client.logger.error(a)}}),ei(this,"onSessionProposeResponse",async(a,b,c)=>{let{id:d}=b;if(be(b)){let{result:e}=b;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:e});let f=this.client.proposal.get(d);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});let g=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});let h=e.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});let i=await this.client.core.crypto.generateSharedKey(g,h);this.pendingSessions.set(d,{sessionTopic:i,pairingTopic:a,proposalId:d,publicKey:g});let j=await this.client.core.relayer.subscribe(i,{transportType:c});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:j}),await this.client.core.pairing.activate({topic:a})}else if(bf(b)){await this.deleteProposal(d);let a=(0,k.engineEvent)("session_connect",d);if(0===this.events.listenerCount(a))throw Error(`emitting ${a} without any listeners, 954`);this.events.emit(a,{error:b.error})}}),ei(this,"onSessionSettleRequest",async(a,b)=>{let{id:c,params:d}=b;try{let c,e;this.isValidSessionSettleRequest(d);let{relay:f,controller:g,expiry:h,namespaces:i,sessionProperties:j,scopedProperties:l,sessionConfig:m,proposalRequestsResponses:o}=b.params,p=[...this.pendingSessions.values()].find(b=>b.sessionTopic===a);if(!p)return this.client.logger.error(`Pending session not found for topic ${a}`);let q=this.client.proposal.get(p.proposalId),r=(c=eh(eh(eh({topic:a,relay:f,expiry:h,namespaces:i,acknowledged:!0,pairingTopic:p.pairingTopic,requiredNamespaces:q.requiredNamespaces,optionalNamespaces:q.optionalNamespaces,controller:g.publicKey,self:{publicKey:p.publicKey,metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},j&&{sessionProperties:j}),l&&{scopedProperties:l}),m&&{sessionConfig:m}),e={transportType:bC,authentication:o?.authentication,walletPayResult:o?.walletPay},eb(c,ec(e)));await this.client.session.set(r.topic,r),await this.setExpiry(r.topic,r.expiry),await this.client.core.pairing.updateMetadata({topic:p.pairingTopic,metadata:r.peer.metadata}),this.pendingSessions.delete(p.proposalId),this.deleteProposal(p.proposalId,!1),this.cleanupDuplicatePairings(r),await this.sendResult({id:b.id,topic:a,throwOnFailedPublish:!0,result:!0}),this.client.events.emit("session_connect",{session:r}),this.events.emit((0,k.engineEvent)("session_connect",p.proposalId),{session:r})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),ei(this,"onSessionSettleResponse",async(a,b)=>{let{id:c}=b;be(b)?(await this.client.session.update(a,{acknowledged:!0}),this.events.emit((0,k.engineEvent)("session_approve",c),{})):bf(b)&&(await this.client.session.delete(a,(0,k.getSdkError)("USER_DISCONNECTED")),this.events.emit((0,k.engineEvent)("session_approve",c),{error:b.error}))}),ei(this,"onSessionUpdateRequest",async(a,b)=>{let{params:c,id:d}=b;try{let b=`${a}_session_update`,e=k.MemoryStore.get(b);if(e&&this.isRequestOutOfSync(e,d)){this.client.logger.warn(`Discarding out of sync request - ${d}`),this.sendError({id:d,topic:a,error:(0,k.getSdkError)("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(eh({topic:a},c));try{k.MemoryStore.set(b,d),await this.client.session.update(a,{namespaces:c.namespaces}),await this.sendResult({id:d,topic:a,result:!0})}catch(a){throw k.MemoryStore.delete(b),a}this.client.events.emit("session_update",{id:d,topic:a,params:c})}catch(b){await this.sendError({id:d,topic:a,error:b}),this.client.logger.error(b)}}),ei(this,"isRequestOutOfSync",(a,b)=>b.toString().slice(0,-3)<a.toString().slice(0,-3)),ei(this,"onSessionUpdateResponse",(a,b)=>{let{id:c}=b,d=(0,k.engineEvent)("session_update",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);be(b)?this.events.emit((0,k.engineEvent)("session_update",c),{}):bf(b)&&this.events.emit((0,k.engineEvent)("session_update",c),{error:b.error})}),ei(this,"onSessionExtendRequest",async(a,b)=>{let{id:c}=b;try{this.isValidExtend({topic:a}),await this.setExpiry(a,(0,k.calcExpiry)(d1)),await this.sendResult({id:c,topic:a,result:!0}),this.client.events.emit("session_extend",{id:c,topic:a})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),ei(this,"onSessionExtendResponse",(a,b)=>{let{id:c}=b,d=(0,k.engineEvent)("session_extend",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);be(b)?this.events.emit((0,k.engineEvent)("session_extend",c),{}):bf(b)&&this.events.emit((0,k.engineEvent)("session_extend",c),{error:b.error})}),ei(this,"onSessionPingRequest",async(a,b)=>{let{id:c}=b;try{this.isValidPing({topic:a}),await this.sendResult({id:c,topic:a,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:c,topic:a})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),ei(this,"onSessionPingResponse",(a,b)=>{let{id:c}=b,d=(0,k.engineEvent)("session_ping",c);setTimeout(()=>{if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners 2176`);be(b)?this.events.emit((0,k.engineEvent)("session_ping",c),{}):bf(b)&&this.events.emit((0,k.engineEvent)("session_ping",c),{error:b.error})},500)}),ei(this,"onSessionDeleteRequest",async(a,b)=>{let{id:c}=b;try{await this.isValidDisconnect({topic:a,reason:b.params}),this.cleanupPendingSentRequestsForTopic({topic:a,error:(0,k.getSdkError)("USER_DISCONNECTED")}),await this.deleteSession({topic:a,id:c})}catch(a){this.client.logger.error(a)}}),ei(this,"onSessionRequest",async a=>{var b,c,d;let{topic:e,payload:f,attestation:g,encryptedId:h,transportType:i}=a,{id:j,params:l}=f;try{await this.isValidRequest(eh({topic:e},l));let a=this.client.session.get(e),f=await this.getVerifyContext({attestationId:g,hash:(0,k.hashMessage)(JSON.stringify(a2("wc_sessionRequest",l,j))),encryptedId:h,metadata:a.peer.metadata,transportType:i}),m={id:j,topic:e,params:l,verifyContext:f};await this.setPendingSessionRequest(m),i===bB&&null!=(b=a.peer.metadata.redirect)&&b.universal&&this.client.core.addLinkModeSupportedApp(null==(c=a.peer.metadata.redirect)?void 0:c.universal),null!=(d=this.client.signConfig)&&d.disableRequestQueue?this.emitSessionRequest(m):(this.addSessionRequestToSessionRequestQueue(m),this.processSessionRequestQueue())}catch(a){await this.sendError({id:j,topic:e,error:a}),this.client.logger.error(a)}}),ei(this,"onSessionRequestResponse",(a,b)=>{let{id:c}=b,d=(0,k.engineEvent)("session_request",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);be(b)?this.events.emit((0,k.engineEvent)("session_request",c),{result:b.result}):bf(b)&&this.events.emit((0,k.engineEvent)("session_request",c),{error:b.error})}),ei(this,"onSessionEventRequest",async(a,b)=>{let{id:c,params:d}=b;try{let b=`${a}_session_event_${d.event.name}`,e=k.MemoryStore.get(b);if(e&&this.isRequestOutOfSync(e,c))return void this.client.logger.info(`Discarding out of sync request - ${c}`);this.isValidEmit(eh({topic:a},d)),this.client.events.emit("session_event",{id:c,topic:a,params:d}),k.MemoryStore.set(b,c)}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),ei(this,"onSessionAuthenticateResponse",(a,b)=>{let{id:c}=b;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:a,payload:b}),be(b)?this.events.emit((0,k.engineEvent)("session_request",c),{result:b.result}):bf(b)&&this.events.emit((0,k.engineEvent)("session_request",c),{error:b.error})}),ei(this,"onSessionAuthenticateRequest",async a=>{var b;let{topic:c,payload:d,attestation:e,encryptedId:f,transportType:g}=a;try{let{requester:a,authPayload:h,expiryTimestamp:i}=d.params,j=await this.getVerifyContext({attestationId:e,hash:(0,k.hashMessage)(JSON.stringify(d)),encryptedId:f,metadata:a.metadata,transportType:g}),l={requester:a,pairingTopic:c,id:d.id,authPayload:h,verifyContext:j,expiryTimestamp:i};await this.setAuthRequest(d.id,{request:l,pairingTopic:c,transportType:g}),g===bB&&null!=(b=a.metadata.redirect)&&b.universal&&this.client.core.addLinkModeSupportedApp(a.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:c,params:d.params,id:d.id,verifyContext:j})}catch(h){this.client.logger.error(h);let a=d.params.requester.publicKey,b=await this.client.core.crypto.generateKeyPair(),e=this.getAppLinkIfEnabled(d.params.requester.metadata,g),f={type:k.TYPE_1,receiverPublicKey:a,senderPublicKey:b};await this.sendError({id:d.id,topic:c,error:h,encodeOpts:f,rpcOpts:d2.wc_sessionAuthenticate.autoReject,appLink:e})}}),ei(this,"addSessionRequestToSessionRequestQueue",a=>{this.sessionRequestQueue.queue.push(a)}),ei(this,"cleanupAfterResponse",a=>{this.deletePendingSessionRequest(a.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=d4,this.processSessionRequestQueue()},(0,h.toMiliseconds)(this.requestQueueDelay))}),ei(this,"cleanupPendingSentRequestsForTopic",({topic:a,error:b})=>{let c=this.client.core.history.pending;c.length>0&&c.filter(b=>b.topic===a&&"wc_sessionRequest"===b.request.method).forEach(a=>{this.events.emit((0,k.engineEvent)("session_request",a.request.id),{error:b})})}),ei(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===d5)return void this.client.logger.info("session request queue is already active.");let a=this.sessionRequestQueue.queue[0];if(!a)return void this.client.logger.info("session request queue is empty.");try{this.emitSessionRequest(a)}catch(a){this.client.logger.error(a)}}),ei(this,"emitSessionRequest",a=>{this.emittedSessionRequests.has(a.id)?this.client.logger.warn({id:a.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${a.id}`):(this.sessionRequestQueue.state=d5,this.emittedSessionRequests.add(a.id),this.client.events.emit("session_request",a))}),ei(this,"onPairingCreated",a=>{if(a.methods&&this.expectedPairingMethodMap.set(a.topic,a.methods),a.active)return;let b=this.client.proposal.getAll().find(b=>b.pairingTopic===a.topic);b&&this.onSessionProposeRequest({topic:a.topic,payload:a2("wc_sessionPropose",eb(eh({},b),ec({requiredNamespaces:b.requiredNamespaces,optionalNamespaces:b.optionalNamespaces,relays:b.relays,proposer:b.proposer,sessionProperties:b.sessionProperties,scopedProperties:b.scopedProperties})),b.id),attestation:b.attestation,encryptedId:b.encryptedId})}),ei(this,"isValidConnect",async a=>{if(!(0,k.isValidParams)(a)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(a)}`);throw Error(b)}let{pairingTopic:b,requiredNamespaces:c,optionalNamespaces:d,sessionProperties:e,scopedProperties:f,relays:g}=a;if((0,k.isUndefined)(b)||await this.isValidPairingTopic(b),!(0,k.isValidRelays)(g,!0)){let{message:a}=(0,k.getInternalError)("MISSING_OR_INVALID",`connect() relays: ${g}`);throw Error(a)}if(c&&!(0,k.isUndefined)(c)&&0!==(0,k.isValidObject)(c)){let a="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(a):this.client.logger.warn(a),this.validateNamespaces(c,"requiredNamespaces")}if(d&&!(0,k.isUndefined)(d)&&0!==(0,k.isValidObject)(d)&&this.validateNamespaces(d,"optionalNamespaces"),e&&!(0,k.isUndefined)(e)&&this.validateSessionProps(e,"sessionProperties"),f&&!(0,k.isUndefined)(f)){this.validateSessionProps(f,"scopedProperties");let a=Object.keys(c||{}).concat(Object.keys(d||{}));if(!Object.keys(f).every(b=>a.includes(b.split(":")[0])))throw Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(f)}, required/optional namespaces: ${JSON.stringify(a)}`)}}),ei(this,"validateNamespaces",(a,b)=>{let c=(0,k.isValidRequiredNamespaces)(a,"connect()",b);if(c)throw Error(c.message)}),ei(this,"isValidApprove",async a=>{if(!(0,k.isValidParams)(a))throw Error((0,k.getInternalError)("MISSING_OR_INVALID",`approve() params: ${a}`).message);let{id:b,namespaces:c,relayProtocol:d,sessionProperties:e,scopedProperties:f}=a;this.checkRecentlyDeleted(b),await this.isValidProposalId(b);let g=this.client.proposal.get(b),h=(0,k.isValidNamespaces)(c,"approve()");if(h)throw Error(h.message);let i=(0,k.isConformingNamespaces)(g.requiredNamespaces,c,"approve()");if(i)throw Error(i.message);if(!(0,k.isValidString)(d,!0)){let{message:a}=(0,k.getInternalError)("MISSING_OR_INVALID",`approve() relayProtocol: ${d}`);throw Error(a)}if(e&&!(0,k.isUndefined)(e)&&this.validateSessionProps(e,"sessionProperties"),f&&!(0,k.isUndefined)(f)){this.validateSessionProps(f,"scopedProperties");let a=new Set(Object.keys(c));if(!Object.keys(f).every(b=>a.has(b.split(":")[0])))throw Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(f)}, approved namespaces: ${Array.from(a).join(", ")}`)}}),ei(this,"isValidReject",async a=>{if(!(0,k.isValidParams)(a)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`reject() params: ${a}`);throw Error(b)}let{id:b,reason:c}=a;if(this.checkRecentlyDeleted(b),await this.isValidProposalId(b),!(0,k.isValidErrorReason)(c)){let{message:a}=(0,k.getInternalError)("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(c)}`);throw Error(a)}}),ei(this,"isValidSessionSettleRequest",a=>{if(!(0,k.isValidParams)(a)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${a}`);throw Error(b)}let{relay:b,controller:c,namespaces:d,expiry:e}=a;if(!(0,k.isValidRelay)(b)){let{message:a}=(0,k.getInternalError)("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw Error(a)}let f=(0,k.isValidController)(c,"onSessionSettleRequest()");if(f)throw Error(f.message);let g=(0,k.isValidNamespaces)(d,"onSessionSettleRequest()");if(g)throw Error(g.message);if((0,k.isExpired)(e)){let{message:a}=(0,k.getInternalError)("EXPIRED","onSessionSettleRequest()");throw Error(a)}}),ei(this,"isValidUpdate",async a=>{if(!(0,k.isValidParams)(a)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`update() params: ${a}`);throw Error(b)}let{topic:b,namespaces:c}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b);let d=this.client.session.get(b),e=(0,k.isValidNamespaces)(c,"update()");if(e)throw Error(e.message);let f=(0,k.isConformingNamespaces)(d.requiredNamespaces,c,"update()");if(f)throw Error(f.message)}),ei(this,"isValidExtend",async a=>{if(!(0,k.isValidParams)(a)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`extend() params: ${a}`);throw Error(b)}let{topic:b}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b)}),ei(this,"isValidRequest",async a=>{if(!(0,k.isValidParams)(a)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`request() params: ${a}`);throw Error(b)}let{topic:b,request:c,chainId:d,expiry:e}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b);let{namespaces:f}=this.client.session.get(b);if(!(0,k.isValidNamespacesChainId)(f,d)){let{message:a}=(0,k.getInternalError)("MISSING_OR_INVALID",`request() chainId: ${d}`);throw Error(a)}if(!(0,k.isValidRequest)(c)){let{message:a}=(0,k.getInternalError)("MISSING_OR_INVALID",`request() ${JSON.stringify(c)}`);throw Error(a)}if(!(0,k.isValidNamespacesRequest)(f,d,c.method)){let{message:a}=(0,k.getInternalError)("MISSING_OR_INVALID",`request() method: ${c.method}`);throw Error(a)}this.validateRequestExpiry(e)}),ei(this,"isValidRespond",async a=>{var b;if(!(0,k.isValidParams)(a)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`respond() params: ${a}`);throw Error(b)}let{topic:c,response:d}=a;try{await this.isValidSessionTopic(c)}catch(c){throw null!=(b=a?.response)&&b.id&&this.cleanupAfterResponse(a),c}if(!(0,k.isValidResponse)(d)){let{message:a}=(0,k.getInternalError)("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(d)}`);throw Error(a)}let e=this.client.pendingRequest.get(d.id);if(e.topic!==c){let{message:a}=(0,k.getInternalError)("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${d.id}, expected topic: ${e.topic}, received topic: ${c}`);throw Error(a)}}),ei(this,"isValidPing",async a=>{if(!(0,k.isValidParams)(a)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`ping() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidSessionOrPairingTopic(b)}),ei(this,"isValidEmit",async a=>{if(!(0,k.isValidParams)(a)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`emit() params: ${a}`);throw Error(b)}let{topic:b,event:c,chainId:d}=a;await this.isValidSessionTopic(b);let{namespaces:e}=this.client.session.get(b);if(!(0,k.isValidNamespacesChainId)(e,d)){let{message:a}=(0,k.getInternalError)("MISSING_OR_INVALID",`emit() chainId: ${d}`);throw Error(a)}if(!(0,k.isValidEvent)(c)||!(0,k.isValidNamespacesEvent)(e,d,c.name)){let{message:a}=(0,k.getInternalError)("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(c)}`);throw Error(a)}}),ei(this,"isValidDisconnect",async a=>{if(!(0,k.isValidParams)(a)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`disconnect() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidSessionOrPairingTopic(b)}),ei(this,"isValidAuthenticate",a=>{let{chains:b,uri:c,domain:d,nonce:e}=a;if(!Array.isArray(b)||0===b.length)throw Error("chains is required and must be a non-empty array");if(!(0,k.isValidString)(c,!1))throw Error("uri is required parameter");if(!(0,k.isValidString)(d,!1))throw Error("domain is required parameter");if(!(0,k.isValidString)(e,!1))throw Error("nonce is required parameter");if([...new Set(b.map(a=>(0,k.parseChainId)(a).namespace))].length>1)throw Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:f}=(0,k.parseChainId)(b[0]);if("eip155"!==f)throw Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),ei(this,"getVerifyContext",async a=>{let{attestationId:b,hash:c,encryptedId:d,metadata:e,transportType:f}=a,g={verified:{verifyUrl:e.verifyUrl||bQ,validation:"UNKNOWN",origin:e.url||""}};try{if(f===bB){let a=this.getAppLinkIfEnabled(e,f);return g.verified.validation=a&&new URL(a).origin===new URL(e.url).origin?"VALID":"INVALID",g}let a=await this.client.core.verify.resolve({attestationId:b,hash:c,encryptedId:d,verifyUrl:e.verifyUrl});a&&(g.verified.origin=a.origin,g.verified.isScam=a.isScam,g.verified.validation=a.origin===new URL(e.url).origin?"VALID":"INVALID")}catch(a){this.client.logger.warn(a)}return this.client.logger.debug(`Verify context: ${JSON.stringify(g)}`),g}),ei(this,"validateSessionProps",(a,b)=>{Object.values(a).forEach((c,d)=>{if(null==c){let{message:e}=(0,k.getInternalError)("MISSING_OR_INVALID",`${b} must contain an existing value for each key. Received: ${c} for key ${Object.keys(a)[d]}`);throw Error(e)}})}),ei(this,"getPendingAuthRequest",a=>{let b=this.client.auth.requests.get(a);return"object"==typeof b?b:void 0}),ei(this,"addToRecentlyDeleted",(a,b)=>{if(this.recentlyDeletedMap.set(a,b),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let a=0,b=this.recentlyDeletedLimit/2;for(let c of this.recentlyDeletedMap.keys()){if(a++>=b)break;this.recentlyDeletedMap.delete(c)}}}),ei(this,"checkRecentlyDeleted",a=>{let b=this.recentlyDeletedMap.get(a);if(b){let{message:c}=(0,k.getInternalError)("MISSING_OR_INVALID",`Record was recently deleted - ${b}: ${a}`);throw Error(c)}}),ei(this,"isLinkModeEnabled",(b,c)=>{var d,e,f,g,h,i,j,k,l;return!!b&&c===bB&&(null==(e=null==(d=this.client.metadata)?void 0:d.redirect)?void 0:e.linkMode)===!0&&(null==(g=null==(f=this.client.metadata)?void 0:f.redirect)?void 0:g.universal)!==void 0&&(null==(i=null==(h=this.client.metadata)?void 0:h.redirect)?void 0:i.universal)!==""&&(null==(j=b?.redirect)?void 0:j.universal)!==void 0&&(null==(k=b?.redirect)?void 0:k.universal)!==""&&(null==(l=b?.redirect)?void 0:l.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(b.redirect.universal)&&"u">typeof(null==a.g?void 0:a.g.Linking)}),ei(this,"getAppLinkIfEnabled",(a,b)=>{var c;return this.isLinkModeEnabled(a,b)?null==(c=a?.redirect)?void 0:c.universal:void 0}),ei(this,"handleLinkModeMessage",({url:a})=>{if(!a||!a.includes("wc_ev")||!a.includes("topic"))return;let b=(0,k.getSearchParamFromURL)(a,"topic")||"",c=decodeURIComponent((0,k.getSearchParamFromURL)(a,"wc_ev")||""),d=this.client.session.keys.includes(b);d&&this.client.session.update(b,{transportType:bB}),this.client.core.dispatchEnvelope({topic:b,message:c,sessionExists:d})}),ei(this,"registerLinkModeListeners",async()=>{var b;if((0,k.isTestRun)()||(0,k.isReactNative)()&&null!=(b=this.client.metadata.redirect)&&b.linkMode){let b=null==a.g?void 0:a.g.Linking;if("u">typeof b){b.addEventListener("url",this.handleLinkModeMessage,this.client.name);let a=await b.getInitialURL();a&&setTimeout(()=>{this.handleLinkModeMessage({url:a})},50)}}}),ei(this,"getTVFApproveParams",a=>{try{let b=(0,k.getNamespacesChains)(a.namespaces),c=(0,k.getNamespacesMethods)(a.namespaces),d=(0,k.getNamespacesEvents)(a.namespaces),e=a.sessionProperties,f=a.scopedProperties;return{approvedChains:b,approvedMethods:c,approvedEvents:d,sessionProperties:e,scopedProperties:f}}catch(a){return this.client.logger.warn(a,"Error getting TVF approve params"),{}}}),ei(this,"getTVFParams",(a,b,c)=>{var d,e,f;if(!(null!=(d=b.request)&&d.method))return{};let g={correlationId:a,rpcMethods:[b.request.method],chainId:b.chainId};try{g.txHashes=this.extractTxHashesFromResult(b.request,c),g.contractAddresses=this.isValidContractData(b.request.params)?[null==(f=null==(e=b.request.params)?void 0:e[0])?void 0:f.to]:[]}catch(a){this.client.logger.warn(a,"Error getting TVF params")}return g}),ei(this,"isValidContractData",a=>{var b;if(!a)return!1;try{let c=a?.data||(null==(b=a?.[0])?void 0:b.data);if(!c.startsWith("0x"))return!1;let d=c.slice(2);return!!/^[0-9a-fA-F]*$/.test(d)&&d.length%2==0}catch{}return!1}),ei(this,"extractTxHashesFromResult",(a,b)=>{var c;try{if(!b)return[];let d=a.method,e=d6[d];if("sui_signTransaction"===d)return[(0,k.getSuiDigest)(b.transactionBytes)];if("near_signTransaction"===d)return[(0,k.getNearTransactionIdFromSignedTransaction)(b)];if("near_signTransactions"===d)return b.map(a=>(0,k.getNearTransactionIdFromSignedTransaction)(a));if("xrpl_signTransactionFor"===d||"xrpl_signTransaction"===d)return[null==(c=b.tx_json)?void 0:c.hash];if("polkadot_signTransaction"===d)return[(0,k.buildSignedExtrinsicHash)({transaction:a.params.transactionPayload,signature:b.signature})];if("algo_signTxn"===d)return(0,k.isValidArray)(b)?b.map(a=>(0,k.getAlgorandTransactionId)(a)):[(0,k.getAlgorandTransactionId)(b)];if("cosmos_signDirect"===d)return[(0,k.getSignDirectHash)(b)];if("wallet_sendCalls"===d)return(0,k.getWalletSendCallsHashes)(b);if("string"==typeof b)return[b];let f=b[e.key];if((0,k.isValidArray)(f))return"solana_signAllTransactions"===d?f.map(a=>(0,k.extractSolanaTransactionId)(a)):f;if("string"==typeof f)return[f]}catch(a){this.client.logger.warn(a,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{let a=this.client.session.keys,b=this.client.core.relayer.messages.getWithoutAck(a);for(let[a,c]of Object.entries(b))for(let b of c)try{await this.onProviderMessageEvent({topic:a,message:b,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${a}, message: ${b}`)}}catch(a){this.client.logger.warn(a,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){let{message:a}=(0,k.getInternalError)("NOT_INITIALIZED",this.name);throw Error(a)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(bs,a=>{this.onProviderMessageEvent(a)})}async onRelayMessage(a){let{topic:b,message:c,attestation:d,transportType:e}=a,{publicKey:f}=this.client.auth.authKeys.keys.includes(d9)?this.client.auth.authKeys.get(d9):{responseTopic:void 0,publicKey:void 0};try{let a=await this.client.core.crypto.decode(b,c,{receiverPublicKey:f,encoding:e===bB?k.BASE64URL:k.BASE64});bc(a)?(this.client.core.history.set(b,a),await this.onRelayEventRequest({topic:b,payload:a,attestation:d,transportType:e,encryptedId:(0,k.hashMessage)(c)})):bd(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:b,payload:a,transportType:e}),this.client.core.history.delete(b,a.id)):(this.client.logger.error(`onRelayMessage() -> unknown payload: ${JSON.stringify(a)}`),await this.onRelayEventUnknownPayload({topic:b,payload:a,transportType:e})),await this.client.core.relayer.messages.ack(b,c)}catch(a){this.client.logger.error(`onRelayMessage() -> failed to process an inbound message: ${c}`),this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(bP,async a=>{let{topic:b,id:c}=(0,k.parseExpirerTarget)(a.target);return c&&this.client.pendingRequest.keys.includes(c)?await this.deletePendingSessionRequest(c,(0,k.getInternalError)("EXPIRED"),!0):c&&this.client.auth.requests.keys.includes(c)?await this.deletePendingAuthRequest(c,(0,k.getInternalError)("EXPIRED"),!0):void(b?this.client.session.keys.includes(b)&&(await this.deleteSession({topic:b,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:b})):c&&(await this.deleteProposal(c,!0),this.client.events.emit("proposal_expire",{id:c})))})}registerPairingEvents(){this.client.core.pairing.events.on(bI,a=>this.onPairingCreated(a)),this.client.core.pairing.events.on(bJ,a=>{this.addToRecentlyDeleted(a.topic,"pairing")})}isValidPairingTopic(a){if(!(0,k.isValidString)(a,!1)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`pairing topic should be a string: ${a}`);throw Error(b)}if(!this.client.core.pairing.pairings.keys.includes(a)){let{message:b}=(0,k.getInternalError)("NO_MATCHING_KEY",`pairing topic doesn't exist: ${a}`);throw Error(b)}if((0,k.isExpired)(this.client.core.pairing.pairings.get(a).expiry)){let{message:b}=(0,k.getInternalError)("EXPIRED",`pairing topic: ${a}`);throw Error(b)}}async isValidSessionTopic(a){if(!(0,k.isValidString)(a,!1)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`session topic should be a string: ${a}`);throw Error(b)}if(this.checkRecentlyDeleted(a),!this.client.session.keys.includes(a)){let{message:b}=(0,k.getInternalError)("NO_MATCHING_KEY",`session topic doesn't exist: ${a}`);throw Error(b)}if((0,k.isExpired)(this.client.session.get(a).expiry)){await this.deleteSession({topic:a});let{message:b}=(0,k.getInternalError)("EXPIRED",`session topic: ${a}`);throw Error(b)}if(!this.client.core.crypto.keychain.has(a)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`session topic does not exist in keychain: ${a}`);throw await this.deleteSession({topic:a}),Error(b)}}async isValidSessionOrPairingTopic(a){if(this.checkRecentlyDeleted(a),this.client.session.keys.includes(a))await this.isValidSessionTopic(a);else if(this.client.core.pairing.pairings.keys.includes(a))this.isValidPairingTopic(a);else if((0,k.isValidString)(a,!1)){let{message:b}=(0,k.getInternalError)("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${a}`);throw Error(b)}else{let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`session or pairing topic should be a string: ${a}`);throw Error(b)}}async isValidProposalId(a){if(!(0,k.isValidId)(a)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`proposal id should be a number: ${a}`);throw Error(b)}if(!this.client.proposal.keys.includes(a)){let{message:b}=(0,k.getInternalError)("NO_MATCHING_KEY",`proposal id doesn't exist: ${a}`);throw Error(b)}if((0,k.isExpired)(this.client.proposal.get(a).expiryTimestamp)){await this.deleteProposal(a);let{message:b}=(0,k.getInternalError)("EXPIRED",`proposal id: ${a}`);throw Error(b)}}validateRequestExpiry(a){if(a&&!(0,k.isValidRequestExpiry)(a,d3)){let{message:b}=(0,k.getInternalError)("MISSING_OR_INVALID",`request() expiry: ${a}. Expiry must be a number (in seconds) between ${d3.min} and ${d3.max}`);throw Error(b)}}}class ek extends ds{constructor(a,b){super(a,b,"proposal",d$),this.core=a,this.logger=b}}class el extends ds{constructor(a,b){super(a,b,"session",d$),this.core=a,this.logger=b}}class em extends ds{constructor(a,b){super(a,b,"request",d$,a=>a.id),this.core=a,this.logger=b}}class en extends ds{constructor(a,b){super(a,b,"authKeys",d8,()=>d9),this.core=a,this.logger=b}}class eo extends ds{constructor(a,b){super(a,b,"pairingTopics",d8),this.core=a,this.logger=b}}class ep extends ds{constructor(a,b){super(a,b,"requests",d8,a=>a.id),this.core=a,this.logger=b}}var eq=Object.defineProperty,er=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?eq(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class es{constructor(a,b){this.core=a,this.logger=b,er(this,"authKeys"),er(this,"pairingTopics"),er(this,"requests"),this.authKeys=new en(this.core,this.logger),this.pairingTopics=new eo(this.core,this.logger),this.requests=new ep(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var et=Object.defineProperty,eu=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?et(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class ev extends dY.ISignClient{constructor(a){super(a),eu(this,"protocol","wc"),eu(this,"version",2),eu(this,"name",dZ),eu(this,"metadata"),eu(this,"core"),eu(this,"logger"),eu(this,"events",new c.EventEmitter),eu(this,"engine"),eu(this,"session"),eu(this,"proposal"),eu(this,"pendingRequest"),eu(this,"auth"),eu(this,"signConfig"),eu(this,"on",(a,b)=>this.events.on(a,b)),eu(this,"once",(a,b)=>this.events.once(a,b)),eu(this,"off",(a,b)=>this.events.off(a,b)),eu(this,"removeListener",(a,b)=>this.events.removeListener(a,b)),eu(this,"removeAllListeners",a=>this.events.removeAllListeners(a)),eu(this,"connect",async a=>{try{return await this.engine.connect(a)}catch(a){throw this.logger.error(a.message),a}}),eu(this,"pair",async a=>{try{return await this.engine.pair(a)}catch(a){throw this.logger.error(a.message),a}}),eu(this,"approve",async a=>{try{return await this.engine.approve(a)}catch(a){throw this.logger.error(a.message),a}}),eu(this,"reject",async a=>{try{return await this.engine.reject(a)}catch(a){throw this.logger.error(a.message),a}}),eu(this,"update",async a=>{try{return await this.engine.update(a)}catch(a){throw this.logger.error(a.message),a}}),eu(this,"extend",async a=>{try{return await this.engine.extend(a)}catch(a){throw this.logger.error(a.message),a}}),eu(this,"request",async a=>{try{return await this.engine.request(a)}catch(a){throw this.logger.error(a.message),a}}),eu(this,"respond",async a=>{try{return await this.engine.respond(a)}catch(a){throw this.logger.error(a.message),a}}),eu(this,"ping",async a=>{try{return await this.engine.ping(a)}catch(a){throw this.logger.error(a.message),a}}),eu(this,"emit",async a=>{try{return await this.engine.emit(a)}catch(a){throw this.logger.error(a.message),a}}),eu(this,"disconnect",async a=>{try{return await this.engine.disconnect(a)}catch(a){throw this.logger.error(a.message),a}}),eu(this,"find",a=>{try{return this.engine.find(a)}catch(a){throw this.logger.error(a.message),a}}),eu(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(a){throw this.logger.error(a.message),a}}),eu(this,"authenticate",async(a,b)=>{try{return await this.engine.authenticate(a,b)}catch(a){throw this.logger.error(a.message),a}}),eu(this,"formatAuthMessage",a=>{try{return this.engine.formatAuthMessage(a)}catch(a){throw this.logger.error(a.message),a}}),eu(this,"approveSessionAuthenticate",async a=>{try{return await this.engine.approveSessionAuthenticate(a)}catch(a){throw this.logger.error(a.message),a}}),eu(this,"rejectSessionAuthenticate",async a=>{try{return await this.engine.rejectSessionAuthenticate(a)}catch(a){throw this.logger.error(a.message),a}}),this.name=a?.name||dZ,this.metadata=(0,k.populateAppMetadata)(a?.metadata),this.signConfig=a?.signConfig;const b=(0,k.createLogger)({logger:a?.logger||"error",name:this.name});this.logger=b,this.core=a?.core||new dX(a),this.session=new el(this.core,this.logger),this.proposal=new ek(this.core,this.logger),this.pendingRequest=new em(this.core,this.logger),this.engine=new ej(this),this.auth=new es(this.core,this.logger)}static async init(a){let b=new ev(a);return await b.initialize(),b}get context(){return(0,f.getLoggerContext)(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(a){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(a.message),a}}}var ew=a.i(837591),ex=Object.defineProperty,ey=Object.defineProperties,ez=Object.getOwnPropertyDescriptors,eA=Object.getOwnPropertySymbols,eB=Object.prototype.hasOwnProperty,eC=Object.prototype.propertyIsEnumerable,eD=(a,b,c)=>b in a?ex(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,eE=(a,b)=>{for(var c in b||(b={}))eB.call(b,c)&&eD(a,c,b[c]);if(eA)for(var c of eA(b))eC.call(b,c)&&eD(a,c,b[c]);return a};let eF={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"};class eG{constructor(a,b=!1){if(this.url=a,this.disableProviderPing=b,this.events=new c.EventEmitter,this.isAvailable=!1,this.registering=!1,!a9(a))throw Error(`Provided URL is not compatible with HTTP connection: ${a}`);this.url=a,this.disableProviderPing=b}get connected(){return this.isAvailable}get connecting(){return this.registering}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async open(a=this.url){await this.register(a)}async close(){if(!this.isAvailable)throw Error("Connection already closed");this.onClose()}async send(a){this.isAvailable||await this.register();try{let b,c,d=(0,i.safeJsonStringify)(a),e=await (await (0,ew.default)(this.url,(b=eE({},eF),c={body:d},ey(b,ez(c))))).json();this.onPayload({data:e})}catch(b){this.onError(a.id,b)}}async register(a=this.url){if(!a9(a))throw Error(`Provided URL is not compatible with HTTP connection: ${a}`);if(this.registering){let a=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=a||this.events.listenerCount("open")>=a)&&this.events.setMaxListeners(a+1),new Promise((a,b)=>{this.events.once("register_error",a=>{this.resetMaxListeners(),b(a)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return b(Error("HTTP connection is missing or invalid"));a()})})}this.url=a,this.registering=!0;try{if(!this.disableProviderPing){let b,c,d=(0,i.safeJsonStringify)({id:1,jsonrpc:"2.0",method:"test",params:[]});await (0,ew.default)(a,(b=eE({},eF),c={body:d},ey(b,ez(c))))}this.onOpen()}catch(b){let a=this.parseError(b);throw this.events.emit("register_error",a),this.onClose(),a}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(a){if(typeof a.data>"u")return;let b="string"==typeof a.data?(0,i.safeJsonParse)(a.data):a.data;this.events.emit("payload",b)}onError(a,b){let c=this.parseError(b),d=a4(a,c.message||c.toString());this.events.emit("payload",d)}parseError(a,b=this.url){return a$(a,b,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>10&&this.events.setMaxListeners(10)}}function eH(a){return null==a||"object"!=typeof a&&"function"!=typeof a}function eI(a){return Object.getOwnPropertySymbols(a).filter(b=>Object.prototype.propertyIsEnumerable.call(a,b))}function eJ(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":Object.prototype.toString.call(a)}let eK="[object String]",eL="[object Number]",eM="[object Boolean]",eN="[object Arguments]";function eO(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)}function eP(a,b,c,d=new Map,e){let f=e?.(a,b,c,d);if(null!=f)return f;if(eH(a))return a;if(d.has(a))return d.get(a);if(Array.isArray(a)){let b=Array(a.length);d.set(a,b);for(let f=0;f<a.length;f++)b[f]=eP(a[f],f,c,d,e);return Object.hasOwn(a,"index")&&(b.index=a.index),Object.hasOwn(a,"input")&&(b.input=a.input),b}if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp){let b=new RegExp(a.source,a.flags);return b.lastIndex=a.lastIndex,b}if(a instanceof Map){let b=new Map;for(let[f,g]of(d.set(a,b),a))b.set(f,eP(g,f,c,d,e));return b}if(a instanceof Set){let b=new Set;for(let f of(d.set(a,b),a))b.add(eP(f,void 0,c,d,e));return b}if("u">typeof Buffer&&Buffer.isBuffer(a))return a.subarray();if(eO(a)){let b=new(Object.getPrototypeOf(a)).constructor(a.length);d.set(a,b);for(let f=0;f<a.length;f++)b[f]=eP(a[f],f,c,d,e);return b}if(a instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&a instanceof SharedArrayBuffer)return a.slice(0);if(a instanceof DataView){let b=new DataView(a.buffer.slice(0),a.byteOffset,a.byteLength);return d.set(a,b),eQ(b,a,c,d,e),b}if("u">typeof File&&a instanceof File){let b=new File([a],a.name,{type:a.type});return d.set(a,b),eQ(b,a,c,d,e),b}if(a instanceof Blob){let b=new Blob([a],{type:a.type});return d.set(a,b),eQ(b,a,c,d,e),b}if(a instanceof Error){let b=new a.constructor;return d.set(a,b),b.message=a.message,b.name=a.name,b.stack=a.stack,b.cause=a.cause,eQ(b,a,c,d,e),b}if("object"==typeof a&&function(a){switch(eJ(a)){case eN:case"[object Array]":case"[object ArrayBuffer]":case"[object DataView]":case eM:case"[object Date]":case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Map]":case eL:case"[object Object]":case"[object RegExp]":case"[object Set]":case eK:case"[object Symbol]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return!0;default:return!1}}(a)){let b=Object.create(Object.getPrototypeOf(a));return d.set(a,b),eQ(b,a,c,d,e),b}return a}function eQ(a,b,c=a,d,e){let f=[...Object.keys(b),...eI(b)];for(let g=0;g<f.length;g++){let h=f[g],i=Object.getOwnPropertyDescriptor(a,h);(null==i||i.writable)&&(a[h]=eP(b[h],h,c,d,e))}}function eR(a){var b;return b=(b,c,d,e)=>{let f;if(null!=f)return f;if("object"==typeof a)switch(Object.prototype.toString.call(a)){case eL:case eK:case eM:{let b=new a.constructor(a?.valueOf());return eQ(b,a),b}case eN:{let b={};return eQ(b,a),b.length=a.length,b[Symbol.iterator]=a[Symbol.iterator],b}default:return}},eP(a,void 0,a,new Map,b)}function eS(a){return null!==a&&"object"==typeof a&&"[object Arguments]"===eJ(a)}function eT(a){return"object"==typeof a&&null!==a}function eU(){}let eV="error",eW="universal_provider",eX=`wc@2:${eW}:`,eY="https://rpc.walletconnect.org/v1/",eZ="generic",e$=`${eY}bundler`,e_="call_status",e0="default_chain_changed";var e1=Object.defineProperty,e2=Object.defineProperties,e3=Object.getOwnPropertyDescriptors,e4=Object.getOwnPropertySymbols,e5=Object.prototype.hasOwnProperty,e6=Object.prototype.propertyIsEnumerable,e7=(a,b,c)=>b in a?e1(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,e8=(a,b)=>{for(var c in b||(b={}))e5.call(b,c)&&e7(a,c,b[c]);if(e4)for(var c of e4(b))e6.call(b,c)&&e7(a,c,b[c]);return a},e9=(a,b)=>e2(a,e3(b));function fa(a,b,c){var d;let e=(0,k.parseChainId)(a);return(null==(d=b.rpcMap)?void 0:d[e.reference])||`${eY}?chainId=${e.namespace}:${e.reference}&projectId=${c}`}function fb(a){return a.map(a=>`${a.split(":")[0]}:${a.split(":")[1]}`)}function fc(a){return Object.fromEntries(Object.entries(a).filter(([a,b])=>{var c,d;return(null==(c=b?.chains)?void 0:c.length)&&(null==(d=b?.chains)?void 0:d.length)>0}))}function fd(a={},b={}){return function(a,...b){return function(a,...b){let c=b.slice(0,-1),d=b[b.length-1],e=a;for(let a=0;a<c.length;a++)e=function a(b,c,d,e){if(eH(b)&&(b=Object(b)),null==c||"object"!=typeof c)return b;if(e.has(c))return function(a){if(eH(a))return a;if(Array.isArray(a)||eO(a)||a instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&a instanceof SharedArrayBuffer)return a.slice(0);let b=Object.getPrototypeOf(a),c=b.constructor;if(a instanceof Date||a instanceof Map||a instanceof Set)return new c(a);if(a instanceof RegExp){let b=new c(a);return b.lastIndex=a.lastIndex,b}if(a instanceof DataView)return new c(a.buffer.slice(0));if(a instanceof Error){let b=new c(a.message);return b.stack=a.stack,b.name=a.name,b.cause=a.cause,b}return"u">typeof File&&a instanceof File?new c([a],a.name,{type:a.type,lastModified:a.lastModified}):"object"==typeof a?Object.assign(Object.create(b),a):a}(e.get(c));if(e.set(c,b),Array.isArray(c)){c=c.slice();for(let a=0;a<c.length;a++)c[a]=c[a]??void 0}let f=[...Object.keys(c),...eI(c)];for(let g=0;g<f.length;g++){let h=f[g],i=c[h],j=b[h];if(eS(i)&&(i={...i}),eS(j)&&(j={...j}),"u">typeof Buffer&&Buffer.isBuffer(i)&&(i=eR(i)),Array.isArray(i))if("object"==typeof j&&null!=j){let a=[],b=Reflect.ownKeys(j);for(let c=0;c<b.length;c++){let d=b[c];a[d]=j[d]}j=a}else j=[];let k=d(j,i,h,b,c,e);null!=k?b[h]=k:Array.isArray(i)||eT(j)&&eT(i)?b[h]=a(j,i,d,e):null==j&&function(a){if("object"!=typeof a||null==a)return!1;if(null===Object.getPrototypeOf(a))return!0;if("[object Object]"!==Object.prototype.toString.call(a)){let b=a[Symbol.toStringTag];return null!=b&&!!Object.getOwnPropertyDescriptor(a,Symbol.toStringTag)?.writable&&a.toString()===`[object ${b}]`}let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b}(i)?b[h]=a({},i,d,e):null==j&&eO(i)?b[h]=eR(i):(void 0===j||void 0!==i)&&(b[h]=i)}return b}(e,c[a],d,new Map);return e}(a,...b,eU)}(fc(fe(a)),fc(fe(b)))}function fe(a){var b,c,d,e,f;let g={};if(!(0,k.isValidObject)(a))return g;for(let[h,i]of Object.entries(a)){let a=(0,k.isCaipNamespace)(h)?[h]:i.chains,j=i.methods||[],l=i.events||[],m=i.rpcMap||{},o=(0,k.parseNamespaceKey)(h);g[o]=e9(e8(e8({},g[o]),i),{chains:(0,k.mergeArrays)(a,null==(b=g[o])?void 0:b.chains),methods:(0,k.mergeArrays)(j,null==(c=g[o])?void 0:c.methods),events:(0,k.mergeArrays)(l,null==(d=g[o])?void 0:d.events)}),((0,k.isValidObject)(m)||(0,k.isValidObject)((null==(e=g[o])?void 0:e.rpcMap)||{}))&&(g[o].rpcMap=e8(e8({},m),null==(f=g[o])?void 0:f.rpcMap))}return g}function ff(a){return a.includes(":")?a.split(":")[2]:a}function fg(a){let b={};for(let[c,d]of Object.entries(a)){let a=d.methods||[],e=d.events||[],f=d.accounts||[],g=(0,k.isCaipNamespace)(c)?[c]:d.chains?d.chains:fb(d.accounts);b[c]={chains:g,methods:a,events:e,accounts:f}}return b}function fh(a){return"number"==typeof a?a:a.includes("0x")?parseInt(a,16):isNaN(Number(a=a.includes(":")?a.split(":")[1]:a))?a:Number(a)}let fi={},fj=a=>fi[a],fk=(a,b)=>{fi[a]=b};var fl=Object.defineProperty,fm=Object.getOwnPropertySymbols,fn=Object.prototype.hasOwnProperty,fo=Object.prototype.propertyIsEnumerable,fp=(a,b,c)=>b in a?fl(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,fq=(a,b)=>{for(var c in b||(b={}))fn.call(b,c)&&fp(a,c,b[c]);if(fm)for(var c of fm(b))fo.call(b,c)&&fp(a,c,b[c]);return a};let fr="eip155",fs=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],ft=a=>a&&a.startsWith("0x")?BigInt(a).toString(10):a,fu=a=>a&&a.startsWith("0x")?a:`0x${BigInt(a).toString(16)}`,fv=a=>Object.keys(a).filter(a=>fs.includes(a)).reduce((b,c)=>(b[c]=fw(a[c]),b),{}),fw=a=>"string"==typeof a&&function(a){try{let b=JSON.parse(a);return"object"==typeof b&&null!==b&&!Array.isArray(b)}catch{return!1}}(a)?JSON.parse(a):a;var fx=Object.defineProperty;class fy{constructor(a){((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?fx(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"storage"),this.storage=a}async getItem(a){return await this.storage.getItem(a)}async setItem(a,b){return await this.storage.setItem(a,b)}async removeItem(a){return await this.storage.removeItem(a)}static getStorage(a){return b||(b=new fy(a)),b}}var fz=Object.defineProperty,fA=Object.defineProperties,fB=Object.getOwnPropertyDescriptors,fC=Object.getOwnPropertySymbols,fD=Object.prototype.hasOwnProperty,fE=Object.prototype.propertyIsEnumerable,fF=(a,b,c)=>b in a?fz(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c;async function fG(a,b){let c,d=(0,k.parseChainId)(a.result.capabilities.caip345.caip2),e=a.result.capabilities.caip345.transactionHashes,f=await Promise.allSettled(e.map(a=>fH(d.reference,a,b))),g=f.filter(a=>"fulfilled"===a.status).map(a=>a.value).filter(a=>a);f.filter(a=>"rejected"===a.status).forEach(a=>console.warn("Failed to fetch transaction receipt:",a.reason));let h=!g.length||g.some(a=>!a),i=g.every(a=>a?.status==="0x1"),j=g.every(a=>a?.status==="0x0"),l=g.some(a=>a?.status==="0x0");return h?c=100:i?c=200:j?c=500:l&&(c=600),{id:a.result.id,version:a.request.version,atomic:a.request.atomicRequired,chainId:a.request.chainId,capabilities:a.result.capabilities,receipts:g,status:c}}async function fH(a,b,c){return await c(parseInt(a)).request(a2("eth_getTransactionReceipt",[b]))}async function fI({sendCalls:a,storage:b}){let c=await b.getItem(e_);await b.setItem(e_,fA(((a,b)=>{for(var c in b||(b={}))fD.call(b,c)&&fF(a,c,b[c]);if(fC)for(var c of fC(b))fE.call(b,c)&&fF(a,c,b[c]);return a})({},c),fB({[a.result.id]:{request:a.request,result:a.result,expiry:(0,k.calcExpiry)(86400)}})))}async function fJ({resultId:a,storage:b}){let c=await b.getItem(e_);if(c){for(let d in delete c[a],await b.setItem(e_,c),c)(0,k.isExpired)(c[d].expiry)&&delete c[d];await b.setItem(e_,c)}}async function fK({resultId:a,storage:b}){let c=await b.getItem(e_),d=c?.[a];if(d&&!(0,k.isExpired)(d.expiry))return d;await fJ({resultId:a,storage:b})}var fL=Object.defineProperty,fM=Object.defineProperties,fN=Object.getOwnPropertyDescriptors,fO=Object.getOwnPropertySymbols,fP=Object.prototype.hasOwnProperty,fQ=Object.prototype.propertyIsEnumerable,fR=(a,b,c)=>b in a?fL(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,fS=(a,b)=>{for(var c in b||(b={}))fP.call(b,c)&&fR(a,c,b[c]);if(fO)for(var c of fO(b))fQ.call(b,c)&&fR(a,c,b[c]);return a},fT=(a,b,c)=>fR(a,"symbol"!=typeof b?b+"":b,c);class fU{constructor(a){fT(this,"name","eip155"),fT(this,"client"),fT(this,"chainId"),fT(this,"namespace"),fT(this,"httpProviders"),fT(this,"events"),fT(this,"storage"),this.namespace=a.namespace,this.events=fj("events"),this.client=fj("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=fy.getStorage(this.client.core.storage)}async request(a){switch(a.request.method){case"eth_requestAccounts":case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(a);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(a);case"wallet_getCallsStatus":return await this.getCallStatus(a);case"wallet_sendCalls":return await this.sendCalls(a)}return this.namespace.methods.includes(a.request.method)?await this.client.request(a):this.getHttpProvider().request(a.request)}updateNamespace(a){this.namespace=Object.assign(this.namespace,a)}setDefaultChain(a,b){this.httpProviders[a]||this.setHttpProvider(parseInt(a),b);let c=this.chainId;this.chainId=parseInt(a),this.events.emit(e0,{currentCaipChainId:`${this.name}:${a}`,previousCaipChainId:`${this.name}:${c}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}createHttpProvider(a,b){return new bg(new eG(b||fa(`${this.name}:${a}`,this.namespace,this.client.core.projectId),fj("disableProviderPing")))}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProviders(){let a={};return this.namespace.chains.forEach(b=>{var c;let d=parseInt(b.includes(":")?b.split(":")[1]:b);a[d]=this.createHttpProvider(d,null==(c=this.namespace.rpcMap)?void 0:c[b])}),a}getAccounts(){let a=this.namespace.accounts;return a?[...new Set(a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2]))]:[]}getHttpProvider(a){let b=a||this.chainId;return this.httpProviders[b]||(this.httpProviders=fM(fS({},this.httpProviders),fN({[b]:this.createHttpProvider(b)})),this.httpProviders[b])}async handleSwitchChain(a){var b,c;let d=a.request.params?null==(b=a.request.params[0])?void 0:b.chainId:"0x0",e=parseInt(d=d.startsWith("0x")?d:`0x${d}`,16);if(this.isChainApproved(e))this.setDefaultChain(`${e}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:a.topic,request:{method:a.request.method,params:[{chainId:d}]},chainId:null==(c=this.namespace.chains)?void 0:c[0]}),this.setDefaultChain(`${e}`);else throw Error(`Failed to switch to chain 'eip155:${e}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(a){return this.namespace.chains.includes(`${this.name}:${a}`)}async getCapabilities(a){var b,c,d,e,f;let g,h=null==(c=null==(b=a.request)?void 0:b.params)?void 0:c[0],i=(null==(e=null==(d=a.request)?void 0:d.params)?void 0:e[1])||[];if(!h)throw Error("Missing address parameter in `wallet_getCapabilities` request");let j=this.client.session.get(a.topic),l=(null==(f=j?.sessionProperties)?void 0:f.capabilities)||{},m=`${h}${i.join(",")}`,o=l?.[m];if(o)return o;try{g=((a,b,c)=>{let{sessionProperties:d={},scopedProperties:e={}}=a,f={};if(!(0,k.isValidObject)(e)&&!(0,k.isValidObject)(d))return;let g=fv(d);for(let a of c){let c=ft(a);if(!c)continue;f[fu(c)]=g;let d=e?.[`${fr}:${c}`];if(d){let a=d?.[`${fr}:${c}:${b}`];f[fu(c)]=fq(fq({},f[fu(c)]),fv(a||d))}}for(let[a,b]of Object.entries(f))0===Object.keys(b).length&&delete f[a];return Object.keys(f).length>0?f:void 0})(j,h,i)}catch(a){console.warn("Failed to extract capabilities from session",a)}if(g)return g;let p=await this.client.request(a);try{let b,c,d,e;await this.client.session.update(a.topic,{sessionProperties:(d=fS({},j.sessionProperties||{}),e={capabilities:(b=fS({},l||{}),c={[m]:p},fM(b,fN(c)))},fM(d,fN(e)))})}catch(a){console.warn("Failed to update session with capabilities",a)}return p}async getCallStatus(a){var b,c,d;let e=this.client.session.get(a.topic),f=null==(b=e.sessionProperties)?void 0:b.bundler_name;if(f){let b=this.getBundlerUrl(a.chainId,f);try{return await this.getUserOperationReceipt(b,a)}catch(a){console.warn("Failed to fetch call status from bundler",a,b)}}let g=null==(c=e.sessionProperties)?void 0:c.bundler_url;if(g)try{return await this.getUserOperationReceipt(g,a)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,g)}let h=await fK({resultId:null==(d=a.request.params)?void 0:d[0],storage:this.storage});if(h)try{return await fG(h,this.getHttpProvider.bind(this))}catch(a){console.warn("Failed to fetch call status from stored send calls",a,h)}if(this.namespace.methods.includes(a.request.method))return await this.client.request(a);throw Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(a,b){var c;let d=new URL(a),e=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a2("eth_getUserOperationReceipt",[null==(c=b.request.params)?void 0:c[0]]))});if(!e.ok)throw Error(`Failed to fetch user operation receipt - ${e.status}`);return await e.json()}getBundlerUrl(a,b){return`${e$}?projectId=${this.client.core.projectId}&chainId=${a}&bundler=${b}`}async sendCalls(a){var b,c,d;let e=await this.client.request(a),f=null==(b=a.request.params)?void 0:b[0],g=e?.id,h=e?.capabilities||{},i=null==(c=h?.caip345)?void 0:c.caip2,j=null==(d=h?.caip345)?void 0:d.transactionHashes;return g&&i&&null!=j&&j.length&&await fI({sendCalls:{request:f,result:e},storage:this.storage}),e}}var fV=Object.defineProperty,fW=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?fV(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class fX{constructor(a){fW(this,"name",eZ),fW(this,"client"),fW(this,"httpProviders"),fW(this,"events"),fW(this,"namespace"),fW(this,"chainId"),this.namespace=a.namespace,this.events=fj("events"),this.client=fj("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(a){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(a.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(a.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(a.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(a.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(a){return this.namespace.methods.includes(a.request.method)?this.client.request(a):this.getHttpProvider(a.chainId).request(a.request)}setDefaultChain(a,b){this.httpProviders[a]||this.setHttpProvider(a,b);let c=this.chainId;this.chainId=a,this.events.emit(e0,{currentCaipChainId:`${this.name}:${a}`,previousCaipChainId:`${this.name}:${c}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}getNamespaceName(){let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return(0,k.parseChainId)(a).namespace}getAccounts(){let a=this.namespace.accounts;return a?[...new Set(a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2]))]:[]}createHttpProviders(){var a,b;let c={};return null==(b=null==(a=this.namespace)?void 0:a.accounts)||b.forEach(a=>{var b,d;let e=(0,k.parseChainId)(a),f=null==(d=null==(b=this.namespace)?void 0:b.rpcMap)?void 0:d[`${e.namespace}:${e.reference}`];c[e.reference]=this.createHttpProvider(a,f)}),c}getHttpProvider(a){let b=(0,k.parseChainId)(a).reference,c=this.httpProviders[b];if(typeof c>"u")throw Error(`JSON-RPC provider for ${a} not found`);return c}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProvider(a,b){return new bg(new eG(b||fa(a,this.namespace,this.client.core.projectId),fj("disableProviderPing")))}}var fY=Object.defineProperty,fZ=Object.defineProperties,f$=Object.getOwnPropertyDescriptors,f_=Object.getOwnPropertySymbols,f0=Object.prototype.hasOwnProperty,f1=Object.prototype.propertyIsEnumerable,f2=(a,b,c)=>b in a?fY(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,f3=(a,b)=>{for(var c in b||(b={}))f0.call(b,c)&&f2(a,c,b[c]);if(f_)for(var c of f_(b))f1.call(b,c)&&f2(a,c,b[c]);return a},f4=(a,b,c)=>f2(a,"symbol"!=typeof b?b+"":b,c);class f5{constructor(a){var b,d;f4(this,"client"),f4(this,"namespaces"),f4(this,"optionalNamespaces"),f4(this,"sessionProperties"),f4(this,"scopedProperties"),f4(this,"events",new c.default),f4(this,"rpcProviders",{}),f4(this,"session"),f4(this,"providerOpts"),f4(this,"logger"),f4(this,"uri"),f4(this,"disableProviderPing",!1),f4(this,"connectParams"),this.providerOpts=a,this.logger=(0,k.createLogger)({logger:null!=(b=a.logger)?b:eV,name:null!=(d=this.providerOpts.name)?d:eW}),this.disableProviderPing=a?.disableProviderPing||!1}static async init(a){let b=new f5(a);return await b.initialize(),b}async request(a,b,c){let[d,e]=this.validateChain(b);if(!this.session)throw Error("Please call connect() before request()");return await this.getProvider(d).request({request:f3({},a),chainId:`${d}:${e}`,topic:this.session.topic,expiry:c})}sendAsync(a,b,c,d){let e=new Date().getTime();this.request(a,c,d).then(a=>b(null,a3(e,a))).catch(a=>b(a,void 0))}async enable(){if(!this.client)throw Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var a;if(!this.session)throw Error("Please call connect() before enable()");await this.client.disconnect({topic:null==(a=this.session)?void 0:a.topic,reason:(0,k.getSdkError)("USER_DISCONNECTED")}),await this.cleanup()}async connect(a){if(!this.client)throw Error("Sign Client not initialized");if(this.connectParams=a,this.setNamespaces(a),this.cleanupPendingPairings(),!a.skipPairing)return await this.pair(a.pairingTopic)}async authenticate(a,b){if(!this.client)throw Error("Sign Client not initialized");this.setNamespaces(a),await this.cleanupPendingPairings();let{uri:c,response:d}=await this.client.authenticate(a,b);c&&(this.uri=c,this.events.emit("display_uri",c));let e=await d();if(this.session=e.session,this.session){let a=fg(this.session.namespaces);this.namespaces=fd(this.namespaces,a),await this.persist("namespaces",this.namespaces),this.onConnect()}return e}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}removeListener(a,b){this.events.removeListener(a,b)}off(a,b){this.events.off(a,b)}get isWalletConnect(){return!0}async pair(a){var b,c;let{uri:d,approval:e}=await this.client.connect({pairingTopic:a,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties,authentication:null==(b=this.connectParams)?void 0:b.authentication,walletPay:null==(c=this.connectParams)?void 0:c.walletPay});d&&(this.uri=d,this.events.emit("display_uri",d));let f=await e();this.session=f;let g=fg(f.namespaces);return this.namespaces=fd(this.namespaces,g),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(a,b){try{if(!this.session)return;let[c,d]=this.validateChain(a);this.getProvider(c).setDefaultChain(d,b)}catch(a){if(!/Please call connect/.test(a.message))throw a}}async cleanupPendingPairings(a={}){try{this.logger.info("Cleaning up inactive pairings...");let b=this.client.pairing.getAll();if(!(0,k.isValidArray)(b))return;for(let c of b)a.deletePairings?this.client.core.expirer.set(c.topic,0):await this.client.core.relayer.subscriber.unsubscribe(c.topic);this.logger.info(`Inactive pairings cleared: ${b.length}`)}catch(a){this.logger.warn(a,"Failed to cleanup pending pairings")}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var a,b;if(this.client=this.providerOpts.client||await ev.init({core:this.providerOpts.core,logger:this.providerOpts.logger||eV,relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.org",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(c){throw this.logger.error(c,"Failed to get session"),Error(`The provided session: ${null==(b=null==(a=this.providerOpts)?void 0:a.session)?void 0:b.topic} doesn't exist in the Sign client`)}else{let a=this.client.session.getAll();this.session=a[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw Error("Sign Client not initialized");if(!this.session)throw Error("Session not initialized. Please call connect() before enable()");let a=[...new Set(Object.keys(this.session.namespaces).map(a=>(0,k.parseNamespaceKey)(a)))];fk("client",this.client),fk("events",this.events),fk("disableProviderPing",this.disableProviderPing),a.forEach(a=>{if(!this.session)return;let b=function(a,b){let c=Object.keys(b.namespaces).filter(b=>b.includes(a));if(!c.length)return[];let d=[];return c.forEach(a=>{let c=b.namespaces[a].accounts;d.push(...c)}),d}(a,this.session);if(b?.length===0)return;let c=fb(b),d=fZ(f3({},fd(this.namespaces,this.optionalNamespaces)[a]),f$({accounts:b,chains:c}));"eip155"===a?this.rpcProviders[a]=new fU({namespace:d}):this.rpcProviders[a]=new fX({namespace:d})})}registerEventListeners(){if(typeof this.client>"u")throw Error("Sign Client is not initialized");this.client.on("session_ping",a=>{var b;let{topic:c}=a;c===(null==(b=this.session)?void 0:b.topic)&&this.events.emit("session_ping",a)}),this.client.on("session_event",a=>{var b;let{params:c,topic:d}=a;if(d!==(null==(b=this.session)?void 0:b.topic))return;let{event:e}=c;if("accountsChanged"===e.name){let a=e.data;a&&(0,k.isValidArray)(a)&&this.events.emit("accountsChanged",a.map(ff))}else if("chainChanged"===e.name){let a=c.chainId,b=c.event.data,d=(0,k.parseNamespaceKey)(a),e=fh(a)!==fh(b)?`${d}:${fh(b)}`:a;this.onChainChanged({currentCaipChainId:e})}else this.events.emit(e.name,e.data);this.events.emit("session_event",a)}),this.client.on("session_update",({topic:a,params:b})=>{var c,d;if(a!==(null==(c=this.session)?void 0:c.topic))return;let{namespaces:e}=b,f=null==(d=this.client)?void 0:d.session.get(a);this.session=fZ(f3({},f),f$({namespaces:e})),this.onSessionUpdate(),this.events.emit("session_update",{topic:a,params:b})}),this.client.on("session_delete",async a=>{var b;a.topic===(null==(b=this.session)?void 0:b.topic)&&(await this.cleanup(),this.events.emit("session_delete",a),this.events.emit("disconnect",fZ(f3({},(0,k.getSdkError)("USER_DISCONNECTED")),f$({data:a.topic}))))}),this.on(e0,a=>{this.onChainChanged(fZ(f3({},a),f$({internal:!0})))})}getProvider(a){return this.rpcProviders[a]||this.rpcProviders[eZ]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(a=>{var b;this.getProvider(a).updateNamespace(null==(b=this.session)?void 0:b.namespaces[a])})}setNamespaces(a){let{namespaces:b={},optionalNamespaces:c={},sessionProperties:d,scopedProperties:e}=a;this.optionalNamespaces=fd(b,c),this.sessionProperties=d,this.scopedProperties=e}validateChain(a){let[b,c]=a?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[b,c];if(b&&!Object.keys(this.namespaces||{}).map(a=>(0,k.parseNamespaceKey)(a)).includes(b))throw Error(`Namespace '${b}' is not configured. Please call connect() first with namespace config.`);if(b&&c)return[b,c];let d=(0,k.parseNamespaceKey)(Object.keys(this.namespaces)[0]),e=this.rpcProviders[d].getDefaultChain();return[d,e]}async requestAccounts(){let[a]=this.validateChain();return await this.getProvider(a).requestAccounts()}async onChainChanged({currentCaipChainId:a,previousCaipChainId:b,internal:c=!1}){if(!this.namespaces)return;let[d,e]=this.validateChain(a);e&&(this.updateNamespaceChain(d,e),c?(this.events.emit("chainChanged",e),this.emitAccountsChangedOnChainChange({namespace:d,currentCaipChainId:a,previousCaipChainId:b})):this.getProvider(d).setDefaultChain(e),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:a,currentCaipChainId:b,previousCaipChainId:c}){var d,e;try{if(c===b)return;let f=null==(e=null==(d=this.session)?void 0:d.namespaces[a])?void 0:e.accounts;if(!f)return;let g=f.filter(a=>a.includes(`${b}:`)).map(ff);if(!(0,k.isValidArray)(g))return;this.events.emit("accountsChanged",g)}catch(a){this.logger.warn(a,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(a,b){if(!this.namespaces)return;let c=this.namespaces[a]?a:`${a}:${b}`;this.namespaces[c]?this.namespaces[c]&&(this.namespaces[c].defaultChain=b):this.namespaces[c]={chains:[],methods:[],events:[],defaultChain:b}}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.connectParams=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(a,b){var c;let d=(null==(c=this.session)?void 0:c.topic)||"";await this.client.core.storage.setItem(`${eX}/${a}${d}`,b)}async getFromStore(a){var b;let c=(null==(b=this.session)?void 0:b.topic)||"";return await this.client.core.storage.getItem(`${eX}/${a}${c}`)}async deleteFromStore(a){var b;let c=(null==(b=this.session)?void 0:b.topic)||"";await this.client.core.storage.removeItem(`${eX}/${a}${c}`)}async cleanupStorage(){var a;try{if((null==(a=this.client)?void 0:a.session.length)>0)return;for(let a of(await this.client.core.storage.getKeys()))a.startsWith(eX)&&await this.client.core.storage.removeItem(a)}catch(a){this.logger.warn(a,"Failed to cleanup storage")}}}a.s(["UniversalProvider",()=>f5,"default",()=>f5],109260)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__fd69cfb9._.js.map