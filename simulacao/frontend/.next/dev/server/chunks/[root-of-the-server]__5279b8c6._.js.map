{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///Users/silvis/Documents/revolucao-cibernetica/frontend/src/app/api/metrics/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { register, collectDefaultMetrics, Counter, Histogram } from 'prom-client'\n\n// Configuração para export estático (desabilita em modo demo)\nexport const dynamic = 'force-dynamic'\nexport const revalidate = 0\n\n// Coletar métricas padrão do Node.js (CPU, memória, etc)\ncollectDefaultMetrics({ register })\n\n// Contador de requisições HTTP\nexport const httpRequestsTotal = new Counter({\n  name: 'http_requests_total',\n  help: 'Total de requisições HTTP',\n  labelNames: ['method', 'route', 'status_code'],\n  registers: [register],\n})\n\n// Histograma de duração das requisições\nexport const httpRequestDuration = new Histogram({\n  name: 'http_request_duration_seconds',\n  help: 'Duração das requisições HTTP em segundos',\n  labelNames: ['method', 'route', 'status_code'],\n  buckets: [0.005, 0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1, 2.5, 5, 10],\n  registers: [register],\n})\n\n// Contador de erros\nexport const httpRequestErrors = new Counter({\n  name: 'http_request_errors_total',\n  help: 'Total de erros HTTP',\n  labelNames: ['method', 'route', 'error_type'],\n  registers: [register],\n})\n\n// Gauge para Web Vitals\nimport { Gauge } from 'prom-client'\n\nexport const webVitalsLCP = new Gauge({\n  name: 'web_vitals_lcp_seconds',\n  help: 'Largest Contentful Paint (LCP)',\n  labelNames: ['page'],\n  registers: [register],\n})\n\nexport const webVitalsFID = new Gauge({\n  name: 'web_vitals_fid_seconds',\n  help: 'First Input Delay (FID)',\n  labelNames: ['page'],\n  registers: [register],\n})\n\nexport const webVitalsCLS = new Gauge({\n  name: 'web_vitals_cls_score',\n  help: 'Cumulative Layout Shift (CLS)',\n  labelNames: ['page'],\n  registers: [register],\n})\n\nexport const webVitalsFCP = new Gauge({\n  name: 'web_vitals_fcp_seconds',\n  help: 'First Contentful Paint (FCP)',\n  labelNames: ['page'],\n  registers: [register],\n})\n\nexport const webVitalsTTFB = new Gauge({\n  name: 'web_vitals_ttfb_seconds',\n  help: 'Time to First Byte (TTFB)',\n  labelNames: ['page'],\n  registers: [register],\n})\n\n// Contador de page views\nexport const pageViews = new Counter({\n  name: 'page_views_total',\n  help: 'Total de visualizações de página',\n  labelNames: ['page', 'referrer'],\n  registers: [register],\n})\n\n// Gauge de usuários ativos\nexport const activeUsers = new Gauge({\n  name: 'active_users_current',\n  help: 'Número de usuários ativos atualmente',\n  registers: [register],\n})\n\n// GET /api/metrics - Endpoint para Prometheus\nexport async function GET() {\n  try {\n    const metrics = await register.metrics()\n    \n    return new NextResponse(metrics, {\n      headers: {\n        'Content-Type': register.contentType,\n      },\n    })\n  } catch (error) {\n    console.error('Error collecting metrics:', error)\n    return NextResponse.json(\n      { error: 'Failed to collect metrics' },\n      { status: 500 }\n    )\n  }\n}\n\n// POST /api/metrics - Endpoint para receber Web Vitals do cliente\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json()\n    const { name, value, page } = body\n\n    // Converter milissegundos para segundos (padrão Prometheus)\n    const valueInSeconds = value / 1000\n\n    switch (name) {\n      case 'LCP':\n        webVitalsLCP.set({ page }, valueInSeconds)\n        break\n      case 'FID':\n        webVitalsFID.set({ page }, valueInSeconds)\n        break\n      case 'CLS':\n        webVitalsCLS.set({ page }, value) // CLS já é um score, não tempo\n        break\n      case 'FCP':\n        webVitalsFCP.set({ page }, valueInSeconds)\n        break\n      case 'TTFB':\n        webVitalsTTFB.set({ page }, valueInSeconds)\n        break\n      default:\n        console.warn(`Unknown metric: ${name}`)\n    }\n\n    // Incrementar page view se for primeira métrica\n    if (name === 'TTFB') {\n      const referrer = request.headers.get('referer') || 'direct'\n      pageViews.inc({ page, referrer })\n    }\n\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error('Error processing metrics:', error)\n    return NextResponse.json(\n      { error: 'Failed to process metrics' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 334, "column": 0}, "map": {"version":3,"sources":["file:///Users/silvis/Documents/revolucao-cibernetica/frontend/src/proxy.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport type { NextRequest } from 'next/server'\nimport { httpRequestsTotal, httpRequestDuration } from './app/api/metrics/route'\n\nexport function proxy(request: NextRequest) {\n  const start = Date.now()\n  const { pathname, search } = request.nextUrl\n  const method = request.method\n  \n  // Criar resposta\n  const response = NextResponse.next()\n  \n  // Calcular duração após resposta\n  const duration = (Date.now() - start) / 1000 // converter para segundos\n  const status = response.status.toString()\n  \n  // Registrar métricas\n  try {\n    httpRequestsTotal.inc({\n      method,\n      route: pathname,\n      status_code: status,\n    })\n    \n    httpRequestDuration.observe(\n      {\n        method,\n        route: pathname,\n        status_code: status,\n      },\n      duration\n    )\n  } catch (error) {\n    console.error('Error recording metrics in proxy:', error)\n  }\n  \n  return response\n}\n\n// Configurar rotas que o proxy deve processar\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except for the ones starting with:\n     * - api/metrics (avoid recursive metrics)\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     */\n    '/((?!api/metrics|_next/static|_next/image|favicon.ico).*)',\n  ],\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAEA;;;AAEO,SAAS,MAAM,OAAoB;IACxC,MAAM,QAAQ,KAAK,GAAG;IACtB,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,QAAQ,OAAO;IAC5C,MAAM,SAAS,QAAQ,MAAM;IAE7B,iBAAiB;IACjB,MAAM,WAAW,8IAAY,CAAC,IAAI;IAElC,iCAAiC;IACjC,MAAM,WAAW,CAAC,KAAK,GAAG,KAAK,KAAK,IAAI,KAAK,0BAA0B;;IACvE,MAAM,SAAS,SAAS,MAAM,CAAC,QAAQ;IAEvC,qBAAqB;IACrB,IAAI;QACF,0JAAiB,CAAC,GAAG,CAAC;YACpB;YACA,OAAO;YACP,aAAa;QACf;QAEA,4JAAmB,CAAC,OAAO,CACzB;YACE;YACA,OAAO;YACP,aAAa;QACf,GACA;IAEJ,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qCAAqC;IACrD;IAEA,OAAO;AACT;AAGO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH","debugId":null}}]
}